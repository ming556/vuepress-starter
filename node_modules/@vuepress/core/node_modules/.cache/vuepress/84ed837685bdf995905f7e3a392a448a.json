{"remainingRequest":"D:\\项目\\My_project\\vuepress-starter\\vuepress-starter\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!D:\\项目\\My_project\\vuepress-starter\\vuepress-starter\\node_modules\\gitalk\\dist\\gitalk.js","dependencies":[{"path":"D:\\项目\\My_project\\vuepress-starter\\vuepress-starter\\node_modules\\gitalk\\dist\\gitalk.js","mtime":1591948918348},{"path":"D:\\项目\\My_project\\vuepress-starter\\vuepress-starter\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1591862511060},{"path":"D:\\项目\\My_project\\vuepress-starter\\vuepress-starter\\node_modules\\babel-loader\\lib\\index.js","mtime":1591862511204}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5pdGVyYXRvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmV2ZXJ5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZyb20iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmlzLWFycmF5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJlZHVjZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJldmVyc2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvcnQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS1idWZmZXIuY29uc3RydWN0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS1idWZmZXIuaXMtdmlldyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LWJ1ZmZlci5zbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmRhdGUubm93Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1pc28tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1qc29uIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5iaW5kIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm1hcCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3RvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5jcmVhdGUiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnRpZXMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnR5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LW5hbWVzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1wcm90b3R5cGUtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuaXMtZXh0ZW5zaWJsZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnByZXZlbnQtZXh0ZW5zaW9ucyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5zZXQtcHJvdG90eXBlLW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnBhcnNlLWZsb2F0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucGFyc2UtaW50Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc2VhcmNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS51aW50OC1jbGFtcGVkLWFycmF5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuY29weS13aXRoaW4iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5ldmVyeSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbGwiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maWx0ZXIiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmluZC1pbmRleCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaW5jbHVkZXMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lml0ZXJhdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuam9pbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lmxhc3QtaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5tYXAiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZWR1Y2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZWR1Y2UtcmlnaHQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZXZlcnNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2V0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2xpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zb21lIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc29ydCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnN1YmFycmF5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudG8tbG9jYWxlLXN0cmluZyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnRvLXN0cmluZyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmltbWVkaWF0ZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi50aW1lcnMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIudXJsIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC50by1qc29uIik7Cgp2YXIgX3R5cGVvZjQgPSByZXF1aXJlKCJEOi9cdTk4NzlcdTc2RUUvTXlfcHJvamVjdC92dWVwcmVzcy1zdGFydGVyL3Z1ZXByZXNzLXN0YXJ0ZXIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mIik7CgooZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkgewogIGlmICgodHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mNChleHBvcnRzKSkgPT09ICdvYmplY3QnICYmICh0eXBlb2YgbW9kdWxlID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZjQobW9kdWxlKSkgPT09ICdvYmplY3QnKSBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIGRlZmluZShbXSwgZmFjdG9yeSk7ZWxzZSBpZiAoKHR5cGVvZiBleHBvcnRzID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZjQoZXhwb3J0cykpID09PSAnb2JqZWN0JykgZXhwb3J0c1siR2l0YWxrIl0gPSBmYWN0b3J5KCk7ZWxzZSByb290WyJHaXRhbGsiXSA9IGZhY3RvcnkoKTsKfSkodGhpcywgZnVuY3Rpb24gKCkgewogIHJldHVybiAoCiAgICAvKioqKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZXMpIHsKICAgICAgLy8gd2VicGFja0Jvb3RzdHJhcAoKICAgICAgLyoqKioqKi8KICAgICAgLy8gVGhlIG1vZHVsZSBjYWNoZQoKICAgICAgLyoqKioqKi8KICAgICAgdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsKICAgICAgLyoqKioqKi8KCiAgICAgIC8qKioqKiovCiAgICAgIC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uCgogICAgICAvKioqKioqLwoKICAgICAgZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewogICAgICAgIC8qKioqKiovCgogICAgICAgIC8qKioqKiovCiAgICAgICAgLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCgogICAgICAgIC8qKioqKiovCiAgICAgICAgaWYgKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7CiAgICAgICAgICAvKioqKioqLwogICAgICAgICAgcmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7CiAgICAgICAgICAvKioqKioqLwogICAgICAgIH0KICAgICAgICAvKioqKioqLwogICAgICAgIC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCgogICAgICAgIC8qKioqKiovCgoKICAgICAgICB2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7CiAgICAgICAgICAvKioqKioqLwogICAgICAgICAgaTogbW9kdWxlSWQsCgogICAgICAgICAgLyoqKioqKi8KICAgICAgICAgIGw6IGZhbHNlLAoKICAgICAgICAgIC8qKioqKiovCiAgICAgICAgICBleHBvcnRzOiB7fQogICAgICAgICAgLyoqKioqKi8KCiAgICAgICAgfTsKICAgICAgICAvKioqKioqLwoKICAgICAgICAvKioqKioqLwogICAgICAgIC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvbgoKICAgICAgICAvKioqKioqLwoKICAgICAgICBtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsKICAgICAgICAvKioqKioqLwoKICAgICAgICAvKioqKioqLwogICAgICAgIC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWQKCiAgICAgICAgLyoqKioqKi8KCiAgICAgICAgbW9kdWxlLmwgPSB0cnVlOwogICAgICAgIC8qKioqKiovCgogICAgICAgIC8qKioqKiovCiAgICAgICAgLy8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGUKCiAgICAgICAgLyoqKioqKi8KCiAgICAgICAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwogICAgICAgIC8qKioqKiovCiAgICAgIH0KICAgICAgLyoqKioqKi8KCiAgICAgIC8qKioqKiovCgogICAgICAvKioqKioqLwogICAgICAvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKQoKICAgICAgLyoqKioqKi8KCgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOwogICAgICAvKioqKioqLwoKICAgICAgLyoqKioqKi8KICAgICAgLy8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGUKCiAgICAgIC8qKioqKiovCgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzOwogICAgICAvKioqKioqLwoKICAgICAgLyoqKioqKi8KICAgICAgLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzCgogICAgICAvKioqKioqLwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24gKGV4cG9ydHMsIG5hbWUsIGdldHRlcikgewogICAgICAgIC8qKioqKiovCiAgICAgICAgaWYgKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHsKICAgICAgICAgIC8qKioqKiovCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgewogICAgICAgICAgICAvKioqKioqLwogICAgICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlLAoKICAgICAgICAgICAgLyoqKioqKi8KICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKCiAgICAgICAgICAgIC8qKioqKiovCiAgICAgICAgICAgIGdldDogZ2V0dGVyCiAgICAgICAgICAgIC8qKioqKiovCgogICAgICAgICAgfSk7CiAgICAgICAgICAvKioqKioqLwogICAgICAgIH0KICAgICAgICAvKioqKioqLwoKICAgICAgfTsKICAgICAgLyoqKioqKi8KCiAgICAgIC8qKioqKiovCiAgICAgIC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzCgogICAgICAvKioqKioqLwoKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uIChtb2R1bGUpIHsKICAgICAgICAvKioqKioqLwogICAgICAgIHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgPwogICAgICAgIC8qKioqKiovCiAgICAgICAgZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsKICAgICAgICAgIHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsKICAgICAgICB9IDoKICAgICAgICAvKioqKioqLwogICAgICAgIGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7CiAgICAgICAgICByZXR1cm4gbW9kdWxlOwogICAgICAgIH07CiAgICAgICAgLyoqKioqKi8KCiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpOwogICAgICAgIC8qKioqKiovCgoKICAgICAgICByZXR1cm4gZ2V0dGVyOwogICAgICAgIC8qKioqKiovCiAgICAgIH07CiAgICAgIC8qKioqKiovCgogICAgICAvKioqKioqLwogICAgICAvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwKCiAgICAgIC8qKioqKiovCgoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24gKG9iamVjdCwgcHJvcGVydHkpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOwogICAgICB9OwogICAgICAvKioqKioqLwoKICAgICAgLyoqKioqKi8KICAgICAgLy8gX193ZWJwYWNrX3B1YmxpY19wYXRoX18KCiAgICAgIC8qKioqKiovCgoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gIi9kaXN0IjsKICAgICAgLyoqKioqKi8KCiAgICAgIC8qKioqKiovCiAgICAgIC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0cwoKICAgICAgLyoqKioqKi8KCiAgICAgIHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDgyKTsKICAgICAgLyoqKioqKi8KICAgIH0oCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgIC8qKioqKiovCiAgICBbCiAgICAvKiAwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgdmFyIGNvcmUgPSBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICB2ZXJzaW9uOiAnMi42LjExJwogICAgICB9OwogICAgICBpZiAodHlwZW9mIF9fZSA9PSAnbnVtYmVyJykgX19lID0gY29yZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZgoKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvaXNzdWVzLzg2I2lzc3VlY29tbWVudC0xMTU3NTkwMjgKICAgICAgdmFyIGdsb2JhbCA9IG1vZHVsZS5leHBvcnRzID0gdHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoID8gd2luZG93IDogdHlwZW9mIHNlbGYgIT0gJ3VuZGVmaW5lZCcgJiYgc2VsZi5NYXRoID09IE1hdGggPyBzZWxmIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuYwogICAgICA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7CiAgICAgIGlmICh0eXBlb2YgX19nID09ICdudW1iZXInKSBfX2cgPSBnbG9iYWw7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWYKCiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBzdG9yZSA9IF9fd2VicGFja19yZXF1aXJlX18oMzkpKCd3a3MnKTsKCiAgICAgIHZhciB1aWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI1KTsKCiAgICAgIHZhciBfU3ltYm9sID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKS5TeW1ib2w7CgogICAgICB2YXIgVVNFX1NZTUJPTCA9IHR5cGVvZiBfU3ltYm9sID09ICdmdW5jdGlvbic7CgogICAgICB2YXIgJGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgcmV0dXJuIHN0b3JlW25hbWVdIHx8IChzdG9yZVtuYW1lXSA9IFVTRV9TWU1CT0wgJiYgX1N5bWJvbFtuYW1lXSB8fCAoVVNFX1NZTUJPTCA/IF9TeW1ib2wgOiB1aWQpKCdTeW1ib2wuJyArIG5hbWUpKTsKICAgICAgfTsKCiAgICAgICRleHBvcnRzLnN0b3JlID0gc3RvcmU7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciBiaW5kID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3Mik7CiAgICAgIC8qZ2xvYmFsIHRvU3RyaW5nOnRydWUqLwogICAgICAvLyB1dGlscyBpcyBhIGxpYnJhcnkgb2YgZ2VuZXJpYyBoZWxwZXIgZnVuY3Rpb25zIG5vbi1zcGVjaWZpYyB0byBheGlvcwoKCiAgICAgIHZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhbiBBcnJheQogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsIFRoZSB2YWx1ZSB0byB0ZXN0CiAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHZhbHVlIGlzIGFuIEFycmF5LCBvdGhlcndpc2UgZmFsc2UKICAgICAgICovCgogICAgICBmdW5jdGlvbiBpc0FycmF5KHZhbCkgewogICAgICAgIHJldHVybiB0b1N0cmluZy5jYWxsKHZhbCkgPT09ICdbb2JqZWN0IEFycmF5XSc7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIERldGVybWluZSBpZiBhIHZhbHVlIGlzIHVuZGVmaW5lZAogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsIFRoZSB2YWx1ZSB0byB0ZXN0CiAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHRoZSB2YWx1ZSBpcyB1bmRlZmluZWQsIG90aGVyd2lzZSBmYWxzZQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBpc1VuZGVmaW5lZCh2YWwpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ3VuZGVmaW5lZCc7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIERldGVybWluZSBpZiBhIHZhbHVlIGlzIGEgQnVmZmVyCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2YWwgVGhlIHZhbHVlIHRvIHRlc3QKICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdmFsdWUgaXMgYSBCdWZmZXIsIG90aGVyd2lzZSBmYWxzZQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBpc0J1ZmZlcih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9PSBudWxsICYmICFpc1VuZGVmaW5lZCh2YWwpICYmIHZhbC5jb25zdHJ1Y3RvciAhPT0gbnVsbCAmJiAhaXNVbmRlZmluZWQodmFsLmNvbnN0cnVjdG9yKSAmJiB0eXBlb2YgdmFsLmNvbnN0cnVjdG9yLmlzQnVmZmVyID09PSAnZnVuY3Rpb24nICYmIHZhbC5jb25zdHJ1Y3Rvci5pc0J1ZmZlcih2YWwpOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhbiBBcnJheUJ1ZmZlcgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsIFRoZSB2YWx1ZSB0byB0ZXN0CiAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHZhbHVlIGlzIGFuIEFycmF5QnVmZmVyLCBvdGhlcndpc2UgZmFsc2UKICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gaXNBcnJheUJ1ZmZlcih2YWwpIHsKICAgICAgICByZXR1cm4gdG9TdHJpbmcuY2FsbCh2YWwpID09PSAnW29iamVjdCBBcnJheUJ1ZmZlcl0nOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhIEZvcm1EYXRhCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2YWwgVGhlIHZhbHVlIHRvIHRlc3QKICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdmFsdWUgaXMgYW4gRm9ybURhdGEsIG90aGVyd2lzZSBmYWxzZQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBpc0Zvcm1EYXRhKHZhbCkgewogICAgICAgIHJldHVybiB0eXBlb2YgRm9ybURhdGEgIT09ICd1bmRlZmluZWQnICYmIHZhbCBpbnN0YW5jZW9mIEZvcm1EYXRhOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhIHZpZXcgb24gYW4gQXJyYXlCdWZmZXIKICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R9IHZhbCBUaGUgdmFsdWUgdG8gdGVzdAogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB2YWx1ZSBpcyBhIHZpZXcgb24gYW4gQXJyYXlCdWZmZXIsIG90aGVyd2lzZSBmYWxzZQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBpc0FycmF5QnVmZmVyVmlldyh2YWwpIHsKICAgICAgICB2YXIgcmVzdWx0OwoKICAgICAgICBpZiAodHlwZW9mIEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJiBBcnJheUJ1ZmZlci5pc1ZpZXcpIHsKICAgICAgICAgIHJlc3VsdCA9IEFycmF5QnVmZmVyLmlzVmlldyh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQgPSB2YWwgJiYgdmFsLmJ1ZmZlciAmJiB2YWwuYnVmZmVyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhIFN0cmluZwogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsIFRoZSB2YWx1ZSB0byB0ZXN0CiAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHZhbHVlIGlzIGEgU3RyaW5nLCBvdGhlcndpc2UgZmFsc2UKICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gaXNTdHJpbmcodmFsKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhIE51bWJlcgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsIFRoZSB2YWx1ZSB0byB0ZXN0CiAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHZhbHVlIGlzIGEgTnVtYmVyLCBvdGhlcndpc2UgZmFsc2UKICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gaXNOdW1iZXIodmFsKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdudW1iZXInOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhbiBPYmplY3QKICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R9IHZhbCBUaGUgdmFsdWUgdG8gdGVzdAogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB2YWx1ZSBpcyBhbiBPYmplY3QsIG90aGVyd2lzZSBmYWxzZQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBpc09iamVjdCh2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9PSBudWxsICYmIF90eXBlb2Y0KHZhbCkgPT09ICdvYmplY3QnOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhIERhdGUKICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R9IHZhbCBUaGUgdmFsdWUgdG8gdGVzdAogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB2YWx1ZSBpcyBhIERhdGUsIG90aGVyd2lzZSBmYWxzZQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBpc0RhdGUodmFsKSB7CiAgICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwodmFsKSA9PT0gJ1tvYmplY3QgRGF0ZV0nOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhIEZpbGUKICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R9IHZhbCBUaGUgdmFsdWUgdG8gdGVzdAogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB2YWx1ZSBpcyBhIEZpbGUsIG90aGVyd2lzZSBmYWxzZQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBpc0ZpbGUodmFsKSB7CiAgICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwodmFsKSA9PT0gJ1tvYmplY3QgRmlsZV0nOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhIEJsb2IKICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R9IHZhbCBUaGUgdmFsdWUgdG8gdGVzdAogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB2YWx1ZSBpcyBhIEJsb2IsIG90aGVyd2lzZSBmYWxzZQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBpc0Jsb2IodmFsKSB7CiAgICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwodmFsKSA9PT0gJ1tvYmplY3QgQmxvYl0nOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhIEZ1bmN0aW9uCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2YWwgVGhlIHZhbHVlIHRvIHRlc3QKICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdmFsdWUgaXMgYSBGdW5jdGlvbiwgb3RoZXJ3aXNlIGZhbHNlCiAgICAgICAqLwoKCiAgICAgIGZ1bmN0aW9uIGlzRnVuY3Rpb24odmFsKSB7CiAgICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwodmFsKSA9PT0gJ1tvYmplY3QgRnVuY3Rpb25dJzsKICAgICAgfQogICAgICAvKioKICAgICAgICogRGV0ZXJtaW5lIGlmIGEgdmFsdWUgaXMgYSBTdHJlYW0KICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R9IHZhbCBUaGUgdmFsdWUgdG8gdGVzdAogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB2YWx1ZSBpcyBhIFN0cmVhbSwgb3RoZXJ3aXNlIGZhbHNlCiAgICAgICAqLwoKCiAgICAgIGZ1bmN0aW9uIGlzU3RyZWFtKHZhbCkgewogICAgICAgIHJldHVybiBpc09iamVjdCh2YWwpICYmIGlzRnVuY3Rpb24odmFsLnBpcGUpOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgYSB2YWx1ZSBpcyBhIFVSTFNlYXJjaFBhcmFtcyBvYmplY3QKICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R9IHZhbCBUaGUgdmFsdWUgdG8gdGVzdAogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB2YWx1ZSBpcyBhIFVSTFNlYXJjaFBhcmFtcyBvYmplY3QsIG90aGVyd2lzZSBmYWxzZQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBpc1VSTFNlYXJjaFBhcmFtcyh2YWwpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIFVSTFNlYXJjaFBhcmFtcyAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsIGluc3RhbmNlb2YgVVJMU2VhcmNoUGFyYW1zOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBUcmltIGV4Y2VzcyB3aGl0ZXNwYWNlIG9mZiB0aGUgYmVnaW5uaW5nIGFuZCBlbmQgb2YgYSBzdHJpbmcKICAgICAgICoKICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHN0ciBUaGUgU3RyaW5nIHRvIHRyaW0KICAgICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIFN0cmluZyBmcmVlZCBvZiBleGNlc3Mgd2hpdGVzcGFjZQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiB0cmltKHN0cikgewogICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvXlxzKi8sICcnKS5yZXBsYWNlKC9ccyokLywgJycpOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgd2UncmUgcnVubmluZyBpbiBhIHN0YW5kYXJkIGJyb3dzZXIgZW52aXJvbm1lbnQKICAgICAgICoKICAgICAgICogVGhpcyBhbGxvd3MgYXhpb3MgdG8gcnVuIGluIGEgd2ViIHdvcmtlciwgYW5kIHJlYWN0LW5hdGl2ZS4KICAgICAgICogQm90aCBlbnZpcm9ubWVudHMgc3VwcG9ydCBYTUxIdHRwUmVxdWVzdCwgYnV0IG5vdCBmdWxseSBzdGFuZGFyZCBnbG9iYWxzLgogICAgICAgKgogICAgICAgKiB3ZWIgd29ya2VyczoKICAgICAgICogIHR5cGVvZiB3aW5kb3cgLT4gdW5kZWZpbmVkCiAgICAgICAqICB0eXBlb2YgZG9jdW1lbnQgLT4gdW5kZWZpbmVkCiAgICAgICAqCiAgICAgICAqIHJlYWN0LW5hdGl2ZToKICAgICAgICogIG5hdmlnYXRvci5wcm9kdWN0IC0+ICdSZWFjdE5hdGl2ZScKICAgICAgICogbmF0aXZlc2NyaXB0CiAgICAgICAqICBuYXZpZ2F0b3IucHJvZHVjdCAtPiAnTmF0aXZlU2NyaXB0JyBvciAnTlMnCiAgICAgICAqLwoKCiAgICAgIGZ1bmN0aW9uIGlzU3RhbmRhcmRCcm93c2VyRW52KCkgewogICAgICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiAobmF2aWdhdG9yLnByb2R1Y3QgPT09ICdSZWFjdE5hdGl2ZScgfHwgbmF2aWdhdG9yLnByb2R1Y3QgPT09ICdOYXRpdmVTY3JpcHQnIHx8IG5hdmlnYXRvci5wcm9kdWN0ID09PSAnTlMnKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCc7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIEl0ZXJhdGUgb3ZlciBhbiBBcnJheSBvciBhbiBPYmplY3QgaW52b2tpbmcgYSBmdW5jdGlvbiBmb3IgZWFjaCBpdGVtLgogICAgICAgKgogICAgICAgKiBJZiBgb2JqYCBpcyBhbiBBcnJheSBjYWxsYmFjayB3aWxsIGJlIGNhbGxlZCBwYXNzaW5nCiAgICAgICAqIHRoZSB2YWx1ZSwgaW5kZXgsIGFuZCBjb21wbGV0ZSBhcnJheSBmb3IgZWFjaCBpdGVtLgogICAgICAgKgogICAgICAgKiBJZiAnb2JqJyBpcyBhbiBPYmplY3QgY2FsbGJhY2sgd2lsbCBiZSBjYWxsZWQgcGFzc2luZwogICAgICAgKiB0aGUgdmFsdWUsIGtleSwgYW5kIGNvbXBsZXRlIG9iamVjdCBmb3IgZWFjaCBwcm9wZXJ0eS4KICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R8QXJyYXl9IG9iaiBUaGUgb2JqZWN0IHRvIGl0ZXJhdGUKICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGNhbGxiYWNrIHRvIGludm9rZSBmb3IgZWFjaCBpdGVtCiAgICAgICAqLwoKCiAgICAgIGZ1bmN0aW9uIGZvckVhY2gob2JqLCBmbikgewogICAgICAgIC8vIERvbid0IGJvdGhlciBpZiBubyB2YWx1ZSBwcm92aWRlZAogICAgICAgIGlmIChvYmogPT09IG51bGwgfHwgdHlwZW9mIG9iaiA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIEZvcmNlIGFuIGFycmF5IGlmIG5vdCBhbHJlYWR5IHNvbWV0aGluZyBpdGVyYWJsZQoKCiAgICAgICAgaWYgKF90eXBlb2Y0KG9iaikgIT09ICdvYmplY3QnKSB7CiAgICAgICAgICAvKmVzbGludCBuby1wYXJhbS1yZWFzc2lnbjowKi8KICAgICAgICAgIG9iaiA9IFtvYmpdOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzQXJyYXkob2JqKSkgewogICAgICAgICAgLy8gSXRlcmF0ZSBvdmVyIGFycmF5IHZhbHVlcwogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBvYmoubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIGZuLmNhbGwobnVsbCwgb2JqW2ldLCBpLCBvYmopOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBJdGVyYXRlIG92ZXIgb2JqZWN0IGtleXMKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgICAgICBmbi5jYWxsKG51bGwsIG9ialtrZXldLCBrZXksIG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIEFjY2VwdHMgdmFyYXJncyBleHBlY3RpbmcgZWFjaCBhcmd1bWVudCB0byBiZSBhbiBvYmplY3QsIHRoZW4KICAgICAgICogaW1tdXRhYmx5IG1lcmdlcyB0aGUgcHJvcGVydGllcyBvZiBlYWNoIG9iamVjdCBhbmQgcmV0dXJucyByZXN1bHQuCiAgICAgICAqCiAgICAgICAqIFdoZW4gbXVsdGlwbGUgb2JqZWN0cyBjb250YWluIHRoZSBzYW1lIGtleSB0aGUgbGF0ZXIgb2JqZWN0IGluCiAgICAgICAqIHRoZSBhcmd1bWVudHMgbGlzdCB3aWxsIHRha2UgcHJlY2VkZW5jZS4KICAgICAgICoKICAgICAgICogRXhhbXBsZToKICAgICAgICoKICAgICAgICogYGBganMKICAgICAgICogdmFyIHJlc3VsdCA9IG1lcmdlKHtmb286IDEyM30sIHtmb286IDQ1Nn0pOwogICAgICAgKiBjb25zb2xlLmxvZyhyZXN1bHQuZm9vKTsgLy8gb3V0cHV0cyA0NTYKICAgICAgICogYGBgCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmoxIE9iamVjdCB0byBtZXJnZQogICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXN1bHQgb2YgYWxsIG1lcmdlIHByb3BlcnRpZXMKICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gbWVyZ2UoKQogICAgICAvKiBvYmoxLCBvYmoyLCBvYmozLCAuLi4gKi8KICAgICAgewogICAgICAgIHZhciByZXN1bHQgPSB7fTsKCiAgICAgICAgZnVuY3Rpb24gYXNzaWduVmFsdWUodmFsLCBrZXkpIHsKICAgICAgICAgIGlmIChfdHlwZW9mNChyZXN1bHRba2V5XSkgPT09ICdvYmplY3QnICYmIF90eXBlb2Y0KHZhbCkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gbWVyZ2UocmVzdWx0W2tleV0sIHZhbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgZm9yRWFjaChhcmd1bWVudHNbaV0sIGFzc2lnblZhbHVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIEZ1bmN0aW9uIGVxdWFsIHRvIG1lcmdlIHdpdGggdGhlIGRpZmZlcmVuY2UgYmVpbmcgdGhhdCBubyByZWZlcmVuY2UKICAgICAgICogdG8gb3JpZ2luYWwgb2JqZWN0cyBpcyBrZXB0LgogICAgICAgKgogICAgICAgKiBAc2VlIG1lcmdlCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmoxIE9iamVjdCB0byBtZXJnZQogICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXN1bHQgb2YgYWxsIG1lcmdlIHByb3BlcnRpZXMKICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gZGVlcE1lcmdlKCkKICAgICAgLyogb2JqMSwgb2JqMiwgb2JqMywgLi4uICovCiAgICAgIHsKICAgICAgICB2YXIgcmVzdWx0ID0ge307CgogICAgICAgIGZ1bmN0aW9uIGFzc2lnblZhbHVlKHZhbCwga2V5KSB7CiAgICAgICAgICBpZiAoX3R5cGVvZjQocmVzdWx0W2tleV0pID09PSAnb2JqZWN0JyAmJiBfdHlwZW9mNCh2YWwpID09PSAnb2JqZWN0JykgewogICAgICAgICAgICByZXN1bHRba2V5XSA9IGRlZXBNZXJnZShyZXN1bHRba2V5XSwgdmFsKTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3R5cGVvZjQodmFsKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBkZWVwTWVyZ2Uoe30sIHZhbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgZm9yRWFjaChhcmd1bWVudHNbaV0sIGFzc2lnblZhbHVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIEV4dGVuZHMgb2JqZWN0IGEgYnkgbXV0YWJseSBhZGRpbmcgdG8gaXQgdGhlIHByb3BlcnRpZXMgb2Ygb2JqZWN0IGIuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBhIFRoZSBvYmplY3QgdG8gYmUgZXh0ZW5kZWQKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGIgVGhlIG9iamVjdCB0byBjb3B5IHByb3BlcnRpZXMgZnJvbQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gdGhpc0FyZyBUaGUgb2JqZWN0IHRvIGJpbmQgZnVuY3Rpb24gdG8KICAgICAgICogQHJldHVybiB7T2JqZWN0fSBUaGUgcmVzdWx0aW5nIHZhbHVlIG9mIG9iamVjdCBhCiAgICAgICAqLwoKCiAgICAgIGZ1bmN0aW9uIGV4dGVuZChhLCBiLCB0aGlzQXJnKSB7CiAgICAgICAgZm9yRWFjaChiLCBmdW5jdGlvbiBhc3NpZ25WYWx1ZSh2YWwsIGtleSkgewogICAgICAgICAgaWYgKHRoaXNBcmcgJiYgdHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBhW2tleV0gPSBiaW5kKHZhbCwgdGhpc0FyZyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhW2tleV0gPSB2YWw7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGE7CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgIGlzQXJyYXk6IGlzQXJyYXksCiAgICAgICAgaXNBcnJheUJ1ZmZlcjogaXNBcnJheUJ1ZmZlciwKICAgICAgICBpc0J1ZmZlcjogaXNCdWZmZXIsCiAgICAgICAgaXNGb3JtRGF0YTogaXNGb3JtRGF0YSwKICAgICAgICBpc0FycmF5QnVmZmVyVmlldzogaXNBcnJheUJ1ZmZlclZpZXcsCiAgICAgICAgaXNTdHJpbmc6IGlzU3RyaW5nLAogICAgICAgIGlzTnVtYmVyOiBpc051bWJlciwKICAgICAgICBpc09iamVjdDogaXNPYmplY3QsCiAgICAgICAgaXNVbmRlZmluZWQ6IGlzVW5kZWZpbmVkLAogICAgICAgIGlzRGF0ZTogaXNEYXRlLAogICAgICAgIGlzRmlsZTogaXNGaWxlLAogICAgICAgIGlzQmxvYjogaXNCbG9iLAogICAgICAgIGlzRnVuY3Rpb246IGlzRnVuY3Rpb24sCiAgICAgICAgaXNTdHJlYW06IGlzU3RyZWFtLAogICAgICAgIGlzVVJMU2VhcmNoUGFyYW1zOiBpc1VSTFNlYXJjaFBhcmFtcywKICAgICAgICBpc1N0YW5kYXJkQnJvd3NlckVudjogaXNTdGFuZGFyZEJyb3dzZXJFbnYsCiAgICAgICAgZm9yRWFjaDogZm9yRWFjaCwKICAgICAgICBtZXJnZTogbWVyZ2UsCiAgICAgICAgZGVlcE1lcmdlOiBkZWVwTWVyZ2UsCiAgICAgICAgZXh0ZW5kOiBleHRlbmQsCiAgICAgICAgdHJpbTogdHJpbQogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgICAgIHZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTsKCiAgICAgIHZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKTsKCiAgICAgIHZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMSk7CgogICAgICB2YXIgaGFzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMik7CgogICAgICB2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7CgogICAgICB2YXIgJGV4cG9ydCA9IGZ1bmN0aW9uICRleHBvcnQodHlwZSwgbmFtZSwgc291cmNlKSB7CiAgICAgICAgdmFyIElTX0ZPUkNFRCA9IHR5cGUgJiAkZXhwb3J0LkY7CiAgICAgICAgdmFyIElTX0dMT0JBTCA9IHR5cGUgJiAkZXhwb3J0Lkc7CiAgICAgICAgdmFyIElTX1NUQVRJQyA9IHR5cGUgJiAkZXhwb3J0LlM7CiAgICAgICAgdmFyIElTX1BST1RPID0gdHlwZSAmICRleHBvcnQuUDsKICAgICAgICB2YXIgSVNfQklORCA9IHR5cGUgJiAkZXhwb3J0LkI7CiAgICAgICAgdmFyIElTX1dSQVAgPSB0eXBlICYgJGV4cG9ydC5XOwogICAgICAgIHZhciBleHBvcnRzID0gSVNfR0xPQkFMID8gY29yZSA6IGNvcmVbbmFtZV0gfHwgKGNvcmVbbmFtZV0gPSB7fSk7CiAgICAgICAgdmFyIGV4cFByb3RvID0gZXhwb3J0c1tQUk9UT1RZUEVdOwogICAgICAgIHZhciB0YXJnZXQgPSBJU19HTE9CQUwgPyBnbG9iYWwgOiBJU19TVEFUSUMgPyBnbG9iYWxbbmFtZV0gOiAoZ2xvYmFsW25hbWVdIHx8IHt9KVtQUk9UT1RZUEVdOwogICAgICAgIHZhciBrZXksIG93biwgb3V0OwogICAgICAgIGlmIChJU19HTE9CQUwpIHNvdXJjZSA9IG5hbWU7CgogICAgICAgIGZvciAoa2V5IGluIHNvdXJjZSkgewogICAgICAgICAgLy8gY29udGFpbnMgaW4gbmF0aXZlCiAgICAgICAgICBvd24gPSAhSVNfRk9SQ0VEICYmIHRhcmdldCAmJiB0YXJnZXRba2V5XSAhPT0gdW5kZWZpbmVkOwogICAgICAgICAgaWYgKG93biAmJiBoYXMoZXhwb3J0cywga2V5KSkgY29udGludWU7IC8vIGV4cG9ydCBuYXRpdmUgb3IgcGFzc2VkCgogICAgICAgICAgb3V0ID0gb3duID8gdGFyZ2V0W2tleV0gOiBzb3VyY2Vba2V5XTsgLy8gcHJldmVudCBnbG9iYWwgcG9sbHV0aW9uIGZvciBuYW1lc3BhY2VzCgogICAgICAgICAgZXhwb3J0c1trZXldID0gSVNfR0xPQkFMICYmIHR5cGVvZiB0YXJnZXRba2V5XSAhPSAnZnVuY3Rpb24nID8gc291cmNlW2tleV0gLy8gYmluZCB0aW1lcnMgdG8gZ2xvYmFsIGZvciBjYWxsIGZyb20gZXhwb3J0IGNvbnRleHQKICAgICAgICAgIDogSVNfQklORCAmJiBvd24gPyBjdHgob3V0LCBnbG9iYWwpIC8vIHdyYXAgZ2xvYmFsIGNvbnN0cnVjdG9ycyBmb3IgcHJldmVudCBjaGFuZ2UgdGhlbSBpbiBsaWJyYXJ5CiAgICAgICAgICA6IElTX1dSQVAgJiYgdGFyZ2V0W2tleV0gPT0gb3V0ID8gZnVuY3Rpb24gKEMpIHsKICAgICAgICAgICAgdmFyIEYgPSBmdW5jdGlvbiBGKGEsIGIsIGMpIHsKICAgICAgICAgICAgICBpZiAodGhpcyBpbnN0YW5jZW9mIEMpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDKCk7CgogICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDKGEpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQyhhLCBiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEMoYSwgYiwgYyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gQy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgRltQUk9UT1RZUEVdID0gQ1tQUk9UT1RZUEVdOwogICAgICAgICAgICByZXR1cm4gRjsgLy8gbWFrZSBzdGF0aWMgdmVyc2lvbnMgZm9yIHByb3RvdHlwZSBtZXRob2RzCiAgICAgICAgICB9KG91dCkgOiBJU19QUk9UTyAmJiB0eXBlb2Ygb3V0ID09ICdmdW5jdGlvbicgPyBjdHgoRnVuY3Rpb24uY2FsbCwgb3V0KSA6IG91dDsgLy8gZXhwb3J0IHByb3RvIG1ldGhvZHMgdG8gY29yZS4lQ09OU1RSVUNUT1IlLm1ldGhvZHMuJU5BTUUlCgogICAgICAgICAgaWYgKElTX1BST1RPKSB7CiAgICAgICAgICAgIChleHBvcnRzLnZpcnR1YWwgfHwgKGV4cG9ydHMudmlydHVhbCA9IHt9KSlba2V5XSA9IG91dDsgLy8gZXhwb3J0IHByb3RvIG1ldGhvZHMgdG8gY29yZS4lQ09OU1RSVUNUT1IlLnByb3RvdHlwZS4lTkFNRSUKCiAgICAgICAgICAgIGlmICh0eXBlICYgJGV4cG9ydC5SICYmIGV4cFByb3RvICYmICFleHBQcm90b1trZXldKSBoaWRlKGV4cFByb3RvLCBrZXksIG91dCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OyAvLyB0eXBlIGJpdG1hcAoKCiAgICAgICRleHBvcnQuRiA9IDE7IC8vIGZvcmNlZAoKICAgICAgJGV4cG9ydC5HID0gMjsgLy8gZ2xvYmFsCgogICAgICAkZXhwb3J0LlMgPSA0OyAvLyBzdGF0aWMKCiAgICAgICRleHBvcnQuUCA9IDg7IC8vIHByb3RvCgogICAgICAkZXhwb3J0LkIgPSAxNjsgLy8gYmluZAoKICAgICAgJGV4cG9ydC5XID0gMzI7IC8vIHdyYXAKCiAgICAgICRleHBvcnQuVSA9IDY0OyAvLyBzYWZlCgogICAgICAkZXhwb3J0LlIgPSAxMjg7IC8vIHJlYWwgcHJvdG8gbWV0aG9kIGZvciBgbGlicmFyeWAKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gJGV4cG9ydDsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA1ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF9fd2VicGFja19leHBvcnRzX18sICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwogICAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8KCiAgICAgIChmdW5jdGlvbiAocHJvY2VzcykgewogICAgICAgIC8qIGhhcm1vbnkgZXhwb3J0IChiaW5kaW5nKSAqLwogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAidmVyc2lvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB2ZXJzaW9uOwogICAgICAgIH0pOwogICAgICAgIC8qIGhhcm1vbnkgZXhwb3J0IChiaW5kaW5nKSAqLwoKCiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJET00iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gRE9NOwogICAgICAgIH0pOwogICAgICAgIC8qIGhhcm1vbnkgZXhwb3J0IChiaW5kaW5nKSAqLwoKCiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJDaGlsZHJlbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBDaGlsZHJlbjsKICAgICAgICB9KTsKICAgICAgICAvKiBoYXJtb255IGV4cG9ydCAoYmluZGluZykgKi8KCgogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAicmVuZGVyIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHJlbmRlciQxOwogICAgICAgIH0pOwogICAgICAgIC8qIGhhcm1vbnkgZXhwb3J0IChiaW5kaW5nKSAqLwoKCiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJjcmVhdGVDbGFzcyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBjcmVhdGVDbGFzczsKICAgICAgICB9KTsKICAgICAgICAvKiBoYXJtb255IGV4cG9ydCAoYmluZGluZykgKi8KCgogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiY3JlYXRlRmFjdG9yeSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBjcmVhdGVGYWN0b3J5OwogICAgICAgIH0pOwogICAgICAgIC8qIGhhcm1vbnkgZXhwb3J0IChiaW5kaW5nKSAqLwoKCiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJjcmVhdGVFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGNyZWF0ZUVsZW1lbnQ7CiAgICAgICAgfSk7CiAgICAgICAgLyogaGFybW9ueSBleHBvcnQgKGJpbmRpbmcpICovCgoKICAgICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgImNsb25lRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBjbG9uZUVsZW1lbnQkMTsKICAgICAgICB9KTsKICAgICAgICAvKiBoYXJtb255IGV4cG9ydCAoYmluZGluZykgKi8KCgogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiaXNWYWxpZEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gaXNWYWxpZEVsZW1lbnQ7CiAgICAgICAgfSk7CiAgICAgICAgLyogaGFybW9ueSBleHBvcnQgKGJpbmRpbmcpICovCgoKICAgICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgImZpbmRET01Ob2RlIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGZpbmRET01Ob2RlOwogICAgICAgIH0pOwogICAgICAgIC8qIGhhcm1vbnkgZXhwb3J0IChiaW5kaW5nKSAqLwoKCiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJ1bm1vdW50Q29tcG9uZW50QXROb2RlIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHVubW91bnRDb21wb25lbnRBdE5vZGU7CiAgICAgICAgfSk7CiAgICAgICAgLyogaGFybW9ueSBleHBvcnQgKGJpbmRpbmcpICovCgoKICAgICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgIkNvbXBvbmVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBDb21wb25lbnQkMTsKICAgICAgICB9KTsKICAgICAgICAvKiBoYXJtb255IGV4cG9ydCAoYmluZGluZykgKi8KCgogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiUHVyZUNvbXBvbmVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBQdXJlQ29tcG9uZW50OwogICAgICAgIH0pOwogICAgICAgIC8qIGhhcm1vbnkgZXhwb3J0IChiaW5kaW5nKSAqLwoKCiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJ1bnN0YWJsZV9yZW5kZXJTdWJ0cmVlSW50b0NvbnRhaW5lciIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiByZW5kZXJTdWJ0cmVlSW50b0NvbnRhaW5lcjsKICAgICAgICB9KTsKICAgICAgICAvKiBoYXJtb255IGltcG9ydCAqLwoKCiAgICAgICAgdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9wcm9wX3R5cGVzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg2KTsKICAgICAgICAvKiBoYXJtb255IGltcG9ydCAqLwoKCiAgICAgICAgdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9wcm9wX3R5cGVzX19fZGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18ubihfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfcHJvcF90eXBlc19fKTsKICAgICAgICAvKiBoYXJtb255IGltcG9ydCAqLwoKCiAgICAgICAgdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9wcmVhY3RfXyA9IF9fd2VicGFja19yZXF1aXJlX18oOTMpOwogICAgICAgIC8qIGhhcm1vbnkgaW1wb3J0ICovCgoKICAgICAgICB2YXIgX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX3ByZWFjdF9fX2RlZmF1bHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLm4oX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX3ByZWFjdF9fKTsKICAgICAgICAvKiBoYXJtb255IHJlZXhwb3J0IChkZWZhdWx0IGZyb20gbm9uLWhhbW9yeSkgKi8KCgogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiUHJvcFR5cGVzIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9wcm9wX3R5cGVzX19fZGVmYXVsdC5hOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgdmVyc2lvbiA9ICcxNS4xLjAnOyAvLyB0cmljayBsaWJyYXJpZXMgdG8gdGhpbmsgd2UgYXJlIHJlYWN0CgogICAgICAgIHZhciBFTEVNRU5UUyA9ICdhIGFiYnIgYWRkcmVzcyBhcmVhIGFydGljbGUgYXNpZGUgYXVkaW8gYiBiYXNlIGJkaSBiZG8gYmlnIGJsb2NrcXVvdGUgYm9keSBiciBidXR0b24gY2FudmFzIGNhcHRpb24gY2l0ZSBjb2RlIGNvbCBjb2xncm91cCBkYXRhIGRhdGFsaXN0IGRkIGRlbCBkZXRhaWxzIGRmbiBkaWFsb2cgZGl2IGRsIGR0IGVtIGVtYmVkIGZpZWxkc2V0IGZpZ2NhcHRpb24gZmlndXJlIGZvb3RlciBmb3JtIGgxIGgyIGgzIGg0IGg1IGg2IGhlYWQgaGVhZGVyIGhncm91cCBociBodG1sIGkgaWZyYW1lIGltZyBpbnB1dCBpbnMga2JkIGtleWdlbiBsYWJlbCBsZWdlbmQgbGkgbGluayBtYWluIG1hcCBtYXJrIG1lbnUgbWVudWl0ZW0gbWV0YSBtZXRlciBuYXYgbm9zY3JpcHQgb2JqZWN0IG9sIG9wdGdyb3VwIG9wdGlvbiBvdXRwdXQgcCBwYXJhbSBwaWN0dXJlIHByZSBwcm9ncmVzcyBxIHJwIHJ0IHJ1YnkgcyBzYW1wIHNjcmlwdCBzZWN0aW9uIHNlbGVjdCBzbWFsbCBzb3VyY2Ugc3BhbiBzdHJvbmcgc3R5bGUgc3ViIHN1bW1hcnkgc3VwIHRhYmxlIHRib2R5IHRkIHRleHRhcmVhIHRmb290IHRoIHRoZWFkIHRpbWUgdGl0bGUgdHIgdHJhY2sgdSB1bCB2YXIgdmlkZW8gd2JyIGNpcmNsZSBjbGlwUGF0aCBkZWZzIGVsbGlwc2UgZyBpbWFnZSBsaW5lIGxpbmVhckdyYWRpZW50IG1hc2sgcGF0aCBwYXR0ZXJuIHBvbHlnb24gcG9seWxpbmUgcmFkaWFsR3JhZGllbnQgcmVjdCBzdG9wIHN2ZyB0ZXh0IHRzcGFuJy5zcGxpdCgnICcpOwogICAgICAgIHZhciBSRUFDVF9FTEVNRU5UX1RZUEUgPSB0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2xbImZvciJdICYmIFN5bWJvbFsiZm9yIl0oJ3JlYWN0LmVsZW1lbnQnKSB8fCAweGVhYzc7CiAgICAgICAgdmFyIENPTVBPTkVOVF9XUkFQUEVSX0tFWSA9IHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnID8gU3ltYm9sWyJmb3IiXSgnX19wcmVhY3RDb21wYXRXcmFwcGVyJykgOiAnX19wcmVhY3RDb21wYXRXcmFwcGVyJzsgLy8gZG9uJ3QgYXV0b2JpbmQgdGhlc2UgbWV0aG9kcyBzaW5jZSB0aGV5IGFscmVhZHkgaGF2ZSBndWFyYW50ZWVkIGNvbnRleHQuCgogICAgICAgIHZhciBBVVRPQklORF9CTEFDS0xJU1QgPSB7CiAgICAgICAgICBjb25zdHJ1Y3RvcjogMSwKICAgICAgICAgIHJlbmRlcjogMSwKICAgICAgICAgIHNob3VsZENvbXBvbmVudFVwZGF0ZTogMSwKICAgICAgICAgIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHM6IDEsCiAgICAgICAgICBjb21wb25lbnRXaWxsVXBkYXRlOiAxLAogICAgICAgICAgY29tcG9uZW50RGlkVXBkYXRlOiAxLAogICAgICAgICAgY29tcG9uZW50V2lsbE1vdW50OiAxLAogICAgICAgICAgY29tcG9uZW50RGlkTW91bnQ6IDEsCiAgICAgICAgICBjb21wb25lbnRXaWxsVW5tb3VudDogMSwKICAgICAgICAgIGNvbXBvbmVudERpZFVubW91bnQ6IDEKICAgICAgICB9OwogICAgICAgIHZhciBDQU1FTF9QUk9QUyA9IC9eKD86YWNjZW50fGFsaWdubWVudHxhcmFiaWN8YmFzZWxpbmV8Y2FwfGNsaXB8Y29sb3J8ZmlsbHxmbG9vZHxmb250fGdseXBofGhvcml6fG1hcmtlcnxvdmVybGluZXxwYWludHxzdG9wfHN0cmlrZXRocm91Z2h8c3Ryb2tlfHRleHR8dW5kZXJsaW5lfHVuaWNvZGV8dW5pdHN8dnx2ZXJ0fHdvcmR8d3JpdGluZ3x4KVtBLVpdLzsKICAgICAgICB2YXIgQllQQVNTX0hPT0sgPSB7fTsKICAgICAgICAvKmdsb2JhbCBwcm9jZXNzKi8KCiAgICAgICAgdmFyIERFViA9IHR5cGVvZiBwcm9jZXNzID09PSAndW5kZWZpbmVkJyB8fCAhcHJvY2Vzcy5lbnYgfHwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJzsgLy8gYSBjb21wb25lbnQgdGhhdCByZW5kZXJzIG5vdGhpbmcuIFVzZWQgdG8gcmVwbGFjZSBjb21wb25lbnRzIGZvciB1bm1vdW50Q29tcG9uZW50QXROb2RlLgoKICAgICAgICBmdW5jdGlvbiBFbXB0eUNvbXBvbmVudCgpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0gLy8gbWFrZSByZWFjdCB0aGluayB3ZSdyZSByZWFjdC4KCgogICAgICAgIHZhciBWTm9kZSA9IF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9wcmVhY3RfX1siaCJdKCdhJywgbnVsbCkuY29uc3RydWN0b3I7CgogICAgICAgIFZOb2RlLnByb3RvdHlwZS4kJHR5cGVvZiA9IFJFQUNUX0VMRU1FTlRfVFlQRTsKICAgICAgICBWTm9kZS5wcm90b3R5cGUucHJlYWN0Q29tcGF0VXBncmFkZWQgPSBmYWxzZTsKICAgICAgICBWTm9kZS5wcm90b3R5cGUucHJlYWN0Q29tcGF0Tm9ybWFsaXplZCA9IGZhbHNlOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWTm9kZS5wcm90b3R5cGUsICd0eXBlJywgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5vZGVOYW1lOwogICAgICAgICAgfSwKICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHYpIHsKICAgICAgICAgICAgdGhpcy5ub2RlTmFtZSA9IHY7CiAgICAgICAgICB9LAogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZOb2RlLnByb3RvdHlwZSwgJ3Byb3BzJywgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXM7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodikgewogICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSB2OwogICAgICAgICAgfSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHZhciBvbGRFdmVudEhvb2sgPSBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfcHJlYWN0X19bIm9wdGlvbnMiXS5ldmVudDsKCiAgICAgICAgX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX3ByZWFjdF9fWyJvcHRpb25zIl0uZXZlbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKG9sZEV2ZW50SG9vaykgewogICAgICAgICAgICBlID0gb2xkRXZlbnRIb29rKGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGUucGVyc2lzdCA9IE9iamVjdDsKICAgICAgICAgIGUubmF0aXZlRXZlbnQgPSBlOwogICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIG9sZFZub2RlSG9vayA9IF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9wcmVhY3RfX1sib3B0aW9ucyJdLnZub2RlOwoKICAgICAgICBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfcHJlYWN0X19bIm9wdGlvbnMiXS52bm9kZSA9IGZ1bmN0aW9uICh2bm9kZSkgewogICAgICAgICAgaWYgKCF2bm9kZS5wcmVhY3RDb21wYXRVcGdyYWRlZCkgewogICAgICAgICAgICB2bm9kZS5wcmVhY3RDb21wYXRVcGdyYWRlZCA9IHRydWU7CiAgICAgICAgICAgIHZhciB0YWcgPSB2bm9kZS5ub2RlTmFtZSwKICAgICAgICAgICAgICAgIGF0dHJzID0gdm5vZGUuYXR0cmlidXRlcyA9IGV4dGVuZCh7fSwgdm5vZGUuYXR0cmlidXRlcyk7CgogICAgICAgICAgICBpZiAodHlwZW9mIHRhZyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgIGlmICh0YWdbQ09NUE9ORU5UX1dSQVBQRVJfS0VZXSA9PT0gdHJ1ZSB8fCB0YWcucHJvdG90eXBlICYmICdpc1JlYWN0Q29tcG9uZW50JyBpbiB0YWcucHJvdG90eXBlKSB7CiAgICAgICAgICAgICAgICBpZiAodm5vZGUuY2hpbGRyZW4gJiYgU3RyaW5nKHZub2RlLmNoaWxkcmVuKSA9PT0gJycpIHsKICAgICAgICAgICAgICAgICAgdm5vZGUuY2hpbGRyZW4gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHZub2RlLmNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICAgIGF0dHJzLmNoaWxkcmVuID0gdm5vZGUuY2hpbGRyZW47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCF2bm9kZS5wcmVhY3RDb21wYXROb3JtYWxpemVkKSB7CiAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZVZOb2RlKHZub2RlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBoYW5kbGVDb21wb25lbnRWTm9kZSh2bm9kZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmICh2bm9kZS5jaGlsZHJlbiAmJiBTdHJpbmcodm5vZGUuY2hpbGRyZW4pID09PSAnJykgewogICAgICAgICAgICAgICAgdm5vZGUuY2hpbGRyZW4gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodm5vZGUuY2hpbGRyZW4pIHsKICAgICAgICAgICAgICAgIGF0dHJzLmNoaWxkcmVuID0gdm5vZGUuY2hpbGRyZW47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoYXR0cnMuZGVmYXVsdFZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAoIWF0dHJzLnZhbHVlICYmIGF0dHJzLnZhbHVlICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgIGF0dHJzLnZhbHVlID0gYXR0cnMuZGVmYXVsdFZhbHVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGRlbGV0ZSBhdHRycy5kZWZhdWx0VmFsdWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBoYW5kbGVFbGVtZW50Vk5vZGUodm5vZGUsIGF0dHJzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChvbGRWbm9kZUhvb2spIHsKICAgICAgICAgICAgb2xkVm5vZGVIb29rKHZub2RlKTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBoYW5kbGVDb21wb25lbnRWTm9kZSh2bm9kZSkgewogICAgICAgICAgdmFyIHRhZyA9IHZub2RlLm5vZGVOYW1lLAogICAgICAgICAgICAgIGEgPSB2bm9kZS5hdHRyaWJ1dGVzOwogICAgICAgICAgdm5vZGUuYXR0cmlidXRlcyA9IHt9OwoKICAgICAgICAgIGlmICh0YWcuZGVmYXVsdFByb3BzKSB7CiAgICAgICAgICAgIGV4dGVuZCh2bm9kZS5hdHRyaWJ1dGVzLCB0YWcuZGVmYXVsdFByb3BzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoYSkgewogICAgICAgICAgICBleHRlbmQodm5vZGUuYXR0cmlidXRlcywgYSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBoYW5kbGVFbGVtZW50Vk5vZGUodm5vZGUsIGEpIHsKICAgICAgICAgIHZhciBzaG91bGRTYW5pdGl6ZSwgYXR0cnMsIGk7CgogICAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgZm9yIChpIGluIGEpIHsKICAgICAgICAgICAgICBpZiAoc2hvdWxkU2FuaXRpemUgPSBDQU1FTF9QUk9QUy50ZXN0KGkpKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzaG91bGRTYW5pdGl6ZSkgewogICAgICAgICAgICAgIGF0dHJzID0gdm5vZGUuYXR0cmlidXRlcyA9IHt9OwoKICAgICAgICAgICAgICBmb3IgKGkgaW4gYSkgewogICAgICAgICAgICAgICAgaWYgKGEuaGFzT3duUHJvcGVydHkoaSkpIHsKICAgICAgICAgICAgICAgICAgYXR0cnNbQ0FNRUxfUFJPUFMudGVzdChpKSA/IGkucmVwbGFjZSgvKFtBLVowLTldKS8sICctJDEnKS50b0xvd2VyQ2FzZSgpIDogaV0gPSBhW2ldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gLy8gcHJveHkgcmVuZGVyKCkgc2luY2UgUmVhY3QgcmV0dXJucyBhIENvbXBvbmVudCByZWZlcmVuY2UuCgoKICAgICAgICBmdW5jdGlvbiByZW5kZXIkMSh2bm9kZSwgcGFyZW50LCBjYWxsYmFjaykgewogICAgICAgICAgdmFyIHByZXYgPSBwYXJlbnQgJiYgcGFyZW50Ll9wcmVhY3RDb21wYXRSZW5kZXJlZCAmJiBwYXJlbnQuX3ByZWFjdENvbXBhdFJlbmRlcmVkLmJhc2U7IC8vIGlnbm9yZSBpbXBvc3NpYmxlIHByZXZpb3VzIHJlbmRlcnMKCiAgICAgICAgICBpZiAocHJldiAmJiBwcmV2LnBhcmVudE5vZGUgIT09IHBhcmVudCkgewogICAgICAgICAgICBwcmV2ID0gbnVsbDsKICAgICAgICAgIH0gLy8gZGVmYXVsdCB0byBmaXJzdCBFbGVtZW50IGNoaWxkCgoKICAgICAgICAgIGlmICghcHJldikgewogICAgICAgICAgICBwcmV2ID0gcGFyZW50LmNoaWxkcmVuWzBdOwogICAgICAgICAgfSAvLyByZW1vdmUgdW5hZmZlY3RlZCBzaWJsaW5ncwoKCiAgICAgICAgICBmb3IgKHZhciBpID0gcGFyZW50LmNoaWxkTm9kZXMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgIGlmIChwYXJlbnQuY2hpbGROb2Rlc1tpXSAhPT0gcHJldikgewogICAgICAgICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChwYXJlbnQuY2hpbGROb2Rlc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb3V0ID0gX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX3ByZWFjdF9fWyJyZW5kZXIiXSh2bm9kZSwgcGFyZW50LCBwcmV2KTsKCiAgICAgICAgICBpZiAocGFyZW50KSB7CiAgICAgICAgICAgIHBhcmVudC5fcHJlYWN0Q29tcGF0UmVuZGVyZWQgPSBvdXQgJiYgKG91dC5fY29tcG9uZW50IHx8IHsKICAgICAgICAgICAgICBiYXNlOiBvdXQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBvdXQgJiYgb3V0Ll9jb21wb25lbnQgfHwgb3V0OwogICAgICAgIH0KCiAgICAgICAgdmFyIENvbnRleHRQcm92aWRlciA9IGZ1bmN0aW9uIENvbnRleHRQcm92aWRlcigpIHt9OwoKICAgICAgICBDb250ZXh0UHJvdmlkZXIucHJvdG90eXBlLmdldENoaWxkQ29udGV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnByb3BzLmNvbnRleHQ7CiAgICAgICAgfTsKCiAgICAgICAgQ29udGV4dFByb3ZpZGVyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAocHJvcHMpIHsKICAgICAgICAgIHJldHVybiBwcm9wcy5jaGlsZHJlblswXTsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiByZW5kZXJTdWJ0cmVlSW50b0NvbnRhaW5lcihwYXJlbnRDb21wb25lbnQsIHZub2RlLCBjb250YWluZXIsIGNhbGxiYWNrKSB7CiAgICAgICAgICB2YXIgd3JhcCA9IF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9wcmVhY3RfX1siaCJdKENvbnRleHRQcm92aWRlciwgewogICAgICAgICAgICBjb250ZXh0OiBwYXJlbnRDb21wb25lbnQuY29udGV4dAogICAgICAgICAgfSwgdm5vZGUpOwoKICAgICAgICAgIHZhciBjID0gcmVuZGVyJDEod3JhcCwgY29udGFpbmVyKTsKCiAgICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgY2FsbGJhY2soYyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGMuX2NvbXBvbmVudCB8fCBjLmJhc2U7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB1bm1vdW50Q29tcG9uZW50QXROb2RlKGNvbnRhaW5lcikgewogICAgICAgICAgdmFyIGV4aXN0aW5nID0gY29udGFpbmVyLl9wcmVhY3RDb21wYXRSZW5kZXJlZCAmJiBjb250YWluZXIuX3ByZWFjdENvbXBhdFJlbmRlcmVkLmJhc2U7CgogICAgICAgICAgaWYgKGV4aXN0aW5nICYmIGV4aXN0aW5nLnBhcmVudE5vZGUgPT09IGNvbnRhaW5lcikgewogICAgICAgICAgICBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfcHJlYWN0X19bInJlbmRlciJdKF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9wcmVhY3RfX1siaCJdKEVtcHR5Q29tcG9uZW50KSwgY29udGFpbmVyLCBleGlzdGluZyk7CgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgQVJSID0gW107IC8vIFRoaXMgQVBJIGlzIGNvbXBsZXRlbHkgdW5uZWNlc3NhcnkgZm9yIFByZWFjdCwgc28gaXQncyBiYXNpY2FsbHkgcGFzc3Rocm91Z2guCgogICAgICAgIHZhciBDaGlsZHJlbiA9IHsKICAgICAgICAgIG1hcDogZnVuY3Rpb24gbWFwKGNoaWxkcmVuLCBmbiwgY3R4KSB7CiAgICAgICAgICAgIGlmIChjaGlsZHJlbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNoaWxkcmVuID0gQ2hpbGRyZW4udG9BcnJheShjaGlsZHJlbik7CgogICAgICAgICAgICBpZiAoY3R4ICYmIGN0eCAhPT0gY2hpbGRyZW4pIHsKICAgICAgICAgICAgICBmbiA9IGZuLmJpbmQoY3R4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNoaWxkcmVuLm1hcChmbik7CiAgICAgICAgICB9LAogICAgICAgICAgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChjaGlsZHJlbiwgZm4sIGN0eCkgewogICAgICAgICAgICBpZiAoY2hpbGRyZW4gPT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjaGlsZHJlbiA9IENoaWxkcmVuLnRvQXJyYXkoY2hpbGRyZW4pOwoKICAgICAgICAgICAgaWYgKGN0eCAmJiBjdHggIT09IGNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgZm4gPSBmbi5iaW5kKGN0eCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNoaWxkcmVuLmZvckVhY2goZm4pOwogICAgICAgICAgfSwKICAgICAgICAgIGNvdW50OiBmdW5jdGlvbiBjb3VudChjaGlsZHJlbikgewogICAgICAgICAgICByZXR1cm4gY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoIHx8IDA7CiAgICAgICAgICB9LAogICAgICAgICAgb25seTogZnVuY3Rpb24gb25seShjaGlsZHJlbikgewogICAgICAgICAgICBjaGlsZHJlbiA9IENoaWxkcmVuLnRvQXJyYXkoY2hpbGRyZW4pOwoKICAgICAgICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCAhPT0gMSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2hpbGRyZW4ub25seSgpIGV4cGVjdHMgb25seSBvbmUgY2hpbGQuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBjaGlsZHJlblswXTsKICAgICAgICAgIH0sCiAgICAgICAgICB0b0FycmF5OiBmdW5jdGlvbiB0b0FycmF5KGNoaWxkcmVuKSB7CiAgICAgICAgICAgIGlmIChjaGlsZHJlbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheSAmJiBBcnJheS5pc0FycmF5KGNoaWxkcmVuKSA/IGNoaWxkcmVuIDogQVJSLmNvbmNhdChjaGlsZHJlbik7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvKiogVHJhY2sgY3VycmVudCByZW5kZXIoKSBjb21wb25lbnQgZm9yIHJlZiBhc3NpZ25tZW50ICovCgogICAgICAgIHZhciBjdXJyZW50Q29tcG9uZW50OwoKICAgICAgICBmdW5jdGlvbiBjcmVhdGVGYWN0b3J5KHR5cGUpIHsKICAgICAgICAgIHJldHVybiBjcmVhdGVFbGVtZW50LmJpbmQobnVsbCwgdHlwZSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgRE9NID0ge307CgogICAgICAgIGZvciAodmFyIGkgPSBFTEVNRU5UUy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgIERPTVtFTEVNRU5UU1tpXV0gPSBjcmVhdGVGYWN0b3J5KEVMRU1FTlRTW2ldKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZ3JhZGVUb1ZOb2RlcyhhcnIsIG9mZnNldCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldCB8fCAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBvYmogPSBhcnJbaV07CgogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7CiAgICAgICAgICAgICAgdXBncmFkZVRvVk5vZGVzKG9iaik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqICYmIF90eXBlb2Y0KG9iaikgPT09ICdvYmplY3QnICYmICFpc1ZhbGlkRWxlbWVudChvYmopICYmIChvYmoucHJvcHMgJiYgb2JqLnR5cGUgfHwgb2JqLmF0dHJpYnV0ZXMgJiYgb2JqLm5vZGVOYW1lIHx8IG9iai5jaGlsZHJlbikpIHsKICAgICAgICAgICAgICBhcnJbaV0gPSBjcmVhdGVFbGVtZW50KG9iai50eXBlIHx8IG9iai5ub2RlTmFtZSwgb2JqLnByb3BzIHx8IG9iai5hdHRyaWJ1dGVzLCBvYmouY2hpbGRyZW4pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBpc1N0YXRlbGVzc0NvbXBvbmVudChjKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGMgPT09ICdmdW5jdGlvbicgJiYgIShjLnByb3RvdHlwZSAmJiBjLnByb3RvdHlwZS5yZW5kZXIpOwogICAgICAgIH0gLy8gd3JhcHMgc3RhdGVsZXNzIGZ1bmN0aW9uYWwgY29tcG9uZW50cyBpbiBhIFByb3BUeXBlcyB2YWxpZGF0b3IKCgogICAgICAgIGZ1bmN0aW9uIHdyYXBTdGF0ZWxlc3NDb21wb25lbnQoV3JhcHBlZENvbXBvbmVudCkgewogICAgICAgICAgcmV0dXJuIGNyZWF0ZUNsYXNzKHsKICAgICAgICAgICAgZGlzcGxheU5hbWU6IFdyYXBwZWRDb21wb25lbnQuZGlzcGxheU5hbWUgfHwgV3JhcHBlZENvbXBvbmVudC5uYW1lLAogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgICAgICByZXR1cm4gV3JhcHBlZENvbXBvbmVudCh0aGlzLnByb3BzLCB0aGlzLmNvbnRleHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHN0YXRlbGVzc0NvbXBvbmVudEhvb2soQ3RvcikgewogICAgICAgICAgdmFyIFdyYXBwZWQgPSBDdG9yW0NPTVBPTkVOVF9XUkFQUEVSX0tFWV07CgogICAgICAgICAgaWYgKFdyYXBwZWQpIHsKICAgICAgICAgICAgcmV0dXJuIFdyYXBwZWQgPT09IHRydWUgPyBDdG9yIDogV3JhcHBlZDsKICAgICAgICAgIH0KCiAgICAgICAgICBXcmFwcGVkID0gd3JhcFN0YXRlbGVzc0NvbXBvbmVudChDdG9yKTsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXcmFwcGVkLCBDT01QT05FTlRfV1JBUFBFUl9LRVksIHsKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgICB2YWx1ZTogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICBXcmFwcGVkLmRpc3BsYXlOYW1lID0gQ3Rvci5kaXNwbGF5TmFtZTsKICAgICAgICAgIFdyYXBwZWQucHJvcFR5cGVzID0gQ3Rvci5wcm9wVHlwZXM7CiAgICAgICAgICBXcmFwcGVkLmRlZmF1bHRQcm9wcyA9IEN0b3IuZGVmYXVsdFByb3BzOwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEN0b3IsIENPTVBPTkVOVF9XUkFQUEVSX0tFWSwgewogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgIHZhbHVlOiBXcmFwcGVkCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBXcmFwcGVkOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRWxlbWVudCgpIHsKICAgICAgICAgIHZhciBhcmdzID0gW10sCiAgICAgICAgICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKCiAgICAgICAgICB3aGlsZSAobGVuLS0pIHsKICAgICAgICAgICAgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbl07CiAgICAgICAgICB9CgogICAgICAgICAgdXBncmFkZVRvVk5vZGVzKGFyZ3MsIDIpOwogICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZVZOb2RlKF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9wcmVhY3RfX1siaCJdLmFwcGx5KHZvaWQgMCwgYXJncykpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplVk5vZGUodm5vZGUpIHsKICAgICAgICAgIHZub2RlLnByZWFjdENvbXBhdE5vcm1hbGl6ZWQgPSB0cnVlOwogICAgICAgICAgYXBwbHlDbGFzc05hbWUodm5vZGUpOwoKICAgICAgICAgIGlmIChpc1N0YXRlbGVzc0NvbXBvbmVudCh2bm9kZS5ub2RlTmFtZSkpIHsKICAgICAgICAgICAgdm5vZGUubm9kZU5hbWUgPSBzdGF0ZWxlc3NDb21wb25lbnRIb29rKHZub2RlLm5vZGVOYW1lKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVmID0gdm5vZGUuYXR0cmlidXRlcy5yZWYsCiAgICAgICAgICAgICAgdHlwZSA9IHJlZiAmJiBfdHlwZW9mNChyZWYpOwoKICAgICAgICAgIGlmIChjdXJyZW50Q29tcG9uZW50ICYmICh0eXBlID09PSAnc3RyaW5nJyB8fCB0eXBlID09PSAnbnVtYmVyJykpIHsKICAgICAgICAgICAgdm5vZGUuYXR0cmlidXRlcy5yZWYgPSBjcmVhdGVTdHJpbmdSZWZQcm94eShyZWYsIGN1cnJlbnRDb21wb25lbnQpOwogICAgICAgICAgfQoKICAgICAgICAgIGFwcGx5RXZlbnROb3JtYWxpemF0aW9uKHZub2RlKTsKICAgICAgICAgIHJldHVybiB2bm9kZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNsb25lRWxlbWVudCQxKGVsZW1lbnQsIHByb3BzKSB7CiAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBbXSwKICAgICAgICAgICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMjsKCiAgICAgICAgICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICAgICAgICAgIGNoaWxkcmVuW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgMl07CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFpc1ZhbGlkRWxlbWVudChlbGVtZW50KSkgewogICAgICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZWxlbWVudFByb3BzID0gZWxlbWVudC5hdHRyaWJ1dGVzIHx8IGVsZW1lbnQucHJvcHM7CgogICAgICAgICAgdmFyIG5vZGUgPSBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfcHJlYWN0X19bImgiXShlbGVtZW50Lm5vZGVOYW1lIHx8IGVsZW1lbnQudHlwZSwgZWxlbWVudFByb3BzLCBlbGVtZW50LmNoaWxkcmVuIHx8IGVsZW1lbnRQcm9wcyAmJiBlbGVtZW50UHJvcHMuY2hpbGRyZW4pOyAvLyBPbmx5IHByb3ZpZGUgdGhlIDNyZCBhcmd1bWVudCBpZiBuZWVkZWQuCiAgICAgICAgICAvLyBBcmd1bWVudHMgMysgb3ZlcndyaXRlIGVsZW1lbnQuY2hpbGRyZW4gaW4gcHJlYWN0Q2xvbmVFbGVtZW50CgoKICAgICAgICAgIHZhciBjbG9uZUFyZ3MgPSBbbm9kZSwgcHJvcHNdOwoKICAgICAgICAgIGlmIChjaGlsZHJlbiAmJiBjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgICAgY2xvbmVBcmdzLnB1c2goY2hpbGRyZW4pOwogICAgICAgICAgfSBlbHNlIGlmIChwcm9wcyAmJiBwcm9wcy5jaGlsZHJlbikgewogICAgICAgICAgICBjbG9uZUFyZ3MucHVzaChwcm9wcy5jaGlsZHJlbik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZVZOb2RlKF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9wcmVhY3RfX1siY2xvbmVFbGVtZW50Il0uYXBwbHkodm9pZCAwLCBjbG9uZUFyZ3MpKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGlzVmFsaWRFbGVtZW50KGVsZW1lbnQpIHsKICAgICAgICAgIHJldHVybiBlbGVtZW50ICYmIChlbGVtZW50IGluc3RhbmNlb2YgVk5vZGUgfHwgZWxlbWVudC4kJHR5cGVvZiA9PT0gUkVBQ1RfRUxFTUVOVF9UWVBFKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVN0cmluZ1JlZlByb3h5KG5hbWUsIGNvbXBvbmVudCkgewogICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5fcmVmUHJveGllc1tuYW1lXSB8fCAoY29tcG9uZW50Ll9yZWZQcm94aWVzW25hbWVdID0gZnVuY3Rpb24gKHJlc29sdmVkKSB7CiAgICAgICAgICAgIGlmIChjb21wb25lbnQgJiYgY29tcG9uZW50LnJlZnMpIHsKICAgICAgICAgICAgICBjb21wb25lbnQucmVmc1tuYW1lXSA9IHJlc29sdmVkOwoKICAgICAgICAgICAgICBpZiAocmVzb2x2ZWQgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBjb21wb25lbnQuX3JlZlByb3hpZXNbbmFtZV07CiAgICAgICAgICAgICAgICBjb21wb25lbnQgPSBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhcHBseUV2ZW50Tm9ybWFsaXphdGlvbihyZWYpIHsKICAgICAgICAgIHZhciBub2RlTmFtZSA9IHJlZi5ub2RlTmFtZTsKICAgICAgICAgIHZhciBhdHRyaWJ1dGVzID0gcmVmLmF0dHJpYnV0ZXM7CgogICAgICAgICAgaWYgKCFhdHRyaWJ1dGVzIHx8IHR5cGVvZiBub2RlTmFtZSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwcm9wcyA9IHt9OwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gYXR0cmlidXRlcykgewogICAgICAgICAgICBwcm9wc1tpLnRvTG93ZXJDYXNlKCldID0gaTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocHJvcHMub25kb3VibGVjbGljaykgewogICAgICAgICAgICBhdHRyaWJ1dGVzLm9uZGJsY2xpY2sgPSBhdHRyaWJ1dGVzW3Byb3BzLm9uZG91YmxlY2xpY2tdOwogICAgICAgICAgICBkZWxldGUgYXR0cmlidXRlc1twcm9wcy5vbmRvdWJsZWNsaWNrXTsKICAgICAgICAgIH0gLy8gZm9yICp0ZXh0dWFsIGlucHV0cyogKGluY2wgdGV4dGFyZWEpLCBub3JtYWxpemUgYG9uQ2hhbmdlYCAtPiBgb25JbnB1dGA6CgoKICAgICAgICAgIGlmIChwcm9wcy5vbmNoYW5nZSAmJiAobm9kZU5hbWUgPT09ICd0ZXh0YXJlYScgfHwgbm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lucHV0JyAmJiAhL15maWx8Y2hlfHJhZC9pLnRlc3QoYXR0cmlidXRlcy50eXBlKSkpIHsKICAgICAgICAgICAgdmFyIG5vcm1hbGl6ZWQgPSBwcm9wcy5vbmlucHV0IHx8ICdvbmlucHV0JzsKCiAgICAgICAgICAgIGlmICghYXR0cmlidXRlc1tub3JtYWxpemVkXSkgewogICAgICAgICAgICAgIGF0dHJpYnV0ZXNbbm9ybWFsaXplZF0gPSBtdWx0aWhvb2soW2F0dHJpYnV0ZXNbbm9ybWFsaXplZF0sIGF0dHJpYnV0ZXNbcHJvcHMub25jaGFuZ2VdXSk7CiAgICAgICAgICAgICAgZGVsZXRlIGF0dHJpYnV0ZXNbcHJvcHMub25jaGFuZ2VdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhcHBseUNsYXNzTmFtZShyZWYpIHsKICAgICAgICAgIHZhciBhdHRyaWJ1dGVzID0gcmVmLmF0dHJpYnV0ZXM7CgogICAgICAgICAgaWYgKCFhdHRyaWJ1dGVzKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY2wgPSBhdHRyaWJ1dGVzLmNsYXNzTmFtZSB8fCBhdHRyaWJ1dGVzWyJjbGFzcyJdOwoKICAgICAgICAgIGlmIChjbCkgewogICAgICAgICAgICBhdHRyaWJ1dGVzLmNsYXNzTmFtZSA9IGNsOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXh0ZW5kKGJhc2UsIHByb3BzKSB7CiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gcHJvcHMpIHsKICAgICAgICAgICAgaWYgKHByb3BzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICBiYXNlW2tleV0gPSBwcm9wc1trZXldOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGJhc2U7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzaGFsbG93RGlmZmVycyhhLCBiKSB7CiAgICAgICAgICBmb3IgKHZhciBpIGluIGEpIHsKICAgICAgICAgICAgaWYgKCEoaSBpbiBiKSkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgaSQxIGluIGIpIHsKICAgICAgICAgICAgaWYgKGFbaSQxXSAhPT0gYltpJDFdKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmaW5kRE9NTm9kZShjb21wb25lbnQpIHsKICAgICAgICAgIHJldHVybiBjb21wb25lbnQgJiYgY29tcG9uZW50LmJhc2UgfHwgY29tcG9uZW50OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gRigpIHt9CgogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNsYXNzKG9iaikgewogICAgICAgICAgZnVuY3Rpb24gY2wocHJvcHMsIGNvbnRleHQpIHsKICAgICAgICAgICAgYmluZEFsbCh0aGlzKTsKICAgICAgICAgICAgQ29tcG9uZW50JDEuY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCwgQllQQVNTX0hPT0spOwogICAgICAgICAgICBuZXdDb21wb25lbnRIb29rLmNhbGwodGhpcywgcHJvcHMsIGNvbnRleHQpOwogICAgICAgICAgfQoKICAgICAgICAgIG9iaiA9IGV4dGVuZCh7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBjbAogICAgICAgICAgfSwgb2JqKTsgLy8gV2UgbmVlZCB0byBhcHBseSBtaXhpbnMgaGVyZSBzbyB0aGF0IGdldERlZmF1bHRQcm9wcyBpcyBjb3JyZWN0bHkgbWl4ZWQKCiAgICAgICAgICBpZiAob2JqLm1peGlucykgewogICAgICAgICAgICBhcHBseU1peGlucyhvYmosIGNvbGxhdGVNaXhpbnMob2JqLm1peGlucykpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChvYmouc3RhdGljcykgewogICAgICAgICAgICBleHRlbmQoY2wsIG9iai5zdGF0aWNzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAob2JqLnByb3BUeXBlcykgewogICAgICAgICAgICBjbC5wcm9wVHlwZXMgPSBvYmoucHJvcFR5cGVzOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChvYmouZGVmYXVsdFByb3BzKSB7CiAgICAgICAgICAgIGNsLmRlZmF1bHRQcm9wcyA9IG9iai5kZWZhdWx0UHJvcHM7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9iai5nZXREZWZhdWx0UHJvcHMpIHsKICAgICAgICAgICAgY2wuZGVmYXVsdFByb3BzID0gb2JqLmdldERlZmF1bHRQcm9wcygpOwogICAgICAgICAgfQoKICAgICAgICAgIEYucHJvdG90eXBlID0gQ29tcG9uZW50JDEucHJvdG90eXBlOwogICAgICAgICAgY2wucHJvdG90eXBlID0gZXh0ZW5kKG5ldyBGKCksIG9iaik7CiAgICAgICAgICBjbC5kaXNwbGF5TmFtZSA9IG9iai5kaXNwbGF5TmFtZSB8fCAnQ29tcG9uZW50JzsKICAgICAgICAgIHJldHVybiBjbDsKICAgICAgICB9IC8vIEZsYXR0ZW4gYW4gQXJyYXkgb2YgbWl4aW5zIHRvIGEgbWFwIG9mIG1ldGhvZCBuYW1lIHRvIG1peGluIGltcGxlbWVudGF0aW9ucwoKCiAgICAgICAgZnVuY3Rpb24gY29sbGF0ZU1peGlucyhtaXhpbnMpIHsKICAgICAgICAgIHZhciBrZXllZCA9IHt9OwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWl4aW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBtaXhpbiA9IG1peGluc1tpXTsKCiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBtaXhpbikgewogICAgICAgICAgICAgIGlmIChtaXhpbi5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIHR5cGVvZiBtaXhpbltrZXldID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAoa2V5ZWRba2V5XSB8fCAoa2V5ZWRba2V5XSA9IFtdKSkucHVzaChtaXhpbltrZXldKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4ga2V5ZWQ7CiAgICAgICAgfSAvLyBhcHBseSBhIG1hcHBpbmcgb2YgQXJyYXlzIG9mIG1peGluIG1ldGhvZHMgdG8gYSBjb21wb25lbnQgcHJvdG90eXBlCgoKICAgICAgICBmdW5jdGlvbiBhcHBseU1peGlucyhwcm90bywgbWl4aW5zKSB7CiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbWl4aW5zKSB7CiAgICAgICAgICAgIGlmIChtaXhpbnMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgIHByb3RvW2tleV0gPSBtdWx0aWhvb2sobWl4aW5zW2tleV0uY29uY2F0KHByb3RvW2tleV0gfHwgQVJSKSwga2V5ID09PSAnZ2V0RGVmYXVsdFByb3BzJyB8fCBrZXkgPT09ICdnZXRJbml0aWFsU3RhdGUnIHx8IGtleSA9PT0gJ2dldENoaWxkQ29udGV4dCcpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBiaW5kQWxsKGN0eCkgewogICAgICAgICAgZm9yICh2YXIgaSBpbiBjdHgpIHsKICAgICAgICAgICAgdmFyIHYgPSBjdHhbaV07CgogICAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICdmdW5jdGlvbicgJiYgIXYuX19ib3VuZCAmJiAhQVVUT0JJTkRfQkxBQ0tMSVNULmhhc093blByb3BlcnR5KGkpKSB7CiAgICAgICAgICAgICAgKGN0eFtpXSA9IHYuYmluZChjdHgpKS5fX2JvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2FsbE1ldGhvZChjdHgsIG0sIGFyZ3MpIHsKICAgICAgICAgIGlmICh0eXBlb2YgbSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgbSA9IGN0eC5jb25zdHJ1Y3Rvci5wcm90b3R5cGVbbV07CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHR5cGVvZiBtID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHJldHVybiBtLmFwcGx5KGN0eCwgYXJncyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtdWx0aWhvb2soaG9va3MsIHNraXBEdXBsaWNhdGVzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7CiAgICAgICAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwogICAgICAgICAgICB2YXIgcmV0OwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBob29rcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHZhciByID0gY2FsbE1ldGhvZCh0aGlzJDEsIGhvb2tzW2ldLCBhcmd1bWVudHMkMSk7CgogICAgICAgICAgICAgIGlmIChza2lwRHVwbGljYXRlcyAmJiByICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICghcmV0KSB7CiAgICAgICAgICAgICAgICAgIHJldCA9IHt9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiByKSB7CiAgICAgICAgICAgICAgICAgIGlmIChyLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgICAgICByZXRba2V5XSA9IHJba2V5XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHIgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICByZXQgPSByOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBuZXdDb21wb25lbnRIb29rKHByb3BzLCBjb250ZXh0KSB7CiAgICAgICAgICBwcm9wc0hvb2suY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCk7CiAgICAgICAgICB0aGlzLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgPSBtdWx0aWhvb2soW3Byb3BzSG9vaywgdGhpcy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIHx8ICdjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzJ10pOwogICAgICAgICAgdGhpcy5yZW5kZXIgPSBtdWx0aWhvb2soW3Byb3BzSG9vaywgYmVmb3JlUmVuZGVyLCB0aGlzLnJlbmRlciB8fCAncmVuZGVyJywgYWZ0ZXJSZW5kZXJdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHByb3BzSG9vayhwcm9wcywgY29udGV4dCkgewogICAgICAgICAgaWYgKCFwcm9wcykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IC8vIFJlYWN0IGFubm95aW5nbHkgc3BlY2lhbC1jYXNlcyBzaW5nbGUgY2hpbGRyZW4sIGFuZCBzb21lIHJlYWN0IGNvbXBvbmVudHMgYXJlIHJpZGljdWxvdXNseSBzdHJpY3QgYWJvdXQgdGhpcy4KCgogICAgICAgICAgdmFyIGMgPSBwcm9wcy5jaGlsZHJlbjsKCiAgICAgICAgICBpZiAoYyAmJiBBcnJheS5pc0FycmF5KGMpICYmIGMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIHByb3BzLmNoaWxkcmVuID0gY1swXTsgLy8gYnV0IGl0cyB0b3RhbGx5IHN0aWxsIGdvaW5nIHRvIGJlIGFuIEFycmF5LgoKICAgICAgICAgICAgaWYgKHByb3BzLmNoaWxkcmVuICYmIF90eXBlb2Y0KHByb3BzLmNoaWxkcmVuKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICBwcm9wcy5jaGlsZHJlbi5sZW5ndGggPSAxOwogICAgICAgICAgICAgIHByb3BzLmNoaWxkcmVuWzBdID0gcHJvcHMuY2hpbGRyZW47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8gYWRkIHByb3B0eXBlIGNoZWNraW5nCgoKICAgICAgICAgIGlmIChERVYpIHsKICAgICAgICAgICAgdmFyIGN0b3IgPSB0eXBlb2YgdGhpcyA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiB0aGlzLmNvbnN0cnVjdG9yLAogICAgICAgICAgICAgICAgcHJvcFR5cGVzID0gdGhpcy5wcm9wVHlwZXMgfHwgY3Rvci5wcm9wVHlwZXM7CiAgICAgICAgICAgIHZhciBkaXNwbGF5TmFtZSA9IHRoaXMuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lOwoKICAgICAgICAgICAgaWYgKHByb3BUeXBlcykgewogICAgICAgICAgICAgIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9wcm9wX3R5cGVzX19fZGVmYXVsdC5hLmNoZWNrUHJvcFR5cGVzKHByb3BUeXBlcywgcHJvcHMsICdwcm9wJywgZGlzcGxheU5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBiZWZvcmVSZW5kZXIocHJvcHMpIHsKICAgICAgICAgIGN1cnJlbnRDb21wb25lbnQgPSB0aGlzOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYWZ0ZXJSZW5kZXIoKSB7CiAgICAgICAgICBpZiAoY3VycmVudENvbXBvbmVudCA9PT0gdGhpcykgewogICAgICAgICAgICBjdXJyZW50Q29tcG9uZW50ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIENvbXBvbmVudCQxKHByb3BzLCBjb250ZXh0LCBvcHRzKSB7CiAgICAgICAgICBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfcHJlYWN0X19bIkNvbXBvbmVudCJdLmNhbGwodGhpcywgcHJvcHMsIGNvbnRleHQpOwoKICAgICAgICAgIHRoaXMuc3RhdGUgPSB0aGlzLmdldEluaXRpYWxTdGF0ZSA/IHRoaXMuZ2V0SW5pdGlhbFN0YXRlKCkgOiB7fTsKICAgICAgICAgIHRoaXMucmVmcyA9IHt9OwogICAgICAgICAgdGhpcy5fcmVmUHJveGllcyA9IHt9OwoKICAgICAgICAgIGlmIChvcHRzICE9PSBCWVBBU1NfSE9PSykgewogICAgICAgICAgICBuZXdDb21wb25lbnRIb29rLmNhbGwodGhpcywgcHJvcHMsIGNvbnRleHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZXh0ZW5kKENvbXBvbmVudCQxLnByb3RvdHlwZSA9IG5ldyBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfcHJlYWN0X19bIkNvbXBvbmVudCJdKCksIHsKICAgICAgICAgIGNvbnN0cnVjdG9yOiBDb21wb25lbnQkMSwKICAgICAgICAgIGlzUmVhY3RDb21wb25lbnQ6IHt9LAogICAgICAgICAgcmVwbGFjZVN0YXRlOiBmdW5jdGlvbiByZXBsYWNlU3RhdGUoc3RhdGUsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwogICAgICAgICAgICB0aGlzLnNldFN0YXRlKHN0YXRlLCBjYWxsYmFjayk7CgogICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMkMS5zdGF0ZSkgewogICAgICAgICAgICAgIGlmICghKGkgaW4gc3RhdGUpKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcyQxLnN0YXRlW2ldOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGdldERPTU5vZGU6IGZ1bmN0aW9uIGdldERPTU5vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJhc2U7CiAgICAgICAgICB9LAogICAgICAgICAgaXNNb3VudGVkOiBmdW5jdGlvbiBpc01vdW50ZWQoKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuYmFzZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgZnVuY3Rpb24gUHVyZUNvbXBvbmVudChwcm9wcywgY29udGV4dCkgewogICAgICAgICAgQ29tcG9uZW50JDEuY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCk7CiAgICAgICAgfQoKICAgICAgICBGLnByb3RvdHlwZSA9IENvbXBvbmVudCQxLnByb3RvdHlwZTsKICAgICAgICBQdXJlQ29tcG9uZW50LnByb3RvdHlwZSA9IG5ldyBGKCk7CiAgICAgICAgUHVyZUNvbXBvbmVudC5wcm90b3R5cGUuaXNQdXJlUmVhY3RDb21wb25lbnQgPSB0cnVlOwoKICAgICAgICBQdXJlQ29tcG9uZW50LnByb3RvdHlwZS5zaG91bGRDb21wb25lbnRVcGRhdGUgPSBmdW5jdGlvbiAocHJvcHMsIHN0YXRlKSB7CiAgICAgICAgICByZXR1cm4gc2hhbGxvd0RpZmZlcnModGhpcy5wcm9wcywgcHJvcHMpIHx8IHNoYWxsb3dEaWZmZXJzKHRoaXMuc3RhdGUsIHN0YXRlKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgaW5kZXggPSB7CiAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uLAogICAgICAgICAgRE9NOiBET00sCiAgICAgICAgICBQcm9wVHlwZXM6IF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9wcm9wX3R5cGVzX19fZGVmYXVsdC5hLAogICAgICAgICAgQ2hpbGRyZW46IENoaWxkcmVuLAogICAgICAgICAgcmVuZGVyOiByZW5kZXIkMSwKICAgICAgICAgIGNyZWF0ZUNsYXNzOiBjcmVhdGVDbGFzcywKICAgICAgICAgIGNyZWF0ZUZhY3Rvcnk6IGNyZWF0ZUZhY3RvcnksCiAgICAgICAgICBjcmVhdGVFbGVtZW50OiBjcmVhdGVFbGVtZW50LAogICAgICAgICAgY2xvbmVFbGVtZW50OiBjbG9uZUVsZW1lbnQkMSwKICAgICAgICAgIGlzVmFsaWRFbGVtZW50OiBpc1ZhbGlkRWxlbWVudCwKICAgICAgICAgIGZpbmRET01Ob2RlOiBmaW5kRE9NTm9kZSwKICAgICAgICAgIHVubW91bnRDb21wb25lbnRBdE5vZGU6IHVubW91bnRDb21wb25lbnRBdE5vZGUsCiAgICAgICAgICBDb21wb25lbnQ6IENvbXBvbmVudCQxLAogICAgICAgICAgUHVyZUNvbXBvbmVudDogUHVyZUNvbXBvbmVudCwKICAgICAgICAgIHVuc3RhYmxlX3JlbmRlclN1YnRyZWVJbnRvQ29udGFpbmVyOiByZW5kZXJTdWJ0cmVlSW50b0NvbnRhaW5lcgogICAgICAgIH07CiAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKICAgICAgICBfX3dlYnBhY2tfZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBpbmRleDsKICAgICAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8KICAgICAgfSkuY2FsbChfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpKTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICAgIGlmICghaXNPYmplY3QoaXQpKSB0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhbiBvYmplY3QhJyk7CiAgICAgICAgcmV0dXJuIGl0OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCiAgICAgIHZhciBJRThfRE9NX0RFRklORSA9IF9fd2VicGFja19yZXF1aXJlX18oNDgpOwoKICAgICAgdmFyIHRvUHJpbWl0aXZlID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMik7CgogICAgICB2YXIgZFAgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CiAgICAgIGV4cG9ydHMuZiA9IF9fd2VicGFja19yZXF1aXJlX18oOCkgPyBPYmplY3QuZGVmaW5lUHJvcGVydHkgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKSB7CiAgICAgICAgYW5PYmplY3QoTyk7CiAgICAgICAgUCA9IHRvUHJpbWl0aXZlKFAsIHRydWUpOwogICAgICAgIGFuT2JqZWN0KEF0dHJpYnV0ZXMpOwogICAgICAgIGlmIChJRThfRE9NX0RFRklORSkgdHJ5IHsKICAgICAgICAgIHJldHVybiBkUChPLCBQLCBBdHRyaWJ1dGVzKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAvKiBlbXB0eSAqLwogICAgICAgIH0KICAgICAgICBpZiAoJ2dldCcgaW4gQXR0cmlidXRlcyB8fCAnc2V0JyBpbiBBdHRyaWJ1dGVzKSB0aHJvdyBUeXBlRXJyb3IoJ0FjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIScpOwogICAgICAgIGlmICgndmFsdWUnIGluIEF0dHJpYnV0ZXMpIE9bUF0gPSBBdHRyaWJ1dGVzLnZhbHVlOwogICAgICAgIHJldHVybiBPOwogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBUaGFuaydzIElFOCBmb3IgaGlzIGZ1bm55IGRlZmluZVByb3BlcnR5CiAgICAgIG1vZHVsZS5leHBvcnRzID0gIV9fd2VicGFja19yZXF1aXJlX18oMTQpKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAnYScsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gNzsKICAgICAgICAgIH0KICAgICAgICB9KS5hICE9IDc7CiAgICAgIH0pOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICAvLyBzaGltIGZvciB1c2luZyBwcm9jZXNzIGluIGJyb3dzZXIKICAgICAgdmFyIHByb2Nlc3MgPSBtb2R1bGUuZXhwb3J0cyA9IHt9OyAvLyBjYWNoZWQgZnJvbSB3aGF0ZXZlciBnbG9iYWwgaXMgcHJlc2VudCBzbyB0aGF0IHRlc3QgcnVubmVycyB0aGF0IHN0dWIgaXQKICAgICAgLy8gZG9uJ3QgYnJlYWsgdGhpbmdzLiAgQnV0IHdlIG5lZWQgdG8gd3JhcCBpdCBpbiBhIHRyeSBjYXRjaCBpbiBjYXNlIGl0IGlzCiAgICAgIC8vIHdyYXBwZWQgaW4gc3RyaWN0IG1vZGUgY29kZSB3aGljaCBkb2Vzbid0IGRlZmluZSBhbnkgZ2xvYmFscy4gIEl0J3MgaW5zaWRlIGEKICAgICAgLy8gZnVuY3Rpb24gYmVjYXVzZSB0cnkvY2F0Y2hlcyBkZW9wdGltaXplIGluIGNlcnRhaW4gZW5naW5lcy4KCiAgICAgIHZhciBjYWNoZWRTZXRUaW1lb3V0OwogICAgICB2YXIgY2FjaGVkQ2xlYXJUaW1lb3V0OwoKICAgICAgZnVuY3Rpb24gZGVmYXVsdFNldFRpbW91dCgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3NldFRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZGVmYXVsdENsZWFyVGltZW91dCgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NsZWFyVGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpOwogICAgICB9CgogICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAodHlwZW9mIHNldFRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAodHlwZW9mIGNsZWFyVGltZW91dCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBjbGVhclRpbWVvdXQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBkZWZhdWx0Q2xlYXJUaW1lb3V0OwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7CiAgICAgICAgfQogICAgICB9KSgpOwoKICAgICAgZnVuY3Rpb24gcnVuVGltZW91dChmdW4pIHsKICAgICAgICBpZiAoY2FjaGVkU2V0VGltZW91dCA9PT0gc2V0VGltZW91dCkgewogICAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zCiAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW4sIDApOwogICAgICAgIH0gLy8gaWYgc2V0VGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWQKCgogICAgICAgIGlmICgoY2FjaGVkU2V0VGltZW91dCA9PT0gZGVmYXVsdFNldFRpbW91dCB8fCAhY2FjaGVkU2V0VGltZW91dCkgJiYgc2V0VGltZW91dCkgewogICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7CiAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW4sIDApOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3MKICAgICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0KGZ1biwgMCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0IHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5CiAgICAgICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwobnVsbCwgZnVuLCAwKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3IKICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbCh0aGlzLCBmdW4sIDApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gcnVuQ2xlYXJUaW1lb3V0KG1hcmtlcikgewogICAgICAgIGlmIChjYWNoZWRDbGVhclRpbWVvdXQgPT09IGNsZWFyVGltZW91dCkgewogICAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zCiAgICAgICAgICByZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7CiAgICAgICAgfSAvLyBpZiBjbGVhclRpbWVvdXQgd2Fzbid0IGF2YWlsYWJsZSBidXQgd2FzIGxhdHRlciBkZWZpbmVkCgoKICAgICAgICBpZiAoKGNhY2hlZENsZWFyVGltZW91dCA9PT0gZGVmYXVsdENsZWFyVGltZW91dCB8fCAhY2FjaGVkQ2xlYXJUaW1lb3V0KSAmJiBjbGVhclRpbWVvdXQpIHsKICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDsKICAgICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAvLyB3aGVuIHdoZW4gc29tZWJvZHkgaGFzIHNjcmV3ZWQgd2l0aCBzZXRUaW1lb3V0IGJ1dCBubyBJLkUuIG1hZGRuZXNzCiAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0KG1hcmtlcik7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0ICB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseQogICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwobnVsbCwgbWFya2VyKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3IuCiAgICAgICAgICAgIC8vIFNvbWUgdmVyc2lvbnMgb2YgSS5FLiBoYXZlIGRpZmZlcmVudCBydWxlcyBmb3IgY2xlYXJUaW1lb3V0IHZzIHNldFRpbWVvdXQKICAgICAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dC5jYWxsKHRoaXMsIG1hcmtlcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgcXVldWUgPSBbXTsKICAgICAgdmFyIGRyYWluaW5nID0gZmFsc2U7CiAgICAgIHZhciBjdXJyZW50UXVldWU7CiAgICAgIHZhciBxdWV1ZUluZGV4ID0gLTE7CgogICAgICBmdW5jdGlvbiBjbGVhblVwTmV4dFRpY2soKSB7CiAgICAgICAgaWYgKCFkcmFpbmluZyB8fCAhY3VycmVudFF1ZXVlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBkcmFpbmluZyA9IGZhbHNlOwoKICAgICAgICBpZiAoY3VycmVudFF1ZXVlLmxlbmd0aCkgewogICAgICAgICAgcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVldWVJbmRleCA9IC0xOwogICAgICAgIH0KCiAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgICAgZHJhaW5RdWV1ZSgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHsKICAgICAgICBpZiAoZHJhaW5pbmcpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB0aW1lb3V0ID0gcnVuVGltZW91dChjbGVhblVwTmV4dFRpY2spOwogICAgICAgIGRyYWluaW5nID0gdHJ1ZTsKICAgICAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoOwoKICAgICAgICB3aGlsZSAobGVuKSB7CiAgICAgICAgICBjdXJyZW50UXVldWUgPSBxdWV1ZTsKICAgICAgICAgIHF1ZXVlID0gW107CgogICAgICAgICAgd2hpbGUgKCsrcXVldWVJbmRleCA8IGxlbikgewogICAgICAgICAgICBpZiAoY3VycmVudFF1ZXVlKSB7CiAgICAgICAgICAgICAgY3VycmVudFF1ZXVlW3F1ZXVlSW5kZXhdLnJ1bigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcXVldWVJbmRleCA9IC0xOwogICAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgY3VycmVudFF1ZXVlID0gbnVsbDsKICAgICAgICBkcmFpbmluZyA9IGZhbHNlOwogICAgICAgIHJ1bkNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgfQoKICAgICAgcHJvY2Vzcy5uZXh0VGljayA9IGZ1bmN0aW9uIChmdW4pIHsKICAgICAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7CgogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpOwoKICAgICAgICBpZiAocXVldWUubGVuZ3RoID09PSAxICYmICFkcmFpbmluZykgewogICAgICAgICAgcnVuVGltZW91dChkcmFpblF1ZXVlKTsKICAgICAgICB9CiAgICAgIH07IC8vIHY4IGxpa2VzIHByZWRpY3RpYmxlIG9iamVjdHMKCgogICAgICBmdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHsKICAgICAgICB0aGlzLmZ1biA9IGZ1bjsKICAgICAgICB0aGlzLmFycmF5ID0gYXJyYXk7CiAgICAgIH0KCiAgICAgIEl0ZW0ucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmZ1bi5hcHBseShudWxsLCB0aGlzLmFycmF5KTsKICAgICAgfTsKCiAgICAgIHByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7CiAgICAgIHByb2Nlc3MuYnJvd3NlciA9IHRydWU7CiAgICAgIHByb2Nlc3MuZW52ID0ge307CiAgICAgIHByb2Nlc3MuYXJndiA9IFtdOwogICAgICBwcm9jZXNzLnZlcnNpb24gPSAnJzsgLy8gZW1wdHkgc3RyaW5nIHRvIGF2b2lkIHJlZ2V4cCBpc3N1ZXMKCiAgICAgIHByb2Nlc3MudmVyc2lvbnMgPSB7fTsKCiAgICAgIGZ1bmN0aW9uIG5vb3AoKSB7fQoKICAgICAgcHJvY2Vzcy5vbiA9IG5vb3A7CiAgICAgIHByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wOwogICAgICBwcm9jZXNzLm9uY2UgPSBub29wOwogICAgICBwcm9jZXNzLm9mZiA9IG5vb3A7CiAgICAgIHByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wOwogICAgICBwcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7CiAgICAgIHByb2Nlc3MuZW1pdCA9IG5vb3A7CiAgICAgIHByb2Nlc3MucHJlcGVuZExpc3RlbmVyID0gbm9vcDsKICAgICAgcHJvY2Vzcy5wcmVwZW5kT25jZUxpc3RlbmVyID0gbm9vcDsKCiAgICAgIHByb2Nlc3MubGlzdGVuZXJzID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH07CgogICAgICBwcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQnKTsKICAgICAgfTsKCiAgICAgIHByb2Nlc3MuY3dkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAnLyc7CiAgICAgIH07CgogICAgICBwcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7CiAgICAgIH07CgogICAgICBwcm9jZXNzLnVtYXNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAwOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIF90eXBlb2Y0KGl0KSA9PT0gJ29iamVjdCcgPyBpdCAhPT0gbnVsbCA6IHR5cGVvZiBpdCA9PT0gJ2Z1bmN0aW9uJzsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOwoKICAgICAgdmFyIGNyZWF0ZURlc2MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE5KTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KSA/IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKICAgICAgICByZXR1cm4gZFAuZihvYmplY3QsIGtleSwgY3JlYXRlRGVzYygxLCB2YWx1ZSkpOwogICAgICB9IDogZnVuY3Rpb24gKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgICAgIG9iamVjdFtrZXldID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIHZhciBoYXNPd25Qcm9wZXJ0eSA9IHt9Lmhhc093blByb3BlcnR5OwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIGtleSkgewogICAgICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGl0LCBrZXkpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIG9wdGlvbmFsIC8gc2ltcGxlIGNvbnRleHQgYmluZGluZwogICAgICB2YXIgYUZ1bmN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNCk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChmbiwgdGhhdCwgbGVuZ3RoKSB7CiAgICAgICAgYUZ1bmN0aW9uKGZuKTsKICAgICAgICBpZiAodGhhdCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gZm47CgogICAgICAgIHN3aXRjaCAobGVuZ3RoKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEpOwogICAgICAgICAgICB9OwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYik7CiAgICAgICAgICAgIH07CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICAgICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhLCBiLCBjKTsKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKQogICAgICAgIC8qIC4uLmFyZ3MgKi8KICAgICAgICB7CiAgICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhhdCwgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxNCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGV4ZWMpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuICEhZXhlYygpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IHt9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gdG8gaW5kZXhlZCBvYmplY3QsIHRvT2JqZWN0IHdpdGggZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBzdHJpbmdzCiAgICAgIHZhciBJT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1NCk7CgogICAgICB2YXIgZGVmaW5lZCA9IF9fd2VicGFja19yZXF1aXJlX18oMzUpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICByZXR1cm4gSU9iamVjdChkZWZpbmVkKGl0KSk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gNy4xLjEzIFRvT2JqZWN0KGFyZ3VtZW50KQogICAgICB2YXIgZGVmaW5lZCA9IF9fd2VicGFja19yZXF1aXJlX18oMzUpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICByZXR1cm4gT2JqZWN0KGRlZmluZWQoaXQpKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgaXNEYXRlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMDIpOwoKICAgICAgdmFyIE1JTExJU0VDT05EU19JTl9IT1VSID0gMzYwMDAwMDsKICAgICAgdmFyIE1JTExJU0VDT05EU19JTl9NSU5VVEUgPSA2MDAwMDsKICAgICAgdmFyIERFRkFVTFRfQURESVRJT05BTF9ESUdJVFMgPSAyOwogICAgICB2YXIgcGFyc2VUb2tlbkRhdGVUaW1lRGVsaW1ldGVyID0gL1tUIF0vOwogICAgICB2YXIgcGFyc2VUb2tlblBsYWluVGltZSA9IC86LzsgLy8geWVhciB0b2tlbnMKCiAgICAgIHZhciBwYXJzZVRva2VuWVkgPSAvXihcZHsyfSkkLzsKICAgICAgdmFyIHBhcnNlVG9rZW5zWVlZID0gWy9eKFsrLV1cZHsyfSkkLywgLy8gMCBhZGRpdGlvbmFsIGRpZ2l0cwogICAgICAvXihbKy1dXGR7M30pJC8sIC8vIDEgYWRkaXRpb25hbCBkaWdpdAogICAgICAvXihbKy1dXGR7NH0pJC8gLy8gMiBhZGRpdGlvbmFsIGRpZ2l0cwogICAgICBdOwogICAgICB2YXIgcGFyc2VUb2tlbllZWVkgPSAvXihcZHs0fSkvOwogICAgICB2YXIgcGFyc2VUb2tlbnNZWVlZWSA9IFsvXihbKy1dXGR7NH0pLywgLy8gMCBhZGRpdGlvbmFsIGRpZ2l0cwogICAgICAvXihbKy1dXGR7NX0pLywgLy8gMSBhZGRpdGlvbmFsIGRpZ2l0CiAgICAgIC9eKFsrLV1cZHs2fSkvIC8vIDIgYWRkaXRpb25hbCBkaWdpdHMKICAgICAgXTsgLy8gZGF0ZSB0b2tlbnMKCiAgICAgIHZhciBwYXJzZVRva2VuTU0gPSAvXi0oXGR7Mn0pJC87CiAgICAgIHZhciBwYXJzZVRva2VuREREID0gL14tPyhcZHszfSkkLzsKICAgICAgdmFyIHBhcnNlVG9rZW5NTUREID0gL14tPyhcZHsyfSktPyhcZHsyfSkkLzsKICAgICAgdmFyIHBhcnNlVG9rZW5Xd3cgPSAvXi0/VyhcZHsyfSkkLzsKICAgICAgdmFyIHBhcnNlVG9rZW5Xd3dEID0gL14tP1coXGR7Mn0pLT8oXGR7MX0pJC87IC8vIHRpbWUgdG9rZW5zCgogICAgICB2YXIgcGFyc2VUb2tlbkhIID0gL14oXGR7Mn0oWy4sXVxkKik/KSQvOwogICAgICB2YXIgcGFyc2VUb2tlbkhITU0gPSAvXihcZHsyfSk6PyhcZHsyfShbLixdXGQqKT8pJC87CiAgICAgIHZhciBwYXJzZVRva2VuSEhNTVNTID0gL14oXGR7Mn0pOj8oXGR7Mn0pOj8oXGR7Mn0oWy4sXVxkKik/KSQvOyAvLyB0aW1lem9uZSB0b2tlbnMKCiAgICAgIHZhciBwYXJzZVRva2VuVGltZXpvbmUgPSAvKFtaKy1dLiopJC87CiAgICAgIHZhciBwYXJzZVRva2VuVGltZXpvbmVaID0gL14oWikkLzsKICAgICAgdmFyIHBhcnNlVG9rZW5UaW1lem9uZUhIID0gL14oWystXSkoXGR7Mn0pJC87CiAgICAgIHZhciBwYXJzZVRva2VuVGltZXpvbmVISE1NID0gL14oWystXSkoXGR7Mn0pOj8oXGR7Mn0pJC87CiAgICAgIC8qKgogICAgICAgKiBAY2F0ZWdvcnkgQ29tbW9uIEhlbHBlcnMKICAgICAgICogQHN1bW1hcnkgQ29udmVydCB0aGUgZ2l2ZW4gYXJndW1lbnQgdG8gYW4gaW5zdGFuY2Ugb2YgRGF0ZS4KICAgICAgICoKICAgICAgICogQGRlc2NyaXB0aW9uCiAgICAgICAqIENvbnZlcnQgdGhlIGdpdmVuIGFyZ3VtZW50IHRvIGFuIGluc3RhbmNlIG9mIERhdGUuCiAgICAgICAqCiAgICAgICAqIElmIHRoZSBhcmd1bWVudCBpcyBhbiBpbnN0YW5jZSBvZiBEYXRlLCB0aGUgZnVuY3Rpb24gcmV0dXJucyBpdHMgY2xvbmUuCiAgICAgICAqCiAgICAgICAqIElmIHRoZSBhcmd1bWVudCBpcyBhIG51bWJlciwgaXQgaXMgdHJlYXRlZCBhcyBhIHRpbWVzdGFtcC4KICAgICAgICoKICAgICAgICogSWYgYW4gYXJndW1lbnQgaXMgYSBzdHJpbmcsIHRoZSBmdW5jdGlvbiB0cmllcyB0byBwYXJzZSBpdC4KICAgICAgICogRnVuY3Rpb24gYWNjZXB0cyBjb21wbGV0ZSBJU08gODYwMSBmb3JtYXRzIGFzIHdlbGwgYXMgcGFydGlhbCBpbXBsZW1lbnRhdGlvbnMuCiAgICAgICAqIElTTyA4NjAxOiBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0lTT184NjAxCiAgICAgICAqCiAgICAgICAqIElmIGFsbCBhYm92ZSBmYWlscywgdGhlIGZ1bmN0aW9uIHBhc3NlcyB0aGUgZ2l2ZW4gYXJndW1lbnQgdG8gRGF0ZSBjb25zdHJ1Y3Rvci4KICAgICAgICoKICAgICAgICogQHBhcmFtIHtEYXRlfFN0cmluZ3xOdW1iZXJ9IGFyZ3VtZW50IC0gdGhlIHZhbHVlIHRvIGNvbnZlcnQKICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAtIHRoZSBvYmplY3Qgd2l0aCBvcHRpb25zCiAgICAgICAqIEBwYXJhbSB7MCB8IDEgfCAyfSBbb3B0aW9ucy5hZGRpdGlvbmFsRGlnaXRzPTJdIC0gdGhlIGFkZGl0aW9uYWwgbnVtYmVyIG9mIGRpZ2l0cyBpbiB0aGUgZXh0ZW5kZWQgeWVhciBmb3JtYXQKICAgICAgICogQHJldHVybnMge0RhdGV9IHRoZSBwYXJzZWQgZGF0ZSBpbiB0aGUgbG9jYWwgdGltZSB6b25lCiAgICAgICAqCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIC8vIENvbnZlcnQgc3RyaW5nICcyMDE0LTAyLTExVDExOjMwOjMwJyB0byBkYXRlOgogICAgICAgKiB2YXIgcmVzdWx0ID0gcGFyc2UoJzIwMTQtMDItMTFUMTE6MzA6MzAnKQogICAgICAgKiAvLz0+IFR1ZSBGZWIgMTEgMjAxNCAxMTozMDozMAogICAgICAgKgogICAgICAgKiBAZXhhbXBsZQogICAgICAgKiAvLyBQYXJzZSBzdHJpbmcgJyswMjAxNDEwMScsCiAgICAgICAqIC8vIGlmIHRoZSBhZGRpdGlvbmFsIG51bWJlciBvZiBkaWdpdHMgaW4gdGhlIGV4dGVuZGVkIHllYXIgZm9ybWF0IGlzIDE6CiAgICAgICAqIHZhciByZXN1bHQgPSBwYXJzZSgnKzAyMDE0MTAxJywge2FkZGl0aW9uYWxEaWdpdHM6IDF9KQogICAgICAgKiAvLz0+IEZyaSBBcHIgMTEgMjAxNCAwMDowMDowMAogICAgICAgKi8KCiAgICAgIGZ1bmN0aW9uIHBhcnNlKGFyZ3VtZW50LCBkaXJ0eU9wdGlvbnMpIHsKICAgICAgICBpZiAoaXNEYXRlKGFyZ3VtZW50KSkgewogICAgICAgICAgLy8gUHJldmVudCB0aGUgZGF0ZSB0byBsb3NlIHRoZSBtaWxsaXNlY29uZHMgd2hlbiBwYXNzZWQgdG8gbmV3IERhdGUoKSBpbiBJRTEwCiAgICAgICAgICByZXR1cm4gbmV3IERhdGUoYXJndW1lbnQuZ2V0VGltZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmd1bWVudCAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShhcmd1bWVudCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgb3B0aW9ucyA9IGRpcnR5T3B0aW9ucyB8fCB7fTsKICAgICAgICB2YXIgYWRkaXRpb25hbERpZ2l0cyA9IG9wdGlvbnMuYWRkaXRpb25hbERpZ2l0czsKCiAgICAgICAgaWYgKGFkZGl0aW9uYWxEaWdpdHMgPT0gbnVsbCkgewogICAgICAgICAgYWRkaXRpb25hbERpZ2l0cyA9IERFRkFVTFRfQURESVRJT05BTF9ESUdJVFM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFkZGl0aW9uYWxEaWdpdHMgPSBOdW1iZXIoYWRkaXRpb25hbERpZ2l0cyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZGF0ZVN0cmluZ3MgPSBzcGxpdERhdGVTdHJpbmcoYXJndW1lbnQpOwogICAgICAgIHZhciBwYXJzZVllYXJSZXN1bHQgPSBwYXJzZVllYXIoZGF0ZVN0cmluZ3MuZGF0ZSwgYWRkaXRpb25hbERpZ2l0cyk7CiAgICAgICAgdmFyIHllYXIgPSBwYXJzZVllYXJSZXN1bHQueWVhcjsKICAgICAgICB2YXIgcmVzdERhdGVTdHJpbmcgPSBwYXJzZVllYXJSZXN1bHQucmVzdERhdGVTdHJpbmc7CiAgICAgICAgdmFyIGRhdGUgPSBwYXJzZURhdGUocmVzdERhdGVTdHJpbmcsIHllYXIpOwoKICAgICAgICBpZiAoZGF0ZSkgewogICAgICAgICAgdmFyIHRpbWVzdGFtcCA9IGRhdGUuZ2V0VGltZSgpOwogICAgICAgICAgdmFyIHRpbWUgPSAwOwogICAgICAgICAgdmFyIG9mZnNldDsKCiAgICAgICAgICBpZiAoZGF0ZVN0cmluZ3MudGltZSkgewogICAgICAgICAgICB0aW1lID0gcGFyc2VUaW1lKGRhdGVTdHJpbmdzLnRpbWUpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkYXRlU3RyaW5ncy50aW1lem9uZSkgewogICAgICAgICAgICBvZmZzZXQgPSBwYXJzZVRpbWV6b25lKGRhdGVTdHJpbmdzLnRpbWV6b25lKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGdldCBvZmZzZXQgYWNjdXJhdGUgdG8gaG91ciBpbiB0aW1lem9uZXMgdGhhdCBjaGFuZ2Ugb2Zmc2V0CiAgICAgICAgICAgIG9mZnNldCA9IG5ldyBEYXRlKHRpbWVzdGFtcCArIHRpbWUpLmdldFRpbWV6b25lT2Zmc2V0KCk7CiAgICAgICAgICAgIG9mZnNldCA9IG5ldyBEYXRlKHRpbWVzdGFtcCArIHRpbWUgKyBvZmZzZXQgKiBNSUxMSVNFQ09ORFNfSU5fTUlOVVRFKS5nZXRUaW1lem9uZU9mZnNldCgpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSh0aW1lc3RhbXAgKyB0aW1lICsgb2Zmc2V0ICogTUlMTElTRUNPTkRTX0lOX01JTlVURSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShhcmd1bWVudCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBzcGxpdERhdGVTdHJpbmcoZGF0ZVN0cmluZykgewogICAgICAgIHZhciBkYXRlU3RyaW5ncyA9IHt9OwogICAgICAgIHZhciBhcnJheSA9IGRhdGVTdHJpbmcuc3BsaXQocGFyc2VUb2tlbkRhdGVUaW1lRGVsaW1ldGVyKTsKICAgICAgICB2YXIgdGltZVN0cmluZzsKCiAgICAgICAgaWYgKHBhcnNlVG9rZW5QbGFpblRpbWUudGVzdChhcnJheVswXSkpIHsKICAgICAgICAgIGRhdGVTdHJpbmdzLmRhdGUgPSBudWxsOwogICAgICAgICAgdGltZVN0cmluZyA9IGFycmF5WzBdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkYXRlU3RyaW5ncy5kYXRlID0gYXJyYXlbMF07CiAgICAgICAgICB0aW1lU3RyaW5nID0gYXJyYXlbMV07CiAgICAgICAgfQoKICAgICAgICBpZiAodGltZVN0cmluZykgewogICAgICAgICAgdmFyIHRva2VuID0gcGFyc2VUb2tlblRpbWV6b25lLmV4ZWModGltZVN0cmluZyk7CgogICAgICAgICAgaWYgKHRva2VuKSB7CiAgICAgICAgICAgIGRhdGVTdHJpbmdzLnRpbWUgPSB0aW1lU3RyaW5nLnJlcGxhY2UodG9rZW5bMV0sICcnKTsKICAgICAgICAgICAgZGF0ZVN0cmluZ3MudGltZXpvbmUgPSB0b2tlblsxXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRhdGVTdHJpbmdzLnRpbWUgPSB0aW1lU3RyaW5nOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRhdGVTdHJpbmdzOwogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZVllYXIoZGF0ZVN0cmluZywgYWRkaXRpb25hbERpZ2l0cykgewogICAgICAgIHZhciBwYXJzZVRva2VuWVlZID0gcGFyc2VUb2tlbnNZWVlbYWRkaXRpb25hbERpZ2l0c107CiAgICAgICAgdmFyIHBhcnNlVG9rZW5ZWVlZWSA9IHBhcnNlVG9rZW5zWVlZWVlbYWRkaXRpb25hbERpZ2l0c107CiAgICAgICAgdmFyIHRva2VuOyAvLyBZWVlZIG9yIMKxWVlZWVkKCiAgICAgICAgdG9rZW4gPSBwYXJzZVRva2VuWVlZWS5leGVjKGRhdGVTdHJpbmcpIHx8IHBhcnNlVG9rZW5ZWVlZWS5leGVjKGRhdGVTdHJpbmcpOwoKICAgICAgICBpZiAodG9rZW4pIHsKICAgICAgICAgIHZhciB5ZWFyU3RyaW5nID0gdG9rZW5bMV07CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB5ZWFyOiBwYXJzZUludCh5ZWFyU3RyaW5nLCAxMCksCiAgICAgICAgICAgIHJlc3REYXRlU3RyaW5nOiBkYXRlU3RyaW5nLnNsaWNlKHllYXJTdHJpbmcubGVuZ3RoKQogICAgICAgICAgfTsKICAgICAgICB9IC8vIFlZIG9yIMKxWVlZCgoKICAgICAgICB0b2tlbiA9IHBhcnNlVG9rZW5ZWS5leGVjKGRhdGVTdHJpbmcpIHx8IHBhcnNlVG9rZW5ZWVkuZXhlYyhkYXRlU3RyaW5nKTsKCiAgICAgICAgaWYgKHRva2VuKSB7CiAgICAgICAgICB2YXIgY2VudHVyeVN0cmluZyA9IHRva2VuWzFdOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeWVhcjogcGFyc2VJbnQoY2VudHVyeVN0cmluZywgMTApICogMTAwLAogICAgICAgICAgICByZXN0RGF0ZVN0cmluZzogZGF0ZVN0cmluZy5zbGljZShjZW50dXJ5U3RyaW5nLmxlbmd0aCkKICAgICAgICAgIH07CiAgICAgICAgfSAvLyBJbnZhbGlkIElTTy1mb3JtYXR0ZWQgeWVhcgoKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHllYXI6IG51bGwKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZURhdGUoZGF0ZVN0cmluZywgeWVhcikgewogICAgICAgIC8vIEludmFsaWQgSVNPLWZvcm1hdHRlZCB5ZWFyCiAgICAgICAgaWYgKHllYXIgPT09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgdmFyIHRva2VuOwogICAgICAgIHZhciBkYXRlOwogICAgICAgIHZhciBtb250aDsKICAgICAgICB2YXIgd2VlazsgLy8gWVlZWQoKICAgICAgICBpZiAoZGF0ZVN0cmluZy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZSgwKTsKICAgICAgICAgIGRhdGUuc2V0VVRDRnVsbFllYXIoeWVhcik7CiAgICAgICAgICByZXR1cm4gZGF0ZTsKICAgICAgICB9IC8vIFlZWVktTU0KCgogICAgICAgIHRva2VuID0gcGFyc2VUb2tlbk1NLmV4ZWMoZGF0ZVN0cmluZyk7CgogICAgICAgIGlmICh0b2tlbikgewogICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKDApOwogICAgICAgICAgbW9udGggPSBwYXJzZUludCh0b2tlblsxXSwgMTApIC0gMTsKICAgICAgICAgIGRhdGUuc2V0VVRDRnVsbFllYXIoeWVhciwgbW9udGgpOwogICAgICAgICAgcmV0dXJuIGRhdGU7CiAgICAgICAgfSAvLyBZWVlZLURERCBvciBZWVlZRERECgoKICAgICAgICB0b2tlbiA9IHBhcnNlVG9rZW5EREQuZXhlYyhkYXRlU3RyaW5nKTsKCiAgICAgICAgaWYgKHRva2VuKSB7CiAgICAgICAgICBkYXRlID0gbmV3IERhdGUoMCk7CiAgICAgICAgICB2YXIgZGF5T2ZZZWFyID0gcGFyc2VJbnQodG9rZW5bMV0sIDEwKTsKICAgICAgICAgIGRhdGUuc2V0VVRDRnVsbFllYXIoeWVhciwgMCwgZGF5T2ZZZWFyKTsKICAgICAgICAgIHJldHVybiBkYXRlOwogICAgICAgIH0gLy8gWVlZWS1NTS1ERCBvciBZWVlZTU1ERAoKCiAgICAgICAgdG9rZW4gPSBwYXJzZVRva2VuTU1ERC5leGVjKGRhdGVTdHJpbmcpOwoKICAgICAgICBpZiAodG9rZW4pIHsKICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZSgwKTsKICAgICAgICAgIG1vbnRoID0gcGFyc2VJbnQodG9rZW5bMV0sIDEwKSAtIDE7CiAgICAgICAgICB2YXIgZGF5ID0gcGFyc2VJbnQodG9rZW5bMl0sIDEwKTsKICAgICAgICAgIGRhdGUuc2V0VVRDRnVsbFllYXIoeWVhciwgbW9udGgsIGRheSk7CiAgICAgICAgICByZXR1cm4gZGF0ZTsKICAgICAgICB9IC8vIFlZWVktV3d3IG9yIFlZWVlXd3cKCgogICAgICAgIHRva2VuID0gcGFyc2VUb2tlbld3dy5leGVjKGRhdGVTdHJpbmcpOwoKICAgICAgICBpZiAodG9rZW4pIHsKICAgICAgICAgIHdlZWsgPSBwYXJzZUludCh0b2tlblsxXSwgMTApIC0gMTsKICAgICAgICAgIHJldHVybiBkYXlPZklTT1llYXIoeWVhciwgd2Vlayk7CiAgICAgICAgfSAvLyBZWVlZLVd3dy1EIG9yIFlZWVlXd3dECgoKICAgICAgICB0b2tlbiA9IHBhcnNlVG9rZW5Xd3dELmV4ZWMoZGF0ZVN0cmluZyk7CgogICAgICAgIGlmICh0b2tlbikgewogICAgICAgICAgd2VlayA9IHBhcnNlSW50KHRva2VuWzFdLCAxMCkgLSAxOwogICAgICAgICAgdmFyIGRheU9mV2VlayA9IHBhcnNlSW50KHRva2VuWzJdLCAxMCkgLSAxOwogICAgICAgICAgcmV0dXJuIGRheU9mSVNPWWVhcih5ZWFyLCB3ZWVrLCBkYXlPZldlZWspOwogICAgICAgIH0gLy8gSW52YWxpZCBJU08tZm9ybWF0dGVkIGRhdGUKCgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZVRpbWUodGltZVN0cmluZykgewogICAgICAgIHZhciB0b2tlbjsKICAgICAgICB2YXIgaG91cnM7CiAgICAgICAgdmFyIG1pbnV0ZXM7IC8vIGhoCgogICAgICAgIHRva2VuID0gcGFyc2VUb2tlbkhILmV4ZWModGltZVN0cmluZyk7CgogICAgICAgIGlmICh0b2tlbikgewogICAgICAgICAgaG91cnMgPSBwYXJzZUZsb2F0KHRva2VuWzFdLnJlcGxhY2UoJywnLCAnLicpKTsKICAgICAgICAgIHJldHVybiBob3VycyAlIDI0ICogTUlMTElTRUNPTkRTX0lOX0hPVVI7CiAgICAgICAgfSAvLyBoaDptbSBvciBoaG1tCgoKICAgICAgICB0b2tlbiA9IHBhcnNlVG9rZW5ISE1NLmV4ZWModGltZVN0cmluZyk7CgogICAgICAgIGlmICh0b2tlbikgewogICAgICAgICAgaG91cnMgPSBwYXJzZUludCh0b2tlblsxXSwgMTApOwogICAgICAgICAgbWludXRlcyA9IHBhcnNlRmxvYXQodG9rZW5bMl0ucmVwbGFjZSgnLCcsICcuJykpOwogICAgICAgICAgcmV0dXJuIGhvdXJzICUgMjQgKiBNSUxMSVNFQ09ORFNfSU5fSE9VUiArIG1pbnV0ZXMgKiBNSUxMSVNFQ09ORFNfSU5fTUlOVVRFOwogICAgICAgIH0gLy8gaGg6bW06c3Mgb3IgaGhtbXNzCgoKICAgICAgICB0b2tlbiA9IHBhcnNlVG9rZW5ISE1NU1MuZXhlYyh0aW1lU3RyaW5nKTsKCiAgICAgICAgaWYgKHRva2VuKSB7CiAgICAgICAgICBob3VycyA9IHBhcnNlSW50KHRva2VuWzFdLCAxMCk7CiAgICAgICAgICBtaW51dGVzID0gcGFyc2VJbnQodG9rZW5bMl0sIDEwKTsKICAgICAgICAgIHZhciBzZWNvbmRzID0gcGFyc2VGbG9hdCh0b2tlblszXS5yZXBsYWNlKCcsJywgJy4nKSk7CiAgICAgICAgICByZXR1cm4gaG91cnMgJSAyNCAqIE1JTExJU0VDT05EU19JTl9IT1VSICsgbWludXRlcyAqIE1JTExJU0VDT05EU19JTl9NSU5VVEUgKyBzZWNvbmRzICogMTAwMDsKICAgICAgICB9IC8vIEludmFsaWQgSVNPLWZvcm1hdHRlZCB0aW1lCgoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcGFyc2VUaW1lem9uZSh0aW1lem9uZVN0cmluZykgewogICAgICAgIHZhciB0b2tlbjsKICAgICAgICB2YXIgYWJzb2x1dGVPZmZzZXQ7IC8vIFoKCiAgICAgICAgdG9rZW4gPSBwYXJzZVRva2VuVGltZXpvbmVaLmV4ZWModGltZXpvbmVTdHJpbmcpOwoKICAgICAgICBpZiAodG9rZW4pIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0gLy8gwrFoaAoKCiAgICAgICAgdG9rZW4gPSBwYXJzZVRva2VuVGltZXpvbmVISC5leGVjKHRpbWV6b25lU3RyaW5nKTsKCiAgICAgICAgaWYgKHRva2VuKSB7CiAgICAgICAgICBhYnNvbHV0ZU9mZnNldCA9IHBhcnNlSW50KHRva2VuWzJdLCAxMCkgKiA2MDsKICAgICAgICAgIHJldHVybiB0b2tlblsxXSA9PT0gJysnID8gLWFic29sdXRlT2Zmc2V0IDogYWJzb2x1dGVPZmZzZXQ7CiAgICAgICAgfSAvLyDCsWhoOm1tIG9yIMKxaGhtbQoKCiAgICAgICAgdG9rZW4gPSBwYXJzZVRva2VuVGltZXpvbmVISE1NLmV4ZWModGltZXpvbmVTdHJpbmcpOwoKICAgICAgICBpZiAodG9rZW4pIHsKICAgICAgICAgIGFic29sdXRlT2Zmc2V0ID0gcGFyc2VJbnQodG9rZW5bMl0sIDEwKSAqIDYwICsgcGFyc2VJbnQodG9rZW5bM10sIDEwKTsKICAgICAgICAgIHJldHVybiB0b2tlblsxXSA9PT0gJysnID8gLWFic29sdXRlT2Zmc2V0IDogYWJzb2x1dGVPZmZzZXQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZGF5T2ZJU09ZZWFyKGlzb1llYXIsIHdlZWssIGRheSkgewogICAgICAgIHdlZWsgPSB3ZWVrIHx8IDA7CiAgICAgICAgZGF5ID0gZGF5IHx8IDA7CiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgwKTsKICAgICAgICBkYXRlLnNldFVUQ0Z1bGxZZWFyKGlzb1llYXIsIDAsIDQpOwogICAgICAgIHZhciBmb3VydGhPZkphbnVhcnlEYXkgPSBkYXRlLmdldFVUQ0RheSgpIHx8IDc7CiAgICAgICAgdmFyIGRpZmYgPSB3ZWVrICogNyArIGRheSArIDEgLSBmb3VydGhPZkphbnVhcnlEYXk7CiAgICAgICAgZGF0ZS5zZXRVVENEYXRlKGRhdGUuZ2V0VVRDRGF0ZSgpICsgZGlmZik7CiAgICAgICAgcmV0dXJuIGRhdGU7CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyc2U7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChiaXRtYXAsIHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGVudW1lcmFibGU6ICEoYml0bWFwICYgMSksCiAgICAgICAgICBjb25maWd1cmFibGU6ICEoYml0bWFwICYgMiksCiAgICAgICAgICB3cml0YWJsZTogIShiaXRtYXAgJiA0KSwKICAgICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICAgIH07CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDIwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgdmFyICRhdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTAxKSh0cnVlKTsgLy8gMjEuMS4zLjI3IFN0cmluZy5wcm90b3R5cGVbQEBpdGVyYXRvcl0oKQoKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oNTEpKFN0cmluZywgJ1N0cmluZycsIGZ1bmN0aW9uIChpdGVyYXRlZCkgewogICAgICAgIHRoaXMuX3QgPSBTdHJpbmcoaXRlcmF0ZWQpOyAvLyB0YXJnZXQKCiAgICAgICAgdGhpcy5faSA9IDA7IC8vIG5leHQgaW5kZXgKICAgICAgICAvLyAyMS4xLjUuMi4xICVTdHJpbmdJdGVyYXRvclByb3RvdHlwZSUubmV4dCgpCiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgTyA9IHRoaXMuX3Q7CiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5faTsKICAgICAgICB2YXIgcG9pbnQ7CiAgICAgICAgaWYgKGluZGV4ID49IE8ubGVuZ3RoKSByZXR1cm4gewogICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICB9OwogICAgICAgIHBvaW50ID0gJGF0KE8sIGluZGV4KTsKICAgICAgICB0aGlzLl9pICs9IHBvaW50Lmxlbmd0aDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdmFsdWU6IHBvaW50LAogICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICB9OwogICAgICB9KTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMjEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IHRydWU7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyAxOS4xLjIuMTQgLyAxNS4yLjMuMTQgT2JqZWN0LmtleXMoTykKICAgICAgdmFyICRrZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1Myk7CgogICAgICB2YXIgZW51bUJ1Z0tleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQwKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24ga2V5cyhPKSB7CiAgICAgICAgcmV0dXJuICRrZXlzKE8sIGVudW1CdWdLZXlzKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMjMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICB2YXIgdG9TdHJpbmcgPSB7fS50b1N0cmluZzsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwoaXQpLnNsaWNlKDgsIC0xKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMjQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICAgIGlmICh0eXBlb2YgaXQgIT0gJ2Z1bmN0aW9uJykgdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYSBmdW5jdGlvbiEnKTsKICAgICAgICByZXR1cm4gaXQ7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDI1ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgdmFyIGlkID0gMDsKICAgICAgdmFyIHB4ID0gTWF0aC5yYW5kb20oKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIHJldHVybiAnU3ltYm9sKCcuY29uY2F0KGtleSA9PT0gdW5kZWZpbmVkID8gJycgOiBrZXksICcpXycsICgrK2lkICsgcHgpLnRvU3RyaW5nKDM2KSk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDI2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGRlZiA9IF9fd2VicGFja19yZXF1aXJlX18oNykuZjsKCiAgICAgIHZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsKCiAgICAgIHZhciBUQUcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpKCd0b1N0cmluZ1RhZycpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIHRhZywgc3RhdCkgewogICAgICAgIGlmIChpdCAmJiAhaGFzKGl0ID0gc3RhdCA/IGl0IDogaXQucHJvdG90eXBlLCBUQUcpKSBkZWYoaXQsIFRBRywgewogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgdmFsdWU6IHRhZwogICAgICAgIH0pOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAyNyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMTA2KTsKCiAgICAgIHZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICAgICAgdmFyIGhpZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsKCiAgICAgIHZhciBJdGVyYXRvcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KTsKCiAgICAgIHZhciBUT19TVFJJTkdfVEFHID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKSgndG9TdHJpbmdUYWcnKTsKCiAgICAgIHZhciBET01JdGVyYWJsZXMgPSAoJ0NTU1J1bGVMaXN0LENTU1N0eWxlRGVjbGFyYXRpb24sQ1NTVmFsdWVMaXN0LENsaWVudFJlY3RMaXN0LERPTVJlY3RMaXN0LERPTVN0cmluZ0xpc3QsJyArICdET01Ub2tlbkxpc3QsRGF0YVRyYW5zZmVySXRlbUxpc3QsRmlsZUxpc3QsSFRNTEFsbENvbGxlY3Rpb24sSFRNTENvbGxlY3Rpb24sSFRNTEZvcm1FbGVtZW50LEhUTUxTZWxlY3RFbGVtZW50LCcgKyAnTWVkaWFMaXN0LE1pbWVUeXBlQXJyYXksTmFtZWROb2RlTWFwLE5vZGVMaXN0LFBhaW50UmVxdWVzdExpc3QsUGx1Z2luLFBsdWdpbkFycmF5LFNWR0xlbmd0aExpc3QsU1ZHTnVtYmVyTGlzdCwnICsgJ1NWR1BhdGhTZWdMaXN0LFNWR1BvaW50TGlzdCxTVkdTdHJpbmdMaXN0LFNWR1RyYW5zZm9ybUxpc3QsU291cmNlQnVmZmVyTGlzdCxTdHlsZVNoZWV0TGlzdCxUZXh0VHJhY2tDdWVMaXN0LCcgKyAnVGV4dFRyYWNrTGlzdCxUb3VjaExpc3QnKS5zcGxpdCgnLCcpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBET01JdGVyYWJsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgTkFNRSA9IERPTUl0ZXJhYmxlc1tpXTsKICAgICAgICB2YXIgQ29sbGVjdGlvbiA9IGdsb2JhbFtOQU1FXTsKICAgICAgICB2YXIgcHJvdG8gPSBDb2xsZWN0aW9uICYmIENvbGxlY3Rpb24ucHJvdG90eXBlOwogICAgICAgIGlmIChwcm90byAmJiAhcHJvdG9bVE9fU1RSSU5HX1RBR10pIGhpZGUocHJvdG8sIFRPX1NUUklOR19UQUcsIE5BTUUpOwogICAgICAgIEl0ZXJhdG9yc1tOQU1FXSA9IEl0ZXJhdG9ycy5BcnJheTsKICAgICAgfQogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAyOCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIGV4cG9ydHMuZiA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDI5ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCiAgICAgIGV4cG9ydHNbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICAgICAgICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICAgICAgfQogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAzMCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIGV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CgogICAgICB2YXIgX2RlZmluZVByb3BlcnR5ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4Myk7CgogICAgICB2YXIgX2RlZmluZVByb3BlcnR5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2RlZmluZVByb3BlcnR5KTsKCiAgICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgICAgICAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgICAgICAgICJkZWZhdWx0Ijogb2JqCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgICAgICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgICAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyWyJkZWZhdWx0Il0pKHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgICAgICAgIGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICAgICAgICBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgICAgICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICAgICAgICB9OwogICAgICB9KCk7CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDMxICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7CgogICAgICB2YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpLmRvY3VtZW50OyAvLyB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCBpcyAnb2JqZWN0JyBpbiBvbGQgSUUKCgogICAgICB2YXIgaXMgPSBpc09iamVjdChkb2N1bWVudCkgJiYgaXNPYmplY3QoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICAgIHJldHVybiBpcyA/IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoaXQpIDoge307CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDMyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gNy4xLjEgVG9QcmltaXRpdmUoaW5wdXQgWywgUHJlZmVycmVkVHlwZV0pCiAgICAgIHZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTApOyAvLyBpbnN0ZWFkIG9mIHRoZSBFUzYgc3BlYyB2ZXJzaW9uLCB3ZSBkaWRuJ3QgaW1wbGVtZW50IEBAdG9QcmltaXRpdmUgY2FzZQogICAgICAvLyBhbmQgdGhlIHNlY29uZCBhcmd1bWVudCAtIGZsYWcgLSBwcmVmZXJyZWQgdHlwZSBpcyBhIHN0cmluZwoKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBTKSB7CiAgICAgICAgaWYgKCFpc09iamVjdChpdCkpIHJldHVybiBpdDsKICAgICAgICB2YXIgZm4sIHZhbDsKICAgICAgICBpZiAoUyAmJiB0eXBlb2YgKGZuID0gaXQudG9TdHJpbmcpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaXQpKSkgcmV0dXJuIHZhbDsKICAgICAgICBpZiAodHlwZW9mIChmbiA9IGl0LnZhbHVlT2YpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaXQpKSkgcmV0dXJuIHZhbDsKICAgICAgICBpZiAoIVMgJiYgdHlwZW9mIChmbiA9IGl0LnRvU3RyaW5nKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGl0KSkpIHJldHVybiB2YWw7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMzMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIC8qKgogICAgICAgKiBDb3B5cmlnaHQgKGMpIDIwMTMtcHJlc2VudCwgRmFjZWJvb2ssIEluYy4KICAgICAgICoKICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICovCgogICAgICB2YXIgUmVhY3RQcm9wVHlwZXNTZWNyZXQgPSAnU0VDUkVUX0RPX05PVF9QQVNTX1RISVNfT1JfWU9VX1dJTExfQkVfRklSRUQnOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IFJlYWN0UHJvcFR5cGVzU2VjcmV0OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDM0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgLy8gNy4xLjQgVG9JbnRlZ2VyCiAgICAgIHZhciBjZWlsID0gTWF0aC5jZWlsOwogICAgICB2YXIgZmxvb3IgPSBNYXRoLmZsb29yOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICByZXR1cm4gaXNOYU4oaXQgPSAraXQpID8gMCA6IChpdCA+IDAgPyBmbG9vciA6IGNlaWwpKGl0KTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMzUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICAvLyA3LjIuMSBSZXF1aXJlT2JqZWN0Q29lcmNpYmxlKGFyZ3VtZW50KQogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICAgIGlmIChpdCA9PSB1bmRlZmluZWQpIHRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gICIgKyBpdCk7CiAgICAgICAgcmV0dXJuIGl0OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAzNiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIDE5LjEuMi4yIC8gMTUuMi4zLjUgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKQogICAgICB2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwoKICAgICAgdmFyIGRQcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTAzKTsKCiAgICAgIHZhciBlbnVtQnVnS2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oNDApOwoKICAgICAgdmFyIElFX1BST1RPID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOCkoJ0lFX1BST1RPJyk7CgogICAgICB2YXIgRW1wdHkgPSBmdW5jdGlvbiBFbXB0eSgpIHsKICAgICAgICAvKiBlbXB0eSAqLwogICAgICB9OwoKICAgICAgdmFyIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnOyAvLyBDcmVhdGUgb2JqZWN0IHdpdGggZmFrZSBgbnVsbGAgcHJvdG90eXBlOiB1c2UgaWZyYW1lIE9iamVjdCB3aXRoIGNsZWFyZWQgcHJvdG90eXBlCgogICAgICB2YXIgX2NyZWF0ZURpY3QgPSBmdW5jdGlvbiBjcmVhdGVEaWN0KCkgewogICAgICAgIC8vIFRocmFzaCwgd2FzdGUgYW5kIHNvZG9teTogSUUgR0MgYnVnCiAgICAgICAgdmFyIGlmcmFtZSA9IF9fd2VicGFja19yZXF1aXJlX18oMzEpKCdpZnJhbWUnKTsKCiAgICAgICAgdmFyIGkgPSBlbnVtQnVnS2V5cy5sZW5ndGg7CiAgICAgICAgdmFyIGx0ID0gJzwnOwogICAgICAgIHZhciBndCA9ICc+JzsKICAgICAgICB2YXIgaWZyYW1lRG9jdW1lbnQ7CiAgICAgICAgaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18oNTUpLmFwcGVuZENoaWxkKGlmcmFtZSk7CgogICAgICAgIGlmcmFtZS5zcmMgPSAnamF2YXNjcmlwdDonOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXNjcmlwdC11cmwKICAgICAgICAvLyBjcmVhdGVEaWN0ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuT2JqZWN0OwogICAgICAgIC8vIGh0bWwucmVtb3ZlQ2hpbGQoaWZyYW1lKTsKCiAgICAgICAgaWZyYW1lRG9jdW1lbnQgPSBpZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudDsKICAgICAgICBpZnJhbWVEb2N1bWVudC5vcGVuKCk7CiAgICAgICAgaWZyYW1lRG9jdW1lbnQud3JpdGUobHQgKyAnc2NyaXB0JyArIGd0ICsgJ2RvY3VtZW50LkY9T2JqZWN0JyArIGx0ICsgJy9zY3JpcHQnICsgZ3QpOwogICAgICAgIGlmcmFtZURvY3VtZW50LmNsb3NlKCk7CiAgICAgICAgX2NyZWF0ZURpY3QgPSBpZnJhbWVEb2N1bWVudC5GOwoKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICBkZWxldGUgX2NyZWF0ZURpY3RbUFJPVE9UWVBFXVtlbnVtQnVnS2V5c1tpXV07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX2NyZWF0ZURpY3QoKTsKICAgICAgfTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gT2JqZWN0LmNyZWF0ZSB8fCBmdW5jdGlvbiBjcmVhdGUoTywgUHJvcGVydGllcykgewogICAgICAgIHZhciByZXN1bHQ7CgogICAgICAgIGlmIChPICE9PSBudWxsKSB7CiAgICAgICAgICBFbXB0eVtQUk9UT1RZUEVdID0gYW5PYmplY3QoTyk7CiAgICAgICAgICByZXN1bHQgPSBuZXcgRW1wdHkoKTsKICAgICAgICAgIEVtcHR5W1BST1RPVFlQRV0gPSBudWxsOyAvLyBhZGQgIl9fcHJvdG9fXyIgZm9yIE9iamVjdC5nZXRQcm90b3R5cGVPZiBwb2x5ZmlsbAoKICAgICAgICAgIHJlc3VsdFtJRV9QUk9UT10gPSBPOwogICAgICAgIH0gZWxzZSByZXN1bHQgPSBfY3JlYXRlRGljdCgpOwoKICAgICAgICByZXR1cm4gUHJvcGVydGllcyA9PT0gdW5kZWZpbmVkID8gcmVzdWx0IDogZFBzKHJlc3VsdCwgUHJvcGVydGllcyk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDM3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gNy4xLjE1IFRvTGVuZ3RoCiAgICAgIHZhciB0b0ludGVnZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM0KTsKCiAgICAgIHZhciBtaW4gPSBNYXRoLm1pbjsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIGl0ID4gMCA/IG1pbih0b0ludGVnZXIoaXQpLCAweDFmZmZmZmZmZmZmZmZmKSA6IDA7IC8vIHBvdygyLCA1MykgLSAxID09IDkwMDcxOTkyNTQ3NDA5OTEKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMzggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgc2hhcmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOSkoJ2tleXMnKTsKCiAgICAgIHZhciB1aWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI1KTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIHJldHVybiBzaGFyZWRba2V5XSB8fCAoc2hhcmVkW2tleV0gPSB1aWQoa2V5KSk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDM5ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGNvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApOwoKICAgICAgdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogICAgICB2YXIgU0hBUkVEID0gJ19fY29yZS1qc19zaGFyZWRfXyc7CiAgICAgIHZhciBzdG9yZSA9IGdsb2JhbFtTSEFSRURdIHx8IChnbG9iYWxbU0hBUkVEXSA9IHt9KTsKICAgICAgKG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICByZXR1cm4gc3RvcmVba2V5XSB8fCAoc3RvcmVba2V5XSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IHt9KTsKICAgICAgfSkoJ3ZlcnNpb25zJywgW10pLnB1c2goewogICAgICAgIHZlcnNpb246IGNvcmUudmVyc2lvbiwKICAgICAgICBtb2RlOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKSA/ICdwdXJlJyA6ICdnbG9iYWwnLAogICAgICAgIGNvcHlyaWdodDogJ8KpIDIwMTkgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSknCiAgICAgIH0pOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDQwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgLy8gSUUgOC0gZG9uJ3QgZW51bSBidWcga2V5cwogICAgICBtb2R1bGUuZXhwb3J0cyA9ICdjb25zdHJ1Y3RvcixoYXNPd25Qcm9wZXJ0eSxpc1Byb3RvdHlwZU9mLHByb3BlcnR5SXNFbnVtZXJhYmxlLHRvTG9jYWxlU3RyaW5nLHRvU3RyaW5nLHZhbHVlT2YnLnNwbGl0KCcsJyk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNDEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBnZXR0aW5nIHRhZyBmcm9tIDE5LjEuMy42IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcoKQogICAgICB2YXIgY29mID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMyk7CgogICAgICB2YXIgVEFHID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKSgndG9TdHJpbmdUYWcnKTsgLy8gRVMzIHdyb25nIGhlcmUKCgogICAgICB2YXIgQVJHID0gY29mKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzOwogICAgICB9KCkpID09ICdBcmd1bWVudHMnOyAvLyBmYWxsYmFjayBmb3IgSUUxMSBTY3JpcHQgQWNjZXNzIERlbmllZCBlcnJvcgoKICAgICAgdmFyIHRyeUdldCA9IGZ1bmN0aW9uIHRyeUdldChpdCwga2V5KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBpdFtrZXldOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIC8qIGVtcHR5ICovCiAgICAgICAgfQogICAgICB9OwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICB2YXIgTywgVCwgQjsKICAgICAgICByZXR1cm4gaXQgPT09IHVuZGVmaW5lZCA/ICdVbmRlZmluZWQnIDogaXQgPT09IG51bGwgPyAnTnVsbCcgLy8gQEB0b1N0cmluZ1RhZyBjYXNlCiAgICAgICAgOiB0eXBlb2YgKFQgPSB0cnlHZXQoTyA9IE9iamVjdChpdCksIFRBRykpID09ICdzdHJpbmcnID8gVCAvLyBidWlsdGluVGFnIGNhc2UKICAgICAgICA6IEFSRyA/IGNvZihPKSAvLyBFUzMgYXJndW1lbnRzIGZhbGxiYWNrCiAgICAgICAgOiAoQiA9IGNvZihPKSkgPT0gJ09iamVjdCcgJiYgdHlwZW9mIE8uY2FsbGVlID09ICdmdW5jdGlvbicgPyAnQXJndW1lbnRzJyA6IEI7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDQyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGNsYXNzb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxKTsKCiAgICAgIHZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMikoJ2l0ZXJhdG9yJyk7CgogICAgICB2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkuZ2V0SXRlcmF0b3JNZXRob2QgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICBpZiAoaXQgIT0gdW5kZWZpbmVkKSByZXR1cm4gaXRbSVRFUkFUT1JdIHx8IGl0WydAQGl0ZXJhdG9yJ10gfHwgSXRlcmF0b3JzW2NsYXNzb2YoaXQpXTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNDMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7IC8vIDI1LjQuMS41IE5ld1Byb21pc2VDYXBhYmlsaXR5KEMpCgogICAgICB2YXIgYUZ1bmN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNCk7CgogICAgICBmdW5jdGlvbiBQcm9taXNlQ2FwYWJpbGl0eShDKSB7CiAgICAgICAgdmFyIHJlc29sdmUsIHJlamVjdDsKICAgICAgICB0aGlzLnByb21pc2UgPSBuZXcgQyhmdW5jdGlvbiAoJCRyZXNvbHZlLCAkJHJlamVjdCkgewogICAgICAgICAgaWYgKHJlc29sdmUgIT09IHVuZGVmaW5lZCB8fCByZWplY3QgIT09IHVuZGVmaW5lZCkgdGhyb3cgVHlwZUVycm9yKCdCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvcicpOwogICAgICAgICAgcmVzb2x2ZSA9ICQkcmVzb2x2ZTsKICAgICAgICAgIHJlamVjdCA9ICQkcmVqZWN0OwogICAgICAgIH0pOwogICAgICAgIHRoaXMucmVzb2x2ZSA9IGFGdW5jdGlvbihyZXNvbHZlKTsKICAgICAgICB0aGlzLnJlamVjdCA9IGFGdW5jdGlvbihyZWplY3QpOwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cy5mID0gZnVuY3Rpb24gKEMpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2VDYXBhYmlsaXR5KEMpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA0NCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIGV4cG9ydHMuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNDUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBleHBvcnRzLmYgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDQ2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogICAgICB2YXIgY29yZSA9IF9fd2VicGFja19yZXF1aXJlX18oMCk7CgogICAgICB2YXIgTElCUkFSWSA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpOwoKICAgICAgdmFyIHdrc0V4dCA9IF9fd2VicGFja19yZXF1aXJlX18oNDUpOwoKICAgICAgdmFyIGRlZmluZVByb3BlcnR5ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KS5mOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAobmFtZSkgewogICAgICAgIHZhciAkU3ltYm9sID0gY29yZS5TeW1ib2wgfHwgKGNvcmUuU3ltYm9sID0gTElCUkFSWSA/IHt9IDogZ2xvYmFsLlN5bWJvbCB8fCB7fSk7CiAgICAgICAgaWYgKG5hbWUuY2hhckF0KDApICE9ICdfJyAmJiAhKG5hbWUgaW4gJFN5bWJvbCkpIGRlZmluZVByb3BlcnR5KCRTeW1ib2wsIG5hbWUsIHsKICAgICAgICAgIHZhbHVlOiB3a3NFeHQuZihuYW1lKQogICAgICAgIH0pOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA0NyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgICB2YWx1ZTogdHJ1ZQogICAgICB9KTsKICAgICAgZXhwb3J0cy5vbWl0ID0gb21pdDsKICAgICAgZXhwb3J0cy5hcnJheXNFcXVhbCA9IGFycmF5c0VxdWFsOwoKICAgICAgdmFyIGlzRWxlbWVudEFuU0ZDID0gZXhwb3J0cy5pc0VsZW1lbnRBblNGQyA9IGZ1bmN0aW9uIGlzRWxlbWVudEFuU0ZDKGVsZW1lbnQpIHsKICAgICAgICB2YXIgaXNOYXRpdmVET01FbGVtZW50ID0gdHlwZW9mIGVsZW1lbnQudHlwZSA9PT0gJ3N0cmluZyc7CgogICAgICAgIGlmIChpc05hdGl2ZURPTUVsZW1lbnQpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAhZWxlbWVudC50eXBlLnByb3RvdHlwZS5pc1JlYWN0Q29tcG9uZW50OwogICAgICB9OwoKICAgICAgZnVuY3Rpb24gb21pdChvYmopIHsKICAgICAgICB2YXIgYXR0cnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IFtdOwogICAgICAgIHZhciByZXN1bHQgPSB7fTsKICAgICAgICBPYmplY3Qua2V5cyhvYmopLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgaWYgKGF0dHJzLmluZGV4T2Yoa2V5KSA9PT0gLTEpIHsKICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CgogICAgICBmdW5jdGlvbiBhcnJheXNFcXVhbChhLCBiKSB7CiAgICAgICAgdmFyIHNhbWVPYmplY3QgPSBhID09PSBiOwoKICAgICAgICBpZiAoc2FtZU9iamVjdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICB2YXIgbm90Qm90aEFycmF5cyA9ICFBcnJheS5pc0FycmF5KGEpIHx8ICFBcnJheS5pc0FycmF5KGIpOwogICAgICAgIHZhciBkaWZmZXJlbnRMZW5ndGhzID0gYS5sZW5ndGggIT09IGIubGVuZ3RoOwoKICAgICAgICBpZiAobm90Qm90aEFycmF5cyB8fCBkaWZmZXJlbnRMZW5ndGhzKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYS5ldmVyeShmdW5jdGlvbiAoZWxlbWVudCwgaW5kZXgpIHsKICAgICAgICAgIHJldHVybiBlbGVtZW50ID09PSBiW2luZGV4XTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbWVtb2l6ZVN0cmluZyhmbikgewogICAgICAgIHZhciBjYWNoZSA9IHt9OwogICAgICAgIHJldHVybiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgICBpZiAoIWNhY2hlW3N0cl0pIHsKICAgICAgICAgICAgY2FjaGVbc3RyXSA9IGZuKHN0cik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGNhY2hlW3N0cl07CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgdmFyIGh5cGhlbmF0ZSA9IGV4cG9ydHMuaHlwaGVuYXRlID0gbWVtb2l6ZVN0cmluZyhmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oW0EtWl0pL2csICctJDEnKS50b0xvd2VyQ2FzZSgpOwogICAgICB9KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA0OCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gIV9fd2VicGFja19yZXF1aXJlX18oOCkgJiYgIV9fd2VicGFja19yZXF1aXJlX18oMTQpKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KF9fd2VicGFja19yZXF1aXJlX18oMzEpKCdkaXYnKSwgJ2EnLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIDc7CiAgICAgICAgICB9CiAgICAgICAgfSkuYSAhPSA3OwogICAgICB9KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA0OSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovCgogICAgICAoZnVuY3Rpb24gKHByb2Nlc3MpIHsKICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg3KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg4KTsKICAgICAgICB9CiAgICAgICAgLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovCgogICAgICB9KS5jYWxsKGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18oOSkpOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDUwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA1MSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciBMSUJSQVJZID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMSk7CgogICAgICB2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7CgogICAgICB2YXIgcmVkZWZpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyKTsKCiAgICAgIHZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMSk7CgogICAgICB2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7CgogICAgICB2YXIgJGl0ZXJDcmVhdGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwMik7CgogICAgICB2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI2KTsKCiAgICAgIHZhciBnZXRQcm90b3R5cGVPZiA9IF9fd2VicGFja19yZXF1aXJlX18oNTYpOwoKICAgICAgdmFyIElURVJBVE9SID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKSgnaXRlcmF0b3InKTsKCiAgICAgIHZhciBCVUdHWSA9ICEoW10ua2V5cyAmJiAnbmV4dCcgaW4gW10ua2V5cygpKTsgLy8gU2FmYXJpIGhhcyBidWdneSBpdGVyYXRvcnMgdy9vIGBuZXh0YAoKICAgICAgdmFyIEZGX0lURVJBVE9SID0gJ0BAaXRlcmF0b3InOwogICAgICB2YXIgS0VZUyA9ICdrZXlzJzsKICAgICAgdmFyIFZBTFVFUyA9ICd2YWx1ZXMnOwoKICAgICAgdmFyIHJldHVyblRoaXMgPSBmdW5jdGlvbiByZXR1cm5UaGlzKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQmFzZSwgTkFNRSwgQ29uc3RydWN0b3IsIG5leHQsIERFRkFVTFQsIElTX1NFVCwgRk9SQ0VEKSB7CiAgICAgICAgJGl0ZXJDcmVhdGUoQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpOwoKICAgICAgICB2YXIgZ2V0TWV0aG9kID0gZnVuY3Rpb24gZ2V0TWV0aG9kKGtpbmQpIHsKICAgICAgICAgIGlmICghQlVHR1kgJiYga2luZCBpbiBwcm90bykgcmV0dXJuIHByb3RvW2tpbmRdOwoKICAgICAgICAgIHN3aXRjaCAoa2luZCkgewogICAgICAgICAgICBjYXNlIEtFWVM6CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGtleXMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICBjYXNlIFZBTFVFUzoKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gdmFsdWVzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDb25zdHJ1Y3Rvcih0aGlzLCBraW5kKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBlbnRyaWVzKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOwogICAgICAgICAgfTsKICAgICAgICB9OwoKICAgICAgICB2YXIgVEFHID0gTkFNRSArICcgSXRlcmF0b3InOwogICAgICAgIHZhciBERUZfVkFMVUVTID0gREVGQVVMVCA9PSBWQUxVRVM7CiAgICAgICAgdmFyIFZBTFVFU19CVUcgPSBmYWxzZTsKICAgICAgICB2YXIgcHJvdG8gPSBCYXNlLnByb3RvdHlwZTsKICAgICAgICB2YXIgJG5hdGl2ZSA9IHByb3RvW0lURVJBVE9SXSB8fCBwcm90b1tGRl9JVEVSQVRPUl0gfHwgREVGQVVMVCAmJiBwcm90b1tERUZBVUxUXTsKICAgICAgICB2YXIgJGRlZmF1bHQgPSAkbmF0aXZlIHx8IGdldE1ldGhvZChERUZBVUxUKTsKICAgICAgICB2YXIgJGVudHJpZXMgPSBERUZBVUxUID8gIURFRl9WQUxVRVMgPyAkZGVmYXVsdCA6IGdldE1ldGhvZCgnZW50cmllcycpIDogdW5kZWZpbmVkOwogICAgICAgIHZhciAkYW55TmF0aXZlID0gTkFNRSA9PSAnQXJyYXknID8gcHJvdG8uZW50cmllcyB8fCAkbmF0aXZlIDogJG5hdGl2ZTsKICAgICAgICB2YXIgbWV0aG9kcywga2V5LCBJdGVyYXRvclByb3RvdHlwZTsgLy8gRml4IG5hdGl2ZQoKICAgICAgICBpZiAoJGFueU5hdGl2ZSkgewogICAgICAgICAgSXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90b3R5cGVPZigkYW55TmF0aXZlLmNhbGwobmV3IEJhc2UoKSkpOwoKICAgICAgICAgIGlmIChJdGVyYXRvclByb3RvdHlwZSAhPT0gT2JqZWN0LnByb3RvdHlwZSAmJiBJdGVyYXRvclByb3RvdHlwZS5uZXh0KSB7CiAgICAgICAgICAgIC8vIFNldCBAQHRvU3RyaW5nVGFnIHRvIG5hdGl2ZSBpdGVyYXRvcnMKICAgICAgICAgICAgc2V0VG9TdHJpbmdUYWcoSXRlcmF0b3JQcm90b3R5cGUsIFRBRywgdHJ1ZSk7IC8vIGZpeCBmb3Igc29tZSBvbGQgZW5naW5lcwoKICAgICAgICAgICAgaWYgKCFMSUJSQVJZICYmIHR5cGVvZiBJdGVyYXRvclByb3RvdHlwZVtJVEVSQVRPUl0gIT0gJ2Z1bmN0aW9uJykgaGlkZShJdGVyYXRvclByb3RvdHlwZSwgSVRFUkFUT1IsIHJldHVyblRoaXMpOwogICAgICAgICAgfQogICAgICAgIH0gLy8gZml4IEFycmF5I3t2YWx1ZXMsIEBAaXRlcmF0b3J9Lm5hbWUgaW4gVjggLyBGRgoKCiAgICAgICAgaWYgKERFRl9WQUxVRVMgJiYgJG5hdGl2ZSAmJiAkbmF0aXZlLm5hbWUgIT09IFZBTFVFUykgewogICAgICAgICAgVkFMVUVTX0JVRyA9IHRydWU7CgogICAgICAgICAgJGRlZmF1bHQgPSBmdW5jdGlvbiB2YWx1ZXMoKSB7CiAgICAgICAgICAgIHJldHVybiAkbmF0aXZlLmNhbGwodGhpcyk7CiAgICAgICAgICB9OwogICAgICAgIH0gLy8gRGVmaW5lIGl0ZXJhdG9yCgoKICAgICAgICBpZiAoKCFMSUJSQVJZIHx8IEZPUkNFRCkgJiYgKEJVR0dZIHx8IFZBTFVFU19CVUcgfHwgIXByb3RvW0lURVJBVE9SXSkpIHsKICAgICAgICAgIGhpZGUocHJvdG8sIElURVJBVE9SLCAkZGVmYXVsdCk7CiAgICAgICAgfSAvLyBQbHVnIGZvciBsaWJyYXJ5CgoKICAgICAgICBJdGVyYXRvcnNbTkFNRV0gPSAkZGVmYXVsdDsKICAgICAgICBJdGVyYXRvcnNbVEFHXSA9IHJldHVyblRoaXM7CgogICAgICAgIGlmIChERUZBVUxUKSB7CiAgICAgICAgICBtZXRob2RzID0gewogICAgICAgICAgICB2YWx1ZXM6IERFRl9WQUxVRVMgPyAkZGVmYXVsdCA6IGdldE1ldGhvZChWQUxVRVMpLAogICAgICAgICAgICBrZXlzOiBJU19TRVQgPyAkZGVmYXVsdCA6IGdldE1ldGhvZChLRVlTKSwKICAgICAgICAgICAgZW50cmllczogJGVudHJpZXMKICAgICAgICAgIH07CiAgICAgICAgICBpZiAoRk9SQ0VEKSBmb3IgKGtleSBpbiBtZXRob2RzKSB7CiAgICAgICAgICAgIGlmICghKGtleSBpbiBwcm90bykpIHJlZGVmaW5lKHByb3RvLCBrZXksIG1ldGhvZHNba2V5XSk7CiAgICAgICAgICB9IGVsc2UgJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAoQlVHR1kgfHwgVkFMVUVTX0JVRyksIE5BTUUsIG1ldGhvZHMpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1ldGhvZHM7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDUyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA1MyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsKCiAgICAgIHZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2KTsKCiAgICAgIHZhciBhcnJheUluZGV4T2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwNCkoZmFsc2UpOwoKICAgICAgdmFyIElFX1BST1RPID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOCkoJ0lFX1BST1RPJyk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvYmplY3QsIG5hbWVzKSB7CiAgICAgICAgdmFyIE8gPSB0b0lPYmplY3Qob2JqZWN0KTsKICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgIHZhciBrZXk7CgogICAgICAgIGZvciAoa2V5IGluIE8pIHsKICAgICAgICAgIGlmIChrZXkgIT0gSUVfUFJPVE8pIGhhcyhPLCBrZXkpICYmIHJlc3VsdC5wdXNoKGtleSk7CiAgICAgICAgfSAvLyBEb24ndCBlbnVtIGJ1ZyAmIGhpZGRlbiBrZXlzCgoKICAgICAgICB3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkgewogICAgICAgICAgaWYgKGhhcyhPLCBrZXkgPSBuYW1lc1tpKytdKSkgewogICAgICAgICAgICB+YXJyYXlJbmRleE9mKHJlc3VsdCwga2V5KSB8fCByZXN1bHQucHVzaChrZXkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNTQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBmYWxsYmFjayBmb3Igbm9uLWFycmF5LWxpa2UgRVMzIGFuZCBub24tZW51bWVyYWJsZSBvbGQgVjggc3RyaW5ncwogICAgICB2YXIgY29mID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMyk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnMKCgogICAgICBtb2R1bGUuZXhwb3J0cyA9IE9iamVjdCgneicpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApID8gT2JqZWN0IDogZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIGNvZihpdCkgPT0gJ1N0cmluZycgPyBpdC5zcGxpdCgnJykgOiBPYmplY3QoaXQpOwogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDU1ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKS5kb2N1bWVudDsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZG9jdW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDU2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gMTkuMS4yLjkgLyAxNS4yLjMuMiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoTykKICAgICAgdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTIpOwoKICAgICAgdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNyk7CgogICAgICB2YXIgSUVfUFJPVE8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM4KSgnSUVfUFJPVE8nKTsKCiAgICAgIHZhciBPYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiAoTykgewogICAgICAgIE8gPSB0b09iamVjdChPKTsKICAgICAgICBpZiAoaGFzKE8sIElFX1BST1RPKSkgcmV0dXJuIE9bSUVfUFJPVE9dOwoKICAgICAgICBpZiAodHlwZW9mIE8uY29uc3RydWN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBPIGluc3RhbmNlb2YgTy5jb25zdHJ1Y3RvcikgewogICAgICAgICAgcmV0dXJuIE8uY29uc3RydWN0b3IucHJvdG90eXBlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIE8gaW5zdGFuY2VvZiBPYmplY3QgPyBPYmplY3RQcm90byA6IG51bGw7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDU3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gY2FsbCBzb21ldGhpbmcgb24gaXRlcmF0b3Igc3RlcCB3aXRoIHNhZmUgY2xvc2luZyBvbiBlcnJvcgogICAgICB2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXRlcmF0b3IsIGZuLCB2YWx1ZSwgZW50cmllcykgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gZW50cmllcyA/IGZuKGFuT2JqZWN0KHZhbHVlKVswXSwgdmFsdWVbMV0pIDogZm4odmFsdWUpOyAvLyA3LjQuNiBJdGVyYXRvckNsb3NlKGl0ZXJhdG9yLCBjb21wbGV0aW9uKQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHZhciByZXQgPSBpdGVyYXRvclsncmV0dXJuJ107CiAgICAgICAgICBpZiAocmV0ICE9PSB1bmRlZmluZWQpIGFuT2JqZWN0KHJldC5jYWxsKGl0ZXJhdG9yKSk7CiAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNTggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBjaGVjayBvbiBkZWZhdWx0IEFycmF5IGl0ZXJhdG9yCiAgICAgIHZhciBJdGVyYXRvcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KTsKCiAgICAgIHZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMikoJ2l0ZXJhdG9yJyk7CgogICAgICB2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIGl0ICE9PSB1bmRlZmluZWQgJiYgKEl0ZXJhdG9ycy5BcnJheSA9PT0gaXQgfHwgQXJyYXlQcm90b1tJVEVSQVRPUl0gPT09IGl0KTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNTkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyA3LjMuMjAgU3BlY2llc0NvbnN0cnVjdG9yKE8sIGRlZmF1bHRDb25zdHJ1Y3RvcikKICAgICAgdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCiAgICAgIHZhciBhRnVuY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0KTsKCiAgICAgIHZhciBTUEVDSUVTID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKSgnc3BlY2llcycpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoTywgRCkgewogICAgICAgIHZhciBDID0gYW5PYmplY3QoTykuY29uc3RydWN0b3I7CiAgICAgICAgdmFyIFM7CiAgICAgICAgcmV0dXJuIEMgPT09IHVuZGVmaW5lZCB8fCAoUyA9IGFuT2JqZWN0KEMpW1NQRUNJRVNdKSA9PSB1bmRlZmluZWQgPyBEIDogYUZ1bmN0aW9uKFMpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA2MCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKTsKCiAgICAgIHZhciBpbnZva2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExMik7CgogICAgICB2YXIgaHRtbCA9IF9fd2VicGFja19yZXF1aXJlX18oNTUpOwoKICAgICAgdmFyIGNlbCA9IF9fd2VicGFja19yZXF1aXJlX18oMzEpOwoKICAgICAgdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogICAgICB2YXIgcHJvY2VzcyA9IGdsb2JhbC5wcm9jZXNzOwogICAgICB2YXIgc2V0VGFzayA9IGdsb2JhbC5zZXRJbW1lZGlhdGU7CiAgICAgIHZhciBjbGVhclRhc2sgPSBnbG9iYWwuY2xlYXJJbW1lZGlhdGU7CiAgICAgIHZhciBNZXNzYWdlQ2hhbm5lbCA9IGdsb2JhbC5NZXNzYWdlQ2hhbm5lbDsKICAgICAgdmFyIERpc3BhdGNoID0gZ2xvYmFsLkRpc3BhdGNoOwogICAgICB2YXIgY291bnRlciA9IDA7CiAgICAgIHZhciBxdWV1ZSA9IHt9OwogICAgICB2YXIgT05SRUFEWVNUQVRFQ0hBTkdFID0gJ29ucmVhZHlzdGF0ZWNoYW5nZSc7CiAgICAgIHZhciBkZWZlciwgY2hhbm5lbCwgcG9ydDsKCiAgICAgIHZhciBydW4gPSBmdW5jdGlvbiBydW4oKSB7CiAgICAgICAgdmFyIGlkID0gK3RoaXM7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnMKCiAgICAgICAgaWYgKHF1ZXVlLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgICAgdmFyIGZuID0gcXVldWVbaWRdOwogICAgICAgICAgZGVsZXRlIHF1ZXVlW2lkXTsKICAgICAgICAgIGZuKCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24gbGlzdGVuZXIoZXZlbnQpIHsKICAgICAgICBydW4uY2FsbChldmVudC5kYXRhKTsKICAgICAgfTsgLy8gTm9kZS5qcyAwLjkrICYgSUUxMCsgaGFzIHNldEltbWVkaWF0ZSwgb3RoZXJ3aXNlOgoKCiAgICAgIGlmICghc2V0VGFzayB8fCAhY2xlYXJUYXNrKSB7CiAgICAgICAgc2V0VGFzayA9IGZ1bmN0aW9uIHNldEltbWVkaWF0ZShmbikgewogICAgICAgICAgdmFyIGFyZ3MgPSBbXTsKICAgICAgICAgIHZhciBpID0gMTsKCiAgICAgICAgICB3aGlsZSAoYXJndW1lbnRzLmxlbmd0aCA+IGkpIHsKICAgICAgICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpKytdKTsKICAgICAgICAgIH0KCiAgICAgICAgICBxdWV1ZVsrK2NvdW50ZXJdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbmV3LWZ1bmMKICAgICAgICAgICAgaW52b2tlKHR5cGVvZiBmbiA9PSAnZnVuY3Rpb24nID8gZm4gOiBGdW5jdGlvbihmbiksIGFyZ3MpOwogICAgICAgICAgfTsKCiAgICAgICAgICBkZWZlcihjb3VudGVyKTsKICAgICAgICAgIHJldHVybiBjb3VudGVyOwogICAgICAgIH07CgogICAgICAgIGNsZWFyVGFzayA9IGZ1bmN0aW9uIGNsZWFySW1tZWRpYXRlKGlkKSB7CiAgICAgICAgICBkZWxldGUgcXVldWVbaWRdOwogICAgICAgIH07IC8vIE5vZGUuanMgMC44LQoKCiAgICAgICAgaWYgKF9fd2VicGFja19yZXF1aXJlX18oMjMpKHByb2Nlc3MpID09ICdwcm9jZXNzJykgewogICAgICAgICAgZGVmZXIgPSBmdW5jdGlvbiBkZWZlcihpZCkgewogICAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGN0eChydW4sIGlkLCAxKSk7CiAgICAgICAgICB9OyAvLyBTcGhlcmUgKEpTIGdhbWUgZW5naW5lKSBEaXNwYXRjaCBBUEkKCiAgICAgICAgfSBlbHNlIGlmIChEaXNwYXRjaCAmJiBEaXNwYXRjaC5ub3cpIHsKICAgICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgICAgRGlzcGF0Y2gubm93KGN0eChydW4sIGlkLCAxKSk7CiAgICAgICAgICB9OyAvLyBCcm93c2VycyB3aXRoIE1lc3NhZ2VDaGFubmVsLCBpbmNsdWRlcyBXZWJXb3JrZXJzCgogICAgICAgIH0gZWxzZSBpZiAoTWVzc2FnZUNoYW5uZWwpIHsKICAgICAgICAgIGNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTsKICAgICAgICAgIHBvcnQgPSBjaGFubmVsLnBvcnQyOwogICAgICAgICAgY2hhbm5lbC5wb3J0MS5vbm1lc3NhZ2UgPSBsaXN0ZW5lcjsKICAgICAgICAgIGRlZmVyID0gY3R4KHBvcnQucG9zdE1lc3NhZ2UsIHBvcnQsIDEpOyAvLyBCcm93c2VycyB3aXRoIHBvc3RNZXNzYWdlLCBza2lwIFdlYldvcmtlcnMKICAgICAgICAgIC8vIElFOCBoYXMgcG9zdE1lc3NhZ2UsIGJ1dCBpdCdzIHN5bmMgJiB0eXBlb2YgaXRzIHBvc3RNZXNzYWdlIGlzICdvYmplY3QnCiAgICAgICAgfSBlbHNlIGlmIChnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lciAmJiB0eXBlb2YgcG9zdE1lc3NhZ2UgPT0gJ2Z1bmN0aW9uJyAmJiAhZ2xvYmFsLmltcG9ydFNjcmlwdHMpIHsKICAgICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgICAgZ2xvYmFsLnBvc3RNZXNzYWdlKGlkICsgJycsICcqJyk7CiAgICAgICAgICB9OwoKICAgICAgICAgIGdsb2JhbC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbGlzdGVuZXIsIGZhbHNlKTsgLy8gSUU4LQogICAgICAgIH0gZWxzZSBpZiAoT05SRUFEWVNUQVRFQ0hBTkdFIGluIGNlbCgnc2NyaXB0JykpIHsKICAgICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgICAgaHRtbC5hcHBlbmRDaGlsZChjZWwoJ3NjcmlwdCcpKVtPTlJFQURZU1RBVEVDSEFOR0VdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGh0bWwucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgICAgICAgcnVuLmNhbGwoaWQpOwogICAgICAgICAgICB9OwogICAgICAgICAgfTsgLy8gUmVzdCBvbGQgYnJvd3NlcnMKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgICAgc2V0VGltZW91dChjdHgocnVuLCBpZCwgMSksIDApOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgIHNldDogc2V0VGFzaywKICAgICAgICBjbGVhcjogY2xlYXJUYXNrCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNjEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChleGVjKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGU6IGZhbHNlLAogICAgICAgICAgICB2OiBleGVjKCkKICAgICAgICAgIH07CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZTogdHJ1ZSwKICAgICAgICAgICAgdjogZQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDYyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCiAgICAgIHZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTApOwoKICAgICAgdmFyIG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Myk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChDLCB4KSB7CiAgICAgICAgYW5PYmplY3QoQyk7CiAgICAgICAgaWYgKGlzT2JqZWN0KHgpICYmIHguY29uc3RydWN0b3IgPT09IEMpIHJldHVybiB4OwogICAgICAgIHZhciBwcm9taXNlQ2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5LmYoQyk7CiAgICAgICAgdmFyIHJlc29sdmUgPSBwcm9taXNlQ2FwYWJpbGl0eS5yZXNvbHZlOwogICAgICAgIHJlc29sdmUoeCk7CiAgICAgICAgcmV0dXJuIHByb21pc2VDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDYzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIElURVJBVE9SID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKSgnaXRlcmF0b3InKTsKCiAgICAgIHZhciBTQUZFX0NMT1NJTkcgPSBmYWxzZTsKCiAgICAgIHRyeSB7CiAgICAgICAgdmFyIHJpdGVyID0gWzddW0lURVJBVE9SXSgpOwoKICAgICAgICByaXRlclsncmV0dXJuJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBTQUZFX0NMT1NJTkcgPSB0cnVlOwogICAgICAgIH07IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby10aHJvdy1saXRlcmFsCgoKICAgICAgICBBcnJheS5mcm9tKHJpdGVyLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aHJvdyAyOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLyogZW1wdHkgKi8KICAgICAgfQoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZXhlYywgc2tpcENsb3NpbmcpIHsKICAgICAgICBpZiAoIXNraXBDbG9zaW5nICYmICFTQUZFX0NMT1NJTkcpIHJldHVybiBmYWxzZTsKICAgICAgICB2YXIgc2FmZSA9IGZhbHNlOwoKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIGFyciA9IFs3XTsKICAgICAgICAgIHZhciBpdGVyID0gYXJyW0lURVJBVE9SXSgpOwoKICAgICAgICAgIGl0ZXIubmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBkb25lOiBzYWZlID0gdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgfTsKCiAgICAgICAgICBhcnJbSVRFUkFUT1JdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaXRlcjsKICAgICAgICAgIH07CgogICAgICAgICAgZXhlYyhhcnIpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIC8qIGVtcHR5ICovCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2FmZTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNjQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICAiZGVmYXVsdCI6IF9fd2VicGFja19yZXF1aXJlX18oMTIzKSwKICAgICAgICBfX2VzTW9kdWxlOiB0cnVlCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNjUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBtb3N0IE9iamVjdCBtZXRob2RzIGJ5IEVTNiBzaG91bGQgYWNjZXB0IHByaW1pdGl2ZXMKICAgICAgdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOwoKICAgICAgdmFyIGNvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApOwoKICAgICAgdmFyIGZhaWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNCk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChLRVksIGV4ZWMpIHsKICAgICAgICB2YXIgZm4gPSAoY29yZS5PYmplY3QgfHwge30pW0tFWV0gfHwgT2JqZWN0W0tFWV07CiAgICAgICAgdmFyIGV4cCA9IHt9OwogICAgICAgIGV4cFtLRVldID0gZXhlYyhmbik7CiAgICAgICAgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiBmYWlscyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmbigxKTsKICAgICAgICB9KSwgJ09iamVjdCcsIGV4cCk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDY2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCiAgICAgIHZhciBfdHlwZW9mMiA9IF9fd2VicGFja19yZXF1aXJlX18oNjcpOwoKICAgICAgdmFyIF90eXBlb2YzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdHlwZW9mMik7CgogICAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogICAgICAgIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICAgICAgICAiZGVmYXVsdCI6IG9iagogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGV4cG9ydHNbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChzZWxmLCBjYWxsKSB7CiAgICAgICAgaWYgKCFzZWxmKSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNhbGwgJiYgKCh0eXBlb2YgY2FsbCA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6ICgwLCBfdHlwZW9mM1siZGVmYXVsdCJdKShjYWxsKSkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSA/IGNhbGwgOiBzZWxmOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA2NyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIGV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CgogICAgICB2YXIgX2l0ZXJhdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMjUpOwoKICAgICAgdmFyIF9pdGVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pdGVyYXRvcik7CgogICAgICB2YXIgX3N5bWJvbCA9IF9fd2VicGFja19yZXF1aXJlX18oMTI3KTsKCiAgICAgIHZhciBfc3ltYm9sMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3N5bWJvbCk7CgogICAgICB2YXIgX3R5cGVvZiA9IHR5cGVvZiBfc3ltYm9sMlsiZGVmYXVsdCJdID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2Y0KF9pdGVyYXRvcjJbImRlZmF1bHQiXSkgPT09ICJzeW1ib2wiID8gZnVuY3Rpb24gKG9iaikgewogICAgICAgIHJldHVybiBfdHlwZW9mNChvYmopOwogICAgICB9IDogZnVuY3Rpb24gKG9iaikgewogICAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIF9zeW1ib2wyWyJkZWZhdWx0Il0gPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBfc3ltYm9sMlsiZGVmYXVsdCJdICYmIG9iaiAhPT0gX3N5bWJvbDJbImRlZmF1bHQiXS5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2Y0KG9iaik7CiAgICAgIH07CgogICAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogICAgICAgIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICAgICAgICAiZGVmYXVsdCI6IG9iagogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGV4cG9ydHNbImRlZmF1bHQiXSA9IHR5cGVvZiBfc3ltYm9sMlsiZGVmYXVsdCJdID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YoX2l0ZXJhdG9yMlsiZGVmYXVsdCJdKSA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG9iaik7CiAgICAgIH0gOiBmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgX3N5bWJvbDJbImRlZmF1bHQiXSA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IF9zeW1ib2wyWyJkZWZhdWx0Il0gJiYgb2JqICE9PSBfc3ltYm9sMlsiZGVmYXVsdCJdLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iaiA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2Yob2JqKTsKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA2OCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIDE5LjEuMi43IC8gMTUuMi4zLjQgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoTykKICAgICAgdmFyICRrZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1Myk7CgogICAgICB2YXIgaGlkZGVuS2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oNDApLmNvbmNhdCgnbGVuZ3RoJywgJ3Byb3RvdHlwZScpOwoKICAgICAgZXhwb3J0cy5mID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgfHwgZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhPKSB7CiAgICAgICAgcmV0dXJuICRrZXlzKE8sIGhpZGRlbktleXMpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA2OSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBwSUUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4KTsKCiAgICAgIHZhciBjcmVhdGVEZXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOSk7CgogICAgICB2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNik7CgogICAgICB2YXIgdG9QcmltaXRpdmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMyKTsKCiAgICAgIHZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsKCiAgICAgIHZhciBJRThfRE9NX0RFRklORSA9IF9fd2VicGFja19yZXF1aXJlX18oNDgpOwoKICAgICAgdmFyIGdPUEQgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwogICAgICBleHBvcnRzLmYgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpID8gZ09QRCA6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKSB7CiAgICAgICAgTyA9IHRvSU9iamVjdChPKTsKICAgICAgICBQID0gdG9QcmltaXRpdmUoUCwgdHJ1ZSk7CiAgICAgICAgaWYgKElFOF9ET01fREVGSU5FKSB0cnkgewogICAgICAgICAgcmV0dXJuIGdPUEQoTywgUCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgLyogZW1wdHkgKi8KICAgICAgICB9CiAgICAgICAgaWYgKGhhcyhPLCBQKSkgcmV0dXJuIGNyZWF0ZURlc2MoIXBJRS5mLmNhbGwoTywgUCksIE9bUF0pOwogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDcwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCiAgICAgIHZhciBfc2V0UHJvdG90eXBlT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzNik7CgogICAgICB2YXIgX3NldFByb3RvdHlwZU9mMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3NldFByb3RvdHlwZU9mKTsKCiAgICAgIHZhciBfY3JlYXRlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNDApOwoKICAgICAgdmFyIF9jcmVhdGUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY3JlYXRlKTsKCiAgICAgIHZhciBfdHlwZW9mMiA9IF9fd2VicGFja19yZXF1aXJlX18oNjcpOwoKICAgICAgdmFyIF90eXBlb2YzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdHlwZW9mMik7CgogICAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogICAgICAgIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICAgICAgICAiZGVmYXVsdCI6IG9iagogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGV4cG9ydHNbImRlZmF1bHQiXSA9IGZ1bmN0aW9uIChzdWJDbGFzcywgc3VwZXJDbGFzcykgewogICAgICAgIGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyAodHlwZW9mIHN1cGVyQ2xhc3MgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiAoMCwgX3R5cGVvZjNbImRlZmF1bHQiXSkoc3VwZXJDbGFzcykpKTsKICAgICAgICB9CgogICAgICAgIHN1YkNsYXNzLnByb3RvdHlwZSA9ICgwLCBfY3JlYXRlMlsiZGVmYXVsdCJdKShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICAgICAgICBjb25zdHJ1Y3RvcjogewogICAgICAgICAgICB2YWx1ZTogc3ViQ2xhc3MsCiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZjJbImRlZmF1bHQiXSA/ICgwLCBfc2V0UHJvdG90eXBlT2YyWyJkZWZhdWx0Il0pKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDcxICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwogICAgICBleHBvcnRzLmhhc0NsYXNzSW5QYXJlbnQgPSBleHBvcnRzLmZvcm1hdEVycm9yTXNnID0gZXhwb3J0cy5nZXRNZXRhQ29udGVudCA9IGV4cG9ydHMuYXhpb3NHaXRodWIgPSBleHBvcnRzLmF4aW9zSlNPTiA9IGV4cG9ydHMucXVlcnlTdHJpbmdpZnkgPSBleHBvcnRzLnF1ZXJ5UGFyc2UgPSB1bmRlZmluZWQ7CgogICAgICB2YXIgX2tleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2MSk7CgogICAgICB2YXIgX2tleXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfa2V5cyk7CgogICAgICB2YXIgX3NsaWNlZFRvQXJyYXkyID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNjQpOwoKICAgICAgdmFyIF9zbGljZWRUb0FycmF5MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3NsaWNlZFRvQXJyYXkyKTsKCiAgICAgIHZhciBfYXhpb3MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3MSk7CgogICAgICB2YXIgX2F4aW9zMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2F4aW9zKTsKCiAgICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgICAgICAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgICAgICAgICJkZWZhdWx0Ijogb2JqCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgdmFyIHF1ZXJ5UGFyc2UgPSBleHBvcnRzLnF1ZXJ5UGFyc2UgPSBmdW5jdGlvbiBxdWVyeVBhcnNlKCkgewogICAgICAgIHZhciBzZWFyY2ggPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7CiAgICAgICAgaWYgKCFzZWFyY2gpIHJldHVybiB7fTsKICAgICAgICB2YXIgcXVlcnlTdHJpbmcgPSBzZWFyY2hbMF0gPT09ICc/JyA/IHNlYXJjaC5zdWJzdHJpbmcoMSkgOiBzZWFyY2g7CiAgICAgICAgdmFyIHF1ZXJ5ID0ge307CiAgICAgICAgcXVlcnlTdHJpbmcuc3BsaXQoJyYnKS5mb3JFYWNoKGZ1bmN0aW9uIChxdWVyeVN0cikgewogICAgICAgICAgdmFyIF9xdWVyeVN0ciRzcGxpdCA9IHF1ZXJ5U3RyLnNwbGl0KCc9JyksCiAgICAgICAgICAgICAgX3F1ZXJ5U3RyJHNwbGl0MiA9ICgwLCBfc2xpY2VkVG9BcnJheTNbImRlZmF1bHQiXSkoX3F1ZXJ5U3RyJHNwbGl0LCAyKSwKICAgICAgICAgICAgICBrZXkgPSBfcXVlcnlTdHIkc3BsaXQyWzBdLAogICAgICAgICAgICAgIHZhbHVlID0gX3F1ZXJ5U3RyJHNwbGl0MlsxXTsKICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCgoKICAgICAgICAgIGlmIChrZXkpIHF1ZXJ5W2RlY29kZVVSSUNvbXBvbmVudChrZXkpXSA9IGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHF1ZXJ5OwogICAgICB9OwoKICAgICAgdmFyIHF1ZXJ5U3RyaW5naWZ5ID0gZXhwb3J0cy5xdWVyeVN0cmluZ2lmeSA9IGZ1bmN0aW9uIHF1ZXJ5U3RyaW5naWZ5KHF1ZXJ5KSB7CiAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gKDAsIF9rZXlzMlsiZGVmYXVsdCJdKShxdWVyeSkubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIHJldHVybiBrZXkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQocXVlcnlba2V5XSB8fCAnJyk7CiAgICAgICAgfSkuam9pbignJicpOwogICAgICAgIHJldHVybiBxdWVyeVN0cmluZzsKICAgICAgfTsKCiAgICAgIHZhciBheGlvc0pTT04gPSBleHBvcnRzLmF4aW9zSlNPTiA9IF9heGlvczJbImRlZmF1bHQiXS5jcmVhdGUoewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIGF4aW9zR2l0aHViID0gZXhwb3J0cy5heGlvc0dpdGh1YiA9IF9heGlvczJbImRlZmF1bHQiXS5jcmVhdGUoewogICAgICAgIGJhc2VVUkw6ICdodHRwczovL2FwaS5naXRodWIuY29tJywKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHZhciBnZXRNZXRhQ29udGVudCA9IGV4cG9ydHMuZ2V0TWV0YUNvbnRlbnQgPSBmdW5jdGlvbiBnZXRNZXRhQ29udGVudChuYW1lLCBjb250ZW50KSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICBjb250ZW50IHx8IChjb250ZW50ID0gJ2NvbnRlbnQnKTsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKICAgICAgICB2YXIgZWwgPSB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0YVtuYW1lPVwnJyArIG5hbWUgKyAnXCddJyk7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCiAgICAgICAgcmV0dXJuIGVsICYmIGVsLmdldEF0dHJpYnV0ZShjb250ZW50KTsKICAgICAgfTsKCiAgICAgIHZhciBmb3JtYXRFcnJvck1zZyA9IGV4cG9ydHMuZm9ybWF0RXJyb3JNc2cgPSBmdW5jdGlvbiBmb3JtYXRFcnJvck1zZyhlcnIpIHsKICAgICAgICB2YXIgbXNnID0gJ0Vycm9yOiAnOwoKICAgICAgICBpZiAoZXJyLnJlc3BvbnNlICYmIGVyci5yZXNwb25zZS5kYXRhICYmIGVyci5yZXNwb25zZS5kYXRhLm1lc3NhZ2UpIHsKICAgICAgICAgIG1zZyArPSBlcnIucmVzcG9uc2UuZGF0YS5tZXNzYWdlICsgJy4gJzsKICAgICAgICAgIGVyci5yZXNwb25zZS5kYXRhLmVycm9ycyAmJiAobXNnICs9IGVyci5yZXNwb25zZS5kYXRhLmVycm9ycy5tYXAoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgcmV0dXJuIGUubWVzc2FnZTsKICAgICAgICAgIH0pLmpvaW4oJywgJykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtc2cgKz0gZXJyLm1lc3NhZ2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbXNnOwogICAgICB9OwoKICAgICAgdmFyIGhhc0NsYXNzSW5QYXJlbnQgPSBleHBvcnRzLmhhc0NsYXNzSW5QYXJlbnQgPSBmdW5jdGlvbiBoYXNDbGFzc0luUGFyZW50KGVsZW1lbnQpIHsKICAgICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgY2xhc3NOYW1lID0gQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICAgICAgY2xhc3NOYW1lW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgICAgICB9CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCgogICAgICAgIHZhciB5ZXMgPSBmYWxzZTsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQuY2xhc3NOYW1lID09PSAndW5kZWZpbmVkJykgcmV0dXJuIGZhbHNlOwogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogICAgICAgIHZhciBjbGFzc2VzID0gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoJyAnKTsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKICAgICAgICBjbGFzc05hbWUuZm9yRWFjaChmdW5jdGlvbiAoYywgaSkgewogICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICAgIHllcyA9IHllcyB8fCBjbGFzc2VzLmluZGV4T2YoYykgPj0gMDsKICAgICAgICB9KTsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKICAgICAgICBpZiAoeWVzKSByZXR1cm4geWVzOwogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogICAgICAgIHJldHVybiBlbGVtZW50LnBhcmVudE5vZGUgJiYgaGFzQ2xhc3NJblBhcmVudChlbGVtZW50LnBhcmVudE5vZGUsIGNsYXNzTmFtZSk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDcyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBiaW5kKGZuLCB0aGlzQXJnKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIHdyYXAoKSB7CiAgICAgICAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoKTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhpc0FyZywgYXJncyk7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNzMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOwoKICAgICAgZnVuY3Rpb24gZW5jb2RlKHZhbCkgewogICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQodmFsKS5yZXBsYWNlKC8lNDAvZ2ksICdAJykucmVwbGFjZSgvJTNBL2dpLCAnOicpLnJlcGxhY2UoLyUyNC9nLCAnJCcpLnJlcGxhY2UoLyUyQy9naSwgJywnKS5yZXBsYWNlKC8lMjAvZywgJysnKS5yZXBsYWNlKC8lNUIvZ2ksICdbJykucmVwbGFjZSgvJTVEL2dpLCAnXScpOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBCdWlsZCBhIFVSTCBieSBhcHBlbmRpbmcgcGFyYW1zIHRvIHRoZSBlbmQKICAgICAgICoKICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBUaGUgYmFzZSBvZiB0aGUgdXJsIChlLmcuLCBodHRwOi8vd3d3Lmdvb2dsZS5jb20pCiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbcGFyYW1zXSBUaGUgcGFyYW1zIHRvIGJlIGFwcGVuZGVkCiAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBmb3JtYXR0ZWQgdXJsCiAgICAgICAqLwoKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gYnVpbGRVUkwodXJsLCBwYXJhbXMsIHBhcmFtc1NlcmlhbGl6ZXIpIHsKICAgICAgICAvKmVzbGludCBuby1wYXJhbS1yZWFzc2lnbjowKi8KICAgICAgICBpZiAoIXBhcmFtcykgewogICAgICAgICAgcmV0dXJuIHVybDsKICAgICAgICB9CgogICAgICAgIHZhciBzZXJpYWxpemVkUGFyYW1zOwoKICAgICAgICBpZiAocGFyYW1zU2VyaWFsaXplcikgewogICAgICAgICAgc2VyaWFsaXplZFBhcmFtcyA9IHBhcmFtc1NlcmlhbGl6ZXIocGFyYW1zKTsKICAgICAgICB9IGVsc2UgaWYgKHV0aWxzLmlzVVJMU2VhcmNoUGFyYW1zKHBhcmFtcykpIHsKICAgICAgICAgIHNlcmlhbGl6ZWRQYXJhbXMgPSBwYXJhbXMudG9TdHJpbmcoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHBhcnRzID0gW107CiAgICAgICAgICB1dGlscy5mb3JFYWNoKHBhcmFtcywgZnVuY3Rpb24gc2VyaWFsaXplKHZhbCwga2V5KSB7CiAgICAgICAgICAgIGlmICh2YWwgPT09IG51bGwgfHwgdHlwZW9mIHZhbCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh1dGlscy5pc0FycmF5KHZhbCkpIHsKICAgICAgICAgICAgICBrZXkgPSBrZXkgKyAnW10nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhbCA9IFt2YWxdOwogICAgICAgICAgICB9CgogICAgICAgICAgICB1dGlscy5mb3JFYWNoKHZhbCwgZnVuY3Rpb24gcGFyc2VWYWx1ZSh2KSB7CiAgICAgICAgICAgICAgaWYgKHV0aWxzLmlzRGF0ZSh2KSkgewogICAgICAgICAgICAgICAgdiA9IHYudG9JU09TdHJpbmcoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHV0aWxzLmlzT2JqZWN0KHYpKSB7CiAgICAgICAgICAgICAgICB2ID0gSlNPTi5zdHJpbmdpZnkodik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwYXJ0cy5wdXNoKGVuY29kZShrZXkpICsgJz0nICsgZW5jb2RlKHYpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHNlcmlhbGl6ZWRQYXJhbXMgPSBwYXJ0cy5qb2luKCcmJyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VyaWFsaXplZFBhcmFtcykgewogICAgICAgICAgdmFyIGhhc2htYXJrSW5kZXggPSB1cmwuaW5kZXhPZignIycpOwoKICAgICAgICAgIGlmIChoYXNobWFya0luZGV4ICE9PSAtMSkgewogICAgICAgICAgICB1cmwgPSB1cmwuc2xpY2UoMCwgaGFzaG1hcmtJbmRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgdXJsICs9ICh1cmwuaW5kZXhPZignPycpID09PSAtMSA/ICc/JyA6ICcmJykgKyBzZXJpYWxpemVkUGFyYW1zOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHVybDsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNzQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGlzQ2FuY2VsKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuICEhKHZhbHVlICYmIHZhbHVlLl9fQ0FOQ0VMX18pOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA3NSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovCgogICAgICAoZnVuY3Rpb24gKHByb2Nlc3MpIHsKICAgICAgICB2YXIgdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOwoKICAgICAgICB2YXIgbm9ybWFsaXplSGVhZGVyTmFtZSA9IF9fd2VicGFja19yZXF1aXJlX18oMTc3KTsKCiAgICAgICAgdmFyIERFRkFVTFRfQ09OVEVOVF9UWVBFID0gewogICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gc2V0Q29udGVudFR5cGVJZlVuc2V0KGhlYWRlcnMsIHZhbHVlKSB7CiAgICAgICAgICBpZiAoIXV0aWxzLmlzVW5kZWZpbmVkKGhlYWRlcnMpICYmIHV0aWxzLmlzVW5kZWZpbmVkKGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddKSkgewogICAgICAgICAgICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0RGVmYXVsdEFkYXB0ZXIoKSB7CiAgICAgICAgICB2YXIgYWRhcHRlcjsKCiAgICAgICAgICBpZiAodHlwZW9mIFhNTEh0dHBSZXF1ZXN0ICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAvLyBGb3IgYnJvd3NlcnMgdXNlIFhIUiBhZGFwdGVyCiAgICAgICAgICAgIGFkYXB0ZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc2KTsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChwcm9jZXNzKSA9PT0gJ1tvYmplY3QgcHJvY2Vzc10nKSB7CiAgICAgICAgICAgIC8vIEZvciBub2RlIHVzZSBIVFRQIGFkYXB0ZXIKICAgICAgICAgICAgYWRhcHRlciA9IF9fd2VicGFja19yZXF1aXJlX18oNzYpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBhZGFwdGVyOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRlZmF1bHRzID0gewogICAgICAgICAgYWRhcHRlcjogZ2V0RGVmYXVsdEFkYXB0ZXIoKSwKICAgICAgICAgIHRyYW5zZm9ybVJlcXVlc3Q6IFtmdW5jdGlvbiB0cmFuc2Zvcm1SZXF1ZXN0KGRhdGEsIGhlYWRlcnMpIHsKICAgICAgICAgICAgbm9ybWFsaXplSGVhZGVyTmFtZShoZWFkZXJzLCAnQWNjZXB0Jyk7CiAgICAgICAgICAgIG5vcm1hbGl6ZUhlYWRlck5hbWUoaGVhZGVycywgJ0NvbnRlbnQtVHlwZScpOwoKICAgICAgICAgICAgaWYgKHV0aWxzLmlzRm9ybURhdGEoZGF0YSkgfHwgdXRpbHMuaXNBcnJheUJ1ZmZlcihkYXRhKSB8fCB1dGlscy5pc0J1ZmZlcihkYXRhKSB8fCB1dGlscy5pc1N0cmVhbShkYXRhKSB8fCB1dGlscy5pc0ZpbGUoZGF0YSkgfHwgdXRpbHMuaXNCbG9iKGRhdGEpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh1dGlscy5pc0FycmF5QnVmZmVyVmlldyhkYXRhKSkgewogICAgICAgICAgICAgIHJldHVybiBkYXRhLmJ1ZmZlcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHV0aWxzLmlzVVJMU2VhcmNoUGFyYW1zKGRhdGEpKSB7CiAgICAgICAgICAgICAgc2V0Q29udGVudFR5cGVJZlVuc2V0KGhlYWRlcnMsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD11dGYtOCcpOwogICAgICAgICAgICAgIHJldHVybiBkYXRhLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh1dGlscy5pc09iamVjdChkYXRhKSkgewogICAgICAgICAgICAgIHNldENvbnRlbnRUeXBlSWZVbnNldChoZWFkZXJzLCAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jyk7CiAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGRhdGEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICAgIH1dLAogICAgICAgICAgdHJhbnNmb3JtUmVzcG9uc2U6IFtmdW5jdGlvbiB0cmFuc2Zvcm1SZXNwb25zZShkYXRhKSB7CiAgICAgICAgICAgIC8qZXNsaW50IG5vLXBhcmFtLXJlYXNzaWduOjAqLwogICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIC8qIElnbm9yZSAqLwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICB9XSwKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgdGltZW91dCBpbiBtaWxsaXNlY29uZHMgdG8gYWJvcnQgYSByZXF1ZXN0LiBJZiBzZXQgdG8gMCAoZGVmYXVsdCkgYQogICAgICAgICAgICogdGltZW91dCBpcyBub3QgY3JlYXRlZC4KICAgICAgICAgICAqLwogICAgICAgICAgdGltZW91dDogMCwKICAgICAgICAgIHhzcmZDb29raWVOYW1lOiAnWFNSRi1UT0tFTicsCiAgICAgICAgICB4c3JmSGVhZGVyTmFtZTogJ1gtWFNSRi1UT0tFTicsCiAgICAgICAgICBtYXhDb250ZW50TGVuZ3RoOiAtMSwKICAgICAgICAgIHZhbGlkYXRlU3RhdHVzOiBmdW5jdGlvbiB2YWxpZGF0ZVN0YXR1cyhzdGF0dXMpIHsKICAgICAgICAgICAgcmV0dXJuIHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgMzAwOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgZGVmYXVsdHMuaGVhZGVycyA9IHsKICAgICAgICAgIGNvbW1vbjogewogICAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKicKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHV0aWxzLmZvckVhY2goWydkZWxldGUnLCAnZ2V0JywgJ2hlYWQnXSwgZnVuY3Rpb24gZm9yRWFjaE1ldGhvZE5vRGF0YShtZXRob2QpIHsKICAgICAgICAgIGRlZmF1bHRzLmhlYWRlcnNbbWV0aG9kXSA9IHt9OwogICAgICAgIH0pOwogICAgICAgIHV0aWxzLmZvckVhY2goWydwb3N0JywgJ3B1dCcsICdwYXRjaCddLCBmdW5jdGlvbiBmb3JFYWNoTWV0aG9kV2l0aERhdGEobWV0aG9kKSB7CiAgICAgICAgICBkZWZhdWx0cy5oZWFkZXJzW21ldGhvZF0gPSB1dGlscy5tZXJnZShERUZBVUxUX0NPTlRFTlRfVFlQRSk7CiAgICAgICAgfSk7CiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBkZWZhdWx0czsKICAgICAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8KICAgICAgfSkuY2FsbChleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpKTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA3NiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciB1dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7CgogICAgICB2YXIgc2V0dGxlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNzgpOwoKICAgICAgdmFyIGJ1aWxkVVJMID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3Myk7CgogICAgICB2YXIgYnVpbGRGdWxsUGF0aCA9IF9fd2VicGFja19yZXF1aXJlX18oMTgwKTsKCiAgICAgIHZhciBwYXJzZUhlYWRlcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4Myk7CgogICAgICB2YXIgaXNVUkxTYW1lT3JpZ2luID0gX193ZWJwYWNrX3JlcXVpcmVfXygxODQpOwoKICAgICAgdmFyIGNyZWF0ZUVycm9yID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3Nyk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHhockFkYXB0ZXIoY29uZmlnKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIGRpc3BhdGNoWGhyUmVxdWVzdChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHZhciByZXF1ZXN0RGF0YSA9IGNvbmZpZy5kYXRhOwogICAgICAgICAgdmFyIHJlcXVlc3RIZWFkZXJzID0gY29uZmlnLmhlYWRlcnM7CgogICAgICAgICAgaWYgKHV0aWxzLmlzRm9ybURhdGEocmVxdWVzdERhdGEpKSB7CiAgICAgICAgICAgIGRlbGV0ZSByZXF1ZXN0SGVhZGVyc1snQ29udGVudC1UeXBlJ107IC8vIExldCB0aGUgYnJvd3NlciBzZXQgaXQKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOyAvLyBIVFRQIGJhc2ljIGF1dGhlbnRpY2F0aW9uCgogICAgICAgICAgaWYgKGNvbmZpZy5hdXRoKSB7CiAgICAgICAgICAgIHZhciB1c2VybmFtZSA9IGNvbmZpZy5hdXRoLnVzZXJuYW1lIHx8ICcnOwogICAgICAgICAgICB2YXIgcGFzc3dvcmQgPSBjb25maWcuYXV0aC5wYXNzd29yZCB8fCAnJzsKICAgICAgICAgICAgcmVxdWVzdEhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCYXNpYyAnICsgYnRvYSh1c2VybmFtZSArICc6JyArIHBhc3N3b3JkKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZnVsbFBhdGggPSBidWlsZEZ1bGxQYXRoKGNvbmZpZy5iYXNlVVJMLCBjb25maWcudXJsKTsKICAgICAgICAgIHJlcXVlc3Qub3Blbihjb25maWcubWV0aG9kLnRvVXBwZXJDYXNlKCksIGJ1aWxkVVJMKGZ1bGxQYXRoLCBjb25maWcucGFyYW1zLCBjb25maWcucGFyYW1zU2VyaWFsaXplciksIHRydWUpOyAvLyBTZXQgdGhlIHJlcXVlc3QgdGltZW91dCBpbiBNUwoKICAgICAgICAgIHJlcXVlc3QudGltZW91dCA9IGNvbmZpZy50aW1lb3V0OyAvLyBMaXN0ZW4gZm9yIHJlYWR5IHN0YXRlCgogICAgICAgICAgcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiBoYW5kbGVMb2FkKCkgewogICAgICAgICAgICBpZiAoIXJlcXVlc3QgfHwgcmVxdWVzdC5yZWFkeVN0YXRlICE9PSA0KSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IC8vIFRoZSByZXF1ZXN0IGVycm9yZWQgb3V0IGFuZCB3ZSBkaWRuJ3QgZ2V0IGEgcmVzcG9uc2UsIHRoaXMgd2lsbCBiZQogICAgICAgICAgICAvLyBoYW5kbGVkIGJ5IG9uZXJyb3IgaW5zdGVhZAogICAgICAgICAgICAvLyBXaXRoIG9uZSBleGNlcHRpb246IHJlcXVlc3QgdGhhdCB1c2luZyBmaWxlOiBwcm90b2NvbCwgbW9zdCBicm93c2VycwogICAgICAgICAgICAvLyB3aWxsIHJldHVybiBzdGF0dXMgYXMgMCBldmVuIHRob3VnaCBpdCdzIGEgc3VjY2Vzc2Z1bCByZXF1ZXN0CgoKICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID09PSAwICYmICEocmVxdWVzdC5yZXNwb25zZVVSTCAmJiByZXF1ZXN0LnJlc3BvbnNlVVJMLmluZGV4T2YoJ2ZpbGU6JykgPT09IDApKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IC8vIFByZXBhcmUgdGhlIHJlc3BvbnNlCgoKICAgICAgICAgICAgdmFyIHJlc3BvbnNlSGVhZGVycyA9ICdnZXRBbGxSZXNwb25zZUhlYWRlcnMnIGluIHJlcXVlc3QgPyBwYXJzZUhlYWRlcnMocmVxdWVzdC5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSkgOiBudWxsOwogICAgICAgICAgICB2YXIgcmVzcG9uc2VEYXRhID0gIWNvbmZpZy5yZXNwb25zZVR5cGUgfHwgY29uZmlnLnJlc3BvbnNlVHlwZSA9PT0gJ3RleHQnID8gcmVxdWVzdC5yZXNwb25zZVRleHQgOiByZXF1ZXN0LnJlc3BvbnNlOwogICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB7CiAgICAgICAgICAgICAgZGF0YTogcmVzcG9uc2VEYXRhLAogICAgICAgICAgICAgIHN0YXR1czogcmVxdWVzdC5zdGF0dXMsCiAgICAgICAgICAgICAgc3RhdHVzVGV4dDogcmVxdWVzdC5zdGF0dXNUZXh0LAogICAgICAgICAgICAgIGhlYWRlcnM6IHJlc3BvbnNlSGVhZGVycywKICAgICAgICAgICAgICBjb25maWc6IGNvbmZpZywKICAgICAgICAgICAgICByZXF1ZXN0OiByZXF1ZXN0CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHNldHRsZShyZXNvbHZlLCByZWplY3QsIHJlc3BvbnNlKTsgLy8gQ2xlYW4gdXAgcmVxdWVzdAoKICAgICAgICAgICAgcmVxdWVzdCA9IG51bGw7CiAgICAgICAgICB9OyAvLyBIYW5kbGUgYnJvd3NlciByZXF1ZXN0IGNhbmNlbGxhdGlvbiAoYXMgb3Bwb3NlZCB0byBhIG1hbnVhbCBjYW5jZWxsYXRpb24pCgoKICAgICAgICAgIHJlcXVlc3Qub25hYm9ydCA9IGZ1bmN0aW9uIGhhbmRsZUFib3J0KCkgewogICAgICAgICAgICBpZiAoIXJlcXVlc3QpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlamVjdChjcmVhdGVFcnJvcignUmVxdWVzdCBhYm9ydGVkJywgY29uZmlnLCAnRUNPTk5BQk9SVEVEJywgcmVxdWVzdCkpOyAvLyBDbGVhbiB1cCByZXF1ZXN0CgogICAgICAgICAgICByZXF1ZXN0ID0gbnVsbDsKICAgICAgICAgIH07IC8vIEhhbmRsZSBsb3cgbGV2ZWwgbmV0d29yayBlcnJvcnMKCgogICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gaGFuZGxlRXJyb3IoKSB7CiAgICAgICAgICAgIC8vIFJlYWwgZXJyb3JzIGFyZSBoaWRkZW4gZnJvbSB1cyBieSB0aGUgYnJvd3NlcgogICAgICAgICAgICAvLyBvbmVycm9yIHNob3VsZCBvbmx5IGZpcmUgaWYgaXQncyBhIG5ldHdvcmsgZXJyb3IKICAgICAgICAgICAgcmVqZWN0KGNyZWF0ZUVycm9yKCdOZXR3b3JrIEVycm9yJywgY29uZmlnLCBudWxsLCByZXF1ZXN0KSk7IC8vIENsZWFuIHVwIHJlcXVlc3QKCiAgICAgICAgICAgIHJlcXVlc3QgPSBudWxsOwogICAgICAgICAgfTsgLy8gSGFuZGxlIHRpbWVvdXQKCgogICAgICAgICAgcmVxdWVzdC5vbnRpbWVvdXQgPSBmdW5jdGlvbiBoYW5kbGVUaW1lb3V0KCkgewogICAgICAgICAgICB2YXIgdGltZW91dEVycm9yTWVzc2FnZSA9ICd0aW1lb3V0IG9mICcgKyBjb25maWcudGltZW91dCArICdtcyBleGNlZWRlZCc7CgogICAgICAgICAgICBpZiAoY29uZmlnLnRpbWVvdXRFcnJvck1lc3NhZ2UpIHsKICAgICAgICAgICAgICB0aW1lb3V0RXJyb3JNZXNzYWdlID0gY29uZmlnLnRpbWVvdXRFcnJvck1lc3NhZ2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlamVjdChjcmVhdGVFcnJvcih0aW1lb3V0RXJyb3JNZXNzYWdlLCBjb25maWcsICdFQ09OTkFCT1JURUQnLCByZXF1ZXN0KSk7IC8vIENsZWFuIHVwIHJlcXVlc3QKCiAgICAgICAgICAgIHJlcXVlc3QgPSBudWxsOwogICAgICAgICAgfTsgLy8gQWRkIHhzcmYgaGVhZGVyCiAgICAgICAgICAvLyBUaGlzIGlzIG9ubHkgZG9uZSBpZiBydW5uaW5nIGluIGEgc3RhbmRhcmQgYnJvd3NlciBlbnZpcm9ubWVudC4KICAgICAgICAgIC8vIFNwZWNpZmljYWxseSBub3QgaWYgd2UncmUgaW4gYSB3ZWIgd29ya2VyLCBvciByZWFjdC1uYXRpdmUuCgoKICAgICAgICAgIGlmICh1dGlscy5pc1N0YW5kYXJkQnJvd3NlckVudigpKSB7CiAgICAgICAgICAgIHZhciBjb29raWVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxODUpOyAvLyBBZGQgeHNyZiBoZWFkZXIKCgogICAgICAgICAgICB2YXIgeHNyZlZhbHVlID0gKGNvbmZpZy53aXRoQ3JlZGVudGlhbHMgfHwgaXNVUkxTYW1lT3JpZ2luKGZ1bGxQYXRoKSkgJiYgY29uZmlnLnhzcmZDb29raWVOYW1lID8gY29va2llcy5yZWFkKGNvbmZpZy54c3JmQ29va2llTmFtZSkgOiB1bmRlZmluZWQ7CgogICAgICAgICAgICBpZiAoeHNyZlZhbHVlKSB7CiAgICAgICAgICAgICAgcmVxdWVzdEhlYWRlcnNbY29uZmlnLnhzcmZIZWFkZXJOYW1lXSA9IHhzcmZWYWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBBZGQgaGVhZGVycyB0byB0aGUgcmVxdWVzdAoKCiAgICAgICAgICBpZiAoJ3NldFJlcXVlc3RIZWFkZXInIGluIHJlcXVlc3QpIHsKICAgICAgICAgICAgdXRpbHMuZm9yRWFjaChyZXF1ZXN0SGVhZGVycywgZnVuY3Rpb24gc2V0UmVxdWVzdEhlYWRlcih2YWwsIGtleSkgewogICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVxdWVzdERhdGEgPT09ICd1bmRlZmluZWQnICYmIGtleS50b0xvd2VyQ2FzZSgpID09PSAnY29udGVudC10eXBlJykgewogICAgICAgICAgICAgICAgLy8gUmVtb3ZlIENvbnRlbnQtVHlwZSBpZiBkYXRhIGlzIHVuZGVmaW5lZAogICAgICAgICAgICAgICAgZGVsZXRlIHJlcXVlc3RIZWFkZXJzW2tleV07CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSBhZGQgaGVhZGVyIHRvIHRoZSByZXF1ZXN0CiAgICAgICAgICAgICAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoa2V5LCB2YWwpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IC8vIEFkZCB3aXRoQ3JlZGVudGlhbHMgdG8gcmVxdWVzdCBpZiBuZWVkZWQKCgogICAgICAgICAgaWYgKCF1dGlscy5pc1VuZGVmaW5lZChjb25maWcud2l0aENyZWRlbnRpYWxzKSkgewogICAgICAgICAgICByZXF1ZXN0LndpdGhDcmVkZW50aWFscyA9ICEhY29uZmlnLndpdGhDcmVkZW50aWFsczsKICAgICAgICAgIH0gLy8gQWRkIHJlc3BvbnNlVHlwZSB0byByZXF1ZXN0IGlmIG5lZWRlZAoKCiAgICAgICAgICBpZiAoY29uZmlnLnJlc3BvbnNlVHlwZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJlcXVlc3QucmVzcG9uc2VUeXBlID0gY29uZmlnLnJlc3BvbnNlVHlwZTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIC8vIEV4cGVjdGVkIERPTUV4Y2VwdGlvbiB0aHJvd24gYnkgYnJvd3NlcnMgbm90IGNvbXBhdGlibGUgWE1MSHR0cFJlcXVlc3QgTGV2ZWwgMi4KICAgICAgICAgICAgICAvLyBCdXQsIHRoaXMgY2FuIGJlIHN1cHByZXNzZWQgZm9yICdqc29uJyB0eXBlIGFzIGl0IGNhbiBiZSBwYXJzZWQgYnkgZGVmYXVsdCAndHJhbnNmb3JtUmVzcG9uc2UnIGZ1bmN0aW9uLgogICAgICAgICAgICAgIGlmIChjb25maWcucmVzcG9uc2VUeXBlICE9PSAnanNvbicpIHsKICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIEhhbmRsZSBwcm9ncmVzcyBpZiBuZWVkZWQKCgogICAgICAgICAgaWYgKHR5cGVvZiBjb25maWcub25Eb3dubG9hZFByb2dyZXNzID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigncHJvZ3Jlc3MnLCBjb25maWcub25Eb3dubG9hZFByb2dyZXNzKTsKICAgICAgICAgIH0gLy8gTm90IGFsbCBicm93c2VycyBzdXBwb3J0IHVwbG9hZCBldmVudHMKCgogICAgICAgICAgaWYgKHR5cGVvZiBjb25maWcub25VcGxvYWRQcm9ncmVzcyA9PT0gJ2Z1bmN0aW9uJyAmJiByZXF1ZXN0LnVwbG9hZCkgewogICAgICAgICAgICByZXF1ZXN0LnVwbG9hZC5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIGNvbmZpZy5vblVwbG9hZFByb2dyZXNzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY29uZmlnLmNhbmNlbFRva2VuKSB7CiAgICAgICAgICAgIC8vIEhhbmRsZSBjYW5jZWxsYXRpb24KICAgICAgICAgICAgY29uZmlnLmNhbmNlbFRva2VuLnByb21pc2UudGhlbihmdW5jdGlvbiBvbkNhbmNlbGVkKGNhbmNlbCkgewogICAgICAgICAgICAgIGlmICghcmVxdWVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmVxdWVzdC5hYm9ydCgpOwogICAgICAgICAgICAgIHJlamVjdChjYW5jZWwpOyAvLyBDbGVhbiB1cCByZXF1ZXN0CgogICAgICAgICAgICAgIHJlcXVlc3QgPSBudWxsOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocmVxdWVzdERhdGEgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXF1ZXN0RGF0YSA9IG51bGw7CiAgICAgICAgICB9IC8vIFNlbmQgdGhlIHJlcXVlc3QKCgogICAgICAgICAgcmVxdWVzdC5zZW5kKHJlcXVlc3REYXRhKTsKICAgICAgICB9KTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNzcgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgZW5oYW5jZUVycm9yID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNzkpOwogICAgICAvKioKICAgICAgICogQ3JlYXRlIGFuIEVycm9yIHdpdGggdGhlIHNwZWNpZmllZCBtZXNzYWdlLCBjb25maWcsIGVycm9yIGNvZGUsIHJlcXVlc3QgYW5kIHJlc3BvbnNlLgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSBUaGUgZXJyb3IgbWVzc2FnZS4KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBUaGUgY29uZmlnLgogICAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2NvZGVdIFRoZSBlcnJvciBjb2RlIChmb3IgZXhhbXBsZSwgJ0VDT05OQUJPUlRFRCcpLgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gW3JlcXVlc3RdIFRoZSByZXF1ZXN0LgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gW3Jlc3BvbnNlXSBUaGUgcmVzcG9uc2UuCiAgICAgICAqIEByZXR1cm5zIHtFcnJvcn0gVGhlIGNyZWF0ZWQgZXJyb3IuCiAgICAgICAqLwoKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gY3JlYXRlRXJyb3IobWVzc2FnZSwgY29uZmlnLCBjb2RlLCByZXF1ZXN0LCByZXNwb25zZSkgewogICAgICAgIHZhciBlcnJvciA9IG5ldyBFcnJvcihtZXNzYWdlKTsKICAgICAgICByZXR1cm4gZW5oYW5jZUVycm9yKGVycm9yLCBjb25maWcsIGNvZGUsIHJlcXVlc3QsIHJlc3BvbnNlKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNzggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOwogICAgICAvKioKICAgICAgICogQ29uZmlnLXNwZWNpZmljIG1lcmdlLWZ1bmN0aW9uIHdoaWNoIGNyZWF0ZXMgYSBuZXcgY29uZmlnLW9iamVjdAogICAgICAgKiBieSBtZXJnaW5nIHR3byBjb25maWd1cmF0aW9uIG9iamVjdHMgdG9nZXRoZXIuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcxCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcyCiAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IE5ldyBvYmplY3QgcmVzdWx0aW5nIGZyb20gbWVyZ2luZyBjb25maWcyIHRvIGNvbmZpZzEKICAgICAgICovCgoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBtZXJnZUNvbmZpZyhjb25maWcxLCBjb25maWcyKSB7CiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduCiAgICAgICAgY29uZmlnMiA9IGNvbmZpZzIgfHwge307CiAgICAgICAgdmFyIGNvbmZpZyA9IHt9OwogICAgICAgIHZhciB2YWx1ZUZyb21Db25maWcyS2V5cyA9IFsndXJsJywgJ21ldGhvZCcsICdwYXJhbXMnLCAnZGF0YSddOwogICAgICAgIHZhciBtZXJnZURlZXBQcm9wZXJ0aWVzS2V5cyA9IFsnaGVhZGVycycsICdhdXRoJywgJ3Byb3h5J107CiAgICAgICAgdmFyIGRlZmF1bHRUb0NvbmZpZzJLZXlzID0gWydiYXNlVVJMJywgJ3VybCcsICd0cmFuc2Zvcm1SZXF1ZXN0JywgJ3RyYW5zZm9ybVJlc3BvbnNlJywgJ3BhcmFtc1NlcmlhbGl6ZXInLCAndGltZW91dCcsICd3aXRoQ3JlZGVudGlhbHMnLCAnYWRhcHRlcicsICdyZXNwb25zZVR5cGUnLCAneHNyZkNvb2tpZU5hbWUnLCAneHNyZkhlYWRlck5hbWUnLCAnb25VcGxvYWRQcm9ncmVzcycsICdvbkRvd25sb2FkUHJvZ3Jlc3MnLCAnbWF4Q29udGVudExlbmd0aCcsICd2YWxpZGF0ZVN0YXR1cycsICdtYXhSZWRpcmVjdHMnLCAnaHR0cEFnZW50JywgJ2h0dHBzQWdlbnQnLCAnY2FuY2VsVG9rZW4nLCAnc29ja2V0UGF0aCddOwogICAgICAgIHV0aWxzLmZvckVhY2godmFsdWVGcm9tQ29uZmlnMktleXMsIGZ1bmN0aW9uIHZhbHVlRnJvbUNvbmZpZzIocHJvcCkgewogICAgICAgICAgaWYgKHR5cGVvZiBjb25maWcyW3Byb3BdICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBjb25maWdbcHJvcF0gPSBjb25maWcyW3Byb3BdOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHV0aWxzLmZvckVhY2gobWVyZ2VEZWVwUHJvcGVydGllc0tleXMsIGZ1bmN0aW9uIG1lcmdlRGVlcFByb3BlcnRpZXMocHJvcCkgewogICAgICAgICAgaWYgKHV0aWxzLmlzT2JqZWN0KGNvbmZpZzJbcHJvcF0pKSB7CiAgICAgICAgICAgIGNvbmZpZ1twcm9wXSA9IHV0aWxzLmRlZXBNZXJnZShjb25maWcxW3Byb3BdLCBjb25maWcyW3Byb3BdKTsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmZpZzJbcHJvcF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGNvbmZpZ1twcm9wXSA9IGNvbmZpZzJbcHJvcF07CiAgICAgICAgICB9IGVsc2UgaWYgKHV0aWxzLmlzT2JqZWN0KGNvbmZpZzFbcHJvcF0pKSB7CiAgICAgICAgICAgIGNvbmZpZ1twcm9wXSA9IHV0aWxzLmRlZXBNZXJnZShjb25maWcxW3Byb3BdKTsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmZpZzFbcHJvcF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGNvbmZpZ1twcm9wXSA9IGNvbmZpZzFbcHJvcF07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdXRpbHMuZm9yRWFjaChkZWZhdWx0VG9Db25maWcyS2V5cywgZnVuY3Rpb24gZGVmYXVsdFRvQ29uZmlnMihwcm9wKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGNvbmZpZzJbcHJvcF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGNvbmZpZ1twcm9wXSA9IGNvbmZpZzJbcHJvcF07CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcxW3Byb3BdICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBjb25maWdbcHJvcF0gPSBjb25maWcxW3Byb3BdOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHZhciBheGlvc0tleXMgPSB2YWx1ZUZyb21Db25maWcyS2V5cy5jb25jYXQobWVyZ2VEZWVwUHJvcGVydGllc0tleXMpLmNvbmNhdChkZWZhdWx0VG9Db25maWcyS2V5cyk7CiAgICAgICAgdmFyIG90aGVyS2V5cyA9IE9iamVjdC5rZXlzKGNvbmZpZzIpLmZpbHRlcihmdW5jdGlvbiBmaWx0ZXJBeGlvc0tleXMoa2V5KSB7CiAgICAgICAgICByZXR1cm4gYXhpb3NLZXlzLmluZGV4T2Yoa2V5KSA9PT0gLTE7CiAgICAgICAgfSk7CiAgICAgICAgdXRpbHMuZm9yRWFjaChvdGhlcktleXMsIGZ1bmN0aW9uIG90aGVyS2V5c0RlZmF1bHRUb0NvbmZpZzIocHJvcCkgewogICAgICAgICAgaWYgKHR5cGVvZiBjb25maWcyW3Byb3BdICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBjb25maWdbcHJvcF0gPSBjb25maWcyW3Byb3BdOwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnMVtwcm9wXSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgY29uZmlnW3Byb3BdID0gY29uZmlnMVtwcm9wXTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gY29uZmlnOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA3OSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgLyoqCiAgICAgICAqIEEgYENhbmNlbGAgaXMgYW4gb2JqZWN0IHRoYXQgaXMgdGhyb3duIHdoZW4gYW4gb3BlcmF0aW9uIGlzIGNhbmNlbGVkLgogICAgICAgKgogICAgICAgKiBAY2xhc3MKICAgICAgICogQHBhcmFtIHtzdHJpbmc9fSBtZXNzYWdlIFRoZSBtZXNzYWdlLgogICAgICAgKi8KCiAgICAgIGZ1bmN0aW9uIENhbmNlbChtZXNzYWdlKSB7CiAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKICAgICAgfQoKICAgICAgQ2FuY2VsLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiAnQ2FuY2VsJyArICh0aGlzLm1lc3NhZ2UgPyAnOiAnICsgdGhpcy5tZXNzYWdlIDogJycpOwogICAgICB9OwoKICAgICAgQ2FuY2VsLnByb3RvdHlwZS5fX0NBTkNFTF9fID0gdHJ1ZTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBDYW5jZWw7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogODAgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CgogICAgICB2YXIgX3JlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsKCiAgICAgIHZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3QpOwoKICAgICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICAgICAgICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgICAgICAgImRlZmF1bHQiOiBvYmoKICAgICAgICB9OwogICAgICB9CgogICAgICBleHBvcnRzWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAoX3JlZikgewogICAgICAgIHZhciBzcmMgPSBfcmVmLnNyYywKICAgICAgICAgICAgY2xhc3NOYW1lID0gX3JlZi5jbGFzc05hbWUsCiAgICAgICAgICAgIGFsdCA9IF9yZWYuYWx0LAogICAgICAgICAgICBvbkVycm9yID0gX3JlZi5vbkVycm9yOwogICAgICAgIHJldHVybiBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnZGl2JywgewogICAgICAgICAgY2xhc3NOYW1lOiAnZ3QtYXZhdGFyICcgKyBjbGFzc05hbWUKICAgICAgICB9LCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnaW1nJywgewogICAgICAgICAgc3JjOiBzcmMsCiAgICAgICAgICBhbHQ6ICdAJyArIGFsdCwKICAgICAgICAgIG9uRXJyb3I6IG9uRXJyb3IKICAgICAgICB9KSk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDgxICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwoKICAgICAgdmFyIF9yZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgogICAgICB2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTsKCiAgICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgICAgICAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgICAgICAgICJkZWZhdWx0Ijogb2JqCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICB2YXIgY2xhc3NOYW1lID0gX3JlZi5jbGFzc05hbWUsCiAgICAgICAgICAgIHRleHQgPSBfcmVmLnRleHQsCiAgICAgICAgICAgIG5hbWUgPSBfcmVmLm5hbWU7CiAgICAgICAgcmV0dXJuIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICAgY2xhc3NOYW1lOiAiZ3QtaWNvICIgKyBjbGFzc05hbWUKICAgICAgICB9LCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgic3BhbiIsIHsKICAgICAgICAgIGNsYXNzTmFtZTogImd0LXN2ZyIsCiAgICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTDogewogICAgICAgICAgICBfX2h0bWw6IF9fd2VicGFja19yZXF1aXJlX18oMTkxKSgiLi8iICsgbmFtZSArICIuc3ZnIikKICAgICAgICAgIH0KICAgICAgICB9KSwgdGV4dCAmJiBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgic3BhbiIsIHsKICAgICAgICAgIGNsYXNzTmFtZTogImd0LWljby10ZXh0IgogICAgICAgIH0sIHRleHQpKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogODIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMiA9IF9fd2VicGFja19yZXF1aXJlX18oMjkpOwoKICAgICAgdmFyIF9jbGFzc0NhbGxDaGVjazMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jbGFzc0NhbGxDaGVjazIpOwoKICAgICAgdmFyIF9jcmVhdGVDbGFzczIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMwKTsKCiAgICAgIHZhciBfY3JlYXRlQ2xhc3MzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY3JlYXRlQ2xhc3MyKTsKCiAgICAgIHZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKICAgICAgdmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7CgogICAgICB2YXIgX3JlYWN0RG9tID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oOTQpOwoKICAgICAgdmFyIF9naXRhbGsgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk4KTsKCiAgICAgIHZhciBfZ2l0YWxrMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2dpdGFsayk7CgogICAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogICAgICAgIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICAgICAgICAiZGVmYXVsdCI6IG9iagogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHZhciBHaXRhbGsgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gR2l0YWxrKCkgewogICAgICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazNbImRlZmF1bHQiXSkodGhpcywgR2l0YWxrKTsKICAgICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgICAgfQoKICAgICAgICAoMCwgX2NyZWF0ZUNsYXNzM1siZGVmYXVsdCJdKShHaXRhbGssIFt7CiAgICAgICAgICBrZXk6ICdyZW5kZXInLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcihjb250YWluZXIsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBub2RlID0gbnVsbDsKICAgICAgICAgICAgY29udGFpbmVyID0gY29udGFpbmVyIHx8IHRoaXMub3B0aW9ucy5jb250YWluZXI7CiAgICAgICAgICAgIGlmICghY29udGFpbmVyKSB0aHJvdyBuZXcgRXJyb3IoJ0NvbnRhaW5lciBpcyByZXF1aXJlZDogJyArIGNvbnRhaW5lcik7CgogICAgICAgICAgICBpZiAoIShjb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHsKICAgICAgICAgICAgICBub2RlID0gd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lcik7CiAgICAgICAgICAgICAgaWYgKCFub2RlKSB0aHJvdyBuZXcgRXJyb3IoJ0NvbnRhaW5lciBub3QgZm91bmQsIHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZDogJyArIGNvbnRhaW5lcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbm9kZSA9IGNvbnRhaW5lcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24gY2FsbGJhY2soKSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICgwLCBfcmVhY3REb20ucmVuZGVyKShfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudChfZ2l0YWxrMlsiZGVmYXVsdCJdLCB7CiAgICAgICAgICAgICAgb3B0aW9uczogdGhpcy5vcHRpb25zCiAgICAgICAgICAgIH0pLCBub2RlLCBjYWxsYmFjayk7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwogICAgICAgIHJldHVybiBHaXRhbGs7CiAgICAgIH0oKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gR2l0YWxrOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDgzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgImRlZmF1bHQiOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDg0KSwKICAgICAgICBfX2VzTW9kdWxlOiB0cnVlCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogODQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1KTsKCiAgICAgIHZhciAkT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKS5PYmplY3Q7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KGl0LCBrZXksIGRlc2MpIHsKICAgICAgICByZXR1cm4gJE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpdCwga2V5LCBkZXNjKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogODUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7IC8vIDE5LjEuMi40IC8gMTUuMi4zLjYgT2JqZWN0LmRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpCgoKICAgICAgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhX193ZWJwYWNrX3JlcXVpcmVfXyg4KSwgJ09iamVjdCcsIHsKICAgICAgICBkZWZpbmVQcm9wZXJ0eTogX193ZWJwYWNrX3JlcXVpcmVfXyg3KS5mCiAgICAgIH0pOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDg2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovCiAgICAgIChmdW5jdGlvbiAocHJvY2VzcykgewogICAgICAgIC8qKgogICAgICAgICogQ29weXJpZ2h0IChjKSAyMDEzLXByZXNlbnQsIEZhY2Vib29rLCBJbmMuCiAgICAgICAgKgogICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgKi8KICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgdmFyIFJlYWN0SXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5KTsgLy8gQnkgZXhwbGljaXRseSB1c2luZyBgcHJvcC10eXBlc2AgeW91IGFyZSBvcHRpbmcgaW50byBuZXcgZGV2ZWxvcG1lbnQgYmVoYXZpb3IuCiAgICAgICAgICAvLyBodHRwOi8vZmIubWUvcHJvcC10eXBlcy1pbi1wcm9kCgoKICAgICAgICAgIHZhciB0aHJvd09uRGlyZWN0QWNjZXNzID0gdHJ1ZTsKICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4OSkoUmVhY3RJcy5pc0VsZW1lbnQsIHRocm93T25EaXJlY3RBY2Nlc3MpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBCeSBleHBsaWNpdGx5IHVzaW5nIGBwcm9wLXR5cGVzYCB5b3UgYXJlIG9wdGluZyBpbnRvIG5ldyBwcm9kdWN0aW9uIGJlaGF2aW9yLgogICAgICAgICAgLy8gaHR0cDovL2ZiLm1lL3Byb3AtdHlwZXMtaW4tcHJvZAogICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkyKSgpOwogICAgICAgIH0KICAgICAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8KCiAgICAgIH0pLmNhbGwoZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyg5KSk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogODcgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIC8qKiBAbGljZW5zZSBSZWFjdCB2MTYuMTIuMAogICAgICAgKiByZWFjdC1pcy5wcm9kdWN0aW9uLm1pbi5qcwogICAgICAgKgogICAgICAgKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICAgICAgICoKICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICovCgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6ICEwCiAgICAgIH0pOwogICAgICB2YXIgYiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBTeW1ib2wgJiYgU3ltYm9sWyJmb3IiXSwKICAgICAgICAgIGMgPSBiID8gU3ltYm9sWyJmb3IiXSgicmVhY3QuZWxlbWVudCIpIDogNjAxMDMsCiAgICAgICAgICBkID0gYiA/IFN5bWJvbFsiZm9yIl0oInJlYWN0LnBvcnRhbCIpIDogNjAxMDYsCiAgICAgICAgICBlID0gYiA/IFN5bWJvbFsiZm9yIl0oInJlYWN0LmZyYWdtZW50IikgOiA2MDEwNywKICAgICAgICAgIGYgPSBiID8gU3ltYm9sWyJmb3IiXSgicmVhY3Quc3RyaWN0X21vZGUiKSA6IDYwMTA4LAogICAgICAgICAgZyA9IGIgPyBTeW1ib2xbImZvciJdKCJyZWFjdC5wcm9maWxlciIpIDogNjAxMTQsCiAgICAgICAgICBoID0gYiA/IFN5bWJvbFsiZm9yIl0oInJlYWN0LnByb3ZpZGVyIikgOiA2MDEwOSwKICAgICAgICAgIGsgPSBiID8gU3ltYm9sWyJmb3IiXSgicmVhY3QuY29udGV4dCIpIDogNjAxMTAsCiAgICAgICAgICBsID0gYiA/IFN5bWJvbFsiZm9yIl0oInJlYWN0LmFzeW5jX21vZGUiKSA6IDYwMTExLAogICAgICAgICAgbSA9IGIgPyBTeW1ib2xbImZvciJdKCJyZWFjdC5jb25jdXJyZW50X21vZGUiKSA6IDYwMTExLAogICAgICAgICAgbiA9IGIgPyBTeW1ib2xbImZvciJdKCJyZWFjdC5mb3J3YXJkX3JlZiIpIDogNjAxMTIsCiAgICAgICAgICBwID0gYiA/IFN5bWJvbFsiZm9yIl0oInJlYWN0LnN1c3BlbnNlIikgOiA2MDExMywKICAgICAgICAgIHEgPSBiID8gU3ltYm9sWyJmb3IiXSgicmVhY3Quc3VzcGVuc2VfbGlzdCIpIDogNjAxMjAsCiAgICAgICAgICByID0gYiA/IFN5bWJvbFsiZm9yIl0oInJlYWN0Lm1lbW8iKSA6IDYwMTE1LAogICAgICAgICAgdCA9IGIgPyBTeW1ib2xbImZvciJdKCJyZWFjdC5sYXp5IikgOiA2MDExNiwKICAgICAgICAgIHYgPSBiID8gU3ltYm9sWyJmb3IiXSgicmVhY3QuZnVuZGFtZW50YWwiKSA6IDYwMTE3LAogICAgICAgICAgdyA9IGIgPyBTeW1ib2xbImZvciJdKCJyZWFjdC5yZXNwb25kZXIiKSA6IDYwMTE4LAogICAgICAgICAgeCA9IGIgPyBTeW1ib2xbImZvciJdKCJyZWFjdC5zY29wZSIpIDogNjAxMTk7CgogICAgICBmdW5jdGlvbiB5KGEpIHsKICAgICAgICBpZiAoIm9iamVjdCIgPT09IF90eXBlb2Y0KGEpICYmIG51bGwgIT09IGEpIHsKICAgICAgICAgIHZhciB1ID0gYS4kJHR5cGVvZjsKCiAgICAgICAgICBzd2l0Y2ggKHUpIHsKICAgICAgICAgICAgY2FzZSBjOgogICAgICAgICAgICAgIHN3aXRjaCAoYSA9IGEudHlwZSwgYSkgewogICAgICAgICAgICAgICAgY2FzZSBsOgogICAgICAgICAgICAgICAgY2FzZSBtOgogICAgICAgICAgICAgICAgY2FzZSBlOgogICAgICAgICAgICAgICAgY2FzZSBnOgogICAgICAgICAgICAgICAgY2FzZSBmOgogICAgICAgICAgICAgICAgY2FzZSBwOgogICAgICAgICAgICAgICAgICByZXR1cm4gYTsKCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICBzd2l0Y2ggKGEgPSBhICYmIGEuJCR0eXBlb2YsIGEpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIGs6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBuOgogICAgICAgICAgICAgICAgICAgIGNhc2UgdDoKICAgICAgICAgICAgICAgICAgICBjYXNlIHI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBoOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGE7CgogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlIGQ6CiAgICAgICAgICAgICAgcmV0dXJuIHU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiB6KGEpIHsKICAgICAgICByZXR1cm4geShhKSA9PT0gbTsKICAgICAgfQoKICAgICAgZXhwb3J0cy50eXBlT2YgPSB5OwogICAgICBleHBvcnRzLkFzeW5jTW9kZSA9IGw7CiAgICAgIGV4cG9ydHMuQ29uY3VycmVudE1vZGUgPSBtOwogICAgICBleHBvcnRzLkNvbnRleHRDb25zdW1lciA9IGs7CiAgICAgIGV4cG9ydHMuQ29udGV4dFByb3ZpZGVyID0gaDsKICAgICAgZXhwb3J0cy5FbGVtZW50ID0gYzsKICAgICAgZXhwb3J0cy5Gb3J3YXJkUmVmID0gbjsKICAgICAgZXhwb3J0cy5GcmFnbWVudCA9IGU7CiAgICAgIGV4cG9ydHMuTGF6eSA9IHQ7CiAgICAgIGV4cG9ydHMuTWVtbyA9IHI7CiAgICAgIGV4cG9ydHMuUG9ydGFsID0gZDsKICAgICAgZXhwb3J0cy5Qcm9maWxlciA9IGc7CiAgICAgIGV4cG9ydHMuU3RyaWN0TW9kZSA9IGY7CiAgICAgIGV4cG9ydHMuU3VzcGVuc2UgPSBwOwoKICAgICAgZXhwb3J0cy5pc1ZhbGlkRWxlbWVudFR5cGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGEgfHwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEgfHwgYSA9PT0gZSB8fCBhID09PSBtIHx8IGEgPT09IGcgfHwgYSA9PT0gZiB8fCBhID09PSBwIHx8IGEgPT09IHEgfHwgIm9iamVjdCIgPT09IF90eXBlb2Y0KGEpICYmIG51bGwgIT09IGEgJiYgKGEuJCR0eXBlb2YgPT09IHQgfHwgYS4kJHR5cGVvZiA9PT0gciB8fCBhLiQkdHlwZW9mID09PSBoIHx8IGEuJCR0eXBlb2YgPT09IGsgfHwgYS4kJHR5cGVvZiA9PT0gbiB8fCBhLiQkdHlwZW9mID09PSB2IHx8IGEuJCR0eXBlb2YgPT09IHcgfHwgYS4kJHR5cGVvZiA9PT0geCk7CiAgICAgIH07CgogICAgICBleHBvcnRzLmlzQXN5bmNNb2RlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4geihhKSB8fCB5KGEpID09PSBsOwogICAgICB9OwoKICAgICAgZXhwb3J0cy5pc0NvbmN1cnJlbnRNb2RlID0gejsKCiAgICAgIGV4cG9ydHMuaXNDb250ZXh0Q29uc3VtZXIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB5KGEpID09PSBrOwogICAgICB9OwoKICAgICAgZXhwb3J0cy5pc0NvbnRleHRQcm92aWRlciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHkoYSkgPT09IGg7CiAgICAgIH07CgogICAgICBleHBvcnRzLmlzRWxlbWVudCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuICJvYmplY3QiID09PSBfdHlwZW9mNChhKSAmJiBudWxsICE9PSBhICYmIGEuJCR0eXBlb2YgPT09IGM7CiAgICAgIH07CgogICAgICBleHBvcnRzLmlzRm9yd2FyZFJlZiA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHkoYSkgPT09IG47CiAgICAgIH07CgogICAgICBleHBvcnRzLmlzRnJhZ21lbnQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB5KGEpID09PSBlOwogICAgICB9OwoKICAgICAgZXhwb3J0cy5pc0xhenkgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB5KGEpID09PSB0OwogICAgICB9OwoKICAgICAgZXhwb3J0cy5pc01lbW8gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB5KGEpID09PSByOwogICAgICB9OwoKICAgICAgZXhwb3J0cy5pc1BvcnRhbCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHkoYSkgPT09IGQ7CiAgICAgIH07CgogICAgICBleHBvcnRzLmlzUHJvZmlsZXIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB5KGEpID09PSBnOwogICAgICB9OwoKICAgICAgZXhwb3J0cy5pc1N0cmljdE1vZGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB5KGEpID09PSBmOwogICAgICB9OwoKICAgICAgZXhwb3J0cy5pc1N1c3BlbnNlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4geShhKSA9PT0gcDsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogODggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLwoKICAgICAgKGZ1bmN0aW9uIChwcm9jZXNzKSB7CiAgICAgICAgLyoqIEBsaWNlbnNlIFJlYWN0IHYxNi4xMi4wCiAgICAgICAgKiByZWFjdC1pcy5kZXZlbG9wbWVudC5qcwogICAgICAgICoKICAgICAgICAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogICAgICAgICoKICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICovCiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIpIHsKICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICd1c2Ugc3RyaWN0JzsKCiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgICAgICAgICAgICB2YWx1ZTogdHJ1ZQogICAgICAgICAgICB9KTsgLy8gVGhlIFN5bWJvbCB1c2VkIHRvIHRhZyB0aGUgUmVhY3RFbGVtZW50LWxpa2UgdHlwZXMuIElmIHRoZXJlIGlzIG5vIG5hdGl2ZSBTeW1ib2wKICAgICAgICAgICAgLy8gbm9yIHBvbHlmaWxsLCB0aGVuIGEgcGxhaW4gbnVtYmVyIGlzIHVzZWQgZm9yIHBlcmZvcm1hbmNlLgoKICAgICAgICAgICAgdmFyIGhhc1N5bWJvbCA9IHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicgJiYgU3ltYm9sWyJmb3IiXTsKICAgICAgICAgICAgdmFyIFJFQUNUX0VMRU1FTlRfVFlQRSA9IGhhc1N5bWJvbCA/IFN5bWJvbFsiZm9yIl0oJ3JlYWN0LmVsZW1lbnQnKSA6IDB4ZWFjNzsKICAgICAgICAgICAgdmFyIFJFQUNUX1BPUlRBTF9UWVBFID0gaGFzU3ltYm9sID8gU3ltYm9sWyJmb3IiXSgncmVhY3QucG9ydGFsJykgOiAweGVhY2E7CiAgICAgICAgICAgIHZhciBSRUFDVF9GUkFHTUVOVF9UWVBFID0gaGFzU3ltYm9sID8gU3ltYm9sWyJmb3IiXSgncmVhY3QuZnJhZ21lbnQnKSA6IDB4ZWFjYjsKICAgICAgICAgICAgdmFyIFJFQUNUX1NUUklDVF9NT0RFX1RZUEUgPSBoYXNTeW1ib2wgPyBTeW1ib2xbImZvciJdKCdyZWFjdC5zdHJpY3RfbW9kZScpIDogMHhlYWNjOwogICAgICAgICAgICB2YXIgUkVBQ1RfUFJPRklMRVJfVFlQRSA9IGhhc1N5bWJvbCA/IFN5bWJvbFsiZm9yIl0oJ3JlYWN0LnByb2ZpbGVyJykgOiAweGVhZDI7CiAgICAgICAgICAgIHZhciBSRUFDVF9QUk9WSURFUl9UWVBFID0gaGFzU3ltYm9sID8gU3ltYm9sWyJmb3IiXSgncmVhY3QucHJvdmlkZXInKSA6IDB4ZWFjZDsKICAgICAgICAgICAgdmFyIFJFQUNUX0NPTlRFWFRfVFlQRSA9IGhhc1N5bWJvbCA/IFN5bWJvbFsiZm9yIl0oJ3JlYWN0LmNvbnRleHQnKSA6IDB4ZWFjZTsgLy8gVE9ETzogV2UgZG9uJ3QgdXNlIEFzeW5jTW9kZSBvciBDb25jdXJyZW50TW9kZSBhbnltb3JlLiBUaGV5IHdlcmUgdGVtcG9yYXJ5CiAgICAgICAgICAgIC8vICh1bnN0YWJsZSkgQVBJcyB0aGF0IGhhdmUgYmVlbiByZW1vdmVkLiBDYW4gd2UgcmVtb3ZlIHRoZSBzeW1ib2xzPwoKICAgICAgICAgICAgdmFyIFJFQUNUX0FTWU5DX01PREVfVFlQRSA9IGhhc1N5bWJvbCA/IFN5bWJvbFsiZm9yIl0oJ3JlYWN0LmFzeW5jX21vZGUnKSA6IDB4ZWFjZjsKICAgICAgICAgICAgdmFyIFJFQUNUX0NPTkNVUlJFTlRfTU9ERV9UWVBFID0gaGFzU3ltYm9sID8gU3ltYm9sWyJmb3IiXSgncmVhY3QuY29uY3VycmVudF9tb2RlJykgOiAweGVhY2Y7CiAgICAgICAgICAgIHZhciBSRUFDVF9GT1JXQVJEX1JFRl9UWVBFID0gaGFzU3ltYm9sID8gU3ltYm9sWyJmb3IiXSgncmVhY3QuZm9yd2FyZF9yZWYnKSA6IDB4ZWFkMDsKICAgICAgICAgICAgdmFyIFJFQUNUX1NVU1BFTlNFX1RZUEUgPSBoYXNTeW1ib2wgPyBTeW1ib2xbImZvciJdKCdyZWFjdC5zdXNwZW5zZScpIDogMHhlYWQxOwogICAgICAgICAgICB2YXIgUkVBQ1RfU1VTUEVOU0VfTElTVF9UWVBFID0gaGFzU3ltYm9sID8gU3ltYm9sWyJmb3IiXSgncmVhY3Quc3VzcGVuc2VfbGlzdCcpIDogMHhlYWQ4OwogICAgICAgICAgICB2YXIgUkVBQ1RfTUVNT19UWVBFID0gaGFzU3ltYm9sID8gU3ltYm9sWyJmb3IiXSgncmVhY3QubWVtbycpIDogMHhlYWQzOwogICAgICAgICAgICB2YXIgUkVBQ1RfTEFaWV9UWVBFID0gaGFzU3ltYm9sID8gU3ltYm9sWyJmb3IiXSgncmVhY3QubGF6eScpIDogMHhlYWQ0OwogICAgICAgICAgICB2YXIgUkVBQ1RfRlVOREFNRU5UQUxfVFlQRSA9IGhhc1N5bWJvbCA/IFN5bWJvbFsiZm9yIl0oJ3JlYWN0LmZ1bmRhbWVudGFsJykgOiAweGVhZDU7CiAgICAgICAgICAgIHZhciBSRUFDVF9SRVNQT05ERVJfVFlQRSA9IGhhc1N5bWJvbCA/IFN5bWJvbFsiZm9yIl0oJ3JlYWN0LnJlc3BvbmRlcicpIDogMHhlYWQ2OwogICAgICAgICAgICB2YXIgUkVBQ1RfU0NPUEVfVFlQRSA9IGhhc1N5bWJvbCA/IFN5bWJvbFsiZm9yIl0oJ3JlYWN0LnNjb3BlJykgOiAweGVhZDc7CgogICAgICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkRWxlbWVudFR5cGUodHlwZSkgewogICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdHlwZSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHR5cGUgPT09ICdmdW5jdGlvbicgfHwgLy8gTm90ZTogaXRzIHR5cGVvZiBtaWdodCBiZSBvdGhlciB0aGFuICdzeW1ib2wnIG9yICdudW1iZXInIGlmIGl0J3MgYSBwb2x5ZmlsbC4KICAgICAgICAgICAgICB0eXBlID09PSBSRUFDVF9GUkFHTUVOVF9UWVBFIHx8IHR5cGUgPT09IFJFQUNUX0NPTkNVUlJFTlRfTU9ERV9UWVBFIHx8IHR5cGUgPT09IFJFQUNUX1BST0ZJTEVSX1RZUEUgfHwgdHlwZSA9PT0gUkVBQ1RfU1RSSUNUX01PREVfVFlQRSB8fCB0eXBlID09PSBSRUFDVF9TVVNQRU5TRV9UWVBFIHx8IHR5cGUgPT09IFJFQUNUX1NVU1BFTlNFX0xJU1RfVFlQRSB8fCBfdHlwZW9mNCh0eXBlKSA9PT0gJ29iamVjdCcgJiYgdHlwZSAhPT0gbnVsbCAmJiAodHlwZS4kJHR5cGVvZiA9PT0gUkVBQ1RfTEFaWV9UWVBFIHx8IHR5cGUuJCR0eXBlb2YgPT09IFJFQUNUX01FTU9fVFlQRSB8fCB0eXBlLiQkdHlwZW9mID09PSBSRUFDVF9QUk9WSURFUl9UWVBFIHx8IHR5cGUuJCR0eXBlb2YgPT09IFJFQUNUX0NPTlRFWFRfVFlQRSB8fCB0eXBlLiQkdHlwZW9mID09PSBSRUFDVF9GT1JXQVJEX1JFRl9UWVBFIHx8IHR5cGUuJCR0eXBlb2YgPT09IFJFQUNUX0ZVTkRBTUVOVEFMX1RZUEUgfHwgdHlwZS4kJHR5cGVvZiA9PT0gUkVBQ1RfUkVTUE9OREVSX1RZUEUgfHwgdHlwZS4kJHR5cGVvZiA9PT0gUkVBQ1RfU0NPUEVfVFlQRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEZvcmtlZCBmcm9tIGZianMvd2FybmluZzoKICAgICAgICAgICAgICogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL2ZianMvYmxvYi9lNjZiYTIwYWQ1YmU0MzNlYjU0NDIzZjJiMDk3ZDgyOTMyNGQ5ZGU2L3BhY2thZ2VzL2ZianMvc3JjL19fZm9ya3NfXy93YXJuaW5nLmpzCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIE9ubHkgY2hhbmdlIGlzIHdlIHVzZSBjb25zb2xlLndhcm4gaW5zdGVhZCBvZiBjb25zb2xlLmVycm9yLAogICAgICAgICAgICAgKiBhbmQgZG8gbm90aGluZyB3aGVuICdjb25zb2xlJyBpcyBub3Qgc3VwcG9ydGVkLgogICAgICAgICAgICAgKiBUaGlzIHJlYWxseSBzaW1wbGlmaWVzIHRoZSBjb2RlLgogICAgICAgICAgICAgKiAtLS0KICAgICAgICAgICAgICogU2ltaWxhciB0byBpbnZhcmlhbnQgYnV0IG9ubHkgbG9ncyBhIHdhcm5pbmcgaWYgdGhlIGNvbmRpdGlvbiBpcyBub3QgbWV0LgogICAgICAgICAgICAgKiBUaGlzIGNhbiBiZSB1c2VkIHRvIGxvZyBpc3N1ZXMgaW4gZGV2ZWxvcG1lbnQgZW52aXJvbm1lbnRzIGluIGNyaXRpY2FsCiAgICAgICAgICAgICAqIHBhdGhzLiBSZW1vdmluZyB0aGUgbG9nZ2luZyBjb2RlIGZvciBwcm9kdWN0aW9uIGVudmlyb25tZW50cyB3aWxsIGtlZXAgdGhlCiAgICAgICAgICAgICAqIHNhbWUgbG9naWMgYW5kIGZvbGxvdyB0aGUgc2FtZSBjb2RlIHBhdGhzLgogICAgICAgICAgICAgKi8KCgogICAgICAgICAgICB2YXIgbG93UHJpb3JpdHlXYXJuaW5nV2l0aG91dFN0YWNrID0gZnVuY3Rpb24gbG93UHJpb3JpdHlXYXJuaW5nV2l0aG91dFN0YWNrKCkge307CgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdmFyIHByaW50V2FybmluZyA9IGZ1bmN0aW9uIHByaW50V2FybmluZyhmb3JtYXQpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICAgICAgICAgICAgYXJnc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGFyZ0luZGV4ID0gMDsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gJ1dhcm5pbmc6ICcgKyBmb3JtYXQucmVwbGFjZSgvJXMvZywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gYXJnc1thcmdJbmRleCsrXTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIC8vIC0tLSBXZWxjb21lIHRvIGRlYnVnZ2luZyBSZWFjdCAtLS0KICAgICAgICAgICAgICAgICAgLy8gVGhpcyBlcnJvciB3YXMgdGhyb3duIGFzIGEgY29udmVuaWVuY2Ugc28gdGhhdCB5b3UgY2FuIHVzZSB0aGlzIHN0YWNrCiAgICAgICAgICAgICAgICAgIC8vIHRvIGZpbmQgdGhlIGNhbGxzaXRlIHRoYXQgY2F1c2VkIHRoaXMgd2FybmluZyB0byBmaXJlLgogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoICh4KSB7fQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGxvd1ByaW9yaXR5V2FybmluZ1dpdGhvdXRTdGFjayA9IGZ1bmN0aW9uIGxvd1ByaW9yaXR5V2FybmluZ1dpdGhvdXRTdGFjayhjb25kaXRpb24sIGZvcm1hdCkgewogICAgICAgICAgICAgICAgaWYgKGZvcm1hdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYGxvd1ByaW9yaXR5V2FybmluZ1dpdGhvdXRTdGFjayhjb25kaXRpb24sIGZvcm1hdCwgLi4uYXJncylgIHJlcXVpcmVzIGEgd2FybmluZyAnICsgJ21lc3NhZ2UgYXJndW1lbnQnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWNvbmRpdGlvbikgewogICAgICAgICAgICAgICAgICBmb3IgKHZhciBfbGVuMiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbjIgPiAyID8gX2xlbjIgLSAyIDogMCksIF9rZXkyID0gMjsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykgewogICAgICAgICAgICAgICAgICAgIGFyZ3NbX2tleTIgLSAyXSA9IGFyZ3VtZW50c1tfa2V5Ml07CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHByaW50V2FybmluZy5hcHBseSh2b2lkIDAsIFtmb3JtYXRdLmNvbmNhdChhcmdzKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbG93UHJpb3JpdHlXYXJuaW5nV2l0aG91dFN0YWNrJDEgPSBsb3dQcmlvcml0eVdhcm5pbmdXaXRob3V0U3RhY2s7CgogICAgICAgICAgICBmdW5jdGlvbiB0eXBlT2Yob2JqZWN0KSB7CiAgICAgICAgICAgICAgaWYgKF90eXBlb2Y0KG9iamVjdCkgPT09ICdvYmplY3QnICYmIG9iamVjdCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdmFyICQkdHlwZW9mID0gb2JqZWN0LiQkdHlwZW9mOwoKICAgICAgICAgICAgICAgIHN3aXRjaCAoJCR0eXBlb2YpIHsKICAgICAgICAgICAgICAgICAgY2FzZSBSRUFDVF9FTEVNRU5UX1RZUEU6CiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBvYmplY3QudHlwZTsKCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJFQUNUX0FTWU5DX01PREVfVFlQRToKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUkVBQ1RfQ09OQ1VSUkVOVF9NT0RFX1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJFQUNUX0ZSQUdNRU5UX1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJFQUNUX1BST0ZJTEVSX1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJFQUNUX1NUUklDVF9NT0RFX1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJFQUNUX1NVU1BFTlNFX1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlOwoKICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkJHR5cGVvZlR5cGUgPSB0eXBlICYmIHR5cGUuJCR0eXBlb2Y7CgogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCQkdHlwZW9mVHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUkVBQ1RfQ09OVEVYVF9UWVBFOgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUkVBQ1RfRk9SV0FSRF9SRUZfVFlQRToKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJFQUNUX0xBWllfVFlQRToKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJFQUNUX01FTU9fVFlQRToKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFJFQUNUX1BST1ZJREVSX1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJCR0eXBlb2ZUeXBlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQkdHlwZW9mOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGNhc2UgUkVBQ1RfUE9SVEFMX1RZUEU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQkdHlwZW9mOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgfSAvLyBBc3luY01vZGUgaXMgZGVwcmVjYXRlZCBhbG9uZyB3aXRoIGlzQXN5bmNNb2RlCgoKICAgICAgICAgICAgdmFyIEFzeW5jTW9kZSA9IFJFQUNUX0FTWU5DX01PREVfVFlQRTsKICAgICAgICAgICAgdmFyIENvbmN1cnJlbnRNb2RlID0gUkVBQ1RfQ09OQ1VSUkVOVF9NT0RFX1RZUEU7CiAgICAgICAgICAgIHZhciBDb250ZXh0Q29uc3VtZXIgPSBSRUFDVF9DT05URVhUX1RZUEU7CiAgICAgICAgICAgIHZhciBDb250ZXh0UHJvdmlkZXIgPSBSRUFDVF9QUk9WSURFUl9UWVBFOwogICAgICAgICAgICB2YXIgRWxlbWVudCA9IFJFQUNUX0VMRU1FTlRfVFlQRTsKICAgICAgICAgICAgdmFyIEZvcndhcmRSZWYgPSBSRUFDVF9GT1JXQVJEX1JFRl9UWVBFOwogICAgICAgICAgICB2YXIgRnJhZ21lbnQgPSBSRUFDVF9GUkFHTUVOVF9UWVBFOwogICAgICAgICAgICB2YXIgTGF6eSA9IFJFQUNUX0xBWllfVFlQRTsKICAgICAgICAgICAgdmFyIE1lbW8gPSBSRUFDVF9NRU1PX1RZUEU7CiAgICAgICAgICAgIHZhciBQb3J0YWwgPSBSRUFDVF9QT1JUQUxfVFlQRTsKICAgICAgICAgICAgdmFyIFByb2ZpbGVyID0gUkVBQ1RfUFJPRklMRVJfVFlQRTsKICAgICAgICAgICAgdmFyIFN0cmljdE1vZGUgPSBSRUFDVF9TVFJJQ1RfTU9ERV9UWVBFOwogICAgICAgICAgICB2YXIgU3VzcGVuc2UgPSBSRUFDVF9TVVNQRU5TRV9UWVBFOwogICAgICAgICAgICB2YXIgaGFzV2FybmVkQWJvdXREZXByZWNhdGVkSXNBc3luY01vZGUgPSBmYWxzZTsgLy8gQXN5bmNNb2RlIHNob3VsZCBiZSBkZXByZWNhdGVkCgogICAgICAgICAgICBmdW5jdGlvbiBpc0FzeW5jTW9kZShvYmplY3QpIHsKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoIWhhc1dhcm5lZEFib3V0RGVwcmVjYXRlZElzQXN5bmNNb2RlKSB7CiAgICAgICAgICAgICAgICAgIGhhc1dhcm5lZEFib3V0RGVwcmVjYXRlZElzQXN5bmNNb2RlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgbG93UHJpb3JpdHlXYXJuaW5nV2l0aG91dFN0YWNrJDEoZmFsc2UsICdUaGUgUmVhY3RJcy5pc0FzeW5jTW9kZSgpIGFsaWFzIGhhcyBiZWVuIGRlcHJlY2F0ZWQsICcgKyAnYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiBSZWFjdCAxNysuIFVwZGF0ZSB5b3VyIGNvZGUgdG8gdXNlICcgKyAnUmVhY3RJcy5pc0NvbmN1cnJlbnRNb2RlKCkgaW5zdGVhZC4gSXQgaGFzIHRoZSBleGFjdCBzYW1lIEFQSS4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGlzQ29uY3VycmVudE1vZGUob2JqZWN0KSB8fCB0eXBlT2Yob2JqZWN0KSA9PT0gUkVBQ1RfQVNZTkNfTU9ERV9UWVBFOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc0NvbmN1cnJlbnRNb2RlKG9iamVjdCkgewogICAgICAgICAgICAgIHJldHVybiB0eXBlT2Yob2JqZWN0KSA9PT0gUkVBQ1RfQ09OQ1VSUkVOVF9NT0RFX1RZUEU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGlzQ29udGV4dENvbnN1bWVyKG9iamVjdCkgewogICAgICAgICAgICAgIHJldHVybiB0eXBlT2Yob2JqZWN0KSA9PT0gUkVBQ1RfQ09OVEVYVF9UWVBFOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc0NvbnRleHRQcm92aWRlcihvYmplY3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHlwZU9mKG9iamVjdCkgPT09IFJFQUNUX1BST1ZJREVSX1RZUEU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGlzRWxlbWVudChvYmplY3QpIHsKICAgICAgICAgICAgICByZXR1cm4gX3R5cGVvZjQob2JqZWN0KSA9PT0gJ29iamVjdCcgJiYgb2JqZWN0ICE9PSBudWxsICYmIG9iamVjdC4kJHR5cGVvZiA9PT0gUkVBQ1RfRUxFTUVOVF9UWVBFOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc0ZvcndhcmRSZWYob2JqZWN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHR5cGVPZihvYmplY3QpID09PSBSRUFDVF9GT1JXQVJEX1JFRl9UWVBFOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc0ZyYWdtZW50KG9iamVjdCkgewogICAgICAgICAgICAgIHJldHVybiB0eXBlT2Yob2JqZWN0KSA9PT0gUkVBQ1RfRlJBR01FTlRfVFlQRTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gaXNMYXp5KG9iamVjdCkgewogICAgICAgICAgICAgIHJldHVybiB0eXBlT2Yob2JqZWN0KSA9PT0gUkVBQ1RfTEFaWV9UWVBFOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc01lbW8ob2JqZWN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHR5cGVPZihvYmplY3QpID09PSBSRUFDVF9NRU1PX1RZUEU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGlzUG9ydGFsKG9iamVjdCkgewogICAgICAgICAgICAgIHJldHVybiB0eXBlT2Yob2JqZWN0KSA9PT0gUkVBQ1RfUE9SVEFMX1RZUEU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGlzUHJvZmlsZXIob2JqZWN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHR5cGVPZihvYmplY3QpID09PSBSRUFDVF9QUk9GSUxFUl9UWVBFOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc1N0cmljdE1vZGUob2JqZWN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHR5cGVPZihvYmplY3QpID09PSBSRUFDVF9TVFJJQ1RfTU9ERV9UWVBFOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc1N1c3BlbnNlKG9iamVjdCkgewogICAgICAgICAgICAgIHJldHVybiB0eXBlT2Yob2JqZWN0KSA9PT0gUkVBQ1RfU1VTUEVOU0VfVFlQRTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZXhwb3J0cy50eXBlT2YgPSB0eXBlT2Y7CiAgICAgICAgICAgIGV4cG9ydHMuQXN5bmNNb2RlID0gQXN5bmNNb2RlOwogICAgICAgICAgICBleHBvcnRzLkNvbmN1cnJlbnRNb2RlID0gQ29uY3VycmVudE1vZGU7CiAgICAgICAgICAgIGV4cG9ydHMuQ29udGV4dENvbnN1bWVyID0gQ29udGV4dENvbnN1bWVyOwogICAgICAgICAgICBleHBvcnRzLkNvbnRleHRQcm92aWRlciA9IENvbnRleHRQcm92aWRlcjsKICAgICAgICAgICAgZXhwb3J0cy5FbGVtZW50ID0gRWxlbWVudDsKICAgICAgICAgICAgZXhwb3J0cy5Gb3J3YXJkUmVmID0gRm9yd2FyZFJlZjsKICAgICAgICAgICAgZXhwb3J0cy5GcmFnbWVudCA9IEZyYWdtZW50OwogICAgICAgICAgICBleHBvcnRzLkxhenkgPSBMYXp5OwogICAgICAgICAgICBleHBvcnRzLk1lbW8gPSBNZW1vOwogICAgICAgICAgICBleHBvcnRzLlBvcnRhbCA9IFBvcnRhbDsKICAgICAgICAgICAgZXhwb3J0cy5Qcm9maWxlciA9IFByb2ZpbGVyOwogICAgICAgICAgICBleHBvcnRzLlN0cmljdE1vZGUgPSBTdHJpY3RNb2RlOwogICAgICAgICAgICBleHBvcnRzLlN1c3BlbnNlID0gU3VzcGVuc2U7CiAgICAgICAgICAgIGV4cG9ydHMuaXNWYWxpZEVsZW1lbnRUeXBlID0gaXNWYWxpZEVsZW1lbnRUeXBlOwogICAgICAgICAgICBleHBvcnRzLmlzQXN5bmNNb2RlID0gaXNBc3luY01vZGU7CiAgICAgICAgICAgIGV4cG9ydHMuaXNDb25jdXJyZW50TW9kZSA9IGlzQ29uY3VycmVudE1vZGU7CiAgICAgICAgICAgIGV4cG9ydHMuaXNDb250ZXh0Q29uc3VtZXIgPSBpc0NvbnRleHRDb25zdW1lcjsKICAgICAgICAgICAgZXhwb3J0cy5pc0NvbnRleHRQcm92aWRlciA9IGlzQ29udGV4dFByb3ZpZGVyOwogICAgICAgICAgICBleHBvcnRzLmlzRWxlbWVudCA9IGlzRWxlbWVudDsKICAgICAgICAgICAgZXhwb3J0cy5pc0ZvcndhcmRSZWYgPSBpc0ZvcndhcmRSZWY7CiAgICAgICAgICAgIGV4cG9ydHMuaXNGcmFnbWVudCA9IGlzRnJhZ21lbnQ7CiAgICAgICAgICAgIGV4cG9ydHMuaXNMYXp5ID0gaXNMYXp5OwogICAgICAgICAgICBleHBvcnRzLmlzTWVtbyA9IGlzTWVtbzsKICAgICAgICAgICAgZXhwb3J0cy5pc1BvcnRhbCA9IGlzUG9ydGFsOwogICAgICAgICAgICBleHBvcnRzLmlzUHJvZmlsZXIgPSBpc1Byb2ZpbGVyOwogICAgICAgICAgICBleHBvcnRzLmlzU3RyaWN0TW9kZSA9IGlzU3RyaWN0TW9kZTsKICAgICAgICAgICAgZXhwb3J0cy5pc1N1c3BlbnNlID0gaXNTdXNwZW5zZTsKICAgICAgICAgIH0pKCk7CiAgICAgICAgfQogICAgICAgIC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLwoKICAgICAgfSkuY2FsbChleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpKTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA4OSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovCgogICAgICAoZnVuY3Rpb24gKHByb2Nlc3MpIHsKICAgICAgICAvKioKICAgICAgICAqIENvcHlyaWdodCAoYykgMjAxMy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLgogICAgICAgICoKICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICovCiAgICAgICAgdmFyIFJlYWN0SXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5KTsKCiAgICAgICAgdmFyIGFzc2lnbiA9IF9fd2VicGFja19yZXF1aXJlX18oOTApOwoKICAgICAgICB2YXIgUmVhY3RQcm9wVHlwZXNTZWNyZXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzKTsKCiAgICAgICAgdmFyIGNoZWNrUHJvcFR5cGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MSk7CgogICAgICAgIHZhciBoYXMgPSBGdW5jdGlvbi5jYWxsLmJpbmQoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSk7CgogICAgICAgIHZhciBwcmludFdhcm5pbmcgPSBmdW5jdGlvbiBwcmludFdhcm5pbmcoKSB7fTsKCiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgIHByaW50V2FybmluZyA9IGZ1bmN0aW9uIHByaW50V2FybmluZyh0ZXh0KSB7CiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gJ1dhcm5pbmc6ICcgKyB0ZXh0OwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgLy8gLS0tIFdlbGNvbWUgdG8gZGVidWdnaW5nIFJlYWN0IC0tLQogICAgICAgICAgICAgIC8vIFRoaXMgZXJyb3Igd2FzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHRoYXQgeW91IGNhbiB1c2UgdGhpcyBzdGFjawogICAgICAgICAgICAgIC8vIHRvIGZpbmQgdGhlIGNhbGxzaXRlIHRoYXQgY2F1c2VkIHRoaXMgd2FybmluZyB0byBmaXJlLgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKICAgICAgICAgICAgfSBjYXRjaCAoeCkge30KICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBlbXB0eUZ1bmN0aW9uVGhhdFJldHVybnNOdWxsKCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpc1ZhbGlkRWxlbWVudCwgdGhyb3dPbkRpcmVjdEFjY2VzcykgewogICAgICAgICAgLyogZ2xvYmFsIFN5bWJvbCAqLwogICAgICAgICAgdmFyIElURVJBVE9SX1NZTUJPTCA9IHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicgJiYgU3ltYm9sLml0ZXJhdG9yOwogICAgICAgICAgdmFyIEZBVVhfSVRFUkFUT1JfU1lNQk9MID0gJ0BAaXRlcmF0b3InOyAvLyBCZWZvcmUgU3ltYm9sIHNwZWMuCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBpdGVyYXRvciBtZXRob2QgZnVuY3Rpb24gY29udGFpbmVkIG9uIHRoZSBpdGVyYWJsZSBvYmplY3QuCiAgICAgICAgICAgKgogICAgICAgICAgICogQmUgc3VyZSB0byBpbnZva2UgdGhlIGZ1bmN0aW9uIHdpdGggdGhlIGl0ZXJhYmxlIGFzIGNvbnRleHQ6CiAgICAgICAgICAgKgogICAgICAgICAgICogICAgIHZhciBpdGVyYXRvckZuID0gZ2V0SXRlcmF0b3JGbihteUl0ZXJhYmxlKTsKICAgICAgICAgICAqICAgICBpZiAoaXRlcmF0b3JGbikgewogICAgICAgICAgICogICAgICAgdmFyIGl0ZXJhdG9yID0gaXRlcmF0b3JGbi5jYWxsKG15SXRlcmFibGUpOwogICAgICAgICAgICogICAgICAgLi4uCiAgICAgICAgICAgKiAgICAgfQogICAgICAgICAgICoKICAgICAgICAgICAqIEBwYXJhbSB7P29iamVjdH0gbWF5YmVJdGVyYWJsZQogICAgICAgICAgICogQHJldHVybiB7P2Z1bmN0aW9ufQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZ2V0SXRlcmF0b3JGbihtYXliZUl0ZXJhYmxlKSB7CiAgICAgICAgICAgIHZhciBpdGVyYXRvckZuID0gbWF5YmVJdGVyYWJsZSAmJiAoSVRFUkFUT1JfU1lNQk9MICYmIG1heWJlSXRlcmFibGVbSVRFUkFUT1JfU1lNQk9MXSB8fCBtYXliZUl0ZXJhYmxlW0ZBVVhfSVRFUkFUT1JfU1lNQk9MXSk7CgogICAgICAgICAgICBpZiAodHlwZW9mIGl0ZXJhdG9yRm4gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlcmF0b3JGbjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDb2xsZWN0aW9uIG9mIG1ldGhvZHMgdGhhdCBhbGxvdyBkZWNsYXJhdGlvbiBhbmQgdmFsaWRhdGlvbiBvZiBwcm9wcyB0aGF0IGFyZQogICAgICAgICAgICogc3VwcGxpZWQgdG8gUmVhY3QgY29tcG9uZW50cy4gRXhhbXBsZSB1c2FnZToKICAgICAgICAgICAqCiAgICAgICAgICAgKiAgIHZhciBQcm9wcyA9IHJlcXVpcmUoJ1JlYWN0UHJvcFR5cGVzJyk7CiAgICAgICAgICAgKiAgIHZhciBNeUFydGljbGUgPSBSZWFjdC5jcmVhdGVDbGFzcyh7CiAgICAgICAgICAgKiAgICAgcHJvcFR5cGVzOiB7CiAgICAgICAgICAgKiAgICAgICAvLyBBbiBvcHRpb25hbCBzdHJpbmcgcHJvcCBuYW1lZCAiZGVzY3JpcHRpb24iLgogICAgICAgICAgICogICAgICAgZGVzY3JpcHRpb246IFByb3BzLnN0cmluZywKICAgICAgICAgICAqCiAgICAgICAgICAgKiAgICAgICAvLyBBIHJlcXVpcmVkIGVudW0gcHJvcCBuYW1lZCAiY2F0ZWdvcnkiLgogICAgICAgICAgICogICAgICAgY2F0ZWdvcnk6IFByb3BzLm9uZU9mKFsnTmV3cycsJ1Bob3RvcyddKS5pc1JlcXVpcmVkLAogICAgICAgICAgICoKICAgICAgICAgICAqICAgICAgIC8vIEEgcHJvcCBuYW1lZCAiZGlhbG9nIiB0aGF0IHJlcXVpcmVzIGFuIGluc3RhbmNlIG9mIERpYWxvZy4KICAgICAgICAgICAqICAgICAgIGRpYWxvZzogUHJvcHMuaW5zdGFuY2VPZihEaWFsb2cpLmlzUmVxdWlyZWQKICAgICAgICAgICAqICAgICB9LAogICAgICAgICAgICogICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7IC4uLiB9CiAgICAgICAgICAgKiAgIH0pOwogICAgICAgICAgICoKICAgICAgICAgICAqIEEgbW9yZSBmb3JtYWwgc3BlY2lmaWNhdGlvbiBvZiBob3cgdGhlc2UgbWV0aG9kcyBhcmUgdXNlZDoKICAgICAgICAgICAqCiAgICAgICAgICAgKiAgIHR5cGUgOj0gYXJyYXl8Ym9vbHxmdW5jfG9iamVjdHxudW1iZXJ8c3RyaW5nfG9uZU9mKFsuLi5dKXxpbnN0YW5jZU9mKC4uLikKICAgICAgICAgICAqICAgZGVjbCA6PSBSZWFjdFByb3BUeXBlcy57dHlwZX0oLmlzUmVxdWlyZWQpPwogICAgICAgICAgICoKICAgICAgICAgICAqIEVhY2ggYW5kIGV2ZXJ5IGRlY2xhcmF0aW9uIHByb2R1Y2VzIGEgZnVuY3Rpb24gd2l0aCB0aGUgc2FtZSBzaWduYXR1cmUuIFRoaXMKICAgICAgICAgICAqIGFsbG93cyB0aGUgY3JlYXRpb24gb2YgY3VzdG9tIHZhbGlkYXRpb24gZnVuY3Rpb25zLiBGb3IgZXhhbXBsZToKICAgICAgICAgICAqCiAgICAgICAgICAgKiAgdmFyIE15TGluayA9IFJlYWN0LmNyZWF0ZUNsYXNzKHsKICAgICAgICAgICAqICAgIHByb3BUeXBlczogewogICAgICAgICAgICogICAgICAvLyBBbiBvcHRpb25hbCBzdHJpbmcgb3IgVVJJIHByb3AgbmFtZWQgImhyZWYiLgogICAgICAgICAgICogICAgICBocmVmOiBmdW5jdGlvbihwcm9wcywgcHJvcE5hbWUsIGNvbXBvbmVudE5hbWUpIHsKICAgICAgICAgICAqICAgICAgICB2YXIgcHJvcFZhbHVlID0gcHJvcHNbcHJvcE5hbWVdOwogICAgICAgICAgICogICAgICAgIGlmIChwcm9wVmFsdWUgIT0gbnVsbCAmJiB0eXBlb2YgcHJvcFZhbHVlICE9PSAnc3RyaW5nJyAmJgogICAgICAgICAgICogICAgICAgICAgICAhKHByb3BWYWx1ZSBpbnN0YW5jZW9mIFVSSSkpIHsKICAgICAgICAgICAqICAgICAgICAgIHJldHVybiBuZXcgRXJyb3IoCiAgICAgICAgICAgKiAgICAgICAgICAgICdFeHBlY3RlZCBhIHN0cmluZyBvciBhbiBVUkkgZm9yICcgKyBwcm9wTmFtZSArICcgaW4gJyArCiAgICAgICAgICAgKiAgICAgICAgICAgIGNvbXBvbmVudE5hbWUKICAgICAgICAgICAqICAgICAgICAgICk7CiAgICAgICAgICAgKiAgICAgICAgfQogICAgICAgICAgICogICAgICB9CiAgICAgICAgICAgKiAgICB9LAogICAgICAgICAgICogICAgcmVuZGVyOiBmdW5jdGlvbigpIHsuLi59CiAgICAgICAgICAgKiAgfSk7CiAgICAgICAgICAgKgogICAgICAgICAgICogQGludGVybmFsCiAgICAgICAgICAgKi8KCgogICAgICAgICAgdmFyIEFOT05ZTU9VUyA9ICc8PGFub255bW91cz4+JzsgLy8gSW1wb3J0YW50IQogICAgICAgICAgLy8gS2VlcCB0aGlzIGxpc3QgaW4gc3luYyB3aXRoIHByb2R1Y3Rpb24gdmVyc2lvbiBpbiBgLi9mYWN0b3J5V2l0aFRocm93aW5nU2hpbXMuanNgLgoKICAgICAgICAgIHZhciBSZWFjdFByb3BUeXBlcyA9IHsKICAgICAgICAgICAgYXJyYXk6IGNyZWF0ZVByaW1pdGl2ZVR5cGVDaGVja2VyKCdhcnJheScpLAogICAgICAgICAgICBib29sOiBjcmVhdGVQcmltaXRpdmVUeXBlQ2hlY2tlcignYm9vbGVhbicpLAogICAgICAgICAgICBmdW5jOiBjcmVhdGVQcmltaXRpdmVUeXBlQ2hlY2tlcignZnVuY3Rpb24nKSwKICAgICAgICAgICAgbnVtYmVyOiBjcmVhdGVQcmltaXRpdmVUeXBlQ2hlY2tlcignbnVtYmVyJyksCiAgICAgICAgICAgIG9iamVjdDogY3JlYXRlUHJpbWl0aXZlVHlwZUNoZWNrZXIoJ29iamVjdCcpLAogICAgICAgICAgICBzdHJpbmc6IGNyZWF0ZVByaW1pdGl2ZVR5cGVDaGVja2VyKCdzdHJpbmcnKSwKICAgICAgICAgICAgc3ltYm9sOiBjcmVhdGVQcmltaXRpdmVUeXBlQ2hlY2tlcignc3ltYm9sJyksCiAgICAgICAgICAgIGFueTogY3JlYXRlQW55VHlwZUNoZWNrZXIoKSwKICAgICAgICAgICAgYXJyYXlPZjogY3JlYXRlQXJyYXlPZlR5cGVDaGVja2VyLAogICAgICAgICAgICBlbGVtZW50OiBjcmVhdGVFbGVtZW50VHlwZUNoZWNrZXIoKSwKICAgICAgICAgICAgZWxlbWVudFR5cGU6IGNyZWF0ZUVsZW1lbnRUeXBlVHlwZUNoZWNrZXIoKSwKICAgICAgICAgICAgaW5zdGFuY2VPZjogY3JlYXRlSW5zdGFuY2VUeXBlQ2hlY2tlciwKICAgICAgICAgICAgbm9kZTogY3JlYXRlTm9kZUNoZWNrZXIoKSwKICAgICAgICAgICAgb2JqZWN0T2Y6IGNyZWF0ZU9iamVjdE9mVHlwZUNoZWNrZXIsCiAgICAgICAgICAgIG9uZU9mOiBjcmVhdGVFbnVtVHlwZUNoZWNrZXIsCiAgICAgICAgICAgIG9uZU9mVHlwZTogY3JlYXRlVW5pb25UeXBlQ2hlY2tlciwKICAgICAgICAgICAgc2hhcGU6IGNyZWF0ZVNoYXBlVHlwZUNoZWNrZXIsCiAgICAgICAgICAgIGV4YWN0OiBjcmVhdGVTdHJpY3RTaGFwZVR5cGVDaGVja2VyCiAgICAgICAgICB9OwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBpbmxpbmVkIE9iamVjdC5pcyBwb2x5ZmlsbCB0byBhdm9pZCByZXF1aXJpbmcgY29uc3VtZXJzIHNoaXAgdGhlaXIgb3duCiAgICAgICAgICAgKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9PYmplY3QvaXMKICAgICAgICAgICAqLwoKICAgICAgICAgIC8qZXNsaW50LWRpc2FibGUgbm8tc2VsZi1jb21wYXJlKi8KCiAgICAgICAgICBmdW5jdGlvbiBpcyh4LCB5KSB7CiAgICAgICAgICAgIC8vIFNhbWVWYWx1ZSBhbGdvcml0aG0KICAgICAgICAgICAgaWYgKHggPT09IHkpIHsKICAgICAgICAgICAgICAvLyBTdGVwcyAxLTUsIDctMTAKICAgICAgICAgICAgICAvLyBTdGVwcyA2LmItNi5lOiArMCAhPSAtMAogICAgICAgICAgICAgIHJldHVybiB4ICE9PSAwIHx8IDEgLyB4ID09PSAxIC8geTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBTdGVwIDYuYTogTmFOID09IE5hTgogICAgICAgICAgICAgIHJldHVybiB4ICE9PSB4ICYmIHkgIT09IHk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8qZXNsaW50LWVuYWJsZSBuby1zZWxmLWNvbXBhcmUqLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogV2UgdXNlIGFuIEVycm9yLWxpa2Ugb2JqZWN0IGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IGFzIHBlb3BsZSBtYXkgY2FsbAogICAgICAgICAgICogUHJvcFR5cGVzIGRpcmVjdGx5IGFuZCBpbnNwZWN0IHRoZWlyIG91dHB1dC4gSG93ZXZlciwgd2UgZG9uJ3QgdXNlIHJlYWwKICAgICAgICAgICAqIEVycm9ycyBhbnltb3JlLiBXZSBkb24ndCBpbnNwZWN0IHRoZWlyIHN0YWNrIGFueXdheSwgYW5kIGNyZWF0aW5nIHRoZW0KICAgICAgICAgICAqIGlzIHByb2hpYml0aXZlbHkgZXhwZW5zaXZlIGlmIHRoZXkgYXJlIGNyZWF0ZWQgdG9vIG9mdGVuLCBzdWNoIGFzIHdoYXQKICAgICAgICAgICAqIGhhcHBlbnMgaW4gb25lT2ZUeXBlKCkgZm9yIGFueSB0eXBlIGJlZm9yZSB0aGUgb25lIHRoYXQgbWF0Y2hlZC4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBQcm9wVHlwZUVycm9yKG1lc3NhZ2UpIHsKICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKICAgICAgICAgICAgdGhpcy5zdGFjayA9ICcnOwogICAgICAgICAgfSAvLyBNYWtlIGBpbnN0YW5jZW9mIEVycm9yYCBzdGlsbCB3b3JrIGZvciByZXR1cm5lZCBlcnJvcnMuCgoKICAgICAgICAgIFByb3BUeXBlRXJyb3IucHJvdG90eXBlID0gRXJyb3IucHJvdG90eXBlOwoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNoYWluYWJsZVR5cGVDaGVja2VyKHZhbGlkYXRlKSB7CiAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICAgICAgdmFyIG1hbnVhbFByb3BUeXBlQ2FsbENhY2hlID0ge307CiAgICAgICAgICAgICAgdmFyIG1hbnVhbFByb3BUeXBlV2FybmluZ0NvdW50ID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tUeXBlKGlzUmVxdWlyZWQsIHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIHByb3BGdWxsTmFtZSwgc2VjcmV0KSB7CiAgICAgICAgICAgICAgY29tcG9uZW50TmFtZSA9IGNvbXBvbmVudE5hbWUgfHwgQU5PTllNT1VTOwogICAgICAgICAgICAgIHByb3BGdWxsTmFtZSA9IHByb3BGdWxsTmFtZSB8fCBwcm9wTmFtZTsKCiAgICAgICAgICAgICAgaWYgKHNlY3JldCAhPT0gUmVhY3RQcm9wVHlwZXNTZWNyZXQpIHsKICAgICAgICAgICAgICAgIGlmICh0aHJvd09uRGlyZWN0QWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgIC8vIE5ldyBiZWhhdmlvciBvbmx5IGZvciB1c2VycyBvZiBgcHJvcC10eXBlc2AgcGFja2FnZQogICAgICAgICAgICAgICAgICB2YXIgZXJyID0gbmV3IEVycm9yKCdDYWxsaW5nIFByb3BUeXBlcyB2YWxpZGF0b3JzIGRpcmVjdGx5IGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIGBwcm9wLXR5cGVzYCBwYWNrYWdlLiAnICsgJ1VzZSBgUHJvcFR5cGVzLmNoZWNrUHJvcFR5cGVzKClgIHRvIGNhbGwgdGhlbS4gJyArICdSZWFkIG1vcmUgYXQgaHR0cDovL2ZiLm1lL3VzZS1jaGVjay1wcm9wLXR5cGVzJyk7CiAgICAgICAgICAgICAgICAgIGVyci5uYW1lID0gJ0ludmFyaWFudCBWaW9sYXRpb24nOwogICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgIC8vIE9sZCBiZWhhdmlvciBmb3IgcGVvcGxlIHVzaW5nIFJlYWN0LlByb3BUeXBlcwogICAgICAgICAgICAgICAgICB2YXIgY2FjaGVLZXkgPSBjb21wb25lbnROYW1lICsgJzonICsgcHJvcE5hbWU7CgogICAgICAgICAgICAgICAgICBpZiAoIW1hbnVhbFByb3BUeXBlQ2FsbENhY2hlW2NhY2hlS2V5XSAmJiAvLyBBdm9pZCBzcGFtbWluZyB0aGUgY29uc29sZSBiZWNhdXNlIHRoZXkgYXJlIG9mdGVuIG5vdCBhY3Rpb25hYmxlIGV4Y2VwdCBmb3IgbGliIGF1dGhvcnMKICAgICAgICAgICAgICAgICAgbWFudWFsUHJvcFR5cGVXYXJuaW5nQ291bnQgPCAzKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRXYXJuaW5nKCdZb3UgYXJlIG1hbnVhbGx5IGNhbGxpbmcgYSBSZWFjdC5Qcm9wVHlwZXMgdmFsaWRhdGlvbiAnICsgJ2Z1bmN0aW9uIGZvciB0aGUgYCcgKyBwcm9wRnVsbE5hbWUgKyAnYCBwcm9wIG9uIGAnICsgY29tcG9uZW50TmFtZSArICdgLiBUaGlzIGlzIGRlcHJlY2F0ZWQgJyArICdhbmQgd2lsbCB0aHJvdyBpbiB0aGUgc3RhbmRhbG9uZSBgcHJvcC10eXBlc2AgcGFja2FnZS4gJyArICdZb3UgbWF5IGJlIHNlZWluZyB0aGlzIHdhcm5pbmcgZHVlIHRvIGEgdGhpcmQtcGFydHkgUHJvcFR5cGVzICcgKyAnbGlicmFyeS4gU2VlIGh0dHBzOi8vZmIubWUvcmVhY3Qtd2FybmluZy1kb250LWNhbGwtcHJvcHR5cGVzICcgKyAnZm9yIGRldGFpbHMuJyk7CiAgICAgICAgICAgICAgICAgICAgbWFudWFsUHJvcFR5cGVDYWxsQ2FjaGVbY2FjaGVLZXldID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBtYW51YWxQcm9wVHlwZVdhcm5pbmdDb3VudCsrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocHJvcHNbcHJvcE5hbWVdID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChpc1JlcXVpcmVkKSB7CiAgICAgICAgICAgICAgICAgIGlmIChwcm9wc1twcm9wTmFtZV0gPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3BUeXBlRXJyb3IoJ1RoZSAnICsgbG9jYXRpb24gKyAnIGAnICsgcHJvcEZ1bGxOYW1lICsgJ2AgaXMgbWFya2VkIGFzIHJlcXVpcmVkICcgKyAoJ2luIGAnICsgY29tcG9uZW50TmFtZSArICdgLCBidXQgaXRzIHZhbHVlIGlzIGBudWxsYC4nKSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvcFR5cGVFcnJvcignVGhlICcgKyBsb2NhdGlvbiArICcgYCcgKyBwcm9wRnVsbE5hbWUgKyAnYCBpcyBtYXJrZWQgYXMgcmVxdWlyZWQgaW4gJyArICgnYCcgKyBjb21wb25lbnROYW1lICsgJ2AsIGJ1dCBpdHMgdmFsdWUgaXMgYHVuZGVmaW5lZGAuJykpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGUocHJvcHMsIHByb3BOYW1lLCBjb21wb25lbnROYW1lLCBsb2NhdGlvbiwgcHJvcEZ1bGxOYW1lKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjaGFpbmVkQ2hlY2tUeXBlID0gY2hlY2tUeXBlLmJpbmQobnVsbCwgZmFsc2UpOwogICAgICAgICAgICBjaGFpbmVkQ2hlY2tUeXBlLmlzUmVxdWlyZWQgPSBjaGVja1R5cGUuYmluZChudWxsLCB0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIGNoYWluZWRDaGVja1R5cGU7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlUHJpbWl0aXZlVHlwZUNoZWNrZXIoZXhwZWN0ZWRUeXBlKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlKHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIHByb3BGdWxsTmFtZSwgc2VjcmV0KSB7CiAgICAgICAgICAgICAgdmFyIHByb3BWYWx1ZSA9IHByb3BzW3Byb3BOYW1lXTsKICAgICAgICAgICAgICB2YXIgcHJvcFR5cGUgPSBnZXRQcm9wVHlwZShwcm9wVmFsdWUpOwoKICAgICAgICAgICAgICBpZiAocHJvcFR5cGUgIT09IGV4cGVjdGVkVHlwZSkgewogICAgICAgICAgICAgICAgLy8gYHByb3BWYWx1ZWAgYmVpbmcgaW5zdGFuY2Ugb2YsIHNheSwgZGF0ZS9yZWdleHAsIHBhc3MgdGhlICdvYmplY3QnCiAgICAgICAgICAgICAgICAvLyBjaGVjaywgYnV0IHdlIGNhbiBvZmZlciBhIG1vcmUgcHJlY2lzZSBlcnJvciBtZXNzYWdlIGhlcmUgcmF0aGVyIHRoYW4KICAgICAgICAgICAgICAgIC8vICdvZiB0eXBlIGBvYmplY3RgJy4KICAgICAgICAgICAgICAgIHZhciBwcmVjaXNlVHlwZSA9IGdldFByZWNpc2VUeXBlKHByb3BWYWx1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3BUeXBlRXJyb3IoJ0ludmFsaWQgJyArIGxvY2F0aW9uICsgJyBgJyArIHByb3BGdWxsTmFtZSArICdgIG9mIHR5cGUgJyArICgnYCcgKyBwcmVjaXNlVHlwZSArICdgIHN1cHBsaWVkIHRvIGAnICsgY29tcG9uZW50TmFtZSArICdgLCBleHBlY3RlZCAnKSArICgnYCcgKyBleHBlY3RlZFR5cGUgKyAnYC4nKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNoYWluYWJsZVR5cGVDaGVja2VyKHZhbGlkYXRlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVBbnlUeXBlQ2hlY2tlcigpIHsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNoYWluYWJsZVR5cGVDaGVja2VyKGVtcHR5RnVuY3Rpb25UaGF0UmV0dXJuc051bGwpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUFycmF5T2ZUeXBlQ2hlY2tlcih0eXBlQ2hlY2tlcikgewogICAgICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZShwcm9wcywgcHJvcE5hbWUsIGNvbXBvbmVudE5hbWUsIGxvY2F0aW9uLCBwcm9wRnVsbE5hbWUpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHR5cGVDaGVja2VyICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3BUeXBlRXJyb3IoJ1Byb3BlcnR5IGAnICsgcHJvcEZ1bGxOYW1lICsgJ2Agb2YgY29tcG9uZW50IGAnICsgY29tcG9uZW50TmFtZSArICdgIGhhcyBpbnZhbGlkIFByb3BUeXBlIG5vdGF0aW9uIGluc2lkZSBhcnJheU9mLicpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHByb3BWYWx1ZSA9IHByb3BzW3Byb3BOYW1lXTsKCiAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHByb3BWYWx1ZSkpIHsKICAgICAgICAgICAgICAgIHZhciBwcm9wVHlwZSA9IGdldFByb3BUeXBlKHByb3BWYWx1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3BUeXBlRXJyb3IoJ0ludmFsaWQgJyArIGxvY2F0aW9uICsgJyBgJyArIHByb3BGdWxsTmFtZSArICdgIG9mIHR5cGUgJyArICgnYCcgKyBwcm9wVHlwZSArICdgIHN1cHBsaWVkIHRvIGAnICsgY29tcG9uZW50TmFtZSArICdgLCBleHBlY3RlZCBhbiBhcnJheS4nKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BWYWx1ZS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdHlwZUNoZWNrZXIocHJvcFZhbHVlLCBpLCBjb21wb25lbnROYW1lLCBsb2NhdGlvbiwgcHJvcEZ1bGxOYW1lICsgJ1snICsgaSArICddJywgUmVhY3RQcm9wVHlwZXNTZWNyZXQpOwoKICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY3JlYXRlQ2hhaW5hYmxlVHlwZUNoZWNrZXIodmFsaWRhdGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnRUeXBlQ2hlY2tlcigpIHsKICAgICAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGUocHJvcHMsIHByb3BOYW1lLCBjb21wb25lbnROYW1lLCBsb2NhdGlvbiwgcHJvcEZ1bGxOYW1lKSB7CiAgICAgICAgICAgICAgdmFyIHByb3BWYWx1ZSA9IHByb3BzW3Byb3BOYW1lXTsKCiAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkRWxlbWVudChwcm9wVmFsdWUpKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJvcFR5cGUgPSBnZXRQcm9wVHlwZShwcm9wVmFsdWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9wVHlwZUVycm9yKCdJbnZhbGlkICcgKyBsb2NhdGlvbiArICcgYCcgKyBwcm9wRnVsbE5hbWUgKyAnYCBvZiB0eXBlICcgKyAoJ2AnICsgcHJvcFR5cGUgKyAnYCBzdXBwbGllZCB0byBgJyArIGNvbXBvbmVudE5hbWUgKyAnYCwgZXhwZWN0ZWQgYSBzaW5nbGUgUmVhY3RFbGVtZW50LicpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY3JlYXRlQ2hhaW5hYmxlVHlwZUNoZWNrZXIodmFsaWRhdGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnRUeXBlVHlwZUNoZWNrZXIoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlKHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIHByb3BGdWxsTmFtZSkgewogICAgICAgICAgICAgIHZhciBwcm9wVmFsdWUgPSBwcm9wc1twcm9wTmFtZV07CgogICAgICAgICAgICAgIGlmICghUmVhY3RJcy5pc1ZhbGlkRWxlbWVudFR5cGUocHJvcFZhbHVlKSkgewogICAgICAgICAgICAgICAgdmFyIHByb3BUeXBlID0gZ2V0UHJvcFR5cGUocHJvcFZhbHVlKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvcFR5cGVFcnJvcignSW52YWxpZCAnICsgbG9jYXRpb24gKyAnIGAnICsgcHJvcEZ1bGxOYW1lICsgJ2Agb2YgdHlwZSAnICsgKCdgJyArIHByb3BUeXBlICsgJ2Agc3VwcGxpZWQgdG8gYCcgKyBjb21wb25lbnROYW1lICsgJ2AsIGV4cGVjdGVkIGEgc2luZ2xlIFJlYWN0RWxlbWVudCB0eXBlLicpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY3JlYXRlQ2hhaW5hYmxlVHlwZUNoZWNrZXIodmFsaWRhdGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUluc3RhbmNlVHlwZUNoZWNrZXIoZXhwZWN0ZWRDbGFzcykgewogICAgICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZShwcm9wcywgcHJvcE5hbWUsIGNvbXBvbmVudE5hbWUsIGxvY2F0aW9uLCBwcm9wRnVsbE5hbWUpIHsKICAgICAgICAgICAgICBpZiAoIShwcm9wc1twcm9wTmFtZV0gaW5zdGFuY2VvZiBleHBlY3RlZENsYXNzKSkgewogICAgICAgICAgICAgICAgdmFyIGV4cGVjdGVkQ2xhc3NOYW1lID0gZXhwZWN0ZWRDbGFzcy5uYW1lIHx8IEFOT05ZTU9VUzsKICAgICAgICAgICAgICAgIHZhciBhY3R1YWxDbGFzc05hbWUgPSBnZXRDbGFzc05hbWUocHJvcHNbcHJvcE5hbWVdKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvcFR5cGVFcnJvcignSW52YWxpZCAnICsgbG9jYXRpb24gKyAnIGAnICsgcHJvcEZ1bGxOYW1lICsgJ2Agb2YgdHlwZSAnICsgKCdgJyArIGFjdHVhbENsYXNzTmFtZSArICdgIHN1cHBsaWVkIHRvIGAnICsgY29tcG9uZW50TmFtZSArICdgLCBleHBlY3RlZCAnKSArICgnaW5zdGFuY2Ugb2YgYCcgKyBleHBlY3RlZENsYXNzTmFtZSArICdgLicpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY3JlYXRlQ2hhaW5hYmxlVHlwZUNoZWNrZXIodmFsaWRhdGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUVudW1UeXBlQ2hlY2tlcihleHBlY3RlZFZhbHVlcykgewogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZXhwZWN0ZWRWYWx1ZXMpKSB7CiAgICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICBwcmludFdhcm5pbmcoJ0ludmFsaWQgYXJndW1lbnRzIHN1cHBsaWVkIHRvIG9uZU9mLCBleHBlY3RlZCBhbiBhcnJheSwgZ290ICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyBhcmd1bWVudHMuICcgKyAnQSBjb21tb24gbWlzdGFrZSBpcyB0byB3cml0ZSBvbmVPZih4LCB5LCB6KSBpbnN0ZWFkIG9mIG9uZU9mKFt4LCB5LCB6XSkuJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBwcmludFdhcm5pbmcoJ0ludmFsaWQgYXJndW1lbnQgc3VwcGxpZWQgdG8gb25lT2YsIGV4cGVjdGVkIGFuIGFycmF5LicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGVtcHR5RnVuY3Rpb25UaGF0UmV0dXJuc051bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlKHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIHByb3BGdWxsTmFtZSkgewogICAgICAgICAgICAgIHZhciBwcm9wVmFsdWUgPSBwcm9wc1twcm9wTmFtZV07CgogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXhwZWN0ZWRWYWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChpcyhwcm9wVmFsdWUsIGV4cGVjdGVkVmFsdWVzW2ldKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciB2YWx1ZXNTdHJpbmcgPSBKU09OLnN0cmluZ2lmeShleHBlY3RlZFZhbHVlcywgZnVuY3Rpb24gcmVwbGFjZXIoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBnZXRQcmVjaXNlVHlwZSh2YWx1ZSk7CgogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzeW1ib2wnKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcodmFsdWUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3BUeXBlRXJyb3IoJ0ludmFsaWQgJyArIGxvY2F0aW9uICsgJyBgJyArIHByb3BGdWxsTmFtZSArICdgIG9mIHZhbHVlIGAnICsgU3RyaW5nKHByb3BWYWx1ZSkgKyAnYCAnICsgKCdzdXBwbGllZCB0byBgJyArIGNvbXBvbmVudE5hbWUgKyAnYCwgZXhwZWN0ZWQgb25lIG9mICcgKyB2YWx1ZXNTdHJpbmcgKyAnLicpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNoYWluYWJsZVR5cGVDaGVja2VyKHZhbGlkYXRlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVPYmplY3RPZlR5cGVDaGVja2VyKHR5cGVDaGVja2VyKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlKHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIHByb3BGdWxsTmFtZSkgewogICAgICAgICAgICAgIGlmICh0eXBlb2YgdHlwZUNoZWNrZXIgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvcFR5cGVFcnJvcignUHJvcGVydHkgYCcgKyBwcm9wRnVsbE5hbWUgKyAnYCBvZiBjb21wb25lbnQgYCcgKyBjb21wb25lbnROYW1lICsgJ2AgaGFzIGludmFsaWQgUHJvcFR5cGUgbm90YXRpb24gaW5zaWRlIG9iamVjdE9mLicpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHByb3BWYWx1ZSA9IHByb3BzW3Byb3BOYW1lXTsKICAgICAgICAgICAgICB2YXIgcHJvcFR5cGUgPSBnZXRQcm9wVHlwZShwcm9wVmFsdWUpOwoKICAgICAgICAgICAgICBpZiAocHJvcFR5cGUgIT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3BUeXBlRXJyb3IoJ0ludmFsaWQgJyArIGxvY2F0aW9uICsgJyBgJyArIHByb3BGdWxsTmFtZSArICdgIG9mIHR5cGUgJyArICgnYCcgKyBwcm9wVHlwZSArICdgIHN1cHBsaWVkIHRvIGAnICsgY29tcG9uZW50TmFtZSArICdgLCBleHBlY3RlZCBhbiBvYmplY3QuJykpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHByb3BWYWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKGhhcyhwcm9wVmFsdWUsIGtleSkpIHsKICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdHlwZUNoZWNrZXIocHJvcFZhbHVlLCBrZXksIGNvbXBvbmVudE5hbWUsIGxvY2F0aW9uLCBwcm9wRnVsbE5hbWUgKyAnLicgKyBrZXksIFJlYWN0UHJvcFR5cGVzU2VjcmV0KTsKCiAgICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNoYWluYWJsZVR5cGVDaGVja2VyKHZhbGlkYXRlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVVbmlvblR5cGVDaGVja2VyKGFycmF5T2ZUeXBlQ2hlY2tlcnMpIHsKICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGFycmF5T2ZUeXBlQ2hlY2tlcnMpKSB7CiAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyA/IHByaW50V2FybmluZygnSW52YWxpZCBhcmd1bWVudCBzdXBwbGllZCB0byBvbmVPZlR5cGUsIGV4cGVjdGVkIGFuIGluc3RhbmNlIG9mIGFycmF5LicpIDogdm9pZCAwOwogICAgICAgICAgICAgIHJldHVybiBlbXB0eUZ1bmN0aW9uVGhhdFJldHVybnNOdWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5T2ZUeXBlQ2hlY2tlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICB2YXIgY2hlY2tlciA9IGFycmF5T2ZUeXBlQ2hlY2tlcnNbaV07CgogICAgICAgICAgICAgIGlmICh0eXBlb2YgY2hlY2tlciAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgcHJpbnRXYXJuaW5nKCdJbnZhbGlkIGFyZ3VtZW50IHN1cHBsaWVkIHRvIG9uZU9mVHlwZS4gRXhwZWN0ZWQgYW4gYXJyYXkgb2YgY2hlY2sgZnVuY3Rpb25zLCBidXQgJyArICdyZWNlaXZlZCAnICsgZ2V0UG9zdGZpeEZvclR5cGVXYXJuaW5nKGNoZWNrZXIpICsgJyBhdCBpbmRleCAnICsgaSArICcuJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZW1wdHlGdW5jdGlvblRoYXRSZXR1cm5zTnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlKHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIHByb3BGdWxsTmFtZSkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXlPZlR5cGVDaGVja2Vycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGNoZWNrZXIgPSBhcnJheU9mVHlwZUNoZWNrZXJzW2ldOwoKICAgICAgICAgICAgICAgIGlmIChjaGVja2VyKHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIHByb3BGdWxsTmFtZSwgUmVhY3RQcm9wVHlwZXNTZWNyZXQpID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3BUeXBlRXJyb3IoJ0ludmFsaWQgJyArIGxvY2F0aW9uICsgJyBgJyArIHByb3BGdWxsTmFtZSArICdgIHN1cHBsaWVkIHRvICcgKyAoJ2AnICsgY29tcG9uZW50TmFtZSArICdgLicpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNoYWluYWJsZVR5cGVDaGVja2VyKHZhbGlkYXRlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVOb2RlQ2hlY2tlcigpIHsKICAgICAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGUocHJvcHMsIHByb3BOYW1lLCBjb21wb25lbnROYW1lLCBsb2NhdGlvbiwgcHJvcEZ1bGxOYW1lKSB7CiAgICAgICAgICAgICAgaWYgKCFpc05vZGUocHJvcHNbcHJvcE5hbWVdKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9wVHlwZUVycm9yKCdJbnZhbGlkICcgKyBsb2NhdGlvbiArICcgYCcgKyBwcm9wRnVsbE5hbWUgKyAnYCBzdXBwbGllZCB0byAnICsgKCdgJyArIGNvbXBvbmVudE5hbWUgKyAnYCwgZXhwZWN0ZWQgYSBSZWFjdE5vZGUuJykpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVDaGFpbmFibGVUeXBlQ2hlY2tlcih2YWxpZGF0ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlU2hhcGVUeXBlQ2hlY2tlcihzaGFwZVR5cGVzKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlKHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIHByb3BGdWxsTmFtZSkgewogICAgICAgICAgICAgIHZhciBwcm9wVmFsdWUgPSBwcm9wc1twcm9wTmFtZV07CiAgICAgICAgICAgICAgdmFyIHByb3BUeXBlID0gZ2V0UHJvcFR5cGUocHJvcFZhbHVlKTsKCiAgICAgICAgICAgICAgaWYgKHByb3BUeXBlICE9PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9wVHlwZUVycm9yKCdJbnZhbGlkICcgKyBsb2NhdGlvbiArICcgYCcgKyBwcm9wRnVsbE5hbWUgKyAnYCBvZiB0eXBlIGAnICsgcHJvcFR5cGUgKyAnYCAnICsgKCdzdXBwbGllZCB0byBgJyArIGNvbXBvbmVudE5hbWUgKyAnYCwgZXhwZWN0ZWQgYG9iamVjdGAuJykpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHNoYXBlVHlwZXMpIHsKICAgICAgICAgICAgICAgIHZhciBjaGVja2VyID0gc2hhcGVUeXBlc1trZXldOwoKICAgICAgICAgICAgICAgIGlmICghY2hlY2tlcikgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBjaGVja2VyKHByb3BWYWx1ZSwga2V5LCBjb21wb25lbnROYW1lLCBsb2NhdGlvbiwgcHJvcEZ1bGxOYW1lICsgJy4nICsga2V5LCBSZWFjdFByb3BUeXBlc1NlY3JldCk7CgogICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY3JlYXRlQ2hhaW5hYmxlVHlwZUNoZWNrZXIodmFsaWRhdGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVN0cmljdFNoYXBlVHlwZUNoZWNrZXIoc2hhcGVUeXBlcykgewogICAgICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZShwcm9wcywgcHJvcE5hbWUsIGNvbXBvbmVudE5hbWUsIGxvY2F0aW9uLCBwcm9wRnVsbE5hbWUpIHsKICAgICAgICAgICAgICB2YXIgcHJvcFZhbHVlID0gcHJvcHNbcHJvcE5hbWVdOwogICAgICAgICAgICAgIHZhciBwcm9wVHlwZSA9IGdldFByb3BUeXBlKHByb3BWYWx1ZSk7CgogICAgICAgICAgICAgIGlmIChwcm9wVHlwZSAhPT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvcFR5cGVFcnJvcignSW52YWxpZCAnICsgbG9jYXRpb24gKyAnIGAnICsgcHJvcEZ1bGxOYW1lICsgJ2Agb2YgdHlwZSBgJyArIHByb3BUeXBlICsgJ2AgJyArICgnc3VwcGxpZWQgdG8gYCcgKyBjb21wb25lbnROYW1lICsgJ2AsIGV4cGVjdGVkIGBvYmplY3RgLicpKTsKICAgICAgICAgICAgICB9IC8vIFdlIG5lZWQgdG8gY2hlY2sgYWxsIGtleXMgaW4gY2FzZSBzb21lIGFyZSByZXF1aXJlZCBidXQgbWlzc2luZyBmcm9tCiAgICAgICAgICAgICAgLy8gcHJvcHMuCgoKICAgICAgICAgICAgICB2YXIgYWxsS2V5cyA9IGFzc2lnbih7fSwgcHJvcHNbcHJvcE5hbWVdLCBzaGFwZVR5cGVzKTsKCiAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGFsbEtleXMpIHsKICAgICAgICAgICAgICAgIHZhciBjaGVja2VyID0gc2hhcGVUeXBlc1trZXldOwoKICAgICAgICAgICAgICAgIGlmICghY2hlY2tlcikgewogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3BUeXBlRXJyb3IoJ0ludmFsaWQgJyArIGxvY2F0aW9uICsgJyBgJyArIHByb3BGdWxsTmFtZSArICdgIGtleSBgJyArIGtleSArICdgIHN1cHBsaWVkIHRvIGAnICsgY29tcG9uZW50TmFtZSArICdgLicgKyAnXG5CYWQgb2JqZWN0OiAnICsgSlNPTi5zdHJpbmdpZnkocHJvcHNbcHJvcE5hbWVdLCBudWxsLCAnICAnKSArICdcblZhbGlkIGtleXM6ICcgKyBKU09OLnN0cmluZ2lmeShPYmplY3Qua2V5cyhzaGFwZVR5cGVzKSwgbnVsbCwgJyAgJykpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IGNoZWNrZXIocHJvcFZhbHVlLCBrZXksIGNvbXBvbmVudE5hbWUsIGxvY2F0aW9uLCBwcm9wRnVsbE5hbWUgKyAnLicgKyBrZXksIFJlYWN0UHJvcFR5cGVzU2VjcmV0KTsKCiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVDaGFpbmFibGVUeXBlQ2hlY2tlcih2YWxpZGF0ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNOb2RlKHByb3BWYWx1ZSkgewogICAgICAgICAgICBzd2l0Y2ggKF90eXBlb2Y0KHByb3BWYWx1ZSkpIHsKICAgICAgICAgICAgICBjYXNlICdudW1iZXInOgogICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgICAgICAgICAgY2FzZSAndW5kZWZpbmVkJzoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzoKICAgICAgICAgICAgICAgIHJldHVybiAhcHJvcFZhbHVlOwoKICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcFZhbHVlKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gcHJvcFZhbHVlLmV2ZXJ5KGlzTm9kZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHByb3BWYWx1ZSA9PT0gbnVsbCB8fCBpc1ZhbGlkRWxlbWVudChwcm9wVmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBpdGVyYXRvckZuID0gZ2V0SXRlcmF0b3JGbihwcm9wVmFsdWUpOwoKICAgICAgICAgICAgICAgIGlmIChpdGVyYXRvckZuKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpdGVyYXRvciA9IGl0ZXJhdG9yRm4uY2FsbChwcm9wVmFsdWUpOwogICAgICAgICAgICAgICAgICB2YXIgc3RlcDsKCiAgICAgICAgICAgICAgICAgIGlmIChpdGVyYXRvckZuICE9PSBwcm9wVmFsdWUuZW50cmllcykgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICghKHN0ZXAgPSBpdGVyYXRvci5uZXh0KCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNOb2RlKHN0ZXAudmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSXRlcmF0b3Igd2lsbCBwcm92aWRlIGVudHJ5IFtrLHZdIHR1cGxlcyByYXRoZXIgdGhhbiB2YWx1ZXMuCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCEoc3RlcCA9IGl0ZXJhdG9yLm5leHQoKSkuZG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gc3RlcC52YWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05vZGUoZW50cnlbMV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1N5bWJvbChwcm9wVHlwZSwgcHJvcFZhbHVlKSB7CiAgICAgICAgICAgIC8vIE5hdGl2ZSBTeW1ib2wuCiAgICAgICAgICAgIGlmIChwcm9wVHlwZSA9PT0gJ3N5bWJvbCcpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSAvLyBmYWxzeSB2YWx1ZSBjYW4ndCBiZSBhIFN5bWJvbAoKCiAgICAgICAgICAgIGlmICghcHJvcFZhbHVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9IC8vIDE5LjQuMy41IFN5bWJvbC5wcm90b3R5cGVbQEB0b1N0cmluZ1RhZ10gPT09ICdTeW1ib2wnCgoKICAgICAgICAgICAgaWYgKHByb3BWYWx1ZVsnQEB0b1N0cmluZ1RhZyddID09PSAnU3ltYm9sJykgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IC8vIEZhbGxiYWNrIGZvciBub24tc3BlYyBjb21wbGlhbnQgU3ltYm9scyB3aGljaCBhcmUgcG9seWZpbGxlZC4KCgogICAgICAgICAgICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gJ2Z1bmN0aW9uJyAmJiBwcm9wVmFsdWUgaW5zdGFuY2VvZiBTeW1ib2wpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfSAvLyBFcXVpdmFsZW50IG9mIGB0eXBlb2ZgIGJ1dCB3aXRoIHNwZWNpYWwgaGFuZGxpbmcgZm9yIGFycmF5IGFuZCByZWdleHAuCgoKICAgICAgICAgIGZ1bmN0aW9uIGdldFByb3BUeXBlKHByb3BWYWx1ZSkgewogICAgICAgICAgICB2YXIgcHJvcFR5cGUgPSBfdHlwZW9mNChwcm9wVmFsdWUpOwoKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcFZhbHVlKSkgewogICAgICAgICAgICAgIHJldHVybiAnYXJyYXknOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocHJvcFZhbHVlIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgICAgICAgICAgLy8gT2xkIHdlYmtpdHMgKGF0IGxlYXN0IHVudGlsIEFuZHJvaWQgNC4wKSByZXR1cm4gJ2Z1bmN0aW9uJyByYXRoZXIgdGhhbgogICAgICAgICAgICAgIC8vICdvYmplY3QnIGZvciB0eXBlb2YgYSBSZWdFeHAuIFdlJ2xsIG5vcm1hbGl6ZSB0aGlzIGhlcmUgc28gdGhhdCAvYmxhLwogICAgICAgICAgICAgIC8vIHBhc3NlcyBQcm9wVHlwZXMub2JqZWN0LgogICAgICAgICAgICAgIHJldHVybiAnb2JqZWN0JzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzU3ltYm9sKHByb3BUeXBlLCBwcm9wVmFsdWUpKSB7CiAgICAgICAgICAgICAgcmV0dXJuICdzeW1ib2wnOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcHJvcFR5cGU7CiAgICAgICAgICB9IC8vIFRoaXMgaGFuZGxlcyBtb3JlIHR5cGVzIHRoYW4gYGdldFByb3BUeXBlYC4gT25seSB1c2VkIGZvciBlcnJvciBtZXNzYWdlcy4KICAgICAgICAgIC8vIFNlZSBgY3JlYXRlUHJpbWl0aXZlVHlwZUNoZWNrZXJgLgoKCiAgICAgICAgICBmdW5jdGlvbiBnZXRQcmVjaXNlVHlwZShwcm9wVmFsdWUpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBwcm9wVmFsdWUgPT09ICd1bmRlZmluZWQnIHx8IHByb3BWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiAnJyArIHByb3BWYWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHByb3BUeXBlID0gZ2V0UHJvcFR5cGUocHJvcFZhbHVlKTsKCiAgICAgICAgICAgIGlmIChwcm9wVHlwZSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICBpZiAocHJvcFZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICdkYXRlJzsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByb3BWYWx1ZSBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgICAgICAgICAgICAgcmV0dXJuICdyZWdleHAnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHByb3BUeXBlOwogICAgICAgICAgfSAvLyBSZXR1cm5zIGEgc3RyaW5nIHRoYXQgaXMgcG9zdGZpeGVkIHRvIGEgd2FybmluZyBhYm91dCBhbiBpbnZhbGlkIHR5cGUuCiAgICAgICAgICAvLyBGb3IgZXhhbXBsZSwgInVuZGVmaW5lZCIgb3IgIm9mIHR5cGUgYXJyYXkiCgoKICAgICAgICAgIGZ1bmN0aW9uIGdldFBvc3RmaXhGb3JUeXBlV2FybmluZyh2YWx1ZSkgewogICAgICAgICAgICB2YXIgdHlwZSA9IGdldFByZWNpc2VUeXBlKHZhbHVlKTsKCiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgIGNhc2UgJ2FycmF5JzoKICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgICAgICAgcmV0dXJuICdhbiAnICsgdHlwZTsKCiAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6CiAgICAgICAgICAgICAgY2FzZSAnZGF0ZSc6CiAgICAgICAgICAgICAgY2FzZSAncmVnZXhwJzoKICAgICAgICAgICAgICAgIHJldHVybiAnYSAnICsgdHlwZTsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJldHVybnMgY2xhc3MgbmFtZSBvZiB0aGUgb2JqZWN0LCBpZiBhbnkuCgoKICAgICAgICAgIGZ1bmN0aW9uIGdldENsYXNzTmFtZShwcm9wVmFsdWUpIHsKICAgICAgICAgICAgaWYgKCFwcm9wVmFsdWUuY29uc3RydWN0b3IgfHwgIXByb3BWYWx1ZS5jb25zdHJ1Y3Rvci5uYW1lKSB7CiAgICAgICAgICAgICAgcmV0dXJuIEFOT05ZTU9VUzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHByb3BWYWx1ZS5jb25zdHJ1Y3Rvci5uYW1lOwogICAgICAgICAgfQoKICAgICAgICAgIFJlYWN0UHJvcFR5cGVzLmNoZWNrUHJvcFR5cGVzID0gY2hlY2tQcm9wVHlwZXM7CiAgICAgICAgICBSZWFjdFByb3BUeXBlcy5yZXNldFdhcm5pbmdDYWNoZSA9IGNoZWNrUHJvcFR5cGVzLnJlc2V0V2FybmluZ0NhY2hlOwogICAgICAgICAgUmVhY3RQcm9wVHlwZXMuUHJvcFR5cGVzID0gUmVhY3RQcm9wVHlwZXM7CiAgICAgICAgICByZXR1cm4gUmVhY3RQcm9wVHlwZXM7CiAgICAgICAgfTsKICAgICAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8KCiAgICAgIH0pLmNhbGwoZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyg5KSk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogOTAgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIC8qCiAgICAgIG9iamVjdC1hc3NpZ24KICAgICAgKGMpIFNpbmRyZSBTb3JodXMKICAgICAgQGxpY2Vuc2UgTUlUCiAgICAgICovCgogICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqLwoKICAgICAgdmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CiAgICAgIHZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CiAgICAgIHZhciBwcm9wSXNFbnVtZXJhYmxlID0gT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTsKCiAgICAgIGZ1bmN0aW9uIHRvT2JqZWN0KHZhbCkgewogICAgICAgIGlmICh2YWwgPT09IG51bGwgfHwgdmFsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdC5hc3NpZ24gY2Fubm90IGJlIGNhbGxlZCB3aXRoIG51bGwgb3IgdW5kZWZpbmVkJyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gT2JqZWN0KHZhbCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNob3VsZFVzZU5hdGl2ZSgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKCFPYmplY3QuYXNzaWduKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0gLy8gRGV0ZWN0IGJ1Z2d5IHByb3BlcnR5IGVudW1lcmF0aW9uIG9yZGVyIGluIG9sZGVyIFY4IHZlcnNpb25zLgogICAgICAgICAgLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9NDExOAoKCiAgICAgICAgICB2YXIgdGVzdDEgPSBuZXcgU3RyaW5nKCdhYmMnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXctd3JhcHBlcnMKCiAgICAgICAgICB0ZXN0MVs1XSA9ICdkZSc7CgogICAgICAgICAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRlc3QxKVswXSA9PT0gJzUnKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0gLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzA1NgoKCiAgICAgICAgICB2YXIgdGVzdDIgPSB7fTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAgdGVzdDJbJ18nICsgU3RyaW5nLmZyb21DaGFyQ29kZShpKV0gPSBpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvcmRlcjIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0ZXN0MikubWFwKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHJldHVybiB0ZXN0MltuXTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChvcmRlcjIuam9pbignJykgIT09ICcwMTIzNDU2Nzg5JykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9IC8vIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTMwNTYKCgogICAgICAgICAgdmFyIHRlc3QzID0ge307CiAgICAgICAgICAnYWJjZGVmZ2hpamtsbW5vcHFyc3QnLnNwbGl0KCcnKS5mb3JFYWNoKGZ1bmN0aW9uIChsZXR0ZXIpIHsKICAgICAgICAgICAgdGVzdDNbbGV0dGVyXSA9IGxldHRlcjsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhPYmplY3QuYXNzaWduKHt9LCB0ZXN0MykpLmpvaW4oJycpICE9PSAnYWJjZGVmZ2hpamtsbW5vcHFyc3QnKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIC8vIFdlIGRvbid0IGV4cGVjdCBhbnkgb2YgdGhlIGFib3ZlIHRvIHRocm93LCBidXQgYmV0dGVyIHRvIGJlIHNhZmUuCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IHNob3VsZFVzZU5hdGl2ZSgpID8gT2JqZWN0LmFzc2lnbiA6IGZ1bmN0aW9uICh0YXJnZXQsIHNvdXJjZSkgewogICAgICAgIHZhciBmcm9tOwogICAgICAgIHZhciB0byA9IHRvT2JqZWN0KHRhcmdldCk7CiAgICAgICAgdmFyIHN5bWJvbHM7CgogICAgICAgIGZvciAodmFyIHMgPSAxOyBzIDwgYXJndW1lbnRzLmxlbmd0aDsgcysrKSB7CiAgICAgICAgICBmcm9tID0gT2JqZWN0KGFyZ3VtZW50c1tzXSk7CgogICAgICAgICAgZm9yICh2YXIga2V5IGluIGZyb20pIHsKICAgICAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwoZnJvbSwga2V5KSkgewogICAgICAgICAgICAgIHRvW2tleV0gPSBmcm9tW2tleV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICAgICAgICAgIHN5bWJvbHMgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZnJvbSk7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN5bWJvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAocHJvcElzRW51bWVyYWJsZS5jYWxsKGZyb20sIHN5bWJvbHNbaV0pKSB7CiAgICAgICAgICAgICAgICB0b1tzeW1ib2xzW2ldXSA9IGZyb21bc3ltYm9sc1tpXV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG87CiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogOTEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLwoKICAgICAgKGZ1bmN0aW9uIChwcm9jZXNzKSB7CiAgICAgICAgLyoqCiAgICAgICAgKiBDb3B5cmlnaHQgKGMpIDIwMTMtcHJlc2VudCwgRmFjZWJvb2ssIEluYy4KICAgICAgICAqCiAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAqLwogICAgICAgIHZhciBwcmludFdhcm5pbmcgPSBmdW5jdGlvbiBwcmludFdhcm5pbmcoKSB7fTsKCiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgIHZhciBSZWFjdFByb3BUeXBlc1NlY3JldCA9IF9fd2VicGFja19yZXF1aXJlX18oMzMpOwoKICAgICAgICAgIHZhciBsb2dnZWRUeXBlRmFpbHVyZXMgPSB7fTsKICAgICAgICAgIHZhciBoYXMgPSBGdW5jdGlvbi5jYWxsLmJpbmQoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSk7CgogICAgICAgICAgcHJpbnRXYXJuaW5nID0gZnVuY3Rpb24gcHJpbnRXYXJuaW5nKHRleHQpIHsKICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAnV2FybmluZzogJyArIHRleHQ7CgogICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAvLyAtLS0gV2VsY29tZSB0byBkZWJ1Z2dpbmcgUmVhY3QgLS0tCiAgICAgICAgICAgICAgLy8gVGhpcyBlcnJvciB3YXMgdGhyb3duIGFzIGEgY29udmVuaWVuY2Ugc28gdGhhdCB5b3UgY2FuIHVzZSB0aGlzIHN0YWNrCiAgICAgICAgICAgICAgLy8gdG8gZmluZCB0aGUgY2FsbHNpdGUgdGhhdCBjYXVzZWQgdGhpcyB3YXJuaW5nIHRvIGZpcmUuCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOwogICAgICAgICAgICB9IGNhdGNoICh4KSB7fQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQXNzZXJ0IHRoYXQgdGhlIHZhbHVlcyBtYXRjaCB3aXRoIHRoZSB0eXBlIHNwZWNzLgogICAgICAgICAqIEVycm9yIG1lc3NhZ2VzIGFyZSBtZW1vcml6ZWQgYW5kIHdpbGwgb25seSBiZSBzaG93biBvbmNlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IHR5cGVTcGVjcyBNYXAgb2YgbmFtZSB0byBhIFJlYWN0UHJvcFR5cGUKICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gdmFsdWVzIFJ1bnRpbWUgdmFsdWVzIHRoYXQgbmVlZCB0byBiZSB0eXBlLWNoZWNrZWQKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbG9jYXRpb24gZS5nLiAicHJvcCIsICJjb250ZXh0IiwgImNoaWxkIGNvbnRleHQiCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGNvbXBvbmVudE5hbWUgTmFtZSBvZiB0aGUgY29tcG9uZW50IGZvciBlcnJvciBtZXNzYWdlcy4KICAgICAgICAgKiBAcGFyYW0gez9GdW5jdGlvbn0gZ2V0U3RhY2sgUmV0dXJucyB0aGUgY29tcG9uZW50IHN0YWNrLgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCgoKICAgICAgICBmdW5jdGlvbiBjaGVja1Byb3BUeXBlcyh0eXBlU3BlY3MsIHZhbHVlcywgbG9jYXRpb24sIGNvbXBvbmVudE5hbWUsIGdldFN0YWNrKSB7CiAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICBmb3IgKHZhciB0eXBlU3BlY05hbWUgaW4gdHlwZVNwZWNzKSB7CiAgICAgICAgICAgICAgaWYgKGhhcyh0eXBlU3BlY3MsIHR5cGVTcGVjTmFtZSkpIHsKICAgICAgICAgICAgICAgIHZhciBlcnJvcjsgLy8gUHJvcCB0eXBlIHZhbGlkYXRpb24gbWF5IHRocm93LiBJbiBjYXNlIHRoZXkgZG8sIHdlIGRvbid0IHdhbnQgdG8KICAgICAgICAgICAgICAgIC8vIGZhaWwgdGhlIHJlbmRlciBwaGFzZSB3aGVyZSBpdCBkaWRuJ3QgZmFpbCBiZWZvcmUuIFNvIHdlIGxvZyBpdC4KICAgICAgICAgICAgICAgIC8vIEFmdGVyIHRoZXNlIGhhdmUgYmVlbiBjbGVhbmVkIHVwLCB3ZSdsbCBsZXQgdGhlbSB0aHJvdy4KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGludGVudGlvbmFsbHkgYW4gaW52YXJpYW50IHRoYXQgZ2V0cyBjYXVnaHQuIEl0J3MgdGhlIHNhbWUKICAgICAgICAgICAgICAgICAgLy8gYmVoYXZpb3IgYXMgd2l0aG91dCB0aGlzIHN0YXRlbWVudCBleGNlcHQgd2l0aCBhIGJldHRlciBtZXNzYWdlLgogICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHR5cGVTcGVjc1t0eXBlU3BlY05hbWVdICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVyciA9IEVycm9yKChjb21wb25lbnROYW1lIHx8ICdSZWFjdCBjbGFzcycpICsgJzogJyArIGxvY2F0aW9uICsgJyB0eXBlIGAnICsgdHlwZVNwZWNOYW1lICsgJ2AgaXMgaW52YWxpZDsgJyArICdpdCBtdXN0IGJlIGEgZnVuY3Rpb24sIHVzdWFsbHkgZnJvbSB0aGUgYHByb3AtdHlwZXNgIHBhY2thZ2UsIGJ1dCByZWNlaXZlZCBgJyArIF90eXBlb2Y0KHR5cGVTcGVjc1t0eXBlU3BlY05hbWVdKSArICdgLicpOwogICAgICAgICAgICAgICAgICAgIGVyci5uYW1lID0gJ0ludmFyaWFudCBWaW9sYXRpb24nOwogICAgICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0eXBlU3BlY3NbdHlwZVNwZWNOYW1lXSh2YWx1ZXMsIHR5cGVTcGVjTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIG51bGwsIFJlYWN0UHJvcFR5cGVzU2VjcmV0KTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgICAgICAgIGVycm9yID0gZXg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGVycm9yICYmICEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikpIHsKICAgICAgICAgICAgICAgICAgcHJpbnRXYXJuaW5nKChjb21wb25lbnROYW1lIHx8ICdSZWFjdCBjbGFzcycpICsgJzogdHlwZSBzcGVjaWZpY2F0aW9uIG9mICcgKyBsb2NhdGlvbiArICcgYCcgKyB0eXBlU3BlY05hbWUgKyAnYCBpcyBpbnZhbGlkOyB0aGUgdHlwZSBjaGVja2VyICcgKyAnZnVuY3Rpb24gbXVzdCByZXR1cm4gYG51bGxgIG9yIGFuIGBFcnJvcmAgYnV0IHJldHVybmVkIGEgJyArIF90eXBlb2Y0KGVycm9yKSArICcuICcgKyAnWW91IG1heSBoYXZlIGZvcmdvdHRlbiB0byBwYXNzIGFuIGFyZ3VtZW50IHRvIHRoZSB0eXBlIGNoZWNrZXIgJyArICdjcmVhdG9yIChhcnJheU9mLCBpbnN0YW5jZU9mLCBvYmplY3RPZiwgb25lT2YsIG9uZU9mVHlwZSwgYW5kICcgKyAnc2hhcGUgYWxsIHJlcXVpcmUgYW4gYXJndW1lbnQpLicpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yICYmICEoZXJyb3IubWVzc2FnZSBpbiBsb2dnZWRUeXBlRmFpbHVyZXMpKSB7CiAgICAgICAgICAgICAgICAgIC8vIE9ubHkgbW9uaXRvciB0aGlzIGZhaWx1cmUgb25jZSBiZWNhdXNlIHRoZXJlIHRlbmRzIHRvIGJlIGEgbG90IG9mIHRoZQogICAgICAgICAgICAgICAgICAvLyBzYW1lIGVycm9yLgogICAgICAgICAgICAgICAgICBsb2dnZWRUeXBlRmFpbHVyZXNbZXJyb3IubWVzc2FnZV0gPSB0cnVlOwogICAgICAgICAgICAgICAgICB2YXIgc3RhY2sgPSBnZXRTdGFjayA/IGdldFN0YWNrKCkgOiAnJzsKICAgICAgICAgICAgICAgICAgcHJpbnRXYXJuaW5nKCdGYWlsZWQgJyArIGxvY2F0aW9uICsgJyB0eXBlOiAnICsgZXJyb3IubWVzc2FnZSArIChzdGFjayAhPSBudWxsID8gc3RhY2sgOiAnJykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXNldHMgd2FybmluZyBjYWNoZSB3aGVuIHRlc3RpbmcuCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwoKCiAgICAgICAgY2hlY2tQcm9wVHlwZXMucmVzZXRXYXJuaW5nQ2FjaGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICBsb2dnZWRUeXBlRmFpbHVyZXMgPSB7fTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGNoZWNrUHJvcFR5cGVzOwogICAgICAgIC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLwogICAgICB9KS5jYWxsKGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18oOSkpOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDkyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICAvKioKICAgICAgICogQ29weXJpZ2h0IChjKSAyMDEzLXByZXNlbnQsIEZhY2Vib29rLCBJbmMuCiAgICAgICAqCiAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAqLwoKICAgICAgdmFyIFJlYWN0UHJvcFR5cGVzU2VjcmV0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMyk7CgogICAgICBmdW5jdGlvbiBlbXB0eUZ1bmN0aW9uKCkge30KCiAgICAgIGZ1bmN0aW9uIGVtcHR5RnVuY3Rpb25XaXRoUmVzZXQoKSB7fQoKICAgICAgZW1wdHlGdW5jdGlvbldpdGhSZXNldC5yZXNldFdhcm5pbmdDYWNoZSA9IGVtcHR5RnVuY3Rpb247CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBzaGltKHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIHByb3BGdWxsTmFtZSwgc2VjcmV0KSB7CiAgICAgICAgICBpZiAoc2VjcmV0ID09PSBSZWFjdFByb3BUeXBlc1NlY3JldCkgewogICAgICAgICAgICAvLyBJdCBpcyBzdGlsbCBzYWZlIHdoZW4gY2FsbGVkIGZyb20gUmVhY3QuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZXJyID0gbmV3IEVycm9yKCdDYWxsaW5nIFByb3BUeXBlcyB2YWxpZGF0b3JzIGRpcmVjdGx5IGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIGBwcm9wLXR5cGVzYCBwYWNrYWdlLiAnICsgJ1VzZSBQcm9wVHlwZXMuY2hlY2tQcm9wVHlwZXMoKSB0byBjYWxsIHRoZW0uICcgKyAnUmVhZCBtb3JlIGF0IGh0dHA6Ly9mYi5tZS91c2UtY2hlY2stcHJvcC10eXBlcycpOwogICAgICAgICAgZXJyLm5hbWUgPSAnSW52YXJpYW50IFZpb2xhdGlvbic7CiAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgfQoKICAgICAgICA7CiAgICAgICAgc2hpbS5pc1JlcXVpcmVkID0gc2hpbTsKCiAgICAgICAgZnVuY3Rpb24gZ2V0U2hpbSgpIHsKICAgICAgICAgIHJldHVybiBzaGltOwogICAgICAgIH0KCiAgICAgICAgOyAvLyBJbXBvcnRhbnQhCiAgICAgICAgLy8gS2VlcCB0aGlzIGxpc3QgaW4gc3luYyB3aXRoIHByb2R1Y3Rpb24gdmVyc2lvbiBpbiBgLi9mYWN0b3J5V2l0aFR5cGVDaGVja2Vycy5qc2AuCgogICAgICAgIHZhciBSZWFjdFByb3BUeXBlcyA9IHsKICAgICAgICAgIGFycmF5OiBzaGltLAogICAgICAgICAgYm9vbDogc2hpbSwKICAgICAgICAgIGZ1bmM6IHNoaW0sCiAgICAgICAgICBudW1iZXI6IHNoaW0sCiAgICAgICAgICBvYmplY3Q6IHNoaW0sCiAgICAgICAgICBzdHJpbmc6IHNoaW0sCiAgICAgICAgICBzeW1ib2w6IHNoaW0sCiAgICAgICAgICBhbnk6IHNoaW0sCiAgICAgICAgICBhcnJheU9mOiBnZXRTaGltLAogICAgICAgICAgZWxlbWVudDogc2hpbSwKICAgICAgICAgIGVsZW1lbnRUeXBlOiBzaGltLAogICAgICAgICAgaW5zdGFuY2VPZjogZ2V0U2hpbSwKICAgICAgICAgIG5vZGU6IHNoaW0sCiAgICAgICAgICBvYmplY3RPZjogZ2V0U2hpbSwKICAgICAgICAgIG9uZU9mOiBnZXRTaGltLAogICAgICAgICAgb25lT2ZUeXBlOiBnZXRTaGltLAogICAgICAgICAgc2hhcGU6IGdldFNoaW0sCiAgICAgICAgICBleGFjdDogZ2V0U2hpbSwKICAgICAgICAgIGNoZWNrUHJvcFR5cGVzOiBlbXB0eUZ1bmN0aW9uV2l0aFJlc2V0LAogICAgICAgICAgcmVzZXRXYXJuaW5nQ2FjaGU6IGVtcHR5RnVuY3Rpb24KICAgICAgICB9OwogICAgICAgIFJlYWN0UHJvcFR5cGVzLlByb3BUeXBlcyA9IFJlYWN0UHJvcFR5cGVzOwogICAgICAgIHJldHVybiBSZWFjdFByb3BUeXBlczsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogOTMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAhZnVuY3Rpb24gKCkgewogICAgICAgICd1c2Ugc3RyaWN0JzsKCiAgICAgICAgZnVuY3Rpb24gVk5vZGUoKSB7fQoKICAgICAgICBmdW5jdGlvbiBoKG5vZGVOYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICAgICAgICB2YXIgbGFzdFNpbXBsZSwKICAgICAgICAgICAgICBjaGlsZCwKICAgICAgICAgICAgICBzaW1wbGUsCiAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICBjaGlsZHJlbiA9IEVNUFRZX0NISUxEUkVOOwoKICAgICAgICAgIGZvciAoaSA9IGFyZ3VtZW50cy5sZW5ndGg7IGktLSA+IDI7KSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goYXJndW1lbnRzW2ldKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoYXR0cmlidXRlcyAmJiBudWxsICE9IGF0dHJpYnV0ZXMuY2hpbGRyZW4pIHsKICAgICAgICAgICAgaWYgKCFzdGFjay5sZW5ndGgpIHN0YWNrLnB1c2goYXR0cmlidXRlcy5jaGlsZHJlbik7CiAgICAgICAgICAgIGRlbGV0ZSBhdHRyaWJ1dGVzLmNoaWxkcmVuOwogICAgICAgICAgfQoKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGgpIHsKICAgICAgICAgICAgaWYgKChjaGlsZCA9IHN0YWNrLnBvcCgpKSAmJiB2b2lkIDAgIT09IGNoaWxkLnBvcCkgZm9yIChpID0gY2hpbGQubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgc3RhY2sucHVzaChjaGlsZFtpXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKGNoaWxkID09PSAhMCB8fCBjaGlsZCA9PT0gITEpIGNoaWxkID0gbnVsbDsKICAgICAgICAgICAgICBpZiAoc2ltcGxlID0gJ2Z1bmN0aW9uJyAhPSB0eXBlb2Ygbm9kZU5hbWUpIGlmIChudWxsID09IGNoaWxkKSBjaGlsZCA9ICcnO2Vsc2UgaWYgKCdudW1iZXInID09IHR5cGVvZiBjaGlsZCkgY2hpbGQgPSBTdHJpbmcoY2hpbGQpO2Vsc2UgaWYgKCdzdHJpbmcnICE9IHR5cGVvZiBjaGlsZCkgc2ltcGxlID0gITE7CiAgICAgICAgICAgICAgaWYgKHNpbXBsZSAmJiBsYXN0U2ltcGxlKSBjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGggLSAxXSArPSBjaGlsZDtlbHNlIGlmIChjaGlsZHJlbiA9PT0gRU1QVFlfQ0hJTERSRU4pIGNoaWxkcmVuID0gW2NoaWxkXTtlbHNlIGNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgICAgICAgICAgIGxhc3RTaW1wbGUgPSBzaW1wbGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcCA9IG5ldyBWTm9kZSgpOwogICAgICAgICAgcC5ub2RlTmFtZSA9IG5vZGVOYW1lOwogICAgICAgICAgcC5jaGlsZHJlbiA9IGNoaWxkcmVuOwogICAgICAgICAgcC5hdHRyaWJ1dGVzID0gbnVsbCA9PSBhdHRyaWJ1dGVzID8gdm9pZCAwIDogYXR0cmlidXRlczsKICAgICAgICAgIHAua2V5ID0gbnVsbCA9PSBhdHRyaWJ1dGVzID8gdm9pZCAwIDogYXR0cmlidXRlcy5rZXk7CiAgICAgICAgICBpZiAodm9pZCAwICE9PSBvcHRpb25zLnZub2RlKSBvcHRpb25zLnZub2RlKHApOwogICAgICAgICAgcmV0dXJuIHA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleHRlbmQob2JqLCBwcm9wcykgewogICAgICAgICAgZm9yICh2YXIgaSBpbiBwcm9wcykgewogICAgICAgICAgICBvYmpbaV0gPSBwcm9wc1tpXTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2xvbmVFbGVtZW50KHZub2RlLCBwcm9wcykgewogICAgICAgICAgcmV0dXJuIGgodm5vZGUubm9kZU5hbWUsIGV4dGVuZChleHRlbmQoe30sIHZub2RlLmF0dHJpYnV0ZXMpLCBwcm9wcyksIGFyZ3VtZW50cy5sZW5ndGggPiAyID8gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpIDogdm5vZGUuY2hpbGRyZW4pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZW5xdWV1ZVJlbmRlcihjb21wb25lbnQpIHsKICAgICAgICAgIGlmICghY29tcG9uZW50Ll9fZCAmJiAoY29tcG9uZW50Ll9fZCA9ICEwKSAmJiAxID09IGl0ZW1zLnB1c2goY29tcG9uZW50KSkgKG9wdGlvbnMuZGVib3VuY2VSZW5kZXJpbmcgfHwgc2V0VGltZW91dCkocmVyZW5kZXIpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVyZW5kZXIoKSB7CiAgICAgICAgICB2YXIgcCwKICAgICAgICAgICAgICBsaXN0ID0gaXRlbXM7CiAgICAgICAgICBpdGVtcyA9IFtdOwoKICAgICAgICAgIHdoaWxlIChwID0gbGlzdC5wb3AoKSkgewogICAgICAgICAgICBpZiAocC5fX2QpIHJlbmRlckNvbXBvbmVudChwKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGlzU2FtZU5vZGVUeXBlKG5vZGUsIHZub2RlLCBoeWRyYXRpbmcpIHsKICAgICAgICAgIGlmICgnc3RyaW5nJyA9PSB0eXBlb2Ygdm5vZGUgfHwgJ251bWJlcicgPT0gdHlwZW9mIHZub2RlKSByZXR1cm4gdm9pZCAwICE9PSBub2RlLnNwbGl0VGV4dDsKICAgICAgICAgIGlmICgnc3RyaW5nJyA9PSB0eXBlb2Ygdm5vZGUubm9kZU5hbWUpIHJldHVybiAhbm9kZS5fY29tcG9uZW50Q29uc3RydWN0b3IgJiYgaXNOYW1lZE5vZGUobm9kZSwgdm5vZGUubm9kZU5hbWUpO2Vsc2UgcmV0dXJuIGh5ZHJhdGluZyB8fCBub2RlLl9jb21wb25lbnRDb25zdHJ1Y3RvciA9PT0gdm5vZGUubm9kZU5hbWU7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBpc05hbWVkTm9kZShub2RlLCBub2RlTmFtZSkgewogICAgICAgICAgcmV0dXJuIG5vZGUuX19uID09PSBub2RlTmFtZSB8fCBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXROb2RlUHJvcHModm5vZGUpIHsKICAgICAgICAgIHZhciBwcm9wcyA9IGV4dGVuZCh7fSwgdm5vZGUuYXR0cmlidXRlcyk7CiAgICAgICAgICBwcm9wcy5jaGlsZHJlbiA9IHZub2RlLmNoaWxkcmVuOwogICAgICAgICAgdmFyIGRlZmF1bHRQcm9wcyA9IHZub2RlLm5vZGVOYW1lLmRlZmF1bHRQcm9wczsKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGRlZmF1bHRQcm9wcykgZm9yICh2YXIgaSBpbiBkZWZhdWx0UHJvcHMpIHsKICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gcHJvcHNbaV0pIHByb3BzW2ldID0gZGVmYXVsdFByb3BzW2ldOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHByb3BzOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlTm9kZShub2RlTmFtZSwgaXNTdmcpIHsKICAgICAgICAgIHZhciBub2RlID0gaXNTdmcgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgbm9kZU5hbWUpIDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudChub2RlTmFtZSk7CiAgICAgICAgICBub2RlLl9fbiA9IG5vZGVOYW1lOwogICAgICAgICAgcmV0dXJuIG5vZGU7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZW1vdmVOb2RlKG5vZGUpIHsKICAgICAgICAgIGlmIChub2RlLnBhcmVudE5vZGUpIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNldEFjY2Vzc29yKG5vZGUsIG5hbWUsIG9sZCwgdmFsdWUsIGlzU3ZnKSB7CiAgICAgICAgICBpZiAoJ2NsYXNzTmFtZScgPT09IG5hbWUpIG5hbWUgPSAnY2xhc3MnOwogICAgICAgICAgaWYgKCdrZXknID09PSBuYW1lKSA7ZWxzZSBpZiAoJ3JlZicgPT09IG5hbWUpIHsKICAgICAgICAgICAgaWYgKG9sZCkgb2xkKG51bGwpOwogICAgICAgICAgICBpZiAodmFsdWUpIHZhbHVlKG5vZGUpOwogICAgICAgICAgfSBlbHNlIGlmICgnY2xhc3MnID09PSBuYW1lICYmICFpc1N2Zykgbm9kZS5jbGFzc05hbWUgPSB2YWx1ZSB8fCAnJztlbHNlIGlmICgnc3R5bGUnID09PSBuYW1lKSB7CiAgICAgICAgICAgIGlmICghdmFsdWUgfHwgJ3N0cmluZycgPT0gdHlwZW9mIHZhbHVlIHx8ICdzdHJpbmcnID09IHR5cGVvZiBvbGQpIG5vZGUuc3R5bGUuY3NzVGV4dCA9IHZhbHVlIHx8ICcnOwoKICAgICAgICAgICAgaWYgKHZhbHVlICYmICdvYmplY3QnID09IF90eXBlb2Y0KHZhbHVlKSkgewogICAgICAgICAgICAgIGlmICgnc3RyaW5nJyAhPSB0eXBlb2Ygb2xkKSBmb3IgKHZhciBpIGluIG9sZCkgewogICAgICAgICAgICAgICAgaWYgKCEoaSBpbiB2YWx1ZSkpIG5vZGUuc3R5bGVbaV0gPSAnJzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdmFsdWUpIHsKICAgICAgICAgICAgICAgIG5vZGUuc3R5bGVbaV0gPSAnbnVtYmVyJyA9PSB0eXBlb2YgdmFsdWVbaV0gJiYgSVNfTk9OX0RJTUVOU0lPTkFMLnRlc3QoaSkgPT09ICExID8gdmFsdWVbaV0gKyAncHgnIDogdmFsdWVbaV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKCdkYW5nZXJvdXNseVNldElubmVySFRNTCcgPT09IG5hbWUpIHsKICAgICAgICAgICAgaWYgKHZhbHVlKSBub2RlLmlubmVySFRNTCA9IHZhbHVlLl9faHRtbCB8fCAnJzsKICAgICAgICAgIH0gZWxzZSBpZiAoJ28nID09IG5hbWVbMF0gJiYgJ24nID09IG5hbWVbMV0pIHsKICAgICAgICAgICAgdmFyIHVzZUNhcHR1cmUgPSBuYW1lICE9PSAobmFtZSA9IG5hbWUucmVwbGFjZSgvQ2FwdHVyZSQvLCAnJykpOwogICAgICAgICAgICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpLnN1YnN0cmluZygyKTsKCiAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgIGlmICghb2xkKSBub2RlLmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgZXZlbnRQcm94eSwgdXNlQ2FwdHVyZSk7CiAgICAgICAgICAgIH0gZWxzZSBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIobmFtZSwgZXZlbnRQcm94eSwgdXNlQ2FwdHVyZSk7CgogICAgICAgICAgICAobm9kZS5fX2wgfHwgKG5vZGUuX19sID0ge30pKVtuYW1lXSA9IHZhbHVlOwogICAgICAgICAgfSBlbHNlIGlmICgnbGlzdCcgIT09IG5hbWUgJiYgJ3R5cGUnICE9PSBuYW1lICYmICFpc1N2ZyAmJiBuYW1lIGluIG5vZGUpIHsKICAgICAgICAgICAgc2V0UHJvcGVydHkobm9kZSwgbmFtZSwgbnVsbCA9PSB2YWx1ZSA/ICcnIDogdmFsdWUpOwogICAgICAgICAgICBpZiAobnVsbCA9PSB2YWx1ZSB8fCB2YWx1ZSA9PT0gITEpIG5vZGUucmVtb3ZlQXR0cmlidXRlKG5hbWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG5zID0gaXNTdmcgJiYgbmFtZSAhPT0gKG5hbWUgPSBuYW1lLnJlcGxhY2UoL154bGlua1w6Py8sICcnKSk7CiAgICAgICAgICAgIGlmIChudWxsID09IHZhbHVlIHx8IHZhbHVlID09PSAhMSkgewogICAgICAgICAgICAgIGlmIChucykgbm9kZS5yZW1vdmVBdHRyaWJ1dGVOUygnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycsIG5hbWUudG9Mb3dlckNhc2UoKSk7ZWxzZSBub2RlLnJlbW92ZUF0dHJpYnV0ZShuYW1lKTsKICAgICAgICAgICAgfSBlbHNlIGlmICgnZnVuY3Rpb24nICE9IHR5cGVvZiB2YWx1ZSkgaWYgKG5zKSBub2RlLnNldEF0dHJpYnV0ZU5TKCdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJywgbmFtZS50b0xvd2VyQ2FzZSgpLCB2YWx1ZSk7ZWxzZSBub2RlLnNldEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXRQcm9wZXJ0eShub2RlLCBuYW1lLCB2YWx1ZSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbm9kZVtuYW1lXSA9IHZhbHVlOwogICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGV2ZW50UHJveHkoZSkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX19sW2UudHlwZV0ob3B0aW9ucy5ldmVudCAmJiBvcHRpb25zLmV2ZW50KGUpIHx8IGUpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZmx1c2hNb3VudHMoKSB7CiAgICAgICAgICB2YXIgYzsKCiAgICAgICAgICB3aGlsZSAoYyA9IG1vdW50cy5wb3AoKSkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5hZnRlck1vdW50KSBvcHRpb25zLmFmdGVyTW91bnQoYyk7CiAgICAgICAgICAgIGlmIChjLmNvbXBvbmVudERpZE1vdW50KSBjLmNvbXBvbmVudERpZE1vdW50KCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkaWZmKGRvbSwgdm5vZGUsIGNvbnRleHQsIG1vdW50QWxsLCBwYXJlbnQsIGNvbXBvbmVudFJvb3QpIHsKICAgICAgICAgIGlmICghZGlmZkxldmVsKyspIHsKICAgICAgICAgICAgaXNTdmdNb2RlID0gbnVsbCAhPSBwYXJlbnQgJiYgdm9pZCAwICE9PSBwYXJlbnQub3duZXJTVkdFbGVtZW50OwogICAgICAgICAgICBoeWRyYXRpbmcgPSBudWxsICE9IGRvbSAmJiAhKCdfX3ByZWFjdGF0dHJfJyBpbiBkb20pOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciByZXQgPSBpZGlmZihkb20sIHZub2RlLCBjb250ZXh0LCBtb3VudEFsbCwgY29tcG9uZW50Um9vdCk7CiAgICAgICAgICBpZiAocGFyZW50ICYmIHJldC5wYXJlbnROb2RlICE9PSBwYXJlbnQpIHBhcmVudC5hcHBlbmRDaGlsZChyZXQpOwoKICAgICAgICAgIGlmICghIC0tZGlmZkxldmVsKSB7CiAgICAgICAgICAgIGh5ZHJhdGluZyA9ICExOwogICAgICAgICAgICBpZiAoIWNvbXBvbmVudFJvb3QpIGZsdXNoTW91bnRzKCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGlkaWZmKGRvbSwgdm5vZGUsIGNvbnRleHQsIG1vdW50QWxsLCBjb21wb25lbnRSb290KSB7CiAgICAgICAgICB2YXIgb3V0ID0gZG9tLAogICAgICAgICAgICAgIHByZXZTdmdNb2RlID0gaXNTdmdNb2RlOwogICAgICAgICAgaWYgKG51bGwgPT0gdm5vZGUpIHZub2RlID0gJyc7CgogICAgICAgICAgaWYgKCdzdHJpbmcnID09IHR5cGVvZiB2bm9kZSkgewogICAgICAgICAgICBpZiAoZG9tICYmIHZvaWQgMCAhPT0gZG9tLnNwbGl0VGV4dCAmJiBkb20ucGFyZW50Tm9kZSAmJiAoIWRvbS5fY29tcG9uZW50IHx8IGNvbXBvbmVudFJvb3QpKSB7CiAgICAgICAgICAgICAgaWYgKGRvbS5ub2RlVmFsdWUgIT0gdm5vZGUpIGRvbS5ub2RlVmFsdWUgPSB2bm9kZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBvdXQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2bm9kZSk7CgogICAgICAgICAgICAgIGlmIChkb20pIHsKICAgICAgICAgICAgICAgIGlmIChkb20ucGFyZW50Tm9kZSkgZG9tLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG91dCwgZG9tKTsKICAgICAgICAgICAgICAgIHJlY29sbGVjdE5vZGVUcmVlKGRvbSwgITApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3V0Ll9fcHJlYWN0YXR0cl8gPSAhMDsKICAgICAgICAgICAgcmV0dXJuIG91dDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoJ2Z1bmN0aW9uJyA9PSB0eXBlb2Ygdm5vZGUubm9kZU5hbWUpIHJldHVybiBidWlsZENvbXBvbmVudEZyb21WTm9kZShkb20sIHZub2RlLCBjb250ZXh0LCBtb3VudEFsbCk7CiAgICAgICAgICBpc1N2Z01vZGUgPSAnc3ZnJyA9PT0gdm5vZGUubm9kZU5hbWUgPyAhMCA6ICdmb3JlaWduT2JqZWN0JyA9PT0gdm5vZGUubm9kZU5hbWUgPyAhMSA6IGlzU3ZnTW9kZTsKCiAgICAgICAgICBpZiAoIWRvbSB8fCAhaXNOYW1lZE5vZGUoZG9tLCBTdHJpbmcodm5vZGUubm9kZU5hbWUpKSkgewogICAgICAgICAgICBvdXQgPSBjcmVhdGVOb2RlKFN0cmluZyh2bm9kZS5ub2RlTmFtZSksIGlzU3ZnTW9kZSk7CgogICAgICAgICAgICBpZiAoZG9tKSB7CiAgICAgICAgICAgICAgd2hpbGUgKGRvbS5maXJzdENoaWxkKSB7CiAgICAgICAgICAgICAgICBvdXQuYXBwZW5kQ2hpbGQoZG9tLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGRvbS5wYXJlbnROb2RlKSBkb20ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQob3V0LCBkb20pOwogICAgICAgICAgICAgIHJlY29sbGVjdE5vZGVUcmVlKGRvbSwgITApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGZjID0gb3V0LmZpcnN0Q2hpbGQsCiAgICAgICAgICAgICAgcHJvcHMgPSBvdXQuX19wcmVhY3RhdHRyXyB8fCAob3V0Ll9fcHJlYWN0YXR0cl8gPSB7fSksCiAgICAgICAgICAgICAgdmNoaWxkcmVuID0gdm5vZGUuY2hpbGRyZW47CgogICAgICAgICAgaWYgKCFoeWRyYXRpbmcgJiYgdmNoaWxkcmVuICYmIDEgPT09IHZjaGlsZHJlbi5sZW5ndGggJiYgJ3N0cmluZycgPT0gdHlwZW9mIHZjaGlsZHJlblswXSAmJiBudWxsICE9IGZjICYmIHZvaWQgMCAhPT0gZmMuc3BsaXRUZXh0ICYmIG51bGwgPT0gZmMubmV4dFNpYmxpbmcpIHsKICAgICAgICAgICAgaWYgKGZjLm5vZGVWYWx1ZSAhPSB2Y2hpbGRyZW5bMF0pIGZjLm5vZGVWYWx1ZSA9IHZjaGlsZHJlblswXTsKICAgICAgICAgIH0gZWxzZSBpZiAodmNoaWxkcmVuICYmIHZjaGlsZHJlbi5sZW5ndGggfHwgbnVsbCAhPSBmYykgaW5uZXJEaWZmTm9kZShvdXQsIHZjaGlsZHJlbiwgY29udGV4dCwgbW91bnRBbGwsIGh5ZHJhdGluZyB8fCBudWxsICE9IHByb3BzLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKTsKCiAgICAgICAgICBkaWZmQXR0cmlidXRlcyhvdXQsIHZub2RlLmF0dHJpYnV0ZXMsIHByb3BzKTsKICAgICAgICAgIGlzU3ZnTW9kZSA9IHByZXZTdmdNb2RlOwogICAgICAgICAgcmV0dXJuIG91dDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGlubmVyRGlmZk5vZGUoZG9tLCB2Y2hpbGRyZW4sIGNvbnRleHQsIG1vdW50QWxsLCBpc0h5ZHJhdGluZykgewogICAgICAgICAgdmFyIGosCiAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICB2Y2hpbGQsCiAgICAgICAgICAgICAgY2hpbGQsCiAgICAgICAgICAgICAgb3JpZ2luYWxDaGlsZHJlbiA9IGRvbS5jaGlsZE5vZGVzLAogICAgICAgICAgICAgIGNoaWxkcmVuID0gW10sCiAgICAgICAgICAgICAga2V5ZWQgPSB7fSwKICAgICAgICAgICAgICBrZXllZExlbiA9IDAsCiAgICAgICAgICAgICAgbWluID0gMCwKICAgICAgICAgICAgICBsZW4gPSBvcmlnaW5hbENoaWxkcmVuLmxlbmd0aCwKICAgICAgICAgICAgICBjaGlsZHJlbkxlbiA9IDAsCiAgICAgICAgICAgICAgdmxlbiA9IHZjaGlsZHJlbiA/IHZjaGlsZHJlbi5sZW5ndGggOiAwOwogICAgICAgICAgaWYgKDAgIT09IGxlbikgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICB2YXIgX2NoaWxkID0gb3JpZ2luYWxDaGlsZHJlbltpXSwKICAgICAgICAgICAgICAgIHByb3BzID0gX2NoaWxkLl9fcHJlYWN0YXR0cl8sCiAgICAgICAgICAgICAgICBrZXkgPSB2bGVuICYmIHByb3BzID8gX2NoaWxkLl9jb21wb25lbnQgPyBfY2hpbGQuX2NvbXBvbmVudC5fX2sgOiBwcm9wcy5rZXkgOiBudWxsOwoKICAgICAgICAgICAgaWYgKG51bGwgIT0ga2V5KSB7CiAgICAgICAgICAgICAga2V5ZWRMZW4rKzsKICAgICAgICAgICAgICBrZXllZFtrZXldID0gX2NoaWxkOwogICAgICAgICAgICB9IGVsc2UgaWYgKHByb3BzIHx8ICh2b2lkIDAgIT09IF9jaGlsZC5zcGxpdFRleHQgPyBpc0h5ZHJhdGluZyA/IF9jaGlsZC5ub2RlVmFsdWUudHJpbSgpIDogITAgOiBpc0h5ZHJhdGluZykpIGNoaWxkcmVuW2NoaWxkcmVuTGVuKytdID0gX2NoaWxkOwogICAgICAgICAgfQogICAgICAgICAgaWYgKDAgIT09IHZsZW4pIGZvciAodmFyIGkgPSAwOyBpIDwgdmxlbjsgaSsrKSB7CiAgICAgICAgICAgIHZjaGlsZCA9IHZjaGlsZHJlbltpXTsKICAgICAgICAgICAgY2hpbGQgPSBudWxsOwogICAgICAgICAgICB2YXIga2V5ID0gdmNoaWxkLmtleTsKCiAgICAgICAgICAgIGlmIChudWxsICE9IGtleSkgewogICAgICAgICAgICAgIGlmIChrZXllZExlbiAmJiB2b2lkIDAgIT09IGtleWVkW2tleV0pIHsKICAgICAgICAgICAgICAgIGNoaWxkID0ga2V5ZWRba2V5XTsKICAgICAgICAgICAgICAgIGtleWVkW2tleV0gPSB2b2lkIDA7CiAgICAgICAgICAgICAgICBrZXllZExlbi0tOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICghY2hpbGQgJiYgbWluIDwgY2hpbGRyZW5MZW4pIGZvciAoaiA9IG1pbjsgaiA8IGNoaWxkcmVuTGVuOyBqKyspIHsKICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBjaGlsZHJlbltqXSAmJiBpc1NhbWVOb2RlVHlwZShjID0gY2hpbGRyZW5bal0sIHZjaGlsZCwgaXNIeWRyYXRpbmcpKSB7CiAgICAgICAgICAgICAgICBjaGlsZCA9IGM7CiAgICAgICAgICAgICAgICBjaGlsZHJlbltqXSA9IHZvaWQgMDsKICAgICAgICAgICAgICAgIGlmIChqID09PSBjaGlsZHJlbkxlbiAtIDEpIGNoaWxkcmVuTGVuLS07CiAgICAgICAgICAgICAgICBpZiAoaiA9PT0gbWluKSBtaW4rKzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2hpbGQgPSBpZGlmZihjaGlsZCwgdmNoaWxkLCBjb250ZXh0LCBtb3VudEFsbCk7CiAgICAgICAgICAgIGlmIChjaGlsZCAmJiBjaGlsZCAhPT0gZG9tKSBpZiAoaSA+PSBsZW4pIGRvbS5hcHBlbmRDaGlsZChjaGlsZCk7ZWxzZSBpZiAoY2hpbGQgIT09IG9yaWdpbmFsQ2hpbGRyZW5baV0pIGlmIChjaGlsZCA9PT0gb3JpZ2luYWxDaGlsZHJlbltpICsgMV0pIHJlbW92ZU5vZGUob3JpZ2luYWxDaGlsZHJlbltpXSk7ZWxzZSBkb20uaW5zZXJ0QmVmb3JlKGNoaWxkLCBvcmlnaW5hbENoaWxkcmVuW2ldIHx8IG51bGwpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGtleWVkTGVuKSBmb3IgKHZhciBpIGluIGtleWVkKSB7CiAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IGtleWVkW2ldKSByZWNvbGxlY3ROb2RlVHJlZShrZXllZFtpXSwgITEpOwogICAgICAgICAgfQoKICAgICAgICAgIHdoaWxlIChtaW4gPD0gY2hpbGRyZW5MZW4pIHsKICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gKGNoaWxkID0gY2hpbGRyZW5bY2hpbGRyZW5MZW4tLV0pKSByZWNvbGxlY3ROb2RlVHJlZShjaGlsZCwgITEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVjb2xsZWN0Tm9kZVRyZWUobm9kZSwgdW5tb3VudE9ubHkpIHsKICAgICAgICAgIHZhciBjb21wb25lbnQgPSBub2RlLl9jb21wb25lbnQ7CiAgICAgICAgICBpZiAoY29tcG9uZW50KSB1bm1vdW50Q29tcG9uZW50KGNvbXBvbmVudCk7ZWxzZSB7CiAgICAgICAgICAgIGlmIChudWxsICE9IG5vZGUuX19wcmVhY3RhdHRyXyAmJiBub2RlLl9fcHJlYWN0YXR0cl8ucmVmKSBub2RlLl9fcHJlYWN0YXR0cl8ucmVmKG51bGwpOwogICAgICAgICAgICBpZiAodW5tb3VudE9ubHkgPT09ICExIHx8IG51bGwgPT0gbm9kZS5fX3ByZWFjdGF0dHJfKSByZW1vdmVOb2RlKG5vZGUpOwogICAgICAgICAgICByZW1vdmVDaGlsZHJlbihub2RlKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlbW92ZUNoaWxkcmVuKG5vZGUpIHsKICAgICAgICAgIG5vZGUgPSBub2RlLmxhc3RDaGlsZDsKCiAgICAgICAgICB3aGlsZSAobm9kZSkgewogICAgICAgICAgICB2YXIgbmV4dCA9IG5vZGUucHJldmlvdXNTaWJsaW5nOwogICAgICAgICAgICByZWNvbGxlY3ROb2RlVHJlZShub2RlLCAhMCk7CiAgICAgICAgICAgIG5vZGUgPSBuZXh0OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZGlmZkF0dHJpYnV0ZXMoZG9tLCBhdHRycywgb2xkKSB7CiAgICAgICAgICB2YXIgbmFtZTsKCiAgICAgICAgICBmb3IgKG5hbWUgaW4gb2xkKSB7CiAgICAgICAgICAgIGlmICgoIWF0dHJzIHx8IG51bGwgPT0gYXR0cnNbbmFtZV0pICYmIG51bGwgIT0gb2xkW25hbWVdKSBzZXRBY2Nlc3Nvcihkb20sIG5hbWUsIG9sZFtuYW1lXSwgb2xkW25hbWVdID0gdm9pZCAwLCBpc1N2Z01vZGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAobmFtZSBpbiBhdHRycykgewogICAgICAgICAgICBpZiAoISgnY2hpbGRyZW4nID09PSBuYW1lIHx8ICdpbm5lckhUTUwnID09PSBuYW1lIHx8IG5hbWUgaW4gb2xkICYmIGF0dHJzW25hbWVdID09PSAoJ3ZhbHVlJyA9PT0gbmFtZSB8fCAnY2hlY2tlZCcgPT09IG5hbWUgPyBkb21bbmFtZV0gOiBvbGRbbmFtZV0pKSkgc2V0QWNjZXNzb3IoZG9tLCBuYW1lLCBvbGRbbmFtZV0sIG9sZFtuYW1lXSA9IGF0dHJzW25hbWVdLCBpc1N2Z01vZGUpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY29sbGVjdENvbXBvbmVudChjb21wb25lbnQpIHsKICAgICAgICAgIHZhciBuYW1lID0gY29tcG9uZW50LmNvbnN0cnVjdG9yLm5hbWU7CiAgICAgICAgICAoY29tcG9uZW50c1tuYW1lXSB8fCAoY29tcG9uZW50c1tuYW1lXSA9IFtdKSkucHVzaChjb21wb25lbnQpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ29tcG9uZW50KEN0b3IsIHByb3BzLCBjb250ZXh0KSB7CiAgICAgICAgICB2YXIgaW5zdCwKICAgICAgICAgICAgICBsaXN0ID0gY29tcG9uZW50c1tDdG9yLm5hbWVdOwoKICAgICAgICAgIGlmIChDdG9yLnByb3RvdHlwZSAmJiBDdG9yLnByb3RvdHlwZS5yZW5kZXIpIHsKICAgICAgICAgICAgaW5zdCA9IG5ldyBDdG9yKHByb3BzLCBjb250ZXh0KTsKICAgICAgICAgICAgQ29tcG9uZW50LmNhbGwoaW5zdCwgcHJvcHMsIGNvbnRleHQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaW5zdCA9IG5ldyBDb21wb25lbnQocHJvcHMsIGNvbnRleHQpOwogICAgICAgICAgICBpbnN0LmNvbnN0cnVjdG9yID0gQ3RvcjsKICAgICAgICAgICAgaW5zdC5yZW5kZXIgPSBkb1JlbmRlcjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobGlzdCkgZm9yICh2YXIgaSA9IGxpc3QubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgIGlmIChsaXN0W2ldLmNvbnN0cnVjdG9yID09PSBDdG9yKSB7CiAgICAgICAgICAgICAgaW5zdC5fX2IgPSBsaXN0W2ldLl9fYjsKICAgICAgICAgICAgICBsaXN0LnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGluc3Q7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkb1JlbmRlcihwcm9wcywgc3RhdGUsIGNvbnRleHQpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yKHByb3BzLCBjb250ZXh0KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNldENvbXBvbmVudFByb3BzKGNvbXBvbmVudCwgcHJvcHMsIG9wdHMsIGNvbnRleHQsIG1vdW50QWxsKSB7CiAgICAgICAgICBpZiAoIWNvbXBvbmVudC5fX3gpIHsKICAgICAgICAgICAgY29tcG9uZW50Ll9feCA9ICEwOwogICAgICAgICAgICBpZiAoY29tcG9uZW50Ll9fciA9IHByb3BzLnJlZikgZGVsZXRlIHByb3BzLnJlZjsKICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5fX2sgPSBwcm9wcy5rZXkpIGRlbGV0ZSBwcm9wcy5rZXk7CgogICAgICAgICAgICBpZiAoIWNvbXBvbmVudC5iYXNlIHx8IG1vdW50QWxsKSB7CiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5jb21wb25lbnRXaWxsTW91bnQpIGNvbXBvbmVudC5jb21wb25lbnRXaWxsTW91bnQoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wb25lbnQuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcykgY29tcG9uZW50LmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMocHJvcHMsIGNvbnRleHQpOwoKICAgICAgICAgICAgaWYgKGNvbnRleHQgJiYgY29udGV4dCAhPT0gY29tcG9uZW50LmNvbnRleHQpIHsKICAgICAgICAgICAgICBpZiAoIWNvbXBvbmVudC5fX2MpIGNvbXBvbmVudC5fX2MgPSBjb21wb25lbnQuY29udGV4dDsKICAgICAgICAgICAgICBjb21wb25lbnQuY29udGV4dCA9IGNvbnRleHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghY29tcG9uZW50Ll9fcCkgY29tcG9uZW50Ll9fcCA9IGNvbXBvbmVudC5wcm9wczsKICAgICAgICAgICAgY29tcG9uZW50LnByb3BzID0gcHJvcHM7CiAgICAgICAgICAgIGNvbXBvbmVudC5fX3ggPSAhMTsKICAgICAgICAgICAgaWYgKDAgIT09IG9wdHMpIGlmICgxID09PSBvcHRzIHx8IG9wdGlvbnMuc3luY0NvbXBvbmVudFVwZGF0ZXMgIT09ICExIHx8ICFjb21wb25lbnQuYmFzZSkgcmVuZGVyQ29tcG9uZW50KGNvbXBvbmVudCwgMSwgbW91bnRBbGwpO2Vsc2UgZW5xdWV1ZVJlbmRlcihjb21wb25lbnQpOwogICAgICAgICAgICBpZiAoY29tcG9uZW50Ll9fcikgY29tcG9uZW50Ll9fcihjb21wb25lbnQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyQ29tcG9uZW50KGNvbXBvbmVudCwgb3B0cywgbW91bnRBbGwsIGlzQ2hpbGQpIHsKICAgICAgICAgIGlmICghY29tcG9uZW50Ll9feCkgewogICAgICAgICAgICB2YXIgcmVuZGVyZWQsCiAgICAgICAgICAgICAgICBpbnN0LAogICAgICAgICAgICAgICAgY2Jhc2UsCiAgICAgICAgICAgICAgICBwcm9wcyA9IGNvbXBvbmVudC5wcm9wcywKICAgICAgICAgICAgICAgIHN0YXRlID0gY29tcG9uZW50LnN0YXRlLAogICAgICAgICAgICAgICAgY29udGV4dCA9IGNvbXBvbmVudC5jb250ZXh0LAogICAgICAgICAgICAgICAgcHJldmlvdXNQcm9wcyA9IGNvbXBvbmVudC5fX3AgfHwgcHJvcHMsCiAgICAgICAgICAgICAgICBwcmV2aW91c1N0YXRlID0gY29tcG9uZW50Ll9fcyB8fCBzdGF0ZSwKICAgICAgICAgICAgICAgIHByZXZpb3VzQ29udGV4dCA9IGNvbXBvbmVudC5fX2MgfHwgY29udGV4dCwKICAgICAgICAgICAgICAgIGlzVXBkYXRlID0gY29tcG9uZW50LmJhc2UsCiAgICAgICAgICAgICAgICBuZXh0QmFzZSA9IGNvbXBvbmVudC5fX2IsCiAgICAgICAgICAgICAgICBpbml0aWFsQmFzZSA9IGlzVXBkYXRlIHx8IG5leHRCYXNlLAogICAgICAgICAgICAgICAgaW5pdGlhbENoaWxkQ29tcG9uZW50ID0gY29tcG9uZW50Ll9jb21wb25lbnQsCiAgICAgICAgICAgICAgICBza2lwID0gITE7CgogICAgICAgICAgICBpZiAoaXNVcGRhdGUpIHsKICAgICAgICAgICAgICBjb21wb25lbnQucHJvcHMgPSBwcmV2aW91c1Byb3BzOwogICAgICAgICAgICAgIGNvbXBvbmVudC5zdGF0ZSA9IHByZXZpb3VzU3RhdGU7CiAgICAgICAgICAgICAgY29tcG9uZW50LmNvbnRleHQgPSBwcmV2aW91c0NvbnRleHQ7CiAgICAgICAgICAgICAgaWYgKDIgIT09IG9wdHMgJiYgY29tcG9uZW50LnNob3VsZENvbXBvbmVudFVwZGF0ZSAmJiBjb21wb25lbnQuc2hvdWxkQ29tcG9uZW50VXBkYXRlKHByb3BzLCBzdGF0ZSwgY29udGV4dCkgPT09ICExKSBza2lwID0gITA7ZWxzZSBpZiAoY29tcG9uZW50LmNvbXBvbmVudFdpbGxVcGRhdGUpIGNvbXBvbmVudC5jb21wb25lbnRXaWxsVXBkYXRlKHByb3BzLCBzdGF0ZSwgY29udGV4dCk7CiAgICAgICAgICAgICAgY29tcG9uZW50LnByb3BzID0gcHJvcHM7CiAgICAgICAgICAgICAgY29tcG9uZW50LnN0YXRlID0gc3RhdGU7CiAgICAgICAgICAgICAgY29tcG9uZW50LmNvbnRleHQgPSBjb250ZXh0OwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb21wb25lbnQuX19wID0gY29tcG9uZW50Ll9fcyA9IGNvbXBvbmVudC5fX2MgPSBjb21wb25lbnQuX19iID0gbnVsbDsKICAgICAgICAgICAgY29tcG9uZW50Ll9fZCA9ICExOwoKICAgICAgICAgICAgaWYgKCFza2lwKSB7CiAgICAgICAgICAgICAgcmVuZGVyZWQgPSBjb21wb25lbnQucmVuZGVyKHByb3BzLCBzdGF0ZSwgY29udGV4dCk7CiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5nZXRDaGlsZENvbnRleHQpIGNvbnRleHQgPSBleHRlbmQoZXh0ZW5kKHt9LCBjb250ZXh0KSwgY29tcG9uZW50LmdldENoaWxkQ29udGV4dCgpKTsKICAgICAgICAgICAgICB2YXIgdG9Vbm1vdW50LAogICAgICAgICAgICAgICAgICBiYXNlLAogICAgICAgICAgICAgICAgICBjaGlsZENvbXBvbmVudCA9IHJlbmRlcmVkICYmIHJlbmRlcmVkLm5vZGVOYW1lOwoKICAgICAgICAgICAgICBpZiAoJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgY2hpbGRDb21wb25lbnQpIHsKICAgICAgICAgICAgICAgIHZhciBjaGlsZFByb3BzID0gZ2V0Tm9kZVByb3BzKHJlbmRlcmVkKTsKICAgICAgICAgICAgICAgIGluc3QgPSBpbml0aWFsQ2hpbGRDb21wb25lbnQ7CiAgICAgICAgICAgICAgICBpZiAoaW5zdCAmJiBpbnN0LmNvbnN0cnVjdG9yID09PSBjaGlsZENvbXBvbmVudCAmJiBjaGlsZFByb3BzLmtleSA9PSBpbnN0Ll9faykgc2V0Q29tcG9uZW50UHJvcHMoaW5zdCwgY2hpbGRQcm9wcywgMSwgY29udGV4dCwgITEpO2Vsc2UgewogICAgICAgICAgICAgICAgICB0b1VubW91bnQgPSBpbnN0OwogICAgICAgICAgICAgICAgICBjb21wb25lbnQuX2NvbXBvbmVudCA9IGluc3QgPSBjcmVhdGVDb21wb25lbnQoY2hpbGRDb21wb25lbnQsIGNoaWxkUHJvcHMsIGNvbnRleHQpOwogICAgICAgICAgICAgICAgICBpbnN0Ll9fYiA9IGluc3QuX19iIHx8IG5leHRCYXNlOwogICAgICAgICAgICAgICAgICBpbnN0Ll9fdSA9IGNvbXBvbmVudDsKICAgICAgICAgICAgICAgICAgc2V0Q29tcG9uZW50UHJvcHMoaW5zdCwgY2hpbGRQcm9wcywgMCwgY29udGV4dCwgITEpOwogICAgICAgICAgICAgICAgICByZW5kZXJDb21wb25lbnQoaW5zdCwgMSwgbW91bnRBbGwsICEwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJhc2UgPSBpbnN0LmJhc2U7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNiYXNlID0gaW5pdGlhbEJhc2U7CiAgICAgICAgICAgICAgICB0b1VubW91bnQgPSBpbml0aWFsQ2hpbGRDb21wb25lbnQ7CiAgICAgICAgICAgICAgICBpZiAodG9Vbm1vdW50KSBjYmFzZSA9IGNvbXBvbmVudC5fY29tcG9uZW50ID0gbnVsbDsKCiAgICAgICAgICAgICAgICBpZiAoaW5pdGlhbEJhc2UgfHwgMSA9PT0gb3B0cykgewogICAgICAgICAgICAgICAgICBpZiAoY2Jhc2UpIGNiYXNlLl9jb21wb25lbnQgPSBudWxsOwogICAgICAgICAgICAgICAgICBiYXNlID0gZGlmZihjYmFzZSwgcmVuZGVyZWQsIGNvbnRleHQsIG1vdW50QWxsIHx8ICFpc1VwZGF0ZSwgaW5pdGlhbEJhc2UgJiYgaW5pdGlhbEJhc2UucGFyZW50Tm9kZSwgITApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGluaXRpYWxCYXNlICYmIGJhc2UgIT09IGluaXRpYWxCYXNlICYmIGluc3QgIT09IGluaXRpYWxDaGlsZENvbXBvbmVudCkgewogICAgICAgICAgICAgICAgdmFyIGJhc2VQYXJlbnQgPSBpbml0aWFsQmFzZS5wYXJlbnROb2RlOwoKICAgICAgICAgICAgICAgIGlmIChiYXNlUGFyZW50ICYmIGJhc2UgIT09IGJhc2VQYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgYmFzZVBhcmVudC5yZXBsYWNlQ2hpbGQoYmFzZSwgaW5pdGlhbEJhc2UpOwoKICAgICAgICAgICAgICAgICAgaWYgKCF0b1VubW91bnQpIHsKICAgICAgICAgICAgICAgICAgICBpbml0aWFsQmFzZS5fY29tcG9uZW50ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICByZWNvbGxlY3ROb2RlVHJlZShpbml0aWFsQmFzZSwgITEpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodG9Vbm1vdW50KSB1bm1vdW50Q29tcG9uZW50KHRvVW5tb3VudCk7CiAgICAgICAgICAgICAgY29tcG9uZW50LmJhc2UgPSBiYXNlOwoKICAgICAgICAgICAgICBpZiAoYmFzZSAmJiAhaXNDaGlsZCkgewogICAgICAgICAgICAgICAgdmFyIGNvbXBvbmVudFJlZiA9IGNvbXBvbmVudCwKICAgICAgICAgICAgICAgICAgICB0ID0gY29tcG9uZW50OwoKICAgICAgICAgICAgICAgIHdoaWxlICh0ID0gdC5fX3UpIHsKICAgICAgICAgICAgICAgICAgKGNvbXBvbmVudFJlZiA9IHQpLmJhc2UgPSBiYXNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJhc2UuX2NvbXBvbmVudCA9IGNvbXBvbmVudFJlZjsKICAgICAgICAgICAgICAgIGJhc2UuX2NvbXBvbmVudENvbnN0cnVjdG9yID0gY29tcG9uZW50UmVmLmNvbnN0cnVjdG9yOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFpc1VwZGF0ZSB8fCBtb3VudEFsbCkgbW91bnRzLnVuc2hpZnQoY29tcG9uZW50KTtlbHNlIGlmICghc2tpcCkgewogICAgICAgICAgICAgIGZsdXNoTW91bnRzKCk7CiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5jb21wb25lbnREaWRVcGRhdGUpIGNvbXBvbmVudC5jb21wb25lbnREaWRVcGRhdGUocHJldmlvdXNQcm9wcywgcHJldmlvdXNTdGF0ZSwgcHJldmlvdXNDb250ZXh0KTsKICAgICAgICAgICAgICBpZiAob3B0aW9ucy5hZnRlclVwZGF0ZSkgb3B0aW9ucy5hZnRlclVwZGF0ZShjb21wb25lbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChudWxsICE9IGNvbXBvbmVudC5fX2gpIHdoaWxlIChjb21wb25lbnQuX19oLmxlbmd0aCkgewogICAgICAgICAgICAgIGNvbXBvbmVudC5fX2gucG9wKCkuY2FsbChjb21wb25lbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghZGlmZkxldmVsICYmICFpc0NoaWxkKSBmbHVzaE1vdW50cygpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYnVpbGRDb21wb25lbnRGcm9tVk5vZGUoZG9tLCB2bm9kZSwgY29udGV4dCwgbW91bnRBbGwpIHsKICAgICAgICAgIHZhciBjID0gZG9tICYmIGRvbS5fY29tcG9uZW50LAogICAgICAgICAgICAgIG9yaWdpbmFsQ29tcG9uZW50ID0gYywKICAgICAgICAgICAgICBvbGREb20gPSBkb20sCiAgICAgICAgICAgICAgaXNEaXJlY3RPd25lciA9IGMgJiYgZG9tLl9jb21wb25lbnRDb25zdHJ1Y3RvciA9PT0gdm5vZGUubm9kZU5hbWUsCiAgICAgICAgICAgICAgaXNPd25lciA9IGlzRGlyZWN0T3duZXIsCiAgICAgICAgICAgICAgcHJvcHMgPSBnZXROb2RlUHJvcHModm5vZGUpOwoKICAgICAgICAgIHdoaWxlIChjICYmICFpc093bmVyICYmIChjID0gYy5fX3UpKSB7CiAgICAgICAgICAgIGlzT3duZXIgPSBjLmNvbnN0cnVjdG9yID09PSB2bm9kZS5ub2RlTmFtZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoYyAmJiBpc093bmVyICYmICghbW91bnRBbGwgfHwgYy5fY29tcG9uZW50KSkgewogICAgICAgICAgICBzZXRDb21wb25lbnRQcm9wcyhjLCBwcm9wcywgMywgY29udGV4dCwgbW91bnRBbGwpOwogICAgICAgICAgICBkb20gPSBjLmJhc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAob3JpZ2luYWxDb21wb25lbnQgJiYgIWlzRGlyZWN0T3duZXIpIHsKICAgICAgICAgICAgICB1bm1vdW50Q29tcG9uZW50KG9yaWdpbmFsQ29tcG9uZW50KTsKICAgICAgICAgICAgICBkb20gPSBvbGREb20gPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjID0gY3JlYXRlQ29tcG9uZW50KHZub2RlLm5vZGVOYW1lLCBwcm9wcywgY29udGV4dCk7CgogICAgICAgICAgICBpZiAoZG9tICYmICFjLl9fYikgewogICAgICAgICAgICAgIGMuX19iID0gZG9tOwogICAgICAgICAgICAgIG9sZERvbSA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNldENvbXBvbmVudFByb3BzKGMsIHByb3BzLCAxLCBjb250ZXh0LCBtb3VudEFsbCk7CiAgICAgICAgICAgIGRvbSA9IGMuYmFzZTsKCiAgICAgICAgICAgIGlmIChvbGREb20gJiYgZG9tICE9PSBvbGREb20pIHsKICAgICAgICAgICAgICBvbGREb20uX2NvbXBvbmVudCA9IG51bGw7CiAgICAgICAgICAgICAgcmVjb2xsZWN0Tm9kZVRyZWUob2xkRG9tLCAhMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZG9tOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdW5tb3VudENvbXBvbmVudChjb21wb25lbnQpIHsKICAgICAgICAgIGlmIChvcHRpb25zLmJlZm9yZVVubW91bnQpIG9wdGlvbnMuYmVmb3JlVW5tb3VudChjb21wb25lbnQpOwogICAgICAgICAgdmFyIGJhc2UgPSBjb21wb25lbnQuYmFzZTsKICAgICAgICAgIGNvbXBvbmVudC5fX3ggPSAhMDsKICAgICAgICAgIGlmIChjb21wb25lbnQuY29tcG9uZW50V2lsbFVubW91bnQpIGNvbXBvbmVudC5jb21wb25lbnRXaWxsVW5tb3VudCgpOwogICAgICAgICAgY29tcG9uZW50LmJhc2UgPSBudWxsOwogICAgICAgICAgdmFyIGlubmVyID0gY29tcG9uZW50Ll9jb21wb25lbnQ7CiAgICAgICAgICBpZiAoaW5uZXIpIHVubW91bnRDb21wb25lbnQoaW5uZXIpO2Vsc2UgaWYgKGJhc2UpIHsKICAgICAgICAgICAgaWYgKGJhc2UuX19wcmVhY3RhdHRyXyAmJiBiYXNlLl9fcHJlYWN0YXR0cl8ucmVmKSBiYXNlLl9fcHJlYWN0YXR0cl8ucmVmKG51bGwpOwogICAgICAgICAgICBjb21wb25lbnQuX19iID0gYmFzZTsKICAgICAgICAgICAgcmVtb3ZlTm9kZShiYXNlKTsKICAgICAgICAgICAgY29sbGVjdENvbXBvbmVudChjb21wb25lbnQpOwogICAgICAgICAgICByZW1vdmVDaGlsZHJlbihiYXNlKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjb21wb25lbnQuX19yKSBjb21wb25lbnQuX19yKG51bGwpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gQ29tcG9uZW50KHByb3BzLCBjb250ZXh0KSB7CiAgICAgICAgICB0aGlzLl9fZCA9ICEwOwogICAgICAgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDsKICAgICAgICAgIHRoaXMucHJvcHMgPSBwcm9wczsKICAgICAgICAgIHRoaXMuc3RhdGUgPSB0aGlzLnN0YXRlIHx8IHt9OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyKHZub2RlLCBwYXJlbnQsIG1lcmdlKSB7CiAgICAgICAgICByZXR1cm4gZGlmZihtZXJnZSwgdm5vZGUsIHt9LCAhMSwgcGFyZW50LCAhMSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgb3B0aW9ucyA9IHt9OwogICAgICAgIHZhciBzdGFjayA9IFtdOwogICAgICAgIHZhciBFTVBUWV9DSElMRFJFTiA9IFtdOwogICAgICAgIHZhciBJU19OT05fRElNRU5TSU9OQUwgPSAvYWNpdHxleCg/OnN8Z3xufHB8JCl8cnBofG93c3xtbmN8bnR3fGluZVtjaF18em9vfF5vcmQvaTsKICAgICAgICB2YXIgaXRlbXMgPSBbXTsKICAgICAgICB2YXIgbW91bnRzID0gW107CiAgICAgICAgdmFyIGRpZmZMZXZlbCA9IDA7CiAgICAgICAgdmFyIGlzU3ZnTW9kZSA9ICExOwogICAgICAgIHZhciBoeWRyYXRpbmcgPSAhMTsKICAgICAgICB2YXIgY29tcG9uZW50cyA9IHt9OwogICAgICAgIGV4dGVuZChDb21wb25lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICBzZXRTdGF0ZTogZnVuY3Rpb24gc2V0U3RhdGUoc3RhdGUsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBzID0gdGhpcy5zdGF0ZTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9fcykgdGhpcy5fX3MgPSBleHRlbmQoe30sIHMpOwogICAgICAgICAgICBleHRlbmQocywgJ2Z1bmN0aW9uJyA9PSB0eXBlb2Ygc3RhdGUgPyBzdGF0ZShzLCB0aGlzLnByb3BzKSA6IHN0YXRlKTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSAodGhpcy5fX2ggPSB0aGlzLl9faCB8fCBbXSkucHVzaChjYWxsYmFjayk7CiAgICAgICAgICAgIGVucXVldWVSZW5kZXIodGhpcyk7CiAgICAgICAgICB9LAogICAgICAgICAgZm9yY2VVcGRhdGU6IGZ1bmN0aW9uIGZvcmNlVXBkYXRlKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgKHRoaXMuX19oID0gdGhpcy5fX2ggfHwgW10pLnB1c2goY2FsbGJhY2spOwogICAgICAgICAgICByZW5kZXJDb21wb25lbnQodGhpcywgMik7CiAgICAgICAgICB9LAogICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7fQogICAgICAgIH0pOwogICAgICAgIHZhciBwcmVhY3QgPSB7CiAgICAgICAgICBoOiBoLAogICAgICAgICAgY3JlYXRlRWxlbWVudDogaCwKICAgICAgICAgIGNsb25lRWxlbWVudDogY2xvbmVFbGVtZW50LAogICAgICAgICAgQ29tcG9uZW50OiBDb21wb25lbnQsCiAgICAgICAgICByZW5kZXI6IHJlbmRlciwKICAgICAgICAgIHJlcmVuZGVyOiByZXJlbmRlciwKICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICB9OwogICAgICAgIGlmICh0cnVlKSBtb2R1bGUuZXhwb3J0cyA9IHByZWFjdDtlbHNlIHNlbGYucHJlYWN0ID0gcHJlYWN0OwogICAgICB9KCk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogOTQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7IC8vIFRoaXMgZmlsZSBjYW4gYmUgcmVxdWlyZWQgaW4gQnJvd3NlcmlmeSBhbmQgTm9kZS5qcyBmb3IgYXV0b21hdGljIHBvbHlmaWxsCiAgICAgIC8vIFRvIHVzZSBpdDogIHJlcXVpcmUoJ2VzNi1wcm9taXNlL2F1dG8nKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NSkucG9seWZpbGwoKTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA5NSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLwogICAgICAoZnVuY3Rpb24gKHByb2Nlc3MsIGdsb2JhbCkgewogICAgICAgIHZhciByZXF1aXJlOwogICAgICAgIC8qIQogICAgICAgICogQG92ZXJ2aWV3IGVzNi1wcm9taXNlIC0gYSB0aW55IGltcGxlbWVudGF0aW9uIG9mIFByb21pc2VzL0ErLgogICAgICAgICogQGNvcHlyaWdodCBDb3B5cmlnaHQgKGMpIDIwMTQgWWVodWRhIEthdHosIFRvbSBEYWxlLCBTdGVmYW4gUGVubmVyIGFuZCBjb250cmlidXRvcnMgKENvbnZlcnNpb24gdG8gRVM2IEFQSSBieSBKYWtlIEFyY2hpYmFsZCkKICAgICAgICAqIEBsaWNlbnNlICAgTGljZW5zZWQgdW5kZXIgTUlUIGxpY2Vuc2UKICAgICAgICAqICAgICAgICAgICAgU2VlIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9zdGVmYW5wZW5uZXIvZXM2LXByb21pc2UvbWFzdGVyL0xJQ0VOU0UKICAgICAgICAqIEB2ZXJzaW9uICAgNC4xLjEKICAgICAgICAqLwoKCiAgICAgICAgKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKICAgICAgICAgIHRydWUgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6IHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShmYWN0b3J5KSA6IGdsb2JhbC5FUzZQcm9taXNlID0gZmFjdG9yeSgpOwogICAgICAgIH0pKHRoaXMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICd1c2Ugc3RyaWN0JzsKCiAgICAgICAgICBmdW5jdGlvbiBvYmplY3RPckZ1bmN0aW9uKHgpIHsKICAgICAgICAgICAgdmFyIHR5cGUgPSBfdHlwZW9mNCh4KTsKCiAgICAgICAgICAgIHJldHVybiB4ICE9PSBudWxsICYmICh0eXBlID09PSAnb2JqZWN0JyB8fCB0eXBlID09PSAnZnVuY3Rpb24nKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc0Z1bmN0aW9uKHgpIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB4ID09PSAnZnVuY3Rpb24nOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfaXNBcnJheSA9IHVuZGVmaW5lZDsKCiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSkgewogICAgICAgICAgICBfaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfaXNBcnJheSA9IGZ1bmN0aW9uIF9pc0FycmF5KHgpIHsKICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHgpID09PSAnW29iamVjdCBBcnJheV0nOwogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpc0FycmF5ID0gX2lzQXJyYXk7CiAgICAgICAgICB2YXIgbGVuID0gMDsKICAgICAgICAgIHZhciB2ZXJ0eE5leHQgPSB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgY3VzdG9tU2NoZWR1bGVyRm4gPSB1bmRlZmluZWQ7CgogICAgICAgICAgdmFyIGFzYXAgPSBmdW5jdGlvbiBhc2FwKGNhbGxiYWNrLCBhcmcpIHsKICAgICAgICAgICAgcXVldWVbbGVuXSA9IGNhbGxiYWNrOwogICAgICAgICAgICBxdWV1ZVtsZW4gKyAxXSA9IGFyZzsKICAgICAgICAgICAgbGVuICs9IDI7CgogICAgICAgICAgICBpZiAobGVuID09PSAyKSB7CiAgICAgICAgICAgICAgLy8gSWYgbGVuIGlzIDIsIHRoYXQgbWVhbnMgdGhhdCB3ZSBuZWVkIHRvIHNjaGVkdWxlIGFuIGFzeW5jIGZsdXNoLgogICAgICAgICAgICAgIC8vIElmIGFkZGl0aW9uYWwgY2FsbGJhY2tzIGFyZSBxdWV1ZWQgYmVmb3JlIHRoZSBxdWV1ZSBpcyBmbHVzaGVkLCB0aGV5CiAgICAgICAgICAgICAgLy8gd2lsbCBiZSBwcm9jZXNzZWQgYnkgdGhpcyBmbHVzaCB0aGF0IHdlIGFyZSBzY2hlZHVsaW5nLgogICAgICAgICAgICAgIGlmIChjdXN0b21TY2hlZHVsZXJGbikgewogICAgICAgICAgICAgICAgY3VzdG9tU2NoZWR1bGVyRm4oZmx1c2gpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzY2hlZHVsZUZsdXNoKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIGZ1bmN0aW9uIHNldFNjaGVkdWxlcihzY2hlZHVsZUZuKSB7CiAgICAgICAgICAgIGN1c3RvbVNjaGVkdWxlckZuID0gc2NoZWR1bGVGbjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzZXRBc2FwKGFzYXBGbikgewogICAgICAgICAgICBhc2FwID0gYXNhcEZuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBicm93c2VyV2luZG93ID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgYnJvd3Nlckdsb2JhbCA9IGJyb3dzZXJXaW5kb3cgfHwge307CiAgICAgICAgICB2YXIgQnJvd3Nlck11dGF0aW9uT2JzZXJ2ZXIgPSBicm93c2VyR2xvYmFsLk11dGF0aW9uT2JzZXJ2ZXIgfHwgYnJvd3Nlckdsb2JhbC5XZWJLaXRNdXRhdGlvbk9ic2VydmVyOwogICAgICAgICAgdmFyIGlzTm9kZSA9IHR5cGVvZiBzZWxmID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgJiYge30udG9TdHJpbmcuY2FsbChwcm9jZXNzKSA9PT0gJ1tvYmplY3QgcHJvY2Vzc10nOyAvLyB0ZXN0IGZvciB3ZWIgd29ya2VyIGJ1dCBub3QgaW4gSUUxMAoKICAgICAgICAgIHZhciBpc1dvcmtlciA9IHR5cGVvZiBVaW50OENsYW1wZWRBcnJheSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGltcG9ydFNjcmlwdHMgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBNZXNzYWdlQ2hhbm5lbCAhPT0gJ3VuZGVmaW5lZCc7IC8vIG5vZGUKCiAgICAgICAgICBmdW5jdGlvbiB1c2VOZXh0VGljaygpIHsKICAgICAgICAgICAgLy8gbm9kZSB2ZXJzaW9uIDAuMTAueCBkaXNwbGF5cyBhIGRlcHJlY2F0aW9uIHdhcm5pbmcgd2hlbiBuZXh0VGljayBpcyB1c2VkIHJlY3Vyc2l2ZWx5CiAgICAgICAgICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vY3Vqb2pzL3doZW4vaXNzdWVzLzQxMCBmb3IgZGV0YWlscwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzLm5leHRUaWNrKGZsdXNoKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gLy8gdmVydHgKCgogICAgICAgICAgZnVuY3Rpb24gdXNlVmVydHhUaW1lcigpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2ZXJ0eE5leHQgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZlcnR4TmV4dChmbHVzaCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHVzZVNldFRpbWVvdXQoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1c2VNdXRhdGlvbk9ic2VydmVyKCkgewogICAgICAgICAgICB2YXIgaXRlcmF0aW9ucyA9IDA7CiAgICAgICAgICAgIHZhciBvYnNlcnZlciA9IG5ldyBCcm93c2VyTXV0YXRpb25PYnNlcnZlcihmbHVzaCk7CiAgICAgICAgICAgIHZhciBub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycpOwogICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKG5vZGUsIHsKICAgICAgICAgICAgICBjaGFyYWN0ZXJEYXRhOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIG5vZGUuZGF0YSA9IGl0ZXJhdGlvbnMgPSArK2l0ZXJhdGlvbnMgJSAyOwogICAgICAgICAgICB9OwogICAgICAgICAgfSAvLyB3ZWIgd29ya2VyCgoKICAgICAgICAgIGZ1bmN0aW9uIHVzZU1lc3NhZ2VDaGFubmVsKCkgewogICAgICAgICAgICB2YXIgY2hhbm5lbCA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpOwogICAgICAgICAgICBjaGFubmVsLnBvcnQxLm9ubWVzc2FnZSA9IGZsdXNoOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBjaGFubmVsLnBvcnQyLnBvc3RNZXNzYWdlKDApOwogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVNldFRpbWVvdXQoKSB7CiAgICAgICAgICAgIC8vIFN0b3JlIHNldFRpbWVvdXQgcmVmZXJlbmNlIHNvIGVzNi1wcm9taXNlIHdpbGwgYmUgdW5hZmZlY3RlZCBieQogICAgICAgICAgICAvLyBvdGhlciBjb2RlIG1vZGlmeWluZyBzZXRUaW1lb3V0IChsaWtlIHNpbm9uLnVzZUZha2VUaW1lcnMoKSkKICAgICAgICAgICAgdmFyIGdsb2JhbFNldFRpbWVvdXQgPSBzZXRUaW1lb3V0OwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBnbG9iYWxTZXRUaW1lb3V0KGZsdXNoLCAxKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcXVldWUgPSBuZXcgQXJyYXkoMTAwMCk7CgogICAgICAgICAgZnVuY3Rpb24gZmx1c2goKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpICs9IDIpIHsKICAgICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBxdWV1ZVtpXTsKICAgICAgICAgICAgICB2YXIgYXJnID0gcXVldWVbaSArIDFdOwogICAgICAgICAgICAgIGNhbGxiYWNrKGFyZyk7CiAgICAgICAgICAgICAgcXVldWVbaV0gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgcXVldWVbaSArIDFdID0gdW5kZWZpbmVkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZW4gPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGF0dGVtcHRWZXJ0eCgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB2YXIgciA9IHJlcXVpcmU7CgogICAgICAgICAgICAgIHZhciB2ZXJ0eCA9IF9fd2VicGFja19yZXF1aXJlX18oOTcpOwoKICAgICAgICAgICAgICB2ZXJ0eE5leHQgPSB2ZXJ0eC5ydW5Pbkxvb3AgfHwgdmVydHgucnVuT25Db250ZXh0OwogICAgICAgICAgICAgIHJldHVybiB1c2VWZXJ0eFRpbWVyKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gdXNlU2V0VGltZW91dCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHNjaGVkdWxlRmx1c2ggPSB1bmRlZmluZWQ7IC8vIERlY2lkZSB3aGF0IGFzeW5jIG1ldGhvZCB0byB1c2UgdG8gdHJpZ2dlcmluZyBwcm9jZXNzaW5nIG9mIHF1ZXVlZCBjYWxsYmFja3M6CgogICAgICAgICAgaWYgKGlzTm9kZSkgewogICAgICAgICAgICBzY2hlZHVsZUZsdXNoID0gdXNlTmV4dFRpY2soKTsKICAgICAgICAgIH0gZWxzZSBpZiAoQnJvd3Nlck11dGF0aW9uT2JzZXJ2ZXIpIHsKICAgICAgICAgICAgc2NoZWR1bGVGbHVzaCA9IHVzZU11dGF0aW9uT2JzZXJ2ZXIoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaXNXb3JrZXIpIHsKICAgICAgICAgICAgc2NoZWR1bGVGbHVzaCA9IHVzZU1lc3NhZ2VDaGFubmVsKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGJyb3dzZXJXaW5kb3cgPT09IHVuZGVmaW5lZCAmJiAiZnVuY3Rpb24iID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHNjaGVkdWxlRmx1c2ggPSBhdHRlbXB0VmVydHgoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNjaGVkdWxlRmx1c2ggPSB1c2VTZXRUaW1lb3V0KCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxtZW50LCBvblJlamVjdGlvbikgewogICAgICAgICAgICB2YXIgX2FyZ3VtZW50cyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRoaXM7CiAgICAgICAgICAgIHZhciBjaGlsZCA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKG5vb3ApOwoKICAgICAgICAgICAgaWYgKGNoaWxkW1BST01JU0VfSURdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBtYWtlUHJvbWlzZShjaGlsZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfc3RhdGUgPSBwYXJlbnQuX3N0YXRlOwoKICAgICAgICAgICAgaWYgKF9zdGF0ZSkgewogICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBfYXJndW1lbnRzW19zdGF0ZSAtIDFdOwogICAgICAgICAgICAgICAgYXNhcChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpbnZva2VDYWxsYmFjayhfc3RhdGUsIGNoaWxkLCBjYWxsYmFjaywgcGFyZW50Ll9yZXN1bHQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzdWJzY3JpYmUocGFyZW50LCBjaGlsZCwgb25GdWxmaWxsbWVudCwgb25SZWplY3Rpb24pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAgYFByb21pc2UucmVzb2x2ZWAgcmV0dXJucyBhIHByb21pc2UgdGhhdCB3aWxsIGJlY29tZSByZXNvbHZlZCB3aXRoIHRoZQogICAgICAgICAgICBwYXNzZWQgYHZhbHVlYC4gSXQgaXMgc2hvcnRoYW5kIGZvciB0aGUgZm9sbG93aW5nOgogICAgICAgICAgCiAgICAgICAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgICAgICAgbGV0IHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpewogICAgICAgICAgICAgIHJlc29sdmUoMSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgCiAgICAgICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbih2YWx1ZSl7CiAgICAgICAgICAgICAgLy8gdmFsdWUgPT09IDEKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGBgYAogICAgICAgICAgCiAgICAgICAgICAgIEluc3RlYWQgb2Ygd3JpdGluZyB0aGUgYWJvdmUsIHlvdXIgY29kZSBub3cgc2ltcGx5IGJlY29tZXMgdGhlIGZvbGxvd2luZzoKICAgICAgICAgIAogICAgICAgICAgICBgYGBqYXZhc2NyaXB0CiAgICAgICAgICAgIGxldCBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKDEpOwogICAgICAgICAgCiAgICAgICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbih2YWx1ZSl7CiAgICAgICAgICAgICAgLy8gdmFsdWUgPT09IDEKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGBgYAogICAgICAgICAgCiAgICAgICAgICAgIEBtZXRob2QgcmVzb2x2ZQogICAgICAgICAgICBAc3RhdGljCiAgICAgICAgICAgIEBwYXJhbSB7QW55fSB2YWx1ZSB2YWx1ZSB0aGF0IHRoZSByZXR1cm5lZCBwcm9taXNlIHdpbGwgYmUgcmVzb2x2ZWQgd2l0aAogICAgICAgICAgICBVc2VmdWwgZm9yIHRvb2xpbmcuCiAgICAgICAgICAgIEByZXR1cm4ge1Byb21pc2V9IGEgcHJvbWlzZSB0aGF0IHdpbGwgYmVjb21lIGZ1bGZpbGxlZCB3aXRoIHRoZSBnaXZlbgogICAgICAgICAgICBgdmFsdWVgCiAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlJDEob2JqZWN0KSB7CiAgICAgICAgICAgIC8qanNoaW50IHZhbGlkdGhpczp0cnVlICovCiAgICAgICAgICAgIHZhciBDb25zdHJ1Y3RvciA9IHRoaXM7CgogICAgICAgICAgICBpZiAob2JqZWN0ICYmIF90eXBlb2Y0KG9iamVjdCkgPT09ICdvYmplY3QnICYmIG9iamVjdC5jb25zdHJ1Y3RvciA9PT0gQ29uc3RydWN0b3IpIHsKICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBDb25zdHJ1Y3Rvcihub29wKTsKICAgICAgICAgICAgcmVzb2x2ZShwcm9taXNlLCBvYmplY3QpOwogICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgUFJPTUlTRV9JRCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygxNik7CgogICAgICAgICAgZnVuY3Rpb24gbm9vcCgpIHt9CgogICAgICAgICAgdmFyIFBFTkRJTkcgPSB2b2lkIDA7CiAgICAgICAgICB2YXIgRlVMRklMTEVEID0gMTsKICAgICAgICAgIHZhciBSRUpFQ1RFRCA9IDI7CiAgICAgICAgICB2YXIgR0VUX1RIRU5fRVJST1IgPSBuZXcgRXJyb3JPYmplY3QoKTsKCiAgICAgICAgICBmdW5jdGlvbiBzZWxmRnVsZmlsbG1lbnQoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCJZb3UgY2Fubm90IHJlc29sdmUgYSBwcm9taXNlIHdpdGggaXRzZWxmIik7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY2Fubm90UmV0dXJuT3duKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcignQSBwcm9taXNlcyBjYWxsYmFjayBjYW5ub3QgcmV0dXJuIHRoYXQgc2FtZSBwcm9taXNlLicpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldFRoZW4ocHJvbWlzZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBwcm9taXNlLnRoZW47CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgR0VUX1RIRU5fRVJST1IuZXJyb3IgPSBlcnJvcjsKICAgICAgICAgICAgICByZXR1cm4gR0VUX1RIRU5fRVJST1I7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB0cnlUaGVuKHRoZW4kJDEsIHZhbHVlLCBmdWxmaWxsbWVudEhhbmRsZXIsIHJlamVjdGlvbkhhbmRsZXIpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB0aGVuJCQxLmNhbGwodmFsdWUsIGZ1bGZpbGxtZW50SGFuZGxlciwgcmVqZWN0aW9uSGFuZGxlcik7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZUZvcmVpZ25UaGVuYWJsZShwcm9taXNlLCB0aGVuYWJsZSwgdGhlbiQkMSkgewogICAgICAgICAgICBhc2FwKGZ1bmN0aW9uIChwcm9taXNlKSB7CiAgICAgICAgICAgICAgdmFyIHNlYWxlZCA9IGZhbHNlOwogICAgICAgICAgICAgIHZhciBlcnJvciA9IHRyeVRoZW4odGhlbiQkMSwgdGhlbmFibGUsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHNlYWxlZCkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc2VhbGVkID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBpZiAodGhlbmFibGUgIT09IHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIHJlc29sdmUocHJvbWlzZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZnVsZmlsbChwcm9taXNlLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgaWYgKHNlYWxlZCkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc2VhbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJlamVjdChwcm9taXNlLCByZWFzb24pOwogICAgICAgICAgICAgIH0sICdTZXR0bGU6ICcgKyAocHJvbWlzZS5fbGFiZWwgfHwgJyB1bmtub3duIHByb21pc2UnKSk7CgogICAgICAgICAgICAgIGlmICghc2VhbGVkICYmIGVycm9yKSB7CiAgICAgICAgICAgICAgICBzZWFsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVqZWN0KHByb21pc2UsIGVycm9yKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHByb21pc2UpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZU93blRoZW5hYmxlKHByb21pc2UsIHRoZW5hYmxlKSB7CiAgICAgICAgICAgIGlmICh0aGVuYWJsZS5fc3RhdGUgPT09IEZVTEZJTExFRCkgewogICAgICAgICAgICAgIGZ1bGZpbGwocHJvbWlzZSwgdGhlbmFibGUuX3Jlc3VsdCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhlbmFibGUuX3N0YXRlID09PSBSRUpFQ1RFRCkgewogICAgICAgICAgICAgIHJlamVjdChwcm9taXNlLCB0aGVuYWJsZS5fcmVzdWx0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzdWJzY3JpYmUodGhlbmFibGUsIHVuZGVmaW5lZCwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShwcm9taXNlLCB2YWx1ZSk7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChwcm9taXNlLCByZWFzb24pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaGFuZGxlTWF5YmVUaGVuYWJsZShwcm9taXNlLCBtYXliZVRoZW5hYmxlLCB0aGVuJCQxKSB7CiAgICAgICAgICAgIGlmIChtYXliZVRoZW5hYmxlLmNvbnN0cnVjdG9yID09PSBwcm9taXNlLmNvbnN0cnVjdG9yICYmIHRoZW4kJDEgPT09IHRoZW4gJiYgbWF5YmVUaGVuYWJsZS5jb25zdHJ1Y3Rvci5yZXNvbHZlID09PSByZXNvbHZlJDEpIHsKICAgICAgICAgICAgICBoYW5kbGVPd25UaGVuYWJsZShwcm9taXNlLCBtYXliZVRoZW5hYmxlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAodGhlbiQkMSA9PT0gR0VUX1RIRU5fRVJST1IpIHsKICAgICAgICAgICAgICAgIHJlamVjdChwcm9taXNlLCBHRVRfVEhFTl9FUlJPUi5lcnJvcik7CiAgICAgICAgICAgICAgICBHRVRfVEhFTl9FUlJPUi5lcnJvciA9IG51bGw7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGVuJCQxID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGZ1bGZpbGwocHJvbWlzZSwgbWF5YmVUaGVuYWJsZSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0Z1bmN0aW9uKHRoZW4kJDEpKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVGb3JlaWduVGhlbmFibGUocHJvbWlzZSwgbWF5YmVUaGVuYWJsZSwgdGhlbiQkMSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZ1bGZpbGwocHJvbWlzZSwgbWF5YmVUaGVuYWJsZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZShwcm9taXNlLCB2YWx1ZSkgewogICAgICAgICAgICBpZiAocHJvbWlzZSA9PT0gdmFsdWUpIHsKICAgICAgICAgICAgICByZWplY3QocHJvbWlzZSwgc2VsZkZ1bGZpbGxtZW50KCkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKG9iamVjdE9yRnVuY3Rpb24odmFsdWUpKSB7CiAgICAgICAgICAgICAgaGFuZGxlTWF5YmVUaGVuYWJsZShwcm9taXNlLCB2YWx1ZSwgZ2V0VGhlbih2YWx1ZSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZ1bGZpbGwocHJvbWlzZSwgdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcHVibGlzaFJlamVjdGlvbihwcm9taXNlKSB7CiAgICAgICAgICAgIGlmIChwcm9taXNlLl9vbmVycm9yKSB7CiAgICAgICAgICAgICAgcHJvbWlzZS5fb25lcnJvcihwcm9taXNlLl9yZXN1bHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaXNoKHByb21pc2UpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGwocHJvbWlzZSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKHByb21pc2UuX3N0YXRlICE9PSBQRU5ESU5HKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcm9taXNlLl9yZXN1bHQgPSB2YWx1ZTsKICAgICAgICAgICAgcHJvbWlzZS5fc3RhdGUgPSBGVUxGSUxMRUQ7CgogICAgICAgICAgICBpZiAocHJvbWlzZS5fc3Vic2NyaWJlcnMubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgYXNhcChwdWJsaXNoLCBwcm9taXNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJlamVjdChwcm9taXNlLCByZWFzb24pIHsKICAgICAgICAgICAgaWYgKHByb21pc2UuX3N0YXRlICE9PSBQRU5ESU5HKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcm9taXNlLl9zdGF0ZSA9IFJFSkVDVEVEOwogICAgICAgICAgICBwcm9taXNlLl9yZXN1bHQgPSByZWFzb247CiAgICAgICAgICAgIGFzYXAocHVibGlzaFJlamVjdGlvbiwgcHJvbWlzZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlKHBhcmVudCwgY2hpbGQsIG9uRnVsZmlsbG1lbnQsIG9uUmVqZWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBfc3Vic2NyaWJlcnMgPSBwYXJlbnQuX3N1YnNjcmliZXJzOwogICAgICAgICAgICB2YXIgbGVuZ3RoID0gX3N1YnNjcmliZXJzLmxlbmd0aDsKICAgICAgICAgICAgcGFyZW50Ll9vbmVycm9yID0gbnVsbDsKICAgICAgICAgICAgX3N1YnNjcmliZXJzW2xlbmd0aF0gPSBjaGlsZDsKICAgICAgICAgICAgX3N1YnNjcmliZXJzW2xlbmd0aCArIEZVTEZJTExFRF0gPSBvbkZ1bGZpbGxtZW50OwogICAgICAgICAgICBfc3Vic2NyaWJlcnNbbGVuZ3RoICsgUkVKRUNURURdID0gb25SZWplY3Rpb247CgogICAgICAgICAgICBpZiAobGVuZ3RoID09PSAwICYmIHBhcmVudC5fc3RhdGUpIHsKICAgICAgICAgICAgICBhc2FwKHB1Ymxpc2gsIHBhcmVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwdWJsaXNoKHByb21pc2UpIHsKICAgICAgICAgICAgdmFyIHN1YnNjcmliZXJzID0gcHJvbWlzZS5fc3Vic2NyaWJlcnM7CiAgICAgICAgICAgIHZhciBzZXR0bGVkID0gcHJvbWlzZS5fc3RhdGU7CgogICAgICAgICAgICBpZiAoc3Vic2NyaWJlcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgY2hpbGQgPSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGRldGFpbCA9IHByb21pc2UuX3Jlc3VsdDsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Vic2NyaWJlcnMubGVuZ3RoOyBpICs9IDMpIHsKICAgICAgICAgICAgICBjaGlsZCA9IHN1YnNjcmliZXJzW2ldOwogICAgICAgICAgICAgIGNhbGxiYWNrID0gc3Vic2NyaWJlcnNbaSArIHNldHRsZWRdOwoKICAgICAgICAgICAgICBpZiAoY2hpbGQpIHsKICAgICAgICAgICAgICAgIGludm9rZUNhbGxiYWNrKHNldHRsZWQsIGNoaWxkLCBjYWxsYmFjaywgZGV0YWlsKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2FsbGJhY2soZGV0YWlsKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByb21pc2UuX3N1YnNjcmliZXJzLmxlbmd0aCA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gRXJyb3JPYmplY3QoKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBUUllfQ0FUQ0hfRVJST1IgPSBuZXcgRXJyb3JPYmplY3QoKTsKCiAgICAgICAgICBmdW5jdGlvbiB0cnlDYXRjaChjYWxsYmFjaywgZGV0YWlsKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGRldGFpbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICBUUllfQ0FUQ0hfRVJST1IuZXJyb3IgPSBlOwogICAgICAgICAgICAgIHJldHVybiBUUllfQ0FUQ0hfRVJST1I7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpbnZva2VDYWxsYmFjayhzZXR0bGVkLCBwcm9taXNlLCBjYWxsYmFjaywgZGV0YWlsKSB7CiAgICAgICAgICAgIHZhciBoYXNDYWxsYmFjayA9IGlzRnVuY3Rpb24oY2FsbGJhY2spLAogICAgICAgICAgICAgICAgdmFsdWUgPSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBlcnJvciA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHN1Y2NlZWRlZCA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGZhaWxlZCA9IHVuZGVmaW5lZDsKCiAgICAgICAgICAgIGlmIChoYXNDYWxsYmFjaykgewogICAgICAgICAgICAgIHZhbHVlID0gdHJ5Q2F0Y2goY2FsbGJhY2ssIGRldGFpbCk7CgogICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gVFJZX0NBVENIX0VSUk9SKSB7CiAgICAgICAgICAgICAgICBmYWlsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZXJyb3IgPSB2YWx1ZS5lcnJvcjsKICAgICAgICAgICAgICAgIHZhbHVlLmVycm9yID0gbnVsbDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3VjY2VlZGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChwcm9taXNlID09PSB2YWx1ZSkgewogICAgICAgICAgICAgICAgcmVqZWN0KHByb21pc2UsIGNhbm5vdFJldHVybk93bigpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFsdWUgPSBkZXRhaWw7CiAgICAgICAgICAgICAgc3VjY2VlZGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHByb21pc2UuX3N0YXRlICE9PSBQRU5ESU5HKSB7Ly8gbm9vcAogICAgICAgICAgICB9IGVsc2UgaWYgKGhhc0NhbGxiYWNrICYmIHN1Y2NlZWRlZCkgewogICAgICAgICAgICAgIHJlc29sdmUocHJvbWlzZSwgdmFsdWUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZhaWxlZCkgewogICAgICAgICAgICAgIHJlamVjdChwcm9taXNlLCBlcnJvcik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2V0dGxlZCA9PT0gRlVMRklMTEVEKSB7CiAgICAgICAgICAgICAgZnVsZmlsbChwcm9taXNlLCB2YWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2V0dGxlZCA9PT0gUkVKRUNURUQpIHsKICAgICAgICAgICAgICByZWplY3QocHJvbWlzZSwgdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGl6ZVByb21pc2UocHJvbWlzZSwgcmVzb2x2ZXIpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXNvbHZlcihmdW5jdGlvbiByZXNvbHZlUHJvbWlzZSh2YWx1ZSkgewogICAgICAgICAgICAgICAgcmVzb2x2ZShwcm9taXNlLCB2YWx1ZSk7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gcmVqZWN0UHJvbWlzZShyZWFzb24pIHsKICAgICAgICAgICAgICAgIHJlamVjdChwcm9taXNlLCByZWFzb24pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgcmVqZWN0KHByb21pc2UsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGlkID0gMDsKCiAgICAgICAgICBmdW5jdGlvbiBuZXh0SWQoKSB7CiAgICAgICAgICAgIHJldHVybiBpZCsrOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIG1ha2VQcm9taXNlKHByb21pc2UpIHsKICAgICAgICAgICAgcHJvbWlzZVtQUk9NSVNFX0lEXSA9IGlkKys7CiAgICAgICAgICAgIHByb21pc2UuX3N0YXRlID0gdW5kZWZpbmVkOwogICAgICAgICAgICBwcm9taXNlLl9yZXN1bHQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHByb21pc2UuX3N1YnNjcmliZXJzID0gW107CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gRW51bWVyYXRvciQxKENvbnN0cnVjdG9yLCBpbnB1dCkgewogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZUNvbnN0cnVjdG9yID0gQ29uc3RydWN0b3I7CiAgICAgICAgICAgIHRoaXMucHJvbWlzZSA9IG5ldyBDb25zdHJ1Y3Rvcihub29wKTsKCiAgICAgICAgICAgIGlmICghdGhpcy5wcm9taXNlW1BST01JU0VfSURdKSB7CiAgICAgICAgICAgICAgbWFrZVByb21pc2UodGhpcy5wcm9taXNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzQXJyYXkoaW5wdXQpKSB7CiAgICAgICAgICAgICAgdGhpcy5sZW5ndGggPSBpbnB1dC5sZW5ndGg7CiAgICAgICAgICAgICAgdGhpcy5fcmVtYWluaW5nID0gaW5wdXQubGVuZ3RoOwogICAgICAgICAgICAgIHRoaXMuX3Jlc3VsdCA9IG5ldyBBcnJheSh0aGlzLmxlbmd0aCk7CgogICAgICAgICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgZnVsZmlsbCh0aGlzLnByb21pc2UsIHRoaXMuX3Jlc3VsdCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5sZW5ndGggfHwgMDsKCiAgICAgICAgICAgICAgICB0aGlzLl9lbnVtZXJhdGUoaW5wdXQpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZW1haW5pbmcgPT09IDApIHsKICAgICAgICAgICAgICAgICAgZnVsZmlsbCh0aGlzLnByb21pc2UsIHRoaXMuX3Jlc3VsdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlamVjdCh0aGlzLnByb21pc2UsIHZhbGlkYXRpb25FcnJvcigpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRpb25FcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBFcnJvcignQXJyYXkgTWV0aG9kcyBtdXN0IGJlIHByb3ZpZGVkIGFuIEFycmF5Jyk7CiAgICAgICAgICB9CgogICAgICAgICAgRW51bWVyYXRvciQxLnByb3RvdHlwZS5fZW51bWVyYXRlID0gZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyB0aGlzLl9zdGF0ZSA9PT0gUEVORElORyAmJiBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICB0aGlzLl9lYWNoRW50cnkoaW5wdXRbaV0sIGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIEVudW1lcmF0b3IkMS5wcm90b3R5cGUuX2VhY2hFbnRyeSA9IGZ1bmN0aW9uIChlbnRyeSwgaSkgewogICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2luc3RhbmNlQ29uc3RydWN0b3I7CiAgICAgICAgICAgIHZhciByZXNvbHZlJCQxID0gYy5yZXNvbHZlOwoKICAgICAgICAgICAgaWYgKHJlc29sdmUkJDEgPT09IHJlc29sdmUkMSkgewogICAgICAgICAgICAgIHZhciBfdGhlbiA9IGdldFRoZW4oZW50cnkpOwoKICAgICAgICAgICAgICBpZiAoX3RoZW4gPT09IHRoZW4gJiYgZW50cnkuX3N0YXRlICE9PSBQRU5ESU5HKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9zZXR0bGVkQXQoZW50cnkuX3N0YXRlLCBpLCBlbnRyeS5fcmVzdWx0KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBfdGhlbiAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgdGhpcy5fcmVtYWluaW5nLS07CiAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bHRbaV0gPSBlbnRyeTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGMgPT09IFByb21pc2UkMikgewogICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgYyhub29wKTsKICAgICAgICAgICAgICAgIGhhbmRsZU1heWJlVGhlbmFibGUocHJvbWlzZSwgZW50cnksIF90aGVuKTsKCiAgICAgICAgICAgICAgICB0aGlzLl93aWxsU2V0dGxlQXQocHJvbWlzZSwgaSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX3dpbGxTZXR0bGVBdChuZXcgYyhmdW5jdGlvbiAocmVzb2x2ZSQkMSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSQkMShlbnRyeSk7CiAgICAgICAgICAgICAgICB9KSwgaSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuX3dpbGxTZXR0bGVBdChyZXNvbHZlJCQxKGVudHJ5KSwgaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgRW51bWVyYXRvciQxLnByb3RvdHlwZS5fc2V0dGxlZEF0ID0gZnVuY3Rpb24gKHN0YXRlLCBpLCB2YWx1ZSkgewogICAgICAgICAgICB2YXIgcHJvbWlzZSA9IHRoaXMucHJvbWlzZTsKCiAgICAgICAgICAgIGlmIChwcm9taXNlLl9zdGF0ZSA9PT0gUEVORElORykgewogICAgICAgICAgICAgIHRoaXMuX3JlbWFpbmluZy0tOwoKICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09IFJFSkVDVEVEKSB7CiAgICAgICAgICAgICAgICByZWplY3QocHJvbWlzZSwgdmFsdWUpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bHRbaV0gPSB2YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLl9yZW1haW5pbmcgPT09IDApIHsKICAgICAgICAgICAgICBmdWxmaWxsKHByb21pc2UsIHRoaXMuX3Jlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgRW51bWVyYXRvciQxLnByb3RvdHlwZS5fd2lsbFNldHRsZUF0ID0gZnVuY3Rpb24gKHByb21pc2UsIGkpIHsKICAgICAgICAgICAgdmFyIGVudW1lcmF0b3IgPSB0aGlzOwogICAgICAgICAgICBzdWJzY3JpYmUocHJvbWlzZSwgdW5kZWZpbmVkLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICByZXR1cm4gZW51bWVyYXRvci5fc2V0dGxlZEF0KEZVTEZJTExFRCwgaSwgdmFsdWUpOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGVudW1lcmF0b3IuX3NldHRsZWRBdChSRUpFQ1RFRCwgaSwgcmVhc29uKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgICAgLyoqCiAgICAgICAgICAgIGBQcm9taXNlLmFsbGAgYWNjZXB0cyBhbiBhcnJheSBvZiBwcm9taXNlcywgYW5kIHJldHVybnMgYSBuZXcgcHJvbWlzZSB3aGljaAogICAgICAgICAgICBpcyBmdWxmaWxsZWQgd2l0aCBhbiBhcnJheSBvZiBmdWxmaWxsbWVudCB2YWx1ZXMgZm9yIHRoZSBwYXNzZWQgcHJvbWlzZXMsIG9yCiAgICAgICAgICAgIHJlamVjdGVkIHdpdGggdGhlIHJlYXNvbiBvZiB0aGUgZmlyc3QgcGFzc2VkIHByb21pc2UgdG8gYmUgcmVqZWN0ZWQuIEl0IGNhc3RzIGFsbAogICAgICAgICAgICBlbGVtZW50cyBvZiB0aGUgcGFzc2VkIGl0ZXJhYmxlIHRvIHByb21pc2VzIGFzIGl0IHJ1bnMgdGhpcyBhbGdvcml0aG0uCiAgICAgICAgICAKICAgICAgICAgICAgRXhhbXBsZToKICAgICAgICAgIAogICAgICAgICAgICBgYGBqYXZhc2NyaXB0CiAgICAgICAgICAgIGxldCBwcm9taXNlMSA9IHJlc29sdmUoMSk7CiAgICAgICAgICAgIGxldCBwcm9taXNlMiA9IHJlc29sdmUoMik7CiAgICAgICAgICAgIGxldCBwcm9taXNlMyA9IHJlc29sdmUoMyk7CiAgICAgICAgICAgIGxldCBwcm9taXNlcyA9IFsgcHJvbWlzZTEsIHByb21pc2UyLCBwcm9taXNlMyBdOwogICAgICAgICAgCiAgICAgICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uKGFycmF5KXsKICAgICAgICAgICAgICAvLyBUaGUgYXJyYXkgaGVyZSB3b3VsZCBiZSBbIDEsIDIsIDMgXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGBgYAogICAgICAgICAgCiAgICAgICAgICAgIElmIGFueSBvZiB0aGUgYHByb21pc2VzYCBnaXZlbiB0byBgYWxsYCBhcmUgcmVqZWN0ZWQsIHRoZSBmaXJzdCBwcm9taXNlCiAgICAgICAgICAgIHRoYXQgaXMgcmVqZWN0ZWQgd2lsbCBiZSBnaXZlbiBhcyBhbiBhcmd1bWVudCB0byB0aGUgcmV0dXJuZWQgcHJvbWlzZXMncwogICAgICAgICAgICByZWplY3Rpb24gaGFuZGxlci4gRm9yIGV4YW1wbGU6CiAgICAgICAgICAKICAgICAgICAgICAgRXhhbXBsZToKICAgICAgICAgIAogICAgICAgICAgICBgYGBqYXZhc2NyaXB0CiAgICAgICAgICAgIGxldCBwcm9taXNlMSA9IHJlc29sdmUoMSk7CiAgICAgICAgICAgIGxldCBwcm9taXNlMiA9IHJlamVjdChuZXcgRXJyb3IoIjIiKSk7CiAgICAgICAgICAgIGxldCBwcm9taXNlMyA9IHJlamVjdChuZXcgRXJyb3IoIjMiKSk7CiAgICAgICAgICAgIGxldCBwcm9taXNlcyA9IFsgcHJvbWlzZTEsIHByb21pc2UyLCBwcm9taXNlMyBdOwogICAgICAgICAgCiAgICAgICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uKGFycmF5KXsKICAgICAgICAgICAgICAvLyBDb2RlIGhlcmUgbmV2ZXIgcnVucyBiZWNhdXNlIHRoZXJlIGFyZSByZWplY3RlZCBwcm9taXNlcyEKICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICAgICAgICAvLyBlcnJvci5tZXNzYWdlID09PSAiMiIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGBgYAogICAgICAgICAgCiAgICAgICAgICAgIEBtZXRob2QgYWxsCiAgICAgICAgICAgIEBzdGF0aWMKICAgICAgICAgICAgQHBhcmFtIHtBcnJheX0gZW50cmllcyBhcnJheSBvZiBwcm9taXNlcwogICAgICAgICAgICBAcGFyYW0ge1N0cmluZ30gbGFiZWwgb3B0aW9uYWwgc3RyaW5nIGZvciBsYWJlbGluZyB0aGUgcHJvbWlzZS4KICAgICAgICAgICAgVXNlZnVsIGZvciB0b29saW5nLgogICAgICAgICAgICBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlIHRoYXQgaXMgZnVsZmlsbGVkIHdoZW4gYWxsIGBwcm9taXNlc2AgaGF2ZSBiZWVuCiAgICAgICAgICAgIGZ1bGZpbGxlZCwgb3IgcmVqZWN0ZWQgaWYgYW55IG9mIHRoZW0gYmVjb21lIHJlamVjdGVkLgogICAgICAgICAgICBAc3RhdGljCiAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBhbGwkMShlbnRyaWVzKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRW51bWVyYXRvciQxKHRoaXMsIGVudHJpZXMpLnByb21pc2U7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAgYFByb21pc2UucmFjZWAgcmV0dXJucyBhIG5ldyBwcm9taXNlIHdoaWNoIGlzIHNldHRsZWQgaW4gdGhlIHNhbWUgd2F5IGFzIHRoZQogICAgICAgICAgICBmaXJzdCBwYXNzZWQgcHJvbWlzZSB0byBzZXR0bGUuCiAgICAgICAgICAKICAgICAgICAgICAgRXhhbXBsZToKICAgICAgICAgIAogICAgICAgICAgICBgYGBqYXZhc2NyaXB0CiAgICAgICAgICAgIGxldCBwcm9taXNlMSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7CiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmVzb2x2ZSgncHJvbWlzZSAxJyk7CiAgICAgICAgICAgICAgfSwgMjAwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAKICAgICAgICAgICAgbGV0IHByb21pc2UyID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICByZXNvbHZlKCdwcm9taXNlIDInKTsKICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICB9KTsKICAgICAgICAgIAogICAgICAgICAgICBQcm9taXNlLnJhY2UoW3Byb21pc2UxLCBwcm9taXNlMl0pLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXsKICAgICAgICAgICAgICAvLyByZXN1bHQgPT09ICdwcm9taXNlIDInIGJlY2F1c2UgaXQgd2FzIHJlc29sdmVkIGJlZm9yZSBwcm9taXNlMQogICAgICAgICAgICAgIC8vIHdhcyByZXNvbHZlZC4KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGBgYAogICAgICAgICAgCiAgICAgICAgICAgIGBQcm9taXNlLnJhY2VgIGlzIGRldGVybWluaXN0aWMgaW4gdGhhdCBvbmx5IHRoZSBzdGF0ZSBvZiB0aGUgZmlyc3QKICAgICAgICAgICAgc2V0dGxlZCBwcm9taXNlIG1hdHRlcnMuIEZvciBleGFtcGxlLCBldmVuIGlmIG90aGVyIHByb21pc2VzIGdpdmVuIHRvIHRoZQogICAgICAgICAgICBgcHJvbWlzZXNgIGFycmF5IGFyZ3VtZW50IGFyZSByZXNvbHZlZCwgYnV0IHRoZSBmaXJzdCBzZXR0bGVkIHByb21pc2UgaGFzCiAgICAgICAgICAgIGJlY29tZSByZWplY3RlZCBiZWZvcmUgdGhlIG90aGVyIHByb21pc2VzIGJlY2FtZSBmdWxmaWxsZWQsIHRoZSByZXR1cm5lZAogICAgICAgICAgICBwcm9taXNlIHdpbGwgYmVjb21lIHJlamVjdGVkOgogICAgICAgICAgCiAgICAgICAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgICAgICAgbGV0IHByb21pc2UxID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICByZXNvbHZlKCdwcm9taXNlIDEnKTsKICAgICAgICAgICAgICB9LCAyMDApOwogICAgICAgICAgICB9KTsKICAgICAgICAgIAogICAgICAgICAgICBsZXQgcHJvbWlzZTIgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpewogICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ3Byb21pc2UgMicpKTsKICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICB9KTsKICAgICAgICAgIAogICAgICAgICAgICBQcm9taXNlLnJhY2UoW3Byb21pc2UxLCBwcm9taXNlMl0pLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXsKICAgICAgICAgICAgICAvLyBDb2RlIGhlcmUgbmV2ZXIgcnVucwogICAgICAgICAgICB9LCBmdW5jdGlvbihyZWFzb24pewogICAgICAgICAgICAgIC8vIHJlYXNvbi5tZXNzYWdlID09PSAncHJvbWlzZSAyJyBiZWNhdXNlIHByb21pc2UgMiBiZWNhbWUgcmVqZWN0ZWQgYmVmb3JlCiAgICAgICAgICAgICAgLy8gcHJvbWlzZSAxIGJlY2FtZSBmdWxmaWxsZWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGBgYAogICAgICAgICAgCiAgICAgICAgICAgIEFuIGV4YW1wbGUgcmVhbC13b3JsZCB1c2UgY2FzZSBpcyBpbXBsZW1lbnRpbmcgdGltZW91dHM6CiAgICAgICAgICAKICAgICAgICAgICAgYGBgamF2YXNjcmlwdAogICAgICAgICAgICBQcm9taXNlLnJhY2UoW2FqYXgoJ2Zvby5qc29uJyksIHRpbWVvdXQoNTAwMCldKQogICAgICAgICAgICBgYGAKICAgICAgICAgIAogICAgICAgICAgICBAbWV0aG9kIHJhY2UKICAgICAgICAgICAgQHN0YXRpYwogICAgICAgICAgICBAcGFyYW0ge0FycmF5fSBwcm9taXNlcyBhcnJheSBvZiBwcm9taXNlcyB0byBvYnNlcnZlCiAgICAgICAgICAgIFVzZWZ1bCBmb3IgdG9vbGluZy4KICAgICAgICAgICAgQHJldHVybiB7UHJvbWlzZX0gYSBwcm9taXNlIHdoaWNoIHNldHRsZXMgaW4gdGhlIHNhbWUgd2F5IGFzIHRoZSBmaXJzdCBwYXNzZWQKICAgICAgICAgICAgcHJvbWlzZSB0byBzZXR0bGUuCiAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiByYWNlJDEoZW50cmllcykgewogICAgICAgICAgICAvKmpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqLwogICAgICAgICAgICB2YXIgQ29uc3RydWN0b3IgPSB0aGlzOwoKICAgICAgICAgICAgaWYgKCFpc0FycmF5KGVudHJpZXMpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDb25zdHJ1Y3RvcihmdW5jdGlvbiAoXywgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBUeXBlRXJyb3IoJ1lvdSBtdXN0IHBhc3MgYW4gYXJyYXkgdG8gcmFjZS4nKSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDb25zdHJ1Y3RvcihmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICB2YXIgbGVuZ3RoID0gZW50cmllcy5sZW5ndGg7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICBDb25zdHJ1Y3Rvci5yZXNvbHZlKGVudHJpZXNbaV0pLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgIGBQcm9taXNlLnJlamVjdGAgcmV0dXJucyBhIHByb21pc2UgcmVqZWN0ZWQgd2l0aCB0aGUgcGFzc2VkIGByZWFzb25gLgogICAgICAgICAgICBJdCBpcyBzaG9ydGhhbmQgZm9yIHRoZSBmb2xsb3dpbmc6CiAgICAgICAgICAKICAgICAgICAgICAgYGBgamF2YXNjcmlwdAogICAgICAgICAgICBsZXQgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7CiAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignV0hPT1BTJykpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIAogICAgICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24odmFsdWUpewogICAgICAgICAgICAgIC8vIENvZGUgaGVyZSBkb2Vzbid0IHJ1biBiZWNhdXNlIHRoZSBwcm9taXNlIGlzIHJlamVjdGVkIQogICAgICAgICAgICB9LCBmdW5jdGlvbihyZWFzb24pewogICAgICAgICAgICAgIC8vIHJlYXNvbi5tZXNzYWdlID09PSAnV0hPT1BTJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYGBgCiAgICAgICAgICAKICAgICAgICAgICAgSW5zdGVhZCBvZiB3cml0aW5nIHRoZSBhYm92ZSwgeW91ciBjb2RlIG5vdyBzaW1wbHkgYmVjb21lcyB0aGUgZm9sbG93aW5nOgogICAgICAgICAgCiAgICAgICAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgICAgICAgbGV0IHByb21pc2UgPSBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ1dIT09QUycpKTsKICAgICAgICAgIAogICAgICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24odmFsdWUpewogICAgICAgICAgICAgIC8vIENvZGUgaGVyZSBkb2Vzbid0IHJ1biBiZWNhdXNlIHRoZSBwcm9taXNlIGlzIHJlamVjdGVkIQogICAgICAgICAgICB9LCBmdW5jdGlvbihyZWFzb24pewogICAgICAgICAgICAgIC8vIHJlYXNvbi5tZXNzYWdlID09PSAnV0hPT1BTJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYGBgCiAgICAgICAgICAKICAgICAgICAgICAgQG1ldGhvZCByZWplY3QKICAgICAgICAgICAgQHN0YXRpYwogICAgICAgICAgICBAcGFyYW0ge0FueX0gcmVhc29uIHZhbHVlIHRoYXQgdGhlIHJldHVybmVkIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZCB3aXRoLgogICAgICAgICAgICBVc2VmdWwgZm9yIHRvb2xpbmcuCiAgICAgICAgICAgIEByZXR1cm4ge1Byb21pc2V9IGEgcHJvbWlzZSByZWplY3RlZCB3aXRoIHRoZSBnaXZlbiBgcmVhc29uYC4KICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIHJlamVjdCQxKHJlYXNvbikgewogICAgICAgICAgICAvKmpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqLwogICAgICAgICAgICB2YXIgQ29uc3RydWN0b3IgPSB0aGlzOwogICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBDb25zdHJ1Y3Rvcihub29wKTsKICAgICAgICAgICAgcmVqZWN0KHByb21pc2UsIHJlYXNvbik7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIG5lZWRzUmVzb2x2ZXIoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1lvdSBtdXN0IHBhc3MgYSByZXNvbHZlciBmdW5jdGlvbiBhcyB0aGUgZmlyc3QgYXJndW1lbnQgdG8gdGhlIHByb21pc2UgY29uc3RydWN0b3InKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBuZWVkc05ldygpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiRmFpbGVkIHRvIGNvbnN0cnVjdCAnUHJvbWlzZSc6IFBsZWFzZSB1c2UgdGhlICduZXcnIG9wZXJhdG9yLCB0aGlzIG9iamVjdCBjb25zdHJ1Y3RvciBjYW5ub3QgYmUgY2FsbGVkIGFzIGEgZnVuY3Rpb24uIik7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAgUHJvbWlzZSBvYmplY3RzIHJlcHJlc2VudCB0aGUgZXZlbnR1YWwgcmVzdWx0IG9mIGFuIGFzeW5jaHJvbm91cyBvcGVyYXRpb24uIFRoZQogICAgICAgICAgICBwcmltYXJ5IHdheSBvZiBpbnRlcmFjdGluZyB3aXRoIGEgcHJvbWlzZSBpcyB0aHJvdWdoIGl0cyBgdGhlbmAgbWV0aG9kLCB3aGljaAogICAgICAgICAgICByZWdpc3RlcnMgY2FsbGJhY2tzIHRvIHJlY2VpdmUgZWl0aGVyIGEgcHJvbWlzZSdzIGV2ZW50dWFsIHZhbHVlIG9yIHRoZSByZWFzb24KICAgICAgICAgICAgd2h5IHRoZSBwcm9taXNlIGNhbm5vdCBiZSBmdWxmaWxsZWQuCiAgICAgICAgICAKICAgICAgICAgICAgVGVybWlub2xvZ3kKICAgICAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICAgIAogICAgICAgICAgICAtIGBwcm9taXNlYCBpcyBhbiBvYmplY3Qgb3IgZnVuY3Rpb24gd2l0aCBhIGB0aGVuYCBtZXRob2Qgd2hvc2UgYmVoYXZpb3IgY29uZm9ybXMgdG8gdGhpcyBzcGVjaWZpY2F0aW9uLgogICAgICAgICAgICAtIGB0aGVuYWJsZWAgaXMgYW4gb2JqZWN0IG9yIGZ1bmN0aW9uIHRoYXQgZGVmaW5lcyBhIGB0aGVuYCBtZXRob2QuCiAgICAgICAgICAgIC0gYHZhbHVlYCBpcyBhbnkgbGVnYWwgSmF2YVNjcmlwdCB2YWx1ZSAoaW5jbHVkaW5nIHVuZGVmaW5lZCwgYSB0aGVuYWJsZSwgb3IgYSBwcm9taXNlKS4KICAgICAgICAgICAgLSBgZXhjZXB0aW9uYCBpcyBhIHZhbHVlIHRoYXQgaXMgdGhyb3duIHVzaW5nIHRoZSB0aHJvdyBzdGF0ZW1lbnQuCiAgICAgICAgICAgIC0gYHJlYXNvbmAgaXMgYSB2YWx1ZSB0aGF0IGluZGljYXRlcyB3aHkgYSBwcm9taXNlIHdhcyByZWplY3RlZC4KICAgICAgICAgICAgLSBgc2V0dGxlZGAgdGhlIGZpbmFsIHJlc3Rpbmcgc3RhdGUgb2YgYSBwcm9taXNlLCBmdWxmaWxsZWQgb3IgcmVqZWN0ZWQuCiAgICAgICAgICAKICAgICAgICAgICAgQSBwcm9taXNlIGNhbiBiZSBpbiBvbmUgb2YgdGhyZWUgc3RhdGVzOiBwZW5kaW5nLCBmdWxmaWxsZWQsIG9yIHJlamVjdGVkLgogICAgICAgICAgCiAgICAgICAgICAgIFByb21pc2VzIHRoYXQgYXJlIGZ1bGZpbGxlZCBoYXZlIGEgZnVsZmlsbG1lbnQgdmFsdWUgYW5kIGFyZSBpbiB0aGUgZnVsZmlsbGVkCiAgICAgICAgICAgIHN0YXRlLiAgUHJvbWlzZXMgdGhhdCBhcmUgcmVqZWN0ZWQgaGF2ZSBhIHJlamVjdGlvbiByZWFzb24gYW5kIGFyZSBpbiB0aGUKICAgICAgICAgICAgcmVqZWN0ZWQgc3RhdGUuICBBIGZ1bGZpbGxtZW50IHZhbHVlIGlzIG5ldmVyIGEgdGhlbmFibGUuCiAgICAgICAgICAKICAgICAgICAgICAgUHJvbWlzZXMgY2FuIGFsc28gYmUgc2FpZCB0byAqcmVzb2x2ZSogYSB2YWx1ZS4gIElmIHRoaXMgdmFsdWUgaXMgYWxzbyBhCiAgICAgICAgICAgIHByb21pc2UsIHRoZW4gdGhlIG9yaWdpbmFsIHByb21pc2UncyBzZXR0bGVkIHN0YXRlIHdpbGwgbWF0Y2ggdGhlIHZhbHVlJ3MKICAgICAgICAgICAgc2V0dGxlZCBzdGF0ZS4gIFNvIGEgcHJvbWlzZSB0aGF0ICpyZXNvbHZlcyogYSBwcm9taXNlIHRoYXQgcmVqZWN0cyB3aWxsCiAgICAgICAgICAgIGl0c2VsZiByZWplY3QsIGFuZCBhIHByb21pc2UgdGhhdCAqcmVzb2x2ZXMqIGEgcHJvbWlzZSB0aGF0IGZ1bGZpbGxzIHdpbGwKICAgICAgICAgICAgaXRzZWxmIGZ1bGZpbGwuCiAgICAgICAgICAKICAgICAgICAgIAogICAgICAgICAgICBCYXNpYyBVc2FnZToKICAgICAgICAgICAgLS0tLS0tLS0tLS0tCiAgICAgICAgICAKICAgICAgICAgICAgYGBganMKICAgICAgICAgICAgbGV0IHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAvLyBvbiBzdWNjZXNzCiAgICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICAgICAgICAKICAgICAgICAgICAgICAvLyBvbiBmYWlsdXJlCiAgICAgICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgCiAgICAgICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgIC8vIG9uIGZ1bGZpbGxtZW50CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlYXNvbikgewogICAgICAgICAgICAgIC8vIG9uIHJlamVjdGlvbgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYGBgCiAgICAgICAgICAKICAgICAgICAgICAgQWR2YW5jZWQgVXNhZ2U6CiAgICAgICAgICAgIC0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgCiAgICAgICAgICAgIFByb21pc2VzIHNoaW5lIHdoZW4gYWJzdHJhY3RpbmcgYXdheSBhc3luY2hyb25vdXMgaW50ZXJhY3Rpb25zIHN1Y2ggYXMKICAgICAgICAgICAgYFhNTEh0dHBSZXF1ZXN0YHMuCiAgICAgICAgICAKICAgICAgICAgICAgYGBganMKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0SlNPTih1cmwpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXsKICAgICAgICAgICAgICAgIGxldCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgIAogICAgICAgICAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCk7CiAgICAgICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gaGFuZGxlcjsKICAgICAgICAgICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAnanNvbic7CiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICAgICAgICAgIHhoci5zZW5kKCk7CiAgICAgICAgICAKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoKSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT09IHRoaXMuRE9ORSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRoaXMucmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdnZXRKU09OOiBgJyArIHVybCArICdgIGZhaWxlZCB3aXRoIHN0YXR1czogWycgKyB0aGlzLnN0YXR1cyArICddJykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgCiAgICAgICAgICAgIGdldEpTT04oJy9wb3N0cy5qc29uJykudGhlbihmdW5jdGlvbihqc29uKSB7CiAgICAgICAgICAgICAgLy8gb24gZnVsZmlsbG1lbnQKICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVhc29uKSB7CiAgICAgICAgICAgICAgLy8gb24gcmVqZWN0aW9uCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBgYGAKICAgICAgICAgIAogICAgICAgICAgICBVbmxpa2UgY2FsbGJhY2tzLCBwcm9taXNlcyBhcmUgZ3JlYXQgY29tcG9zYWJsZSBwcmltaXRpdmVzLgogICAgICAgICAgCiAgICAgICAgICAgIGBgYGpzCiAgICAgICAgICAgIFByb21pc2UuYWxsKFsKICAgICAgICAgICAgICBnZXRKU09OKCcvcG9zdHMnKSwKICAgICAgICAgICAgICBnZXRKU09OKCcvY29tbWVudHMnKQogICAgICAgICAgICBdKS50aGVuKGZ1bmN0aW9uKHZhbHVlcyl7CiAgICAgICAgICAgICAgdmFsdWVzWzBdIC8vID0+IHBvc3RzSlNPTgogICAgICAgICAgICAgIHZhbHVlc1sxXSAvLyA9PiBjb21tZW50c0pTT04KICAgICAgICAgIAogICAgICAgICAgICAgIHJldHVybiB2YWx1ZXM7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBgYGAKICAgICAgICAgIAogICAgICAgICAgICBAY2xhc3MgUHJvbWlzZQogICAgICAgICAgICBAcGFyYW0ge2Z1bmN0aW9ufSByZXNvbHZlcgogICAgICAgICAgICBVc2VmdWwgZm9yIHRvb2xpbmcuCiAgICAgICAgICAgIEBjb25zdHJ1Y3RvcgogICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gUHJvbWlzZSQyKHJlc29sdmVyKSB7CiAgICAgICAgICAgIHRoaXNbUFJPTUlTRV9JRF0gPSBuZXh0SWQoKTsKICAgICAgICAgICAgdGhpcy5fcmVzdWx0ID0gdGhpcy5fc3RhdGUgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHRoaXMuX3N1YnNjcmliZXJzID0gW107CgogICAgICAgICAgICBpZiAobm9vcCAhPT0gcmVzb2x2ZXIpIHsKICAgICAgICAgICAgICB0eXBlb2YgcmVzb2x2ZXIgIT09ICdmdW5jdGlvbicgJiYgbmVlZHNSZXNvbHZlcigpOwogICAgICAgICAgICAgIHRoaXMgaW5zdGFuY2VvZiBQcm9taXNlJDIgPyBpbml0aWFsaXplUHJvbWlzZSh0aGlzLCByZXNvbHZlcikgOiBuZWVkc05ldygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgUHJvbWlzZSQyLmFsbCA9IGFsbCQxOwogICAgICAgICAgUHJvbWlzZSQyLnJhY2UgPSByYWNlJDE7CiAgICAgICAgICBQcm9taXNlJDIucmVzb2x2ZSA9IHJlc29sdmUkMTsKICAgICAgICAgIFByb21pc2UkMi5yZWplY3QgPSByZWplY3QkMTsKICAgICAgICAgIFByb21pc2UkMi5fc2V0U2NoZWR1bGVyID0gc2V0U2NoZWR1bGVyOwogICAgICAgICAgUHJvbWlzZSQyLl9zZXRBc2FwID0gc2V0QXNhcDsKICAgICAgICAgIFByb21pc2UkMi5fYXNhcCA9IGFzYXA7CiAgICAgICAgICBQcm9taXNlJDIucHJvdG90eXBlID0gewogICAgICAgICAgICBjb25zdHJ1Y3RvcjogUHJvbWlzZSQyLAoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgVGhlIHByaW1hcnkgd2F5IG9mIGludGVyYWN0aW5nIHdpdGggYSBwcm9taXNlIGlzIHRocm91Z2ggaXRzIGB0aGVuYCBtZXRob2QsCiAgICAgICAgICAgICAgd2hpY2ggcmVnaXN0ZXJzIGNhbGxiYWNrcyB0byByZWNlaXZlIGVpdGhlciBhIHByb21pc2UncyBldmVudHVhbCB2YWx1ZSBvciB0aGUKICAgICAgICAgICAgICByZWFzb24gd2h5IHRoZSBwcm9taXNlIGNhbm5vdCBiZSBmdWxmaWxsZWQuCiAgICAgICAgICAgIAogICAgICAgICAgICAgIGBgYGpzCiAgICAgICAgICAgICAgZmluZFVzZXIoKS50aGVuKGZ1bmN0aW9uKHVzZXIpewogICAgICAgICAgICAgICAgLy8gdXNlciBpcyBhdmFpbGFibGUKICAgICAgICAgICAgICB9LCBmdW5jdGlvbihyZWFzb24pewogICAgICAgICAgICAgICAgLy8gdXNlciBpcyB1bmF2YWlsYWJsZSwgYW5kIHlvdSBhcmUgZ2l2ZW4gdGhlIHJlYXNvbiB3aHkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBgYGAKICAgICAgICAgICAgCiAgICAgICAgICAgICAgQ2hhaW5pbmcKICAgICAgICAgICAgICAtLS0tLS0tLQogICAgICAgICAgICAKICAgICAgICAgICAgICBUaGUgcmV0dXJuIHZhbHVlIG9mIGB0aGVuYCBpcyBpdHNlbGYgYSBwcm9taXNlLiAgVGhpcyBzZWNvbmQsICdkb3duc3RyZWFtJwogICAgICAgICAgICAgIHByb21pc2UgaXMgcmVzb2x2ZWQgd2l0aCB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBmaXJzdCBwcm9taXNlJ3MgZnVsZmlsbG1lbnQKICAgICAgICAgICAgICBvciByZWplY3Rpb24gaGFuZGxlciwgb3IgcmVqZWN0ZWQgaWYgdGhlIGhhbmRsZXIgdGhyb3dzIGFuIGV4Y2VwdGlvbi4KICAgICAgICAgICAgCiAgICAgICAgICAgICAgYGBganMKICAgICAgICAgICAgICBmaW5kVXNlcigpLnRoZW4oZnVuY3Rpb24gKHVzZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1c2VyLm5hbWU7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgcmV0dXJuICdkZWZhdWx0IG5hbWUnOwogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHVzZXJOYW1lKSB7CiAgICAgICAgICAgICAgICAvLyBJZiBgZmluZFVzZXJgIGZ1bGZpbGxlZCwgYHVzZXJOYW1lYCB3aWxsIGJlIHRoZSB1c2VyJ3MgbmFtZSwgb3RoZXJ3aXNlIGl0CiAgICAgICAgICAgICAgICAvLyB3aWxsIGJlIGAnZGVmYXVsdCBuYW1lJ2AKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgICAgZmluZFVzZXIoKS50aGVuKGZ1bmN0aW9uICh1c2VyKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZvdW5kIHVzZXIsIGJ1dCBzdGlsbCB1bmhhcHB5Jyk7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdgZmluZFVzZXJgIHJlamVjdGVkIGFuZCB3ZSdyZSB1bmhhcHB5Jyk7CiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgIC8vIG5ldmVyIHJlYWNoZWQKICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBgZmluZFVzZXJgIGZ1bGZpbGxlZCwgYHJlYXNvbmAgd2lsbCBiZSAnRm91bmQgdXNlciwgYnV0IHN0aWxsIHVuaGFwcHknLgogICAgICAgICAgICAgICAgLy8gSWYgYGZpbmRVc2VyYCByZWplY3RlZCwgYHJlYXNvbmAgd2lsbCBiZSAnYGZpbmRVc2VyYCByZWplY3RlZCBhbmQgd2UncmUgdW5oYXBweScuCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYGBgCiAgICAgICAgICAgICAgSWYgdGhlIGRvd25zdHJlYW0gcHJvbWlzZSBkb2VzIG5vdCBzcGVjaWZ5IGEgcmVqZWN0aW9uIGhhbmRsZXIsIHJlamVjdGlvbiByZWFzb25zIHdpbGwgYmUgcHJvcGFnYXRlZCBmdXJ0aGVyIGRvd25zdHJlYW0uCiAgICAgICAgICAgIAogICAgICAgICAgICAgIGBgYGpzCiAgICAgICAgICAgICAgZmluZFVzZXIoKS50aGVuKGZ1bmN0aW9uICh1c2VyKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUGVkYWdvZ2ljYWxFeGNlcHRpb24oJ1Vwc3RyZWFtIGVycm9yJyk7CiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgIC8vIG5ldmVyIHJlYWNoZWQKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICAgICAgLy8gbmV2ZXIgcmVhY2hlZAogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICAgIC8vIFRoZSBgUGVkZ2Fnb2NpYWxFeGNlcHRpb25gIGlzIHByb3BhZ2F0ZWQgYWxsIHRoZSB3YXkgZG93biB0byBoZXJlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYGBgCiAgICAgICAgICAgIAogICAgICAgICAgICAgIEFzc2ltaWxhdGlvbgogICAgICAgICAgICAgIC0tLS0tLS0tLS0tLQogICAgICAgICAgICAKICAgICAgICAgICAgICBTb21ldGltZXMgdGhlIHZhbHVlIHlvdSB3YW50IHRvIHByb3BhZ2F0ZSB0byBhIGRvd25zdHJlYW0gcHJvbWlzZSBjYW4gb25seSBiZQogICAgICAgICAgICAgIHJldHJpZXZlZCBhc3luY2hyb25vdXNseS4gVGhpcyBjYW4gYmUgYWNoaWV2ZWQgYnkgcmV0dXJuaW5nIGEgcHJvbWlzZSBpbiB0aGUKICAgICAgICAgICAgICBmdWxmaWxsbWVudCBvciByZWplY3Rpb24gaGFuZGxlci4gVGhlIGRvd25zdHJlYW0gcHJvbWlzZSB3aWxsIHRoZW4gYmUgcGVuZGluZwogICAgICAgICAgICAgIHVudGlsIHRoZSByZXR1cm5lZCBwcm9taXNlIGlzIHNldHRsZWQuIFRoaXMgaXMgY2FsbGVkICphc3NpbWlsYXRpb24qLgogICAgICAgICAgICAKICAgICAgICAgICAgICBgYGBqcwogICAgICAgICAgICAgIGZpbmRVc2VyKCkudGhlbihmdW5jdGlvbiAodXNlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIGZpbmRDb21tZW50c0J5QXV0aG9yKHVzZXIpOwogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGNvbW1lbnRzKSB7CiAgICAgICAgICAgICAgICAvLyBUaGUgdXNlcidzIGNvbW1lbnRzIGFyZSBub3cgYXZhaWxhYmxlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYGBgCiAgICAgICAgICAgIAogICAgICAgICAgICAgIElmIHRoZSBhc3NpbWxpYXRlZCBwcm9taXNlIHJlamVjdHMsIHRoZW4gdGhlIGRvd25zdHJlYW0gcHJvbWlzZSB3aWxsIGFsc28gcmVqZWN0LgogICAgICAgICAgICAKICAgICAgICAgICAgICBgYGBqcwogICAgICAgICAgICAgIGZpbmRVc2VyKCkudGhlbihmdW5jdGlvbiAodXNlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIGZpbmRDb21tZW50c0J5QXV0aG9yKHVzZXIpOwogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGNvbW1lbnRzKSB7CiAgICAgICAgICAgICAgICAvLyBJZiBgZmluZENvbW1lbnRzQnlBdXRob3JgIGZ1bGZpbGxzLCB3ZSdsbCBoYXZlIHRoZSB2YWx1ZSBoZXJlCiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgLy8gSWYgYGZpbmRDb21tZW50c0J5QXV0aG9yYCByZWplY3RzLCB3ZSdsbCBoYXZlIHRoZSByZWFzb24gaGVyZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGBgYAogICAgICAgICAgICAKICAgICAgICAgICAgICBTaW1wbGUgRXhhbXBsZQogICAgICAgICAgICAgIC0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgIAogICAgICAgICAgICAgIFN5bmNocm9ub3VzIEV4YW1wbGUKICAgICAgICAgICAgCiAgICAgICAgICAgICAgYGBgamF2YXNjcmlwdAogICAgICAgICAgICAgIGxldCByZXN1bHQ7CiAgICAgICAgICAgIAogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmaW5kUmVzdWx0KCk7CiAgICAgICAgICAgICAgICAvLyBzdWNjZXNzCiAgICAgICAgICAgICAgfSBjYXRjaChyZWFzb24pIHsKICAgICAgICAgICAgICAgIC8vIGZhaWx1cmUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYGBgCiAgICAgICAgICAgIAogICAgICAgICAgICAgIEVycmJhY2sgRXhhbXBsZQogICAgICAgICAgICAKICAgICAgICAgICAgICBgYGBqcwogICAgICAgICAgICAgIGZpbmRSZXN1bHQoZnVuY3Rpb24ocmVzdWx0LCBlcnIpewogICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICAvLyBmYWlsdXJlCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAvLyBzdWNjZXNzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYGBgCiAgICAgICAgICAgIAogICAgICAgICAgICAgIFByb21pc2UgRXhhbXBsZTsKICAgICAgICAgICAgCiAgICAgICAgICAgICAgYGBgamF2YXNjcmlwdAogICAgICAgICAgICAgIGZpbmRSZXN1bHQoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7CiAgICAgICAgICAgICAgICAvLyBzdWNjZXNzCiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVhc29uKXsKICAgICAgICAgICAgICAgIC8vIGZhaWx1cmUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBgYGAKICAgICAgICAgICAgCiAgICAgICAgICAgICAgQWR2YW5jZWQgRXhhbXBsZQogICAgICAgICAgICAgIC0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgIAogICAgICAgICAgICAgIFN5bmNocm9ub3VzIEV4YW1wbGUKICAgICAgICAgICAgCiAgICAgICAgICAgICAgYGBgamF2YXNjcmlwdAogICAgICAgICAgICAgIGxldCBhdXRob3IsIGJvb2tzOwogICAgICAgICAgICAKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXV0aG9yID0gZmluZEF1dGhvcigpOwogICAgICAgICAgICAgICAgYm9va3MgID0gZmluZEJvb2tzQnlBdXRob3IoYXV0aG9yKTsKICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3MKICAgICAgICAgICAgICB9IGNhdGNoKHJlYXNvbikgewogICAgICAgICAgICAgICAgLy8gZmFpbHVyZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBgYGAKICAgICAgICAgICAgCiAgICAgICAgICAgICAgRXJyYmFjayBFeGFtcGxlCiAgICAgICAgICAgIAogICAgICAgICAgICAgIGBgYGpzCiAgICAgICAgICAgIAogICAgICAgICAgICAgIGZ1bmN0aW9uIGZvdW5kQm9va3MoYm9va3MpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgICBmdW5jdGlvbiBmYWlsdXJlKHJlYXNvbikgewogICAgICAgICAgICAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAgIGZpbmRBdXRob3IoZnVuY3Rpb24oYXV0aG9yLCBlcnIpewogICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICBmYWlsdXJlKGVycik7CiAgICAgICAgICAgICAgICAgIC8vIGZhaWx1cmUKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZmluZEJvb29rc0J5QXV0aG9yKGF1dGhvciwgZnVuY3Rpb24oYm9va3MsIGVycikgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlKGVycik7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kQm9va3MoYm9va3MpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoKHJlYXNvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmUocmVhc29uKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGNhdGNoKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgZmFpbHVyZShlcnIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3MKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBgYGAKICAgICAgICAgICAgCiAgICAgICAgICAgICAgUHJvbWlzZSBFeGFtcGxlOwogICAgICAgICAgICAKICAgICAgICAgICAgICBgYGBqYXZhc2NyaXB0CiAgICAgICAgICAgICAgZmluZEF1dGhvcigpLgogICAgICAgICAgICAgICAgdGhlbihmaW5kQm9va3NCeUF1dGhvcikuCiAgICAgICAgICAgICAgICB0aGVuKGZ1bmN0aW9uKGJvb2tzKXsKICAgICAgICAgICAgICAgICAgLy8gZm91bmQgYm9va3MKICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihyZWFzb24pewogICAgICAgICAgICAgICAgLy8gc29tZXRoaW5nIHdlbnQgd3JvbmcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBgYGAKICAgICAgICAgICAgCiAgICAgICAgICAgICAgQG1ldGhvZCB0aGVuCiAgICAgICAgICAgICAgQHBhcmFtIHtGdW5jdGlvbn0gb25GdWxmaWxsZWQKICAgICAgICAgICAgICBAcGFyYW0ge0Z1bmN0aW9ufSBvblJlamVjdGVkCiAgICAgICAgICAgICAgVXNlZnVsIGZvciB0b29saW5nLgogICAgICAgICAgICAgIEByZXR1cm4ge1Byb21pc2V9CiAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoZW46IHRoZW4sCgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICBgY2F0Y2hgIGlzIHNpbXBseSBzdWdhciBmb3IgYHRoZW4odW5kZWZpbmVkLCBvblJlamVjdGlvbilgIHdoaWNoIG1ha2VzIGl0IHRoZSBzYW1lCiAgICAgICAgICAgICAgYXMgdGhlIGNhdGNoIGJsb2NrIG9mIGEgdHJ5L2NhdGNoIHN0YXRlbWVudC4KICAgICAgICAgICAgCiAgICAgICAgICAgICAgYGBganMKICAgICAgICAgICAgICBmdW5jdGlvbiBmaW5kQXV0aG9yKCl7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvdWxkbid0IGZpbmQgdGhhdCBhdXRob3InKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAgIC8vIHN5bmNocm9ub3VzCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZpbmRBdXRob3IoKTsKICAgICAgICAgICAgICB9IGNhdGNoKHJlYXNvbikgewogICAgICAgICAgICAgICAgLy8gc29tZXRoaW5nIHdlbnQgd3JvbmcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAgIC8vIGFzeW5jIHdpdGggcHJvbWlzZXMKICAgICAgICAgICAgICBmaW5kQXV0aG9yKCkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKXsKICAgICAgICAgICAgICAgIC8vIHNvbWV0aGluZyB3ZW50IHdyb25nCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYGBgCiAgICAgICAgICAgIAogICAgICAgICAgICAgIEBtZXRob2QgY2F0Y2gKICAgICAgICAgICAgICBAcGFyYW0ge0Z1bmN0aW9ufSBvblJlamVjdGlvbgogICAgICAgICAgICAgIFVzZWZ1bCBmb3IgdG9vbGluZy4KICAgICAgICAgICAgICBAcmV0dXJuIHtQcm9taXNlfQogICAgICAgICAgICAqLwogICAgICAgICAgICAnY2F0Y2gnOiBmdW5jdGlvbiBfY2F0Y2gob25SZWplY3Rpb24pIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKG51bGwsIG9uUmVqZWN0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIC8qZ2xvYmFsIHNlbGYqLwoKICAgICAgICAgIGZ1bmN0aW9uIHBvbHlmaWxsJDEoKSB7CiAgICAgICAgICAgIHZhciBsb2NhbCA9IHVuZGVmaW5lZDsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgIGxvY2FsID0gZ2xvYmFsOwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgIGxvY2FsID0gc2VsZjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbG9jYWwgPSBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncG9seWZpbGwgZmFpbGVkIGJlY2F1c2UgZ2xvYmFsIG9iamVjdCBpcyB1bmF2YWlsYWJsZSBpbiB0aGlzIGVudmlyb25tZW50Jyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgUCA9IGxvY2FsLlByb21pc2U7CgogICAgICAgICAgICBpZiAoUCkgewogICAgICAgICAgICAgIHZhciBwcm9taXNlVG9TdHJpbmcgPSBudWxsOwoKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcHJvbWlzZVRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKFAucmVzb2x2ZSgpKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7Ly8gc2lsZW50bHkgaWdub3JlZAogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHByb21pc2VUb1N0cmluZyA9PT0gJ1tvYmplY3QgUHJvbWlzZV0nICYmICFQLmNhc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsLlByb21pc2UgPSBQcm9taXNlJDI7CiAgICAgICAgICB9IC8vIFN0cmFuZ2UgY29tcGF0Li4KCgogICAgICAgICAgUHJvbWlzZSQyLnBvbHlmaWxsID0gcG9seWZpbGwkMTsKICAgICAgICAgIFByb21pc2UkMi5Qcm9taXNlID0gUHJvbWlzZSQyOwogICAgICAgICAgcmV0dXJuIFByb21pc2UkMjsKICAgICAgICB9KTsKICAgICAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8KCiAgICAgIH0pLmNhbGwoZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyg5KSwgX193ZWJwYWNrX3JlcXVpcmVfXyg5NikpOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDk2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgdmFyIGc7IC8vIFRoaXMgd29ya3MgaW4gbm9uLXN0cmljdCBtb2RlCgogICAgICBnID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9KCk7CgogICAgICB0cnkgewogICAgICAgIC8vIFRoaXMgd29ya3MgaWYgZXZhbCBpcyBhbGxvd2VkIChzZWUgQ1NQKQogICAgICAgIGcgPSBnIHx8IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCkgfHwgKDEsIGV2YWwpKCJ0aGlzIik7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBUaGlzIHdvcmtzIGlmIHRoZSB3aW5kb3cgcmVmZXJlbmNlIGlzIGF2YWlsYWJsZQogICAgICAgIGlmICgodHlwZW9mIHdpbmRvdyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2Y0KHdpbmRvdykpID09PSAib2JqZWN0IikgZyA9IHdpbmRvdzsKICAgICAgfSAvLyBnIGNhbiBzdGlsbCBiZSB1bmRlZmluZWQsIGJ1dCBub3RoaW5nIHRvIGRvIGFib3V0IGl0Li4uCiAgICAgIC8vIFdlIHJldHVybiB1bmRlZmluZWQsIGluc3RlYWQgb2Ygbm90aGluZyBoZXJlLCBzbyBpdCdzCiAgICAgIC8vIGVhc2llciB0byBoYW5kbGUgdGhpcyBjYXNlLiBpZighZ2xvYmFsKSB7IC4uLn0KCgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGc7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogOTcgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICAvKiAoaWdub3JlZCkgKi8KCiAgICAgIC8qKiovCiAgICB9LAogICAgLyogOTggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgX3Byb21pc2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk5KTsKCiAgICAgIHZhciBfcHJvbWlzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9wcm9taXNlKTsKCiAgICAgIHZhciBfYXNzaWduID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMTkpOwoKICAgICAgdmFyIF9hc3NpZ24yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfYXNzaWduKTsKCiAgICAgIHZhciBfZ2V0UHJvdG90eXBlT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY0KTsKCiAgICAgIHZhciBfZ2V0UHJvdG90eXBlT2YyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZ2V0UHJvdG90eXBlT2YpOwoKICAgICAgdmFyIF9jbGFzc0NhbGxDaGVjazIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5KTsKCiAgICAgIHZhciBfY2xhc3NDYWxsQ2hlY2szID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY2xhc3NDYWxsQ2hlY2syKTsKCiAgICAgIHZhciBfY3JlYXRlQ2xhc3MyID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMCk7CgogICAgICB2YXIgX2NyZWF0ZUNsYXNzMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NyZWF0ZUNsYXNzMik7CgogICAgICB2YXIgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4yID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Nik7CgogICAgICB2YXIgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4zID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybjIpOwoKICAgICAgdmFyIF9pbmhlcml0czIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcwKTsKCiAgICAgIHZhciBfaW5oZXJpdHMzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaW5oZXJpdHMyKTsKCiAgICAgIHZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKICAgICAgdmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7CgogICAgICB2YXIgX3JlYWN0RmxpcE1vdmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE0Myk7CgogICAgICB2YXIgX3JlYWN0RmxpcE1vdmUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3RGbGlwTW92ZSk7CgogICAgICB2YXIgX2F1dG9zaXplID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNTApOwoKICAgICAgdmFyIF9hdXRvc2l6ZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9hdXRvc2l6ZSk7CgogICAgICB2YXIgX2kxOG4gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MSk7CgogICAgICB2YXIgX2kxOG4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaTE4bik7CgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2MCk7CgogICAgICB2YXIgX3V0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcxKTsKCiAgICAgIHZhciBfYXZhdGFyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4MCk7CgogICAgICB2YXIgX2F2YXRhcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9hdmF0YXIpOwoKICAgICAgdmFyIF9idXR0b24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4OCk7CgogICAgICB2YXIgX2J1dHRvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9idXR0b24pOwoKICAgICAgdmFyIF9hY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4OSk7CgogICAgICB2YXIgX2FjdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9hY3Rpb24pOwoKICAgICAgdmFyIF9jb21tZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOTApOwoKICAgICAgdmFyIF9jb21tZW50MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbW1lbnQpOwoKICAgICAgdmFyIF9zdmcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgxKTsKCiAgICAgIHZhciBfc3ZnMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3N2Zyk7CgogICAgICB2YXIgX2NvbnN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMTgpOwoKICAgICAgdmFyIF9nZXRDb21tZW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oMjE5KTsKCiAgICAgIHZhciBfZ2V0Q29tbWVudHMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZ2V0Q29tbWVudHMpOwoKICAgICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICAgICAgICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgICAgICAgImRlZmF1bHQiOiBvYmoKICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgR2l0YWxrQ29tcG9uZW50ID0gZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICAgICAgICAoMCwgX2luaGVyaXRzM1siZGVmYXVsdCJdKShHaXRhbGtDb21wb25lbnQsIF9Db21wb25lbnQpOwoKICAgICAgICBmdW5jdGlvbiBHaXRhbGtDb21wb25lbnQocHJvcHMpIHsKICAgICAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2szWyJkZWZhdWx0Il0pKHRoaXMsIEdpdGFsa0NvbXBvbmVudCk7CgogICAgICAgICAgdmFyIF90aGlzID0gKDAsIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuM1siZGVmYXVsdCJdKSh0aGlzLCAoR2l0YWxrQ29tcG9uZW50Ll9fcHJvdG9fXyB8fCAoMCwgX2dldFByb3RvdHlwZU9mMlsiZGVmYXVsdCJdKShHaXRhbGtDb21wb25lbnQpKS5jYWxsKHRoaXMsIHByb3BzKSk7CgogICAgICAgICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgICAgICAgIHVzZXI6IG51bGwsCiAgICAgICAgICAgIGlzc3VlOiBudWxsLAogICAgICAgICAgICBjb21tZW50czogW10sCiAgICAgICAgICAgIGxvY2FsQ29tbWVudHM6IFtdLAogICAgICAgICAgICBjb21tZW50OiAnJywKICAgICAgICAgICAgcGFnZTogMSwKICAgICAgICAgICAgcGFnZXJEaXJlY3Rpb246ICdsYXN0JywKICAgICAgICAgICAgY3Vyc29yOiBudWxsLAogICAgICAgICAgICBwcmV2aWV3SHRtbDogJycsCiAgICAgICAgICAgIGlzTm9Jbml0OiBmYWxzZSwKICAgICAgICAgICAgaXNJbml0aW5nOiB0cnVlLAogICAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSwKICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICAgICAgaXNMb2FkTW9yZTogZmFsc2UsCiAgICAgICAgICAgIGlzTG9hZE92ZXI6IGZhbHNlLAogICAgICAgICAgICBpc0lzc3VlQ3JlYXRpbmc6IGZhbHNlLAogICAgICAgICAgICBpc1BvcHVwVmlzaWJsZTogZmFsc2UsCiAgICAgICAgICAgIGlzSW5wdXRGb2N1c2VkOiBmYWxzZSwKICAgICAgICAgICAgaXNQcmV2aWV3OiBmYWxzZSwKICAgICAgICAgICAgaXNPY2N1ckVycm9yOiBmYWxzZSwKICAgICAgICAgICAgZXJyb3JNc2c6ICcnCiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzLmdldENvbW1lbnRzVjMgPSBmdW5jdGlvbiAoaXNzdWUpIHsKICAgICAgICAgICAgdmFyIF90aGlzJG9wdGlvbnMgPSBfdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgY2xpZW50SUQgPSBfdGhpcyRvcHRpb25zLmNsaWVudElELAogICAgICAgICAgICAgICAgY2xpZW50U2VjcmV0ID0gX3RoaXMkb3B0aW9ucy5jbGllbnRTZWNyZXQsCiAgICAgICAgICAgICAgICBwZXJQYWdlID0gX3RoaXMkb3B0aW9ucy5wZXJQYWdlOwogICAgICAgICAgICB2YXIgcGFnZSA9IF90aGlzLnN0YXRlLnBhZ2U7CiAgICAgICAgICAgIHJldHVybiBfdGhpcy5nZXRJc3N1ZSgpLnRoZW4oZnVuY3Rpb24gKGlzc3VlKSB7CiAgICAgICAgICAgICAgaWYgKCFpc3N1ZSkgcmV0dXJuOwogICAgICAgICAgICAgIHJldHVybiBfdXRpbC5heGlvc0dpdGh1Yi5nZXQoaXNzdWUuY29tbWVudHNfdXJsLCB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIudjMuZnVsbCtqc29uJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGF1dGg6IHsKICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IGNsaWVudElELAogICAgICAgICAgICAgICAgICBwYXNzd29yZDogY2xpZW50U2VjcmV0CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgIHBlcl9wYWdlOiBwZXJQYWdlLAogICAgICAgICAgICAgICAgICBwYWdlOiBwYWdlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICB2YXIgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgICAgICAgICAgICBjb21tZW50cyA9IF90aGlzJHN0YXRlLmNvbW1lbnRzLAogICAgICAgICAgICAgICAgICAgIGlzc3VlID0gX3RoaXMkc3RhdGUuaXNzdWU7CiAgICAgICAgICAgICAgICB2YXIgaXNMb2FkT3ZlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgdmFyIGNzID0gY29tbWVudHMuY29uY2F0KHJlcy5kYXRhKTsKCiAgICAgICAgICAgICAgICBpZiAoY3MubGVuZ3RoID49IGlzc3VlLmNvbW1lbnRzIHx8IHJlcy5kYXRhLmxlbmd0aCA8IHBlclBhZ2UpIHsKICAgICAgICAgICAgICAgICAgaXNMb2FkT3ZlciA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICBjb21tZW50czogY3MsCiAgICAgICAgICAgICAgICAgIGlzTG9hZE92ZXI6IGlzTG9hZE92ZXIsCiAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UgKyAxCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gY3M7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5nZXRSZWYgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpcy5wdWJsaWNCdG5FTCA9IGU7CiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzLnJlcGx5ID0gZnVuY3Rpb24gKHJlcGx5Q29tbWVudCkgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciBjb21tZW50ID0gX3RoaXMuc3RhdGUuY29tbWVudDsKICAgICAgICAgICAgICB2YXIgcmVwbHlDb21tZW50Qm9keSA9IHJlcGx5Q29tbWVudC5ib2R5OwogICAgICAgICAgICAgIHZhciByZXBseUNvbW1lbnRBcnJheSA9IHJlcGx5Q29tbWVudEJvZHkuc3BsaXQoJ1xuJyk7CiAgICAgICAgICAgICAgcmVwbHlDb21tZW50QXJyYXkudW5zaGlmdCgnQCcgKyByZXBseUNvbW1lbnQudXNlci5sb2dpbik7CiAgICAgICAgICAgICAgcmVwbHlDb21tZW50QXJyYXkgPSByZXBseUNvbW1lbnRBcnJheS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnPiAnICsgdDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXBseUNvbW1lbnRBcnJheS5wdXNoKCcnKTsKICAgICAgICAgICAgICByZXBseUNvbW1lbnRBcnJheS5wdXNoKCcnKTsKICAgICAgICAgICAgICBpZiAoY29tbWVudCkgcmVwbHlDb21tZW50QXJyYXkudW5zaGlmdCgnJyk7CgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGNvbW1lbnQ6IGNvbW1lbnQgKyByZXBseUNvbW1lbnRBcnJheS5qb2luKCdcbicpCiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgX2F1dG9zaXplMlsiZGVmYXVsdCJdLnVwZGF0ZShfdGhpcy5jb21tZW50RUwpOwoKICAgICAgICAgICAgICAgIF90aGlzLmNvbW1lbnRFTC5mb2N1cygpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5oYW5kbGVQb3B1cCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgdmFyIGlzVmlzaWJsZSA9ICFfdGhpcy5zdGF0ZS5pc1BvcHVwVmlzaWJsZTsKCiAgICAgICAgICAgIHZhciBoaWRlSGFuZGxlID0gZnVuY3Rpb24gaGlkZUhhbmRsZShlMSkgewogICAgICAgICAgICAgIGlmICgoMCwgX3V0aWwuaGFzQ2xhc3NJblBhcmVudCkoZTEudGFyZ2V0LCAnZ3QtdXNlcicsICdndC1wb3B1cCcpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB3aW5kb3cuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoaWRlSGFuZGxlKTsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNQb3B1cFZpc2libGU6IGZhbHNlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgaXNQb3B1cFZpc2libGU6IGlzVmlzaWJsZQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChpc1Zpc2libGUpIHsKICAgICAgICAgICAgICB3aW5kb3cuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoaWRlSGFuZGxlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB3aW5kb3cuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoaWRlSGFuZGxlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5oYW5kbGVMb2dpbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGNvbW1lbnQgPSBfdGhpcy5zdGF0ZS5jb21tZW50OwogICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oX2NvbnN0LkdUX0NPTU1FTlQsIGVuY29kZVVSSUNvbXBvbmVudChjb21tZW50KSk7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gX3RoaXMubG9naW5MaW5rOwogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5oYW5kbGVJc3N1ZUNyZWF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgIGlzSXNzdWVDcmVhdGluZzogdHJ1ZQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzLmNyZWF0ZUlzc3VlKCkudGhlbihmdW5jdGlvbiAoaXNzdWUpIHsKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpc0lzc3VlQ3JlYXRpbmc6IGZhbHNlLAogICAgICAgICAgICAgICAgaXNPY2N1ckVycm9yOiBmYWxzZQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZ2V0Q29tbWVudHMoaXNzdWUpOwogICAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNJc3N1ZUNyZWF0aW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgIGlzT2NjdXJFcnJvcjogdHJ1ZSwKICAgICAgICAgICAgICAgIGVycm9yTXNnOiAoMCwgX3V0aWwuZm9ybWF0RXJyb3JNc2cpKGVycikKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICBpc05vSW5pdDogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzLmhhbmRsZUNvbW1lbnRDcmVhdGUgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoIV90aGlzLnN0YXRlLmNvbW1lbnQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgZSAmJiBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgIF90aGlzLmNvbW1lbnRFTC5mb2N1cygpOwoKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChzdGF0ZSkgewogICAgICAgICAgICAgIGlmIChzdGF0ZS5pc0NyZWF0aW5nKSByZXR1cm47CgogICAgICAgICAgICAgIF90aGlzLmNyZWF0ZUNvbW1lbnQoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIGlzQ3JlYXRpbmc6IGZhbHNlLAogICAgICAgICAgICAgICAgICBpc09jY3VyRXJyb3I6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIGlzQ3JlYXRpbmc6IGZhbHNlLAogICAgICAgICAgICAgICAgICBpc09jY3VyRXJyb3I6IHRydWUsCiAgICAgICAgICAgICAgICAgIGVycm9yTXNnOiAoMCwgX3V0aWwuZm9ybWF0RXJyb3JNc2cpKGVycikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaXNDcmVhdGluZzogdHJ1ZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5oYW5kbGVDb21tZW50UHJldmlldyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICBpc1ByZXZpZXc6ICFfdGhpcy5zdGF0ZS5pc1ByZXZpZXcKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdXRpbC5heGlvc0dpdGh1Yi5wb3N0KCcvbWFya2Rvd24nLCB7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXMuc3RhdGUuY29tbWVudAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogX3RoaXMuYWNjZXNzVG9rZW4gJiYgewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ3Rva2VuICcgKyBfdGhpcy5hY2Nlc3NUb2tlbgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgcHJldmlld0h0bWw6IHJlcy5kYXRhCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpc09jY3VyRXJyb3I6IHRydWUsCiAgICAgICAgICAgICAgICBlcnJvck1zZzogKDAsIF91dGlsLmZvcm1hdEVycm9yTXNnKShlcnIpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5oYW5kbGVDb21tZW50TG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIF90aGlzJHN0YXRlMiA9IF90aGlzLnN0YXRlLAogICAgICAgICAgICAgICAgaXNzdWUgPSBfdGhpcyRzdGF0ZTIuaXNzdWUsCiAgICAgICAgICAgICAgICBpc0xvYWRNb3JlID0gX3RoaXMkc3RhdGUyLmlzTG9hZE1vcmU7CiAgICAgICAgICAgIGlmIChpc0xvYWRNb3JlKSByZXR1cm47CgogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgaXNMb2FkTW9yZTogdHJ1ZQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzLmdldENvbW1lbnRzKGlzc3VlKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNMb2FkTW9yZTogZmFsc2UKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzLmhhbmRsZUNvbW1lbnRDaGFuZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgIGNvbW1lbnQ6IGUudGFyZ2V0LnZhbHVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5oYW5kbGVMb2dvdXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLmxvZ291dCgpOwoKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5oYW5kbGVDb21tZW50Rm9jdXMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgZGlzdHJhY3Rpb25GcmVlTW9kZSA9IF90aGlzLm9wdGlvbnMuZGlzdHJhY3Rpb25GcmVlTW9kZTsKICAgICAgICAgICAgaWYgKCFkaXN0cmFjdGlvbkZyZWVNb2RlKSByZXR1cm4gZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgIGlzSW5wdXRGb2N1c2VkOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5oYW5kbGVDb21tZW50Qmx1ciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBkaXN0cmFjdGlvbkZyZWVNb2RlID0gX3RoaXMub3B0aW9ucy5kaXN0cmFjdGlvbkZyZWVNb2RlOwogICAgICAgICAgICBpZiAoIWRpc3RyYWN0aW9uRnJlZU1vZGUpIHJldHVybiBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgaXNJbnB1dEZvY3VzZWQ6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5oYW5kbGVTb3J0ID0gZnVuY3Rpb24gKGRpcmVjdGlvbikgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBwYWdlckRpcmVjdGlvbjogZGlyZWN0aW9uCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzLmhhbmRsZUNvbW1lbnRLZXlEb3duID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIGVuYWJsZUhvdEtleSA9IF90aGlzLm9wdGlvbnMuZW5hYmxlSG90S2V5OwoKICAgICAgICAgICAgaWYgKGVuYWJsZUhvdEtleSAmJiAoZS5tZXRhS2V5IHx8IGUuY3RybEtleSkgJiYgZS5rZXlDb2RlID09PSAxMykgewogICAgICAgICAgICAgIF90aGlzLnB1YmxpY0J0bkVMICYmIF90aGlzLnB1YmxpY0J0bkVMLmZvY3VzKCk7CgogICAgICAgICAgICAgIF90aGlzLmhhbmRsZUNvbW1lbnRDcmVhdGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5vcHRpb25zID0gKDAsIF9hc3NpZ24yWyJkZWZhdWx0Il0pKHt9LCB7CiAgICAgICAgICAgIGlkOiB3aW5kb3cubG9jYXRpb24uaHJlZiwKICAgICAgICAgICAgbnVtYmVyOiAtMSwKICAgICAgICAgICAgbGFiZWxzOiBbJ0dpdGFsayddLAogICAgICAgICAgICB0aXRsZTogd2luZG93LmRvY3VtZW50LnRpdGxlLAogICAgICAgICAgICBib2R5OiAnJywKICAgICAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uLmhyZWYgKyBoZWFkZXIubWV0YVtkZXNjcmlwdGlvbl0KICAgICAgICAgICAgbGFuZ3VhZ2U6IHdpbmRvdy5uYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgd2luZG93Lm5hdmlnYXRvci51c2VyTGFuZ3VhZ2UsCiAgICAgICAgICAgIHBlclBhZ2U6IDEwLAogICAgICAgICAgICBwYWdlckRpcmVjdGlvbjogJ2xhc3QnLAogICAgICAgICAgICAvLyBsYXN0IG9yIGZpcnN0CiAgICAgICAgICAgIGNyZWF0ZUlzc3VlTWFudWFsbHk6IGZhbHNlLAogICAgICAgICAgICBkaXN0cmFjdGlvbkZyZWVNb2RlOiBmYWxzZSwKICAgICAgICAgICAgcHJveHk6ICdodHRwczovL2NvcnMtYW55d2hlcmUuaGVyb2t1YXBwLmNvbS9odHRwczovL2dpdGh1Yi5jb20vbG9naW4vb2F1dGgvYWNjZXNzX3Rva2VuJywKICAgICAgICAgICAgZmxpcE1vdmVPcHRpb25zOiB7CiAgICAgICAgICAgICAgc3RhZ2dlckRlbGF5Qnk6IDE1MCwKICAgICAgICAgICAgICBhcHBlYXJBbmltYXRpb246ICdhY2NvcmRpb25WZXJ0aWNhbCcsCiAgICAgICAgICAgICAgZW50ZXJBbmltYXRpb246ICdhY2NvcmRpb25WZXJ0aWNhbCcsCiAgICAgICAgICAgICAgbGVhdmVBbmltYXRpb246ICdhY2NvcmRpb25WZXJ0aWNhbCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5hYmxlSG90S2V5OiB0cnVlLAogICAgICAgICAgICB1cmw6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLAogICAgICAgICAgICBkZWZhdWx0QXV0aG9yOiB7CiAgICAgICAgICAgICAgYXZhdGFyVXJsOiAnLy9hdmF0YXJzMS5naXRodWJ1c2VyY29udGVudC5jb20vdS8yOTY5NzEzMz9zPTUwJywKICAgICAgICAgICAgICBsb2dpbjogJ251bGwnLAogICAgICAgICAgICAgIHVybDogJycKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdXBkYXRlQ291bnRDYWxsYmFjazogbnVsbAogICAgICAgICAgfSwgcHJvcHMub3B0aW9ucyk7CiAgICAgICAgICBfdGhpcy5zdGF0ZS5wYWdlckRpcmVjdGlvbiA9IF90aGlzLm9wdGlvbnMucGFnZXJEaXJlY3Rpb247CiAgICAgICAgICB2YXIgc3RvcmVkQ29tbWVudCA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShfY29uc3QuR1RfQ09NTUVOVCk7CgogICAgICAgICAgaWYgKHN0b3JlZENvbW1lbnQpIHsKICAgICAgICAgICAgX3RoaXMuc3RhdGUuY29tbWVudCA9IGRlY29kZVVSSUNvbXBvbmVudChzdG9yZWRDb21tZW50KTsKICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKF9jb25zdC5HVF9DT01NRU5UKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcXVlcnkgPSAoMCwgX3V0aWwucXVlcnlQYXJzZSkoKTsKCiAgICAgICAgICBpZiAocXVlcnkuY29kZSkgewogICAgICAgICAgICB2YXIgY29kZSA9IHF1ZXJ5LmNvZGU7CiAgICAgICAgICAgIGRlbGV0ZSBxdWVyeS5jb2RlOwogICAgICAgICAgICB2YXIgcmVwbGFjZWRVcmwgPSAnJyArIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gKyB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgKyAoMCwgX3V0aWwucXVlcnlTdHJpbmdpZnkpKHF1ZXJ5KSArIHdpbmRvdy5sb2NhdGlvbi5oYXNoOwogICAgICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShudWxsLCBudWxsLCByZXBsYWNlZFVybCk7CiAgICAgICAgICAgIF90aGlzLm9wdGlvbnMgPSAoMCwgX2Fzc2lnbjJbImRlZmF1bHQiXSkoe30sIF90aGlzLm9wdGlvbnMsIHsKICAgICAgICAgICAgICB1cmw6IHJlcGxhY2VkVXJsLAogICAgICAgICAgICAgIGlkOiByZXBsYWNlZFVybAogICAgICAgICAgICB9LCBwcm9wcy5vcHRpb25zKTsKCiAgICAgICAgICAgIF91dGlsLmF4aW9zSlNPTi5wb3N0KF90aGlzLm9wdGlvbnMucHJveHksIHsKICAgICAgICAgICAgICBjb2RlOiBjb2RlLAogICAgICAgICAgICAgIGNsaWVudF9pZDogX3RoaXMub3B0aW9ucy5jbGllbnRJRCwKICAgICAgICAgICAgICBjbGllbnRfc2VjcmV0OiBfdGhpcy5vcHRpb25zLmNsaWVudFNlY3JldAogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICBpZiAocmVzLmRhdGEgJiYgcmVzLmRhdGEuYWNjZXNzX3Rva2VuKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5hY2Nlc3NUb2tlbiA9IHJlcy5kYXRhLmFjY2Vzc190b2tlbjsKCiAgICAgICAgICAgICAgICBfdGhpcy5nZXRJbml0KCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgaXNJbml0aW5nOiBmYWxzZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycjonLCBlcnIpOwoKICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgIGlzSW5pdGluZzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgaXNPY2N1ckVycm9yOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGVycm9yTXNnOiAoMCwgX3V0aWwuZm9ybWF0RXJyb3JNc2cpKGVycikKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gbm8gYWNjZXNzX3Rva2VuCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzLmRhdGEgZXJyOicsIHJlcy5kYXRhKTsKCiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIGlzT2NjdXJFcnJvcjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgZXJyb3JNc2c6ICgwLCBfdXRpbC5mb3JtYXRFcnJvck1zZykobmV3IEVycm9yKCdubyBhY2Nlc3MgdG9rZW4nKSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnI6ICcsIGVycik7CgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGlzT2NjdXJFcnJvcjogdHJ1ZSwKICAgICAgICAgICAgICAgIGVycm9yTXNnOiAoMCwgX3V0aWwuZm9ybWF0RXJyb3JNc2cpKGVycikKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpcy5nZXRJbml0KCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGlzSW5pdGluZzogZmFsc2UKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnI6JywgZXJyKTsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNJbml0aW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgIGlzT2NjdXJFcnJvcjogdHJ1ZSwKICAgICAgICAgICAgICAgIGVycm9yTXNnOiAoMCwgX3V0aWwuZm9ybWF0RXJyb3JNc2cpKGVycikKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMuaTE4biA9ICgwLCBfaTE4bjJbImRlZmF1bHQiXSkoX3RoaXMub3B0aW9ucy5sYW5ndWFnZSk7CiAgICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgICAgfQoKICAgICAgICAoMCwgX2NyZWF0ZUNsYXNzM1siZGVmYXVsdCJdKShHaXRhbGtDb21wb25lbnQsIFt7CiAgICAgICAgICBrZXk6ICdjb21wb25lbnREaWRVcGRhdGUnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZSgpIHsKICAgICAgICAgICAgdGhpcy5jb21tZW50RUwgJiYgKDAsIF9hdXRvc2l6ZTJbImRlZmF1bHQiXSkodGhpcy5jb21tZW50RUwpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2dldEluaXQnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEluaXQoKSB7CiAgICAgICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VXNlckluZm8oKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyLmdldElzc3VlKCk7CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGlzc3VlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5nZXRDb21tZW50cyhpc3N1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2dldFVzZXJJbmZvJywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRVc2VySW5mbygpIHsKICAgICAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICAgICAgICByZXR1cm4gX3V0aWwuYXhpb3NHaXRodWIuZ2V0KCcvdXNlcicsIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAndG9rZW4gJyArIHRoaXMuYWNjZXNzVG9rZW4KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgIF90aGlzMy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICB1c2VyOiByZXMuZGF0YQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgX3RoaXMzLmxvZ291dCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdnZXRJc3N1ZUJ5SWQnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldElzc3VlQnlJZCgpIHsKICAgICAgICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICAgICAgICB2YXIgX29wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICBvd25lciA9IF9vcHRpb25zLm93bmVyLAogICAgICAgICAgICAgICAgcmVwbyA9IF9vcHRpb25zLnJlcG8sCiAgICAgICAgICAgICAgICBudW1iZXIgPSBfb3B0aW9ucy5udW1iZXIsCiAgICAgICAgICAgICAgICBjbGllbnRJRCA9IF9vcHRpb25zLmNsaWVudElELAogICAgICAgICAgICAgICAgY2xpZW50U2VjcmV0ID0gX29wdGlvbnMuY2xpZW50U2VjcmV0OwogICAgICAgICAgICB2YXIgZ2V0VXJsID0gJy9yZXBvcy8nICsgb3duZXIgKyAnLycgKyByZXBvICsgJy9pc3N1ZXMvJyArIG51bWJlcjsKICAgICAgICAgICAgcmV0dXJuIG5ldyBfcHJvbWlzZTJbImRlZmF1bHQiXShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgX3V0aWwuYXhpb3NHaXRodWIuZ2V0KGdldFVybCwgewogICAgICAgICAgICAgICAgYXV0aDogewogICAgICAgICAgICAgICAgICB1c2VybmFtZTogY2xpZW50SUQsCiAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBjbGllbnRTZWNyZXQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgdDogRGF0ZS5ub3coKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgdmFyIGlzc3VlID0gbnVsbDsKCiAgICAgICAgICAgICAgICBpZiAocmVzICYmIHJlcy5kYXRhICYmIHJlcy5kYXRhLm51bWJlciA9PT0gbnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgIGlzc3VlID0gcmVzLmRhdGE7CgogICAgICAgICAgICAgICAgICBfdGhpczQuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgIGlzc3VlOiBpc3N1ZSwKICAgICAgICAgICAgICAgICAgICBpc05vSW5pdDogZmFsc2UKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVzb2x2ZShpc3N1ZSk7CiAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgLy8gV2hlbiB0aGUgc3RhdHVzIGNvZGUgaXMgNDA0LCBwcm9taXNlIHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCBudWxsCiAgICAgICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSByZXNvbHZlKG51bGwpOwogICAgICAgICAgICAgICAgcmVqZWN0KGVycik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2dldElzc3VlQnlMYWJlbHMnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldElzc3VlQnlMYWJlbHMoKSB7CiAgICAgICAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIF9vcHRpb25zMiA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgIG93bmVyID0gX29wdGlvbnMyLm93bmVyLAogICAgICAgICAgICAgICAgcmVwbyA9IF9vcHRpb25zMi5yZXBvLAogICAgICAgICAgICAgICAgaWQgPSBfb3B0aW9uczIuaWQsCiAgICAgICAgICAgICAgICBsYWJlbHMgPSBfb3B0aW9uczIubGFiZWxzLAogICAgICAgICAgICAgICAgY2xpZW50SUQgPSBfb3B0aW9uczIuY2xpZW50SUQsCiAgICAgICAgICAgICAgICBjbGllbnRTZWNyZXQgPSBfb3B0aW9uczIuY2xpZW50U2VjcmV0OwogICAgICAgICAgICByZXR1cm4gX3V0aWwuYXhpb3NHaXRodWIuZ2V0KCcvcmVwb3MvJyArIG93bmVyICsgJy8nICsgcmVwbyArICcvaXNzdWVzJywgewogICAgICAgICAgICAgIGF1dGg6IHsKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBjbGllbnRJRCwKICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBjbGllbnRTZWNyZXQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgbGFiZWxzOiBsYWJlbHMuY29uY2F0KGlkKS5qb2luKCcsJyksCiAgICAgICAgICAgICAgICB0OiBEYXRlLm5vdygpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICB2YXIgY3JlYXRlSXNzdWVNYW51YWxseSA9IF90aGlzNS5vcHRpb25zLmNyZWF0ZUlzc3VlTWFudWFsbHk7CiAgICAgICAgICAgICAgdmFyIGlzTm9Jbml0ID0gZmFsc2U7CiAgICAgICAgICAgICAgdmFyIGlzc3VlID0gbnVsbDsKCiAgICAgICAgICAgICAgaWYgKCEocmVzICYmIHJlcy5kYXRhICYmIHJlcy5kYXRhLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgIGlmICghY3JlYXRlSXNzdWVNYW51YWxseSAmJiBfdGhpczUuaXNBZG1pbikgewogICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM1LmNyZWF0ZUlzc3VlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaXNOb0luaXQgPSB0cnVlOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpc3N1ZSA9IHJlcy5kYXRhWzBdOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXM1LnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGlzc3VlOiBpc3N1ZSwKICAgICAgICAgICAgICAgIGlzTm9Jbml0OiBpc05vSW5pdAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICByZXR1cm4gaXNzdWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2dldElzc3VlJywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJc3N1ZSgpIHsKICAgICAgICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgbnVtYmVyID0gdGhpcy5vcHRpb25zLm51bWJlcjsKICAgICAgICAgICAgdmFyIGlzc3VlID0gdGhpcy5zdGF0ZS5pc3N1ZTsKCiAgICAgICAgICAgIGlmIChpc3N1ZSkgewogICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNOb0luaXQ6IGZhbHNlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIF9wcm9taXNlMlsiZGVmYXVsdCJdLnJlc29sdmUoaXNzdWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHlwZW9mIG51bWJlciA9PT0gJ251bWJlcicgJiYgbnVtYmVyID4gMCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldElzc3VlQnlJZCgpLnRoZW4oZnVuY3Rpb24gKHJlc0lzc3VlKSB7CiAgICAgICAgICAgICAgICBpZiAoIXJlc0lzc3VlKSByZXR1cm4gX3RoaXM2LmdldElzc3VlQnlMYWJlbHMoKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXNJc3N1ZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SXNzdWVCeUxhYmVscygpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2NyZWF0ZUlzc3VlJywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVJc3N1ZSgpIHsKICAgICAgICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICAgICAgICB2YXIgX29wdGlvbnMzID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgb3duZXIgPSBfb3B0aW9uczMub3duZXIsCiAgICAgICAgICAgICAgICByZXBvID0gX29wdGlvbnMzLnJlcG8sCiAgICAgICAgICAgICAgICB0aXRsZSA9IF9vcHRpb25zMy50aXRsZSwKICAgICAgICAgICAgICAgIGJvZHkgPSBfb3B0aW9uczMuYm9keSwKICAgICAgICAgICAgICAgIGlkID0gX29wdGlvbnMzLmlkLAogICAgICAgICAgICAgICAgbGFiZWxzID0gX29wdGlvbnMzLmxhYmVscywKICAgICAgICAgICAgICAgIHVybCA9IF9vcHRpb25zMy51cmw7CiAgICAgICAgICAgIHJldHVybiBfdXRpbC5heGlvc0dpdGh1Yi5wb3N0KCcvcmVwb3MvJyArIG93bmVyICsgJy8nICsgcmVwbyArICcvaXNzdWVzJywgewogICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgICAgICBsYWJlbHM6IGxhYmVscy5jb25jYXQoaWQpLAogICAgICAgICAgICAgIGJvZHk6IGJvZHkgfHwgdXJsICsgJyBcblxuICcgKyAoKDAsIF91dGlsLmdldE1ldGFDb250ZW50KSgnZGVzY3JpcHRpb24nKSB8fCAoMCwgX3V0aWwuZ2V0TWV0YUNvbnRlbnQpKCdkZXNjcmlwdGlvbicsICdvZzpkZXNjcmlwdGlvbicpIHx8ICcnKQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ3Rva2VuICcgKyB0aGlzLmFjY2Vzc1Rva2VuCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICBfdGhpczcuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNzdWU6IHJlcy5kYXRhCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHJldHVybiByZXMuZGF0YTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IC8vIEdldCBjb21tZW50cyB2aWEgdjMgYXBpLCBkb24ndCByZXF1aXJlIGxvZ2luLCBidXQgc29ydGluZyBmZWF0dXJlIGlzIGRpc2FibGUKCiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnZ2V0Q29tbWVudHMnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvbW1lbnRzKGlzc3VlKSB7CiAgICAgICAgICAgIGlmICghaXNzdWUpIHJldHVybjsgLy8gR2V0IGNvbW1lbnRzIHZpYSB2NCBncmFwaHFsIGFwaSwgbG9naW4gcmVxdWlyZWQgYW5kIHNvcnRpbmcgZmVhdHVyZSBpcyBhdmFpbGFibGUKCiAgICAgICAgICAgIGlmICh0aGlzLmFjY2Vzc1Rva2VuKSByZXR1cm4gX2dldENvbW1lbnRzMlsiZGVmYXVsdCJdLmNhbGwodGhpcywgaXNzdWUpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb21tZW50c1YzKGlzc3VlKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdjcmVhdGVDb21tZW50JywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVDb21tZW50KCkgewogICAgICAgICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgICAgICAgIHZhciBfc3RhdGUgPSB0aGlzLnN0YXRlLAogICAgICAgICAgICAgICAgY29tbWVudCA9IF9zdGF0ZS5jb21tZW50LAogICAgICAgICAgICAgICAgbG9jYWxDb21tZW50cyA9IF9zdGF0ZS5sb2NhbENvbW1lbnRzLAogICAgICAgICAgICAgICAgY29tbWVudHMgPSBfc3RhdGUuY29tbWVudHM7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldElzc3VlKCkudGhlbihmdW5jdGlvbiAoaXNzdWUpIHsKICAgICAgICAgICAgICByZXR1cm4gX3V0aWwuYXhpb3NHaXRodWIucG9zdChpc3N1ZS5jb21tZW50c191cmwsIHsKICAgICAgICAgICAgICAgIGJvZHk6IGNvbW1lbnQKICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIudjMuZnVsbCtqc29uJywKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ3Rva2VuICcgKyBfdGhpczguYWNjZXNzVG9rZW4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgX3RoaXM4LnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGNvbW1lbnQ6ICcnLAogICAgICAgICAgICAgICAgY29tbWVudHM6IGNvbW1lbnRzLmNvbmNhdChyZXMuZGF0YSksCiAgICAgICAgICAgICAgICBsb2NhbENvbW1lbnRzOiBsb2NhbENvbW1lbnRzLmNvbmNhdChyZXMuZGF0YSkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnbG9nb3V0JywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBsb2dvdXQoKSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgIHVzZXI6IG51bGwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShfY29uc3QuR1RfQUNDRVNTX1RPS0VOKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdsaWtlJywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBsaWtlKGNvbW1lbnQpIHsKICAgICAgICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICAgICAgICB2YXIgX29wdGlvbnM0ID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgb3duZXIgPSBfb3B0aW9uczQub3duZXIsCiAgICAgICAgICAgICAgICByZXBvID0gX29wdGlvbnM0LnJlcG87CiAgICAgICAgICAgIHZhciB1c2VyID0gdGhpcy5zdGF0ZS51c2VyOwogICAgICAgICAgICB2YXIgY29tbWVudHMgPSB0aGlzLnN0YXRlLmNvbW1lbnRzOwoKICAgICAgICAgICAgX3V0aWwuYXhpb3NHaXRodWIucG9zdCgnL3JlcG9zLycgKyBvd25lciArICcvJyArIHJlcG8gKyAnL2lzc3Vlcy9jb21tZW50cy8nICsgY29tbWVudC5pZCArICcvcmVhY3Rpb25zJywgewogICAgICAgICAgICAgIGNvbnRlbnQ6ICdoZWFydCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICd0b2tlbiAnICsgdGhpcy5hY2Nlc3NUb2tlbiwKICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIuc3F1aXJyZWwtZ2lybC1wcmV2aWV3JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgY29tbWVudHMgPSBjb21tZW50cy5tYXAoZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgICAgIGlmIChjLmlkID09PSBjb21tZW50LmlkKSB7CiAgICAgICAgICAgICAgICAgIGlmIChjLnJlYWN0aW9ucykgewogICAgICAgICAgICAgICAgICAgIGlmICghfmMucmVhY3Rpb25zLm5vZGVzLmZpbmRJbmRleChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4udXNlci5sb2dpbiA9PT0gdXNlci5sb2dpbjsKICAgICAgICAgICAgICAgICAgICB9KSkgewogICAgICAgICAgICAgICAgICAgICAgYy5yZWFjdGlvbnMudG90YWxDb3VudCArPSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjLnJlYWN0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgICAgIG5vZGVzOiBbXQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5yZWFjdGlvbnMudG90YWxDb3VudCA9IDE7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGMucmVhY3Rpb25zLm5vZGVzLnB1c2gocmVzLmRhdGEpOwogICAgICAgICAgICAgICAgICBjLnJlYWN0aW9ucy52aWV3ZXJIYXNSZWFjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gYzsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXM5LnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGNvbW1lbnRzOiBjb21tZW50cwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICd1bkxpa2UnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHVuTGlrZShjb21tZW50KSB7CiAgICAgICAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgICAgICAgIHZhciB1c2VyID0gdGhpcy5zdGF0ZS51c2VyOwogICAgICAgICAgICB2YXIgY29tbWVudHMgPSB0aGlzLnN0YXRlLmNvbW1lbnRzOyAvLyBjb25zdCB7ICB1c2VyIH0gPSB0aGlzLnN0YXRlCiAgICAgICAgICAgIC8vIGxldCBpZAogICAgICAgICAgICAvLyBjb21tZW50LnJlYWN0aW9ucy5ub2Rlcy5mb3JFYWNoKHIgPT4gewogICAgICAgICAgICAvLyAgIGlmIChyLnVzZXIubG9naW4gPSB1c2VyLmxvZ2luKSBpZCA9IHIuZGF0YWJhc2VJZAogICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAvLyByZXR1cm4gYXhpb3NHaXRodWIuZGVsZXRlKGAvcmVhY3Rpb25zLyR7aWR9YCwgewogICAgICAgICAgICAvLyAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgLy8gICAgIEF1dGhvcml6YXRpb246IGB0b2tlbiAke3RoaXMuYWNjZXNzVG9rZW59YCwKICAgICAgICAgICAgLy8gICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIuc3F1aXJyZWwtZ2lybC1wcmV2aWV3JwogICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgLy8gfSkudGhlbihyZXMgPT4gewogICAgICAgICAgICAvLyAgIGNvbnNvbGUubG9nKCdyZXM6JywgcmVzKQogICAgICAgICAgICAvLyB9KQoKICAgICAgICAgICAgdmFyIGdldFFMID0gZnVuY3Rpb24gZ2V0UUwoaWQpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgb3BlcmF0aW9uTmFtZTogJ1JlbW92ZVJlYWN0aW9uJywKICAgICAgICAgICAgICAgIHF1ZXJ5OiAnXG4gICAgICAgICAgbXV0YXRpb24gUmVtb3ZlUmVhY3Rpb257XG4gICAgICAgICAgICByZW1vdmVSZWFjdGlvbiAoaW5wdXQ6e1xuICAgICAgICAgICAgICBzdWJqZWN0SWQ6ICInICsgaWQgKyAnIixcbiAgICAgICAgICAgICAgY29udGVudDogSEVBUlRcbiAgICAgICAgICAgIH0pIHtcbiAgICAgICAgICAgICAgcmVhY3Rpb24ge1xuICAgICAgICAgICAgICAgIGNvbnRlbnRcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgJwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBfdXRpbC5heGlvc0dpdGh1Yi5wb3N0KCcvZ3JhcGhxbCcsIGdldFFMKGNvbW1lbnQuZ0lkKSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdiZWFyZXIgJyArIHRoaXMuYWNjZXNzVG9rZW4KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgIGlmIChyZXMuZGF0YSkgewogICAgICAgICAgICAgICAgY29tbWVudHMgPSBjb21tZW50cy5tYXAoZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgICAgICAgaWYgKGMuaWQgPT09IGNvbW1lbnQuaWQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBjLnJlYWN0aW9ucy5ub2Rlcy5maW5kSW5kZXgoZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLnVzZXIubG9naW4gPT09IHVzZXIubG9naW47CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGlmICh+aW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgIGMucmVhY3Rpb25zLnRvdGFsQ291bnQgLT0gMTsKICAgICAgICAgICAgICAgICAgICAgIGMucmVhY3Rpb25zLm5vZGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjLnJlYWN0aW9ucy52aWV3ZXJIYXNSZWFjdGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHJldHVybiBjOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXMxMC5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIGNvbW1lbnRzOiBjb21tZW50cwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdpbml0aW5nJywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aW5nKCkgewogICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1pbml0aW5nJwogICAgICAgICAgICB9LCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnaScsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1sb2FkZXInCiAgICAgICAgICAgIH0pLCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgncCcsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1pbml0aW5nLXRleHQnCiAgICAgICAgICAgIH0sIHRoaXMuaTE4bi50KCdpbml0JykpKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdub0luaXQnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG5vSW5pdCgpIHsKICAgICAgICAgICAgdmFyIF9zdGF0ZTIgPSB0aGlzLnN0YXRlLAogICAgICAgICAgICAgICAgdXNlciA9IF9zdGF0ZTIudXNlciwKICAgICAgICAgICAgICAgIGlzSXNzdWVDcmVhdGluZyA9IF9zdGF0ZTIuaXNJc3N1ZUNyZWF0aW5nOwogICAgICAgICAgICB2YXIgX29wdGlvbnM1ID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgb3duZXIgPSBfb3B0aW9uczUub3duZXIsCiAgICAgICAgICAgICAgICByZXBvID0gX29wdGlvbnM1LnJlcG8sCiAgICAgICAgICAgICAgICBhZG1pbiA9IF9vcHRpb25zNS5hZG1pbjsKICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCdkaXYnLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3Qtbm8taW5pdCcsCiAgICAgICAgICAgICAga2V5OiAnbm8taW5pdCcKICAgICAgICAgICAgfSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ3AnLCB7CiAgICAgICAgICAgICAgZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw6IHsKICAgICAgICAgICAgICAgIF9faHRtbDogdGhpcy5pMThuLnQoJ25vLWZvdW5kLXJlbGF0ZWQnLCB7CiAgICAgICAgICAgICAgICAgIGxpbms6ICc8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vJyArIG93bmVyICsgJy8nICsgcmVwbyArICcvaXNzdWVzIj5Jc3N1ZXM8L2E+JwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgncCcsIG51bGwsIHRoaXMuaTE4bi50KCdwbGVhc2UtY29udGFjdCcsIHsKICAgICAgICAgICAgICB1c2VyOiBbXS5jb25jYXQoYWRtaW4pLm1hcChmdW5jdGlvbiAodSkgewogICAgICAgICAgICAgICAgcmV0dXJuICdAJyArIHU7CiAgICAgICAgICAgICAgfSkuam9pbignICcpCiAgICAgICAgICAgIH0pKSwgdGhpcy5pc0FkbWluID8gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ3AnLCBudWxsLCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudChfYnV0dG9uMlsiZGVmYXVsdCJdLCB7CiAgICAgICAgICAgICAgb25DbGljazogdGhpcy5oYW5kbGVJc3N1ZUNyZWF0ZSwKICAgICAgICAgICAgICBpc0xvYWRpbmc6IGlzSXNzdWVDcmVhdGluZywKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmkxOG4udCgnaW5pdC1pc3N1ZScpCiAgICAgICAgICAgIH0pKSA6IG51bGwsICF1c2VyICYmIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KF9idXR0b24yWyJkZWZhdWx0Il0sIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1idG4tbG9naW4nLAogICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuaGFuZGxlTG9naW4sCiAgICAgICAgICAgICAgdGV4dDogdGhpcy5pMThuLnQoJ2xvZ2luLXdpdGgtZ2l0aHViJykKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2hhbmRsZUltYWdlRXJyb3JlZCcsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlSW1hZ2VFcnJvcmVkKG9iaikgewogICAgICAgICAgICBvYmoudGFyZ2V0LnNyYyA9ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2dpdGFsa0AxL3NyYy9hc3NldHMvaWNvbi9naXRodWIuc3ZnIjsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdoZWFkZXInLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGhlYWRlcigpIHsKICAgICAgICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIF9zdGF0ZTMgPSB0aGlzLnN0YXRlLAogICAgICAgICAgICAgICAgdXNlciA9IF9zdGF0ZTMudXNlciwKICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBfc3RhdGUzLmNvbW1lbnQsCiAgICAgICAgICAgICAgICBpc0NyZWF0aW5nID0gX3N0YXRlMy5pc0NyZWF0aW5nLAogICAgICAgICAgICAgICAgcHJldmlld0h0bWwgPSBfc3RhdGUzLnByZXZpZXdIdG1sLAogICAgICAgICAgICAgICAgaXNQcmV2aWV3ID0gX3N0YXRlMy5pc1ByZXZpZXc7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnZGl2JywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWhlYWRlcicsCiAgICAgICAgICAgICAga2V5OiAnaGVhZGVyJwogICAgICAgICAgICB9LCB1c2VyID8gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoX2F2YXRhcjJbImRlZmF1bHQiXSwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWhlYWRlci1hdmF0YXInLAogICAgICAgICAgICAgIHNyYzogdXNlci5hdmF0YXJfdXJsLAogICAgICAgICAgICAgIGFsdDogdXNlci5sb2dpbiwKICAgICAgICAgICAgICBvbkVycm9yOiB0aGlzLmhhbmRsZUltYWdlRXJyb3JlZC5iaW5kKHRoaXMpCiAgICAgICAgICAgIH0pIDogX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2EnLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3QtYXZhdGFyLWdpdGh1YicsCiAgICAgICAgICAgICAgb25Nb3VzZURvd246IHRoaXMuaGFuZGxlTG9naW4KICAgICAgICAgICAgfSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoX3N2ZzJbImRlZmF1bHQiXSwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWljby1naXRodWInLAogICAgICAgICAgICAgIG5hbWU6ICdnaXRodWInCiAgICAgICAgICAgIH0pKSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1oZWFkZXItY29tbWVudCcKICAgICAgICAgICAgfSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJywgewogICAgICAgICAgICAgIHJlZjogZnVuY3Rpb24gcmVmKHQpIHsKICAgICAgICAgICAgICAgIF90aGlzMTEuY29tbWVudEVMID0gdDsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWhlYWRlci10ZXh0YXJlYSAnICsgKGlzUHJldmlldyA/ICdoaWRlJyA6ICcnKSwKICAgICAgICAgICAgICB2YWx1ZTogY29tbWVudCwKICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5oYW5kbGVDb21tZW50Q2hhbmdlLAogICAgICAgICAgICAgIG9uRm9jdXM6IHRoaXMuaGFuZGxlQ29tbWVudEZvY3VzLAogICAgICAgICAgICAgIG9uQmx1cjogdGhpcy5oYW5kbGVDb21tZW50Qmx1ciwKICAgICAgICAgICAgICBvbktleURvd246IHRoaXMuaGFuZGxlQ29tbWVudEtleURvd24sCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IHRoaXMuaTE4bi50KCdsZWF2ZS1hLWNvbW1lbnQnKQogICAgICAgICAgICB9KSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1oZWFkZXItcHJldmlldyBtYXJrZG93bi1ib2R5ICcgKyAoaXNQcmV2aWV3ID8gJycgOiAnaGlkZScpLAogICAgICAgICAgICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MOiB7CiAgICAgICAgICAgICAgICBfX2h0bWw6IHByZXZpZXdIdG1sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1oZWFkZXItY29udHJvbHMnCiAgICAgICAgICAgIH0sIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCdhJywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWhlYWRlci1jb250cm9scy10aXAnLAogICAgICAgICAgICAgIGhyZWY6ICdodHRwczovL2d1aWRlcy5naXRodWIuY29tL2ZlYXR1cmVzL21hc3RlcmluZy1tYXJrZG93bi8nLAogICAgICAgICAgICAgIHRhcmdldDogJ19ibGFuaycKICAgICAgICAgICAgfSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoX3N2ZzJbImRlZmF1bHQiXSwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWljby10aXAnLAogICAgICAgICAgICAgIG5hbWU6ICd0aXAnLAogICAgICAgICAgICAgIHRleHQ6IHRoaXMuaTE4bi50KCdzdXBwb3J0LW1hcmtkb3duJykKICAgICAgICAgICAgfSkpLCB1c2VyICYmIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KF9idXR0b24yWyJkZWZhdWx0Il0sIHsKICAgICAgICAgICAgICBnZXRSZWY6IHRoaXMuZ2V0UmVmLAogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWJ0bi1wdWJsaWMnLAogICAgICAgICAgICAgIG9uTW91c2VEb3duOiB0aGlzLmhhbmRsZUNvbW1lbnRDcmVhdGUsCiAgICAgICAgICAgICAgdGV4dDogdGhpcy5pMThuLnQoJ2NvbW1lbnQnKSwKICAgICAgICAgICAgICBpc0xvYWRpbmc6IGlzQ3JlYXRpbmcKICAgICAgICAgICAgfSksIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KF9idXR0b24yWyJkZWZhdWx0Il0sIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1idG4tcHJldmlldycsCiAgICAgICAgICAgICAgb25Nb3VzZURvd246IHRoaXMuaGFuZGxlQ29tbWVudFByZXZpZXcsCiAgICAgICAgICAgICAgdGV4dDogaXNQcmV2aWV3ID8gdGhpcy5pMThuLnQoJ2VkaXQnKSA6IHRoaXMuaTE4bi50KCdwcmV2aWV3JykgLy8gaXNMb2FkaW5nPXtpc1ByZXZpZXdpbmd9CgogICAgICAgICAgICB9KSwgIXVzZXIgJiYgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoX2J1dHRvbjJbImRlZmF1bHQiXSwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWJ0bi1sb2dpbicsCiAgICAgICAgICAgICAgb25Nb3VzZURvd246IHRoaXMuaGFuZGxlTG9naW4sCiAgICAgICAgICAgICAgdGV4dDogdGhpcy5pMThuLnQoJ2xvZ2luLXdpdGgtZ2l0aHViJykKICAgICAgICAgICAgfSkpKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnY29tbWVudHMnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbW1lbnRzKCkgewogICAgICAgICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgX3N0YXRlNCA9IHRoaXMuc3RhdGUsCiAgICAgICAgICAgICAgICB1c2VyID0gX3N0YXRlNC51c2VyLAogICAgICAgICAgICAgICAgY29tbWVudHMgPSBfc3RhdGU0LmNvbW1lbnRzLAogICAgICAgICAgICAgICAgaXNMb2FkT3ZlciA9IF9zdGF0ZTQuaXNMb2FkT3ZlciwKICAgICAgICAgICAgICAgIGlzTG9hZE1vcmUgPSBfc3RhdGU0LmlzTG9hZE1vcmUsCiAgICAgICAgICAgICAgICBwYWdlckRpcmVjdGlvbiA9IF9zdGF0ZTQucGFnZXJEaXJlY3Rpb247CiAgICAgICAgICAgIHZhciBfb3B0aW9uczYgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICBsYW5ndWFnZSA9IF9vcHRpb25zNi5sYW5ndWFnZSwKICAgICAgICAgICAgICAgIGZsaXBNb3ZlT3B0aW9ucyA9IF9vcHRpb25zNi5mbGlwTW92ZU9wdGlvbnMsCiAgICAgICAgICAgICAgICBhZG1pbiA9IF9vcHRpb25zNi5hZG1pbjsKICAgICAgICAgICAgdmFyIHRvdGFsQ29tbWVudHMgPSBjb21tZW50cy5jb25jYXQoW10pOwoKICAgICAgICAgICAgaWYgKHBhZ2VyRGlyZWN0aW9uID09PSAnbGFzdCcgJiYgdGhpcy5hY2Nlc3NUb2tlbikgewogICAgICAgICAgICAgIHRvdGFsQ29tbWVudHMucmV2ZXJzZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1jb21tZW50cycsCiAgICAgICAgICAgICAga2V5OiAnY29tbWVudHMnCiAgICAgICAgICAgIH0sIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KF9yZWFjdEZsaXBNb3ZlMlsiZGVmYXVsdCJdLCBmbGlwTW92ZU9wdGlvbnMsIHRvdGFsQ29tbWVudHMubWFwKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KF9jb21tZW50MlsiZGVmYXVsdCJdLCB7CiAgICAgICAgICAgICAgICBjb21tZW50OiBjLAogICAgICAgICAgICAgICAga2V5OiBjLmlkLAogICAgICAgICAgICAgICAgdXNlcjogdXNlciwKICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBsYW5ndWFnZSwKICAgICAgICAgICAgICAgIGNvbW1lbnRlZFRleHQ6IF90aGlzMTIuaTE4bi50KCdjb21tZW50ZWQnKSwKICAgICAgICAgICAgICAgIGFkbWluOiBhZG1pbiwKICAgICAgICAgICAgICAgIHJlcGx5Q2FsbGJhY2s6IF90aGlzMTIucmVwbHkoYyksCiAgICAgICAgICAgICAgICBsaWtlQ2FsbGJhY2s6IGMucmVhY3Rpb25zICYmIGMucmVhY3Rpb25zLnZpZXdlckhhc1JlYWN0ZWQgPyBfdGhpczEyLnVuTGlrZS5iaW5kKF90aGlzMTIsIGMpIDogX3RoaXMxMi5saWtlLmJpbmQoX3RoaXMxMiwgYykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkpLCAhdG90YWxDb21tZW50cy5sZW5ndGggJiYgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ3AnLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3QtY29tbWVudHMtbnVsbCcKICAgICAgICAgICAgfSwgdGhpcy5pMThuLnQoJ2ZpcnN0LWNvbW1lbnQtcGVyc29uJykpLCAhaXNMb2FkT3ZlciAmJiB0b3RhbENvbW1lbnRzLmxlbmd0aCA/IF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCdkaXYnLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3QtY29tbWVudHMtY29udHJvbHMnCiAgICAgICAgICAgIH0sIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KF9idXR0b24yWyJkZWZhdWx0Il0sIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1idG4tbG9hZG1vcmUnLAogICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ29tbWVudExvYWQsCiAgICAgICAgICAgICAgaXNMb2FkaW5nOiBpc0xvYWRNb3JlLAogICAgICAgICAgICAgIHRleHQ6IHRoaXMuaTE4bi50KCdsb2FkLW1vcmUnKQogICAgICAgICAgICB9KSkgOiBudWxsKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdtZXRhJywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBtZXRhKCkgewogICAgICAgICAgICB2YXIgX3N0YXRlNSA9IHRoaXMuc3RhdGUsCiAgICAgICAgICAgICAgICB1c2VyID0gX3N0YXRlNS51c2VyLAogICAgICAgICAgICAgICAgaXNzdWUgPSBfc3RhdGU1Lmlzc3VlLAogICAgICAgICAgICAgICAgaXNQb3B1cFZpc2libGUgPSBfc3RhdGU1LmlzUG9wdXBWaXNpYmxlLAogICAgICAgICAgICAgICAgcGFnZXJEaXJlY3Rpb24gPSBfc3RhdGU1LnBhZ2VyRGlyZWN0aW9uLAogICAgICAgICAgICAgICAgbG9jYWxDb21tZW50cyA9IF9zdGF0ZTUubG9jYWxDb21tZW50czsKICAgICAgICAgICAgdmFyIGNudCA9IChpc3N1ZSAmJiBpc3N1ZS5jb21tZW50cykgKyBsb2NhbENvbW1lbnRzLmxlbmd0aDsKICAgICAgICAgICAgdmFyIGlzRGVzYyA9IHBhZ2VyRGlyZWN0aW9uID09PSAnbGFzdCc7CiAgICAgICAgICAgIHZhciB1cGRhdGVDb3VudENhbGxiYWNrID0gdGhpcy5vcHRpb25zLnVwZGF0ZUNvdW50Q2FsbGJhY2s7IC8vIHdpbmRvdy5HSVRBTEtfQ09NTUVOVFNfQ09VTlQgPSBjbnQKCiAgICAgICAgICAgIGlmICh1cGRhdGVDb3VudENhbGxiYWNrICYmIHt9LnRvU3RyaW5nLmNhbGwodXBkYXRlQ291bnRDYWxsYmFjaykgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXScpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdXBkYXRlQ291bnRDYWxsYmFjayhjbnQpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FuIGVycm9yIG9jY3VycmVkIGV4ZWN1dGluZyB0aGUgdXBkYXRlQ291bnRDYWxsYmFjazonLCBlcnIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCdkaXYnLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3QtbWV0YScsCiAgICAgICAgICAgICAga2V5OiAnbWV0YScKICAgICAgICAgICAgfSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3QtY291bnRzJywKICAgICAgICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTDogewogICAgICAgICAgICAgICAgX19odG1sOiB0aGlzLmkxOG4udCgnY291bnRzJywgewogICAgICAgICAgICAgICAgICBjb3VudHM6ICc8YSBjbGFzcz0iZ3QtbGluayBndC1saW5rLWNvdW50cyIgaHJlZj0iJyArIChpc3N1ZSAmJiBpc3N1ZS5odG1sX3VybCkgKyAnIiB0YXJnZXQ9Il9ibGFuayI+JyArIGNudCArICc8L2E+JywKICAgICAgICAgICAgICAgICAgc21hcnRfY291bnQ6IGNudAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLCBpc1BvcHVwVmlzaWJsZSAmJiBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnZGl2JywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LXBvcHVwJwogICAgICAgICAgICB9LCB1c2VyID8gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoX2FjdGlvbjJbImRlZmF1bHQiXSwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWFjdGlvbi1zb3J0YXNjJyArICghaXNEZXNjID8gJyBpcy0tYWN0aXZlJyA6ICcnKSwKICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmhhbmRsZVNvcnQoJ2ZpcnN0JyksCiAgICAgICAgICAgICAgdGV4dDogdGhpcy5pMThuLnQoJ3NvcnQtYXNjJykKICAgICAgICAgICAgfSkgOiBudWxsLCB1c2VyID8gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoX2FjdGlvbjJbImRlZmF1bHQiXSwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWFjdGlvbi1zb3J0ZGVzYycgKyAoaXNEZXNjID8gJyBpcy0tYWN0aXZlJyA6ICcnKSwKICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmhhbmRsZVNvcnQoJ2xhc3QnKSwKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmkxOG4udCgnc29ydC1kZXNjJykKICAgICAgICAgICAgfSkgOiBudWxsLCB1c2VyID8gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoX2FjdGlvbjJbImRlZmF1bHQiXSwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWFjdGlvbi1sb2dvdXQnLAogICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuaGFuZGxlTG9nb3V0LAogICAgICAgICAgICAgIHRleHQ6IHRoaXMuaTE4bi50KCdsb2dvdXQnKQogICAgICAgICAgICB9KSA6IF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCdhJywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWFjdGlvbiBndC1hY3Rpb24tbG9naW4nLAogICAgICAgICAgICAgIG9uTW91c2VEb3duOiB0aGlzLmhhbmRsZUxvZ2luCiAgICAgICAgICAgIH0sIHRoaXMuaTE4bi50KCdsb2dpbi13aXRoLWdpdGh1YicpKSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1jb3B5cmlnaHQnCiAgICAgICAgICAgIH0sIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCdhJywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWxpbmsgZ3QtbGluay1wcm9qZWN0JywKICAgICAgICAgICAgICBocmVmOiAnaHR0cHM6Ly9naXRodWIuY29tL2dpdGFsay9naXRhbGsnLAogICAgICAgICAgICAgIHRhcmdldDogJ19ibGFuaycKICAgICAgICAgICAgfSwgJ0dpdGFsaycpLCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnc3BhbicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC12ZXJzaW9uJwogICAgICAgICAgICB9LCBfY29uc3QuR1RfVkVSU0lPTikpKSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC11c2VyJwogICAgICAgICAgICB9LCB1c2VyID8gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6IGlzUG9wdXBWaXNpYmxlID8gJ2d0LXVzZXItaW5uZXIgaXMtLXBvcGluZycgOiAnZ3QtdXNlci1pbm5lcicsCiAgICAgICAgICAgICAgb25DbGljazogdGhpcy5oYW5kbGVQb3B1cAogICAgICAgICAgICB9LCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnc3BhbicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC11c2VyLW5hbWUnCiAgICAgICAgICAgIH0sIHVzZXIubG9naW4pLCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudChfc3ZnMlsiZGVmYXVsdCJdLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3QtaWNvLWFycmRvd24nLAogICAgICAgICAgICAgIG5hbWU6ICdhcnJvd19kb3duJwogICAgICAgICAgICB9KSkgOiBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnZGl2JywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogaXNQb3B1cFZpc2libGUgPyAnZ3QtdXNlci1pbm5lciBpcy0tcG9waW5nJyA6ICdndC11c2VyLWlubmVyJywKICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmhhbmRsZVBvcHVwCiAgICAgICAgICAgIH0sIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCdzcGFuJywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LXVzZXItbmFtZScKICAgICAgICAgICAgfSwgdGhpcy5pMThuLnQoJ2Fub255bW91cycpKSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoX3N2ZzJbImRlZmF1bHQiXSwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWljby1hcnJkb3duJywKICAgICAgICAgICAgICBuYW1lOiAnYXJyb3dfZG93bicKICAgICAgICAgICAgfSkpKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAncmVuZGVyJywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICAgIHZhciBfc3RhdGU2ID0gdGhpcy5zdGF0ZSwKICAgICAgICAgICAgICAgIGlzSW5pdGluZyA9IF9zdGF0ZTYuaXNJbml0aW5nLAogICAgICAgICAgICAgICAgaXNOb0luaXQgPSBfc3RhdGU2LmlzTm9Jbml0LAogICAgICAgICAgICAgICAgaXNPY2N1ckVycm9yID0gX3N0YXRlNi5pc09jY3VyRXJyb3IsCiAgICAgICAgICAgICAgICBlcnJvck1zZyA9IF9zdGF0ZTYuZXJyb3JNc2csCiAgICAgICAgICAgICAgICBpc0lucHV0Rm9jdXNlZCA9IF9zdGF0ZTYuaXNJbnB1dEZvY3VzZWQ7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnZGl2JywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWNvbnRhaW5lcicgKyAoaXNJbnB1dEZvY3VzZWQgPyAnIGd0LWlucHV0LWZvY3VzZWQnIDogJycpCiAgICAgICAgICAgIH0sIGlzSW5pdGluZyAmJiB0aGlzLmluaXRpbmcoKSwgIWlzSW5pdGluZyAmJiAoaXNOb0luaXQgPyBbXSA6IFt0aGlzLm1ldGEoKV0pLCBpc09jY3VyRXJyb3IgJiYgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1lcnJvcicKICAgICAgICAgICAgfSwgZXJyb3JNc2cpLCAhaXNJbml0aW5nICYmIChpc05vSW5pdCA/IFt0aGlzLm5vSW5pdCgpXSA6IFt0aGlzLmhlYWRlcigpLCB0aGlzLmNvbW1lbnRzKCldKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnYWNjZXNzVG9rZW4nLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY2Nlc3NUb2tlIHx8IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShfY29uc3QuR1RfQUNDRVNTX1RPS0VOKTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh0b2tlbikgewogICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oX2NvbnN0LkdUX0FDQ0VTU19UT0tFTiwgdG9rZW4pOwogICAgICAgICAgICB0aGlzLl9hY2Nlc3NUb2tlbiA9IHRva2VuOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2xvZ2luTGluaycsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgdmFyIGdpdGh1Yk9hdXRoVXJsID0gJ2h0dHBzOi8vZ2l0aHViLmNvbS9sb2dpbi9vYXV0aC9hdXRob3JpemUnOwogICAgICAgICAgICB2YXIgY2xpZW50SUQgPSB0aGlzLm9wdGlvbnMuY2xpZW50SUQ7CiAgICAgICAgICAgIHZhciBxdWVyeSA9IHsKICAgICAgICAgICAgICBjbGllbnRfaWQ6IGNsaWVudElELAogICAgICAgICAgICAgIHJlZGlyZWN0X3VyaTogd2luZG93LmxvY2F0aW9uLmhyZWYsCiAgICAgICAgICAgICAgc2NvcGU6ICdwdWJsaWNfcmVwbycKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIGdpdGh1Yk9hdXRoVXJsICsgJz8nICsgKDAsIF91dGlsLnF1ZXJ5U3RyaW5naWZ5KShxdWVyeSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnaXNBZG1pbicsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgdmFyIGFkbWluID0gdGhpcy5vcHRpb25zLmFkbWluOwogICAgICAgICAgICB2YXIgdXNlciA9IHRoaXMuc3RhdGUudXNlcjsKICAgICAgICAgICAgcmV0dXJuIHVzZXIgJiYgfltdLmNvbmNhdChhZG1pbikubWFwKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGEudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfSkuaW5kZXhPZih1c2VyLmxvZ2luLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgfQogICAgICAgIH1dKTsKICAgICAgICByZXR1cm4gR2l0YWxrQ29tcG9uZW50OwogICAgICB9KF9yZWFjdC5Db21wb25lbnQpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBHaXRhbGtDb21wb25lbnQ7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogOTkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICAiZGVmYXVsdCI6IF9fd2VicGFja19yZXF1aXJlX18oMTAwKSwKICAgICAgICBfX2VzTW9kdWxlOiB0cnVlCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTAwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXyg1MCk7CgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwKTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMjcpOwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygxMDkpOwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygxMTcpOwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygxMTgpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApLlByb21pc2U7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTAxICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oMzQpOwoKICAgICAgdmFyIGRlZmluZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM1KTsgLy8gdHJ1ZSAgLT4gU3RyaW5nI2F0CiAgICAgIC8vIGZhbHNlIC0+IFN0cmluZyNjb2RlUG9pbnRBdAoKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKFRPX1NUUklORykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodGhhdCwgcG9zKSB7CiAgICAgICAgICB2YXIgcyA9IFN0cmluZyhkZWZpbmVkKHRoYXQpKTsKICAgICAgICAgIHZhciBpID0gdG9JbnRlZ2VyKHBvcyk7CiAgICAgICAgICB2YXIgbCA9IHMubGVuZ3RoOwogICAgICAgICAgdmFyIGEsIGI7CiAgICAgICAgICBpZiAoaSA8IDAgfHwgaSA+PSBsKSByZXR1cm4gVE9fU1RSSU5HID8gJycgOiB1bmRlZmluZWQ7CiAgICAgICAgICBhID0gcy5jaGFyQ29kZUF0KGkpOwogICAgICAgICAgcmV0dXJuIGEgPCAweGQ4MDAgfHwgYSA+IDB4ZGJmZiB8fCBpICsgMSA9PT0gbCB8fCAoYiA9IHMuY2hhckNvZGVBdChpICsgMSkpIDwgMHhkYzAwIHx8IGIgPiAweGRmZmYgPyBUT19TVFJJTkcgPyBzLmNoYXJBdChpKSA6IGEgOiBUT19TVFJJTkcgPyBzLnNsaWNlKGksIGkgKyAyKSA6IChhIC0gMHhkODAwIDw8IDEwKSArIChiIC0gMHhkYzAwKSArIDB4MTAwMDA7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTAyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgdmFyIGNyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMzYpOwoKICAgICAgdmFyIGRlc2NyaXB0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE5KTsKCiAgICAgIHZhciBzZXRUb1N0cmluZ1RhZyA9IF9fd2VicGFja19yZXF1aXJlX18oMjYpOwoKICAgICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307IC8vIDI1LjEuMi4xLjEgJUl0ZXJhdG9yUHJvdG90eXBlJVtAQGl0ZXJhdG9yXSgpCgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKShJdGVyYXRvclByb3RvdHlwZSwgX193ZWJwYWNrX3JlcXVpcmVfXygyKSgnaXRlcmF0b3InKSwgZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9KTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBOQU1FLCBuZXh0KSB7CiAgICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlID0gY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlLCB7CiAgICAgICAgICBuZXh0OiBkZXNjcmlwdG9yKDEsIG5leHQpCiAgICAgICAgfSk7CiAgICAgICAgc2V0VG9TdHJpbmdUYWcoQ29uc3RydWN0b3IsIE5BTUUgKyAnIEl0ZXJhdG9yJyk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDEwMyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBkUCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7CgogICAgICB2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwoKICAgICAgdmFyIGdldEtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIyKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzIDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKSB7CiAgICAgICAgYW5PYmplY3QoTyk7CiAgICAgICAgdmFyIGtleXMgPSBnZXRLZXlzKFByb3BlcnRpZXMpOwogICAgICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgdmFyIFA7CgogICAgICAgIHdoaWxlIChsZW5ndGggPiBpKSB7CiAgICAgICAgICBkUC5mKE8sIFAgPSBrZXlzW2krK10sIFByb3BlcnRpZXNbUF0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIE87CiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTA0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gZmFsc2UgLT4gQXJyYXkjaW5kZXhPZgogICAgICAvLyB0cnVlICAtPiBBcnJheSNpbmNsdWRlcwogICAgICB2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNik7CgogICAgICB2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM3KTsKCiAgICAgIHZhciB0b0Fic29sdXRlSW5kZXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwNSk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChJU19JTkNMVURFUykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGVsLCBmcm9tSW5kZXgpIHsKICAgICAgICAgIHZhciBPID0gdG9JT2JqZWN0KCR0aGlzKTsKICAgICAgICAgIHZhciBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7CiAgICAgICAgICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgoZnJvbUluZGV4LCBsZW5ndGgpOwogICAgICAgICAgdmFyIHZhbHVlOyAvLyBBcnJheSNpbmNsdWRlcyB1c2VzIFNhbWVWYWx1ZVplcm8gZXF1YWxpdHkgYWxnb3JpdGhtCiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCgogICAgICAgICAgaWYgKElTX0lOQ0xVREVTICYmIGVsICE9IGVsKSB3aGlsZSAobGVuZ3RoID4gaW5kZXgpIHsKICAgICAgICAgICAgdmFsdWUgPSBPW2luZGV4KytdOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCgogICAgICAgICAgICBpZiAodmFsdWUgIT0gdmFsdWUpIHJldHVybiB0cnVlOyAvLyBBcnJheSNpbmRleE9mIGlnbm9yZXMgaG9sZXMsIEFycmF5I2luY2x1ZGVzIC0gbm90CiAgICAgICAgICB9IGVsc2UgZm9yICg7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CiAgICAgICAgICAgIGlmIChJU19JTkNMVURFUyB8fCBpbmRleCBpbiBPKSB7CiAgICAgICAgICAgICAgaWYgKE9baW5kZXhdID09PSBlbCkgcmV0dXJuIElTX0lOQ0xVREVTIHx8IGluZGV4IHx8IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAhSVNfSU5DTFVERVMgJiYgLTE7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTA1ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oMzQpOwoKICAgICAgdmFyIG1heCA9IE1hdGgubWF4OwogICAgICB2YXIgbWluID0gTWF0aC5taW47CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpbmRleCwgbGVuZ3RoKSB7CiAgICAgICAgaW5kZXggPSB0b0ludGVnZXIoaW5kZXgpOwogICAgICAgIHJldHVybiBpbmRleCA8IDAgPyBtYXgoaW5kZXggKyBsZW5ndGgsIDApIDogbWluKGluZGV4LCBsZW5ndGgpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMDYgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgYWRkVG9VbnNjb3BhYmxlcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTA3KTsKCiAgICAgIHZhciBzdGVwID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMDgpOwoKICAgICAgdmFyIEl0ZXJhdG9ycyA9IF9fd2VicGFja19yZXF1aXJlX18oMTUpOwoKICAgICAgdmFyIHRvSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTYpOyAvLyAyMi4xLjMuNCBBcnJheS5wcm90b3R5cGUuZW50cmllcygpCiAgICAgIC8vIDIyLjEuMy4xMyBBcnJheS5wcm90b3R5cGUua2V5cygpCiAgICAgIC8vIDIyLjEuMy4yOSBBcnJheS5wcm90b3R5cGUudmFsdWVzKCkKICAgICAgLy8gMjIuMS4zLjMwIEFycmF5LnByb3RvdHlwZVtAQGl0ZXJhdG9yXSgpCgoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxKShBcnJheSwgJ0FycmF5JywgZnVuY3Rpb24gKGl0ZXJhdGVkLCBraW5kKSB7CiAgICAgICAgdGhpcy5fdCA9IHRvSU9iamVjdChpdGVyYXRlZCk7IC8vIHRhcmdldAoKICAgICAgICB0aGlzLl9pID0gMDsgLy8gbmV4dCBpbmRleAoKICAgICAgICB0aGlzLl9rID0ga2luZDsgLy8ga2luZAogICAgICAgIC8vIDIyLjEuNS4yLjEgJUFycmF5SXRlcmF0b3JQcm90b3R5cGUlLm5leHQoKQogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIE8gPSB0aGlzLl90OwogICAgICAgIHZhciBraW5kID0gdGhpcy5fazsKICAgICAgICB2YXIgaW5kZXggPSB0aGlzLl9pKys7CgogICAgICAgIGlmICghTyB8fCBpbmRleCA+PSBPLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5fdCA9IHVuZGVmaW5lZDsKICAgICAgICAgIHJldHVybiBzdGVwKDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGtpbmQgPT0gJ2tleXMnKSByZXR1cm4gc3RlcCgwLCBpbmRleCk7CiAgICAgICAgaWYgKGtpbmQgPT0gJ3ZhbHVlcycpIHJldHVybiBzdGVwKDAsIE9baW5kZXhdKTsKICAgICAgICByZXR1cm4gc3RlcCgwLCBbaW5kZXgsIE9baW5kZXhdXSk7CiAgICAgIH0sICd2YWx1ZXMnKTsgLy8gYXJndW1lbnRzTGlzdFtAQGl0ZXJhdG9yXSBpcyAlQXJyYXlQcm90b192YWx1ZXMlICg5LjQuNC42LCA5LjQuNC43KQoKICAgICAgSXRlcmF0b3JzLkFyZ3VtZW50cyA9IEl0ZXJhdG9ycy5BcnJheTsKICAgICAgYWRkVG9VbnNjb3BhYmxlcygna2V5cycpOwogICAgICBhZGRUb1Vuc2NvcGFibGVzKCd2YWx1ZXMnKTsKICAgICAgYWRkVG9VbnNjb3BhYmxlcygnZW50cmllcycpOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDEwNyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKCkgewogICAgICAgIC8qIGVtcHR5ICovCiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDEwOCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGRvbmUsIHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgIGRvbmU6ICEhZG9uZQogICAgICAgIH07CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDEwOSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciBMSUJSQVJZID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMSk7CgogICAgICB2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgICAgIHZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKTsKCiAgICAgIHZhciBjbGFzc29mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MSk7CgogICAgICB2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7CgogICAgICB2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKCiAgICAgIHZhciBhRnVuY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0KTsKCiAgICAgIHZhciBhbkluc3RhbmNlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMTApOwoKICAgICAgdmFyIGZvck9mID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMTEpOwoKICAgICAgdmFyIHNwZWNpZXNDb25zdHJ1Y3RvciA9IF9fd2VicGFja19yZXF1aXJlX18oNTkpOwoKICAgICAgdmFyIHRhc2sgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYwKS5zZXQ7CgogICAgICB2YXIgbWljcm90YXNrID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMTMpKCk7CgogICAgICB2YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQzKTsKCiAgICAgIHZhciBwZXJmb3JtID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MSk7CgogICAgICB2YXIgdXNlckFnZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMTQpOwoKICAgICAgdmFyIHByb21pc2VSZXNvbHZlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Mik7CgogICAgICB2YXIgUFJPTUlTRSA9ICdQcm9taXNlJzsKICAgICAgdmFyIFR5cGVFcnJvciA9IGdsb2JhbC5UeXBlRXJyb3I7CiAgICAgIHZhciBwcm9jZXNzID0gZ2xvYmFsLnByb2Nlc3M7CiAgICAgIHZhciB2ZXJzaW9ucyA9IHByb2Nlc3MgJiYgcHJvY2Vzcy52ZXJzaW9uczsKICAgICAgdmFyIHY4ID0gdmVyc2lvbnMgJiYgdmVyc2lvbnMudjggfHwgJyc7CiAgICAgIHZhciAkUHJvbWlzZSA9IGdsb2JhbFtQUk9NSVNFXTsKICAgICAgdmFyIGlzTm9kZSA9IGNsYXNzb2YocHJvY2VzcykgPT0gJ3Byb2Nlc3MnOwoKICAgICAgdmFyIGVtcHR5ID0gZnVuY3Rpb24gZW1wdHkoKSB7CiAgICAgICAgLyogZW1wdHkgKi8KICAgICAgfTsKCiAgICAgIHZhciBJbnRlcm5hbCwgbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5LCBPd25Qcm9taXNlQ2FwYWJpbGl0eSwgV3JhcHBlcjsKICAgICAgdmFyIG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUuZjsKICAgICAgdmFyIFVTRV9OQVRJVkUgPSAhIWZ1bmN0aW9uICgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgLy8gY29ycmVjdCBzdWJjbGFzc2luZyB3aXRoIEBAc3BlY2llcyBzdXBwb3J0CiAgICAgICAgICB2YXIgcHJvbWlzZSA9ICRQcm9taXNlLnJlc29sdmUoMSk7CgogICAgICAgICAgdmFyIEZha2VQcm9taXNlID0gKHByb21pc2UuY29uc3RydWN0b3IgPSB7fSlbX193ZWJwYWNrX3JlcXVpcmVfXygyKSgnc3BlY2llcycpXSA9IGZ1bmN0aW9uIChleGVjKSB7CiAgICAgICAgICAgIGV4ZWMoZW1wdHksIGVtcHR5KTsKICAgICAgICAgIH07IC8vIHVuaGFuZGxlZCByZWplY3Rpb25zIHRyYWNraW5nIHN1cHBvcnQsIE5vZGVKUyBQcm9taXNlIHdpdGhvdXQgaXQgZmFpbHMgQEBzcGVjaWVzIHRlc3QKCgogICAgICAgICAgcmV0dXJuIChpc05vZGUgfHwgdHlwZW9mIFByb21pc2VSZWplY3Rpb25FdmVudCA9PSAnZnVuY3Rpb24nKSAmJiBwcm9taXNlLnRoZW4oZW1wdHkpIGluc3RhbmNlb2YgRmFrZVByb21pc2UgLy8gdjggNi42IChOb2RlIDEwIGFuZCBDaHJvbWUgNjYpIGhhdmUgYSBidWcgd2l0aCByZXNvbHZpbmcgY3VzdG9tIHRoZW5hYmxlcwogICAgICAgICAgLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9ODMwNTY1CiAgICAgICAgICAvLyB3ZSBjYW4ndCBkZXRlY3QgaXQgc3luY2hyb25vdXNseSwgc28ganVzdCBjaGVjayB2ZXJzaW9ucwogICAgICAgICAgJiYgdjguaW5kZXhPZignNi42JykgIT09IDAgJiYgdXNlckFnZW50LmluZGV4T2YoJ0Nocm9tZS82NicpID09PSAtMTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAvKiBlbXB0eSAqLwogICAgICAgIH0KICAgICAgfSgpOyAvLyBoZWxwZXJzCgogICAgICB2YXIgaXNUaGVuYWJsZSA9IGZ1bmN0aW9uIGlzVGhlbmFibGUoaXQpIHsKICAgICAgICB2YXIgdGhlbjsKICAgICAgICByZXR1cm4gaXNPYmplY3QoaXQpICYmIHR5cGVvZiAodGhlbiA9IGl0LnRoZW4pID09ICdmdW5jdGlvbicgPyB0aGVuIDogZmFsc2U7CiAgICAgIH07CgogICAgICB2YXIgbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KHByb21pc2UsIGlzUmVqZWN0KSB7CiAgICAgICAgaWYgKHByb21pc2UuX24pIHJldHVybjsKICAgICAgICBwcm9taXNlLl9uID0gdHJ1ZTsKICAgICAgICB2YXIgY2hhaW4gPSBwcm9taXNlLl9jOwogICAgICAgIG1pY3JvdGFzayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBwcm9taXNlLl92OwogICAgICAgICAgdmFyIG9rID0gcHJvbWlzZS5fcyA9PSAxOwogICAgICAgICAgdmFyIGkgPSAwOwoKICAgICAgICAgIHZhciBydW4gPSBmdW5jdGlvbiBydW4ocmVhY3Rpb24pIHsKICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSBvayA/IHJlYWN0aW9uLm9rIDogcmVhY3Rpb24uZmFpbDsKICAgICAgICAgICAgdmFyIHJlc29sdmUgPSByZWFjdGlvbi5yZXNvbHZlOwogICAgICAgICAgICB2YXIgcmVqZWN0ID0gcmVhY3Rpb24ucmVqZWN0OwogICAgICAgICAgICB2YXIgZG9tYWluID0gcmVhY3Rpb24uZG9tYWluOwogICAgICAgICAgICB2YXIgcmVzdWx0LCB0aGVuLCBleGl0ZWQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGlmIChoYW5kbGVyKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9rKSB7CiAgICAgICAgICAgICAgICAgIGlmIChwcm9taXNlLl9oID09IDIpIG9uSGFuZGxlVW5oYW5kbGVkKHByb21pc2UpOwogICAgICAgICAgICAgICAgICBwcm9taXNlLl9oID0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlciA9PT0gdHJ1ZSkgcmVzdWx0ID0gdmFsdWU7ZWxzZSB7CiAgICAgICAgICAgICAgICAgIGlmIChkb21haW4pIGRvbWFpbi5lbnRlcigpOwogICAgICAgICAgICAgICAgICByZXN1bHQgPSBoYW5kbGVyKHZhbHVlKTsgLy8gbWF5IHRocm93CgogICAgICAgICAgICAgICAgICBpZiAoZG9tYWluKSB7CiAgICAgICAgICAgICAgICAgICAgZG9tYWluLmV4aXQoKTsKICAgICAgICAgICAgICAgICAgICBleGl0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gcmVhY3Rpb24ucHJvbWlzZSkgewogICAgICAgICAgICAgICAgICByZWplY3QoVHlwZUVycm9yKCdQcm9taXNlLWNoYWluIGN5Y2xlJykpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGVuID0gaXNUaGVuYWJsZShyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICAgIHRoZW4uY2FsbChyZXN1bHQsIHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgcmVzb2x2ZShyZXN1bHQpOwogICAgICAgICAgICAgIH0gZWxzZSByZWplY3QodmFsdWUpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgaWYgKGRvbWFpbiAmJiAhZXhpdGVkKSBkb21haW4uZXhpdCgpOwogICAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICB3aGlsZSAoY2hhaW4ubGVuZ3RoID4gaSkgewogICAgICAgICAgICBydW4oY2hhaW5baSsrXSk7CiAgICAgICAgICB9IC8vIHZhcmlhYmxlIGxlbmd0aCAtIGNhbid0IHVzZSBmb3JFYWNoCgoKICAgICAgICAgIHByb21pc2UuX2MgPSBbXTsKICAgICAgICAgIHByb21pc2UuX24gPSBmYWxzZTsKICAgICAgICAgIGlmIChpc1JlamVjdCAmJiAhcHJvbWlzZS5faCkgb25VbmhhbmRsZWQocHJvbWlzZSk7CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICB2YXIgb25VbmhhbmRsZWQgPSBmdW5jdGlvbiBvblVuaGFuZGxlZChwcm9taXNlKSB7CiAgICAgICAgdGFzay5jYWxsKGdsb2JhbCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHZhbHVlID0gcHJvbWlzZS5fdjsKICAgICAgICAgIHZhciB1bmhhbmRsZWQgPSBpc1VuaGFuZGxlZChwcm9taXNlKTsKICAgICAgICAgIHZhciByZXN1bHQsIGhhbmRsZXIsIGNvbnNvbGU7CgogICAgICAgICAgaWYgKHVuaGFuZGxlZCkgewogICAgICAgICAgICByZXN1bHQgPSBwZXJmb3JtKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoaXNOb2RlKSB7CiAgICAgICAgICAgICAgICBwcm9jZXNzLmVtaXQoJ3VuaGFuZGxlZFJlamVjdGlvbicsIHZhbHVlLCBwcm9taXNlKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhbmRsZXIgPSBnbG9iYWwub251bmhhbmRsZWRyZWplY3Rpb24pIHsKICAgICAgICAgICAgICAgIGhhbmRsZXIoewogICAgICAgICAgICAgICAgICBwcm9taXNlOiBwcm9taXNlLAogICAgICAgICAgICAgICAgICByZWFzb246IHZhbHVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKChjb25zb2xlID0gZ2xvYmFsLmNvbnNvbGUpICYmIGNvbnNvbGUuZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VuaGFuZGxlZCBwcm9taXNlIHJlamVjdGlvbicsIHZhbHVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOyAvLyBCcm93c2VycyBzaG91bGQgbm90IHRyaWdnZXIgYHJlamVjdGlvbkhhbmRsZWRgIGV2ZW50IGlmIGl0IHdhcyBoYW5kbGVkIGhlcmUsIE5vZGVKUyAtIHNob3VsZAoKICAgICAgICAgICAgcHJvbWlzZS5faCA9IGlzTm9kZSB8fCBpc1VuaGFuZGxlZChwcm9taXNlKSA/IDIgOiAxOwogICAgICAgICAgfQoKICAgICAgICAgIHByb21pc2UuX2EgPSB1bmRlZmluZWQ7CiAgICAgICAgICBpZiAodW5oYW5kbGVkICYmIHJlc3VsdC5lKSB0aHJvdyByZXN1bHQudjsKICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIHZhciBpc1VuaGFuZGxlZCA9IGZ1bmN0aW9uIGlzVW5oYW5kbGVkKHByb21pc2UpIHsKICAgICAgICByZXR1cm4gcHJvbWlzZS5faCAhPT0gMSAmJiAocHJvbWlzZS5fYSB8fCBwcm9taXNlLl9jKS5sZW5ndGggPT09IDA7CiAgICAgIH07CgogICAgICB2YXIgb25IYW5kbGVVbmhhbmRsZWQgPSBmdW5jdGlvbiBvbkhhbmRsZVVuaGFuZGxlZChwcm9taXNlKSB7CiAgICAgICAgdGFzay5jYWxsKGdsb2JhbCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGhhbmRsZXI7CgogICAgICAgICAgaWYgKGlzTm9kZSkgewogICAgICAgICAgICBwcm9jZXNzLmVtaXQoJ3JlamVjdGlvbkhhbmRsZWQnLCBwcm9taXNlKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaGFuZGxlciA9IGdsb2JhbC5vbnJlamVjdGlvbmhhbmRsZWQpIHsKICAgICAgICAgICAgaGFuZGxlcih7CiAgICAgICAgICAgICAgcHJvbWlzZTogcHJvbWlzZSwKICAgICAgICAgICAgICByZWFzb246IHByb21pc2UuX3YKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICB2YXIgJHJlamVjdCA9IGZ1bmN0aW9uICRyZWplY3QodmFsdWUpIHsKICAgICAgICB2YXIgcHJvbWlzZSA9IHRoaXM7CiAgICAgICAgaWYgKHByb21pc2UuX2QpIHJldHVybjsKICAgICAgICBwcm9taXNlLl9kID0gdHJ1ZTsKICAgICAgICBwcm9taXNlID0gcHJvbWlzZS5fdyB8fCBwcm9taXNlOyAvLyB1bndyYXAKCiAgICAgICAgcHJvbWlzZS5fdiA9IHZhbHVlOwogICAgICAgIHByb21pc2UuX3MgPSAyOwogICAgICAgIGlmICghcHJvbWlzZS5fYSkgcHJvbWlzZS5fYSA9IHByb21pc2UuX2Muc2xpY2UoKTsKICAgICAgICBub3RpZnkocHJvbWlzZSwgdHJ1ZSk7CiAgICAgIH07CgogICAgICB2YXIgJHJlc29sdmUgPSBmdW5jdGlvbiAkcmVzb2x2ZSh2YWx1ZSkgewogICAgICAgIHZhciBwcm9taXNlID0gdGhpczsKICAgICAgICB2YXIgdGhlbjsKICAgICAgICBpZiAocHJvbWlzZS5fZCkgcmV0dXJuOwogICAgICAgIHByb21pc2UuX2QgPSB0cnVlOwogICAgICAgIHByb21pc2UgPSBwcm9taXNlLl93IHx8IHByb21pc2U7IC8vIHVud3JhcAoKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKHByb21pc2UgPT09IHZhbHVlKSB0aHJvdyBUeXBlRXJyb3IoIlByb21pc2UgY2FuJ3QgYmUgcmVzb2x2ZWQgaXRzZWxmIik7CgogICAgICAgICAgaWYgKHRoZW4gPSBpc1RoZW5hYmxlKHZhbHVlKSkgewogICAgICAgICAgICBtaWNyb3Rhc2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciB3cmFwcGVyID0gewogICAgICAgICAgICAgICAgX3c6IHByb21pc2UsCiAgICAgICAgICAgICAgICBfZDogZmFsc2UKICAgICAgICAgICAgICB9OyAvLyB3cmFwCgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB0aGVuLmNhbGwodmFsdWUsIGN0eCgkcmVzb2x2ZSwgd3JhcHBlciwgMSksIGN0eCgkcmVqZWN0LCB3cmFwcGVyLCAxKSk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgJHJlamVjdC5jYWxsKHdyYXBwZXIsIGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcm9taXNlLl92ID0gdmFsdWU7CiAgICAgICAgICAgIHByb21pc2UuX3MgPSAxOwogICAgICAgICAgICBub3RpZnkocHJvbWlzZSwgZmFsc2UpOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICRyZWplY3QuY2FsbCh7CiAgICAgICAgICAgIF93OiBwcm9taXNlLAogICAgICAgICAgICBfZDogZmFsc2UKICAgICAgICAgIH0sIGUpOyAvLyB3cmFwCiAgICAgICAgfQogICAgICB9OyAvLyBjb25zdHJ1Y3RvciBwb2x5ZmlsbAoKCiAgICAgIGlmICghVVNFX05BVElWRSkgewogICAgICAgIC8vIDI1LjQuMy4xIFByb21pc2UoZXhlY3V0b3IpCiAgICAgICAgJFByb21pc2UgPSBmdW5jdGlvbiBQcm9taXNlKGV4ZWN1dG9yKSB7CiAgICAgICAgICBhbkluc3RhbmNlKHRoaXMsICRQcm9taXNlLCBQUk9NSVNFLCAnX2gnKTsKICAgICAgICAgIGFGdW5jdGlvbihleGVjdXRvcik7CiAgICAgICAgICBJbnRlcm5hbC5jYWxsKHRoaXMpOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGV4ZWN1dG9yKGN0eCgkcmVzb2x2ZSwgdGhpcywgMSksIGN0eCgkcmVqZWN0LCB0aGlzLCAxKSk7CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgJHJlamVjdC5jYWxsKHRoaXMsIGVycik7CiAgICAgICAgICB9CiAgICAgICAgfTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzCgoKICAgICAgICBJbnRlcm5hbCA9IGZ1bmN0aW9uIFByb21pc2UoZXhlY3V0b3IpIHsKICAgICAgICAgIHRoaXMuX2MgPSBbXTsgLy8gPC0gYXdhaXRpbmcgcmVhY3Rpb25zCgogICAgICAgICAgdGhpcy5fYSA9IHVuZGVmaW5lZDsgLy8gPC0gY2hlY2tlZCBpbiBpc1VuaGFuZGxlZCByZWFjdGlvbnMKCiAgICAgICAgICB0aGlzLl9zID0gMDsgLy8gPC0gc3RhdGUKCiAgICAgICAgICB0aGlzLl9kID0gZmFsc2U7IC8vIDwtIGRvbmUKCiAgICAgICAgICB0aGlzLl92ID0gdW5kZWZpbmVkOyAvLyA8LSB2YWx1ZQoKICAgICAgICAgIHRoaXMuX2ggPSAwOyAvLyA8LSByZWplY3Rpb24gc3RhdGUsIDAgLSBkZWZhdWx0LCAxIC0gaGFuZGxlZCwgMiAtIHVuaGFuZGxlZAoKICAgICAgICAgIHRoaXMuX24gPSBmYWxzZTsgLy8gPC0gbm90aWZ5CiAgICAgICAgfTsKCiAgICAgICAgSW50ZXJuYWwucHJvdG90eXBlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMTUpKCRQcm9taXNlLnByb3RvdHlwZSwgewogICAgICAgICAgLy8gMjUuNC41LjMgUHJvbWlzZS5wcm90b3R5cGUudGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkKICAgICAgICAgIHRoZW46IGZ1bmN0aW9uIHRoZW4ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpIHsKICAgICAgICAgICAgdmFyIHJlYWN0aW9uID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoc3BlY2llc0NvbnN0cnVjdG9yKHRoaXMsICRQcm9taXNlKSk7CiAgICAgICAgICAgIHJlYWN0aW9uLm9rID0gdHlwZW9mIG9uRnVsZmlsbGVkID09ICdmdW5jdGlvbicgPyBvbkZ1bGZpbGxlZCA6IHRydWU7CiAgICAgICAgICAgIHJlYWN0aW9uLmZhaWwgPSB0eXBlb2Ygb25SZWplY3RlZCA9PSAnZnVuY3Rpb24nICYmIG9uUmVqZWN0ZWQ7CiAgICAgICAgICAgIHJlYWN0aW9uLmRvbWFpbiA9IGlzTm9kZSA/IHByb2Nlc3MuZG9tYWluIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgdGhpcy5fYy5wdXNoKHJlYWN0aW9uKTsKCiAgICAgICAgICAgIGlmICh0aGlzLl9hKSB0aGlzLl9hLnB1c2gocmVhY3Rpb24pOwogICAgICAgICAgICBpZiAodGhpcy5fcykgbm90aWZ5KHRoaXMsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIHJlYWN0aW9uLnByb21pc2U7CiAgICAgICAgICB9LAogICAgICAgICAgLy8gMjUuNC41LjEgUHJvbWlzZS5wcm90b3R5cGUuY2F0Y2gob25SZWplY3RlZCkKICAgICAgICAgICdjYXRjaCc6IGZ1bmN0aW9uIF9jYXRjaChvblJlamVjdGVkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRoZW4odW5kZWZpbmVkLCBvblJlamVjdGVkKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgT3duUHJvbWlzZUNhcGFiaWxpdHkgPSBmdW5jdGlvbiBPd25Qcm9taXNlQ2FwYWJpbGl0eSgpIHsKICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IEludGVybmFsKCk7CiAgICAgICAgICB0aGlzLnByb21pc2UgPSBwcm9taXNlOwogICAgICAgICAgdGhpcy5yZXNvbHZlID0gY3R4KCRyZXNvbHZlLCBwcm9taXNlLCAxKTsKICAgICAgICAgIHRoaXMucmVqZWN0ID0gY3R4KCRyZWplY3QsIHByb21pc2UsIDEpOwogICAgICAgIH07CgogICAgICAgIG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlLmYgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IGZ1bmN0aW9uIG5ld1Byb21pc2VDYXBhYmlsaXR5KEMpIHsKICAgICAgICAgIHJldHVybiBDID09PSAkUHJvbWlzZSB8fCBDID09PSBXcmFwcGVyID8gbmV3IE93blByb21pc2VDYXBhYmlsaXR5KEMpIDogbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5KEMpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgICRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsIHsKICAgICAgICBQcm9taXNlOiAkUHJvbWlzZQogICAgICB9KTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMjYpKCRQcm9taXNlLCBQUk9NSVNFKTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMTE2KShQUk9NSVNFKTsKCiAgICAgIFdyYXBwZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApW1BST01JU0VdOyAvLyBzdGF0aWNzCgogICAgICAkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFVU0VfTkFUSVZFLCBQUk9NSVNFLCB7CiAgICAgICAgLy8gMjUuNC40LjUgUHJvbWlzZS5yZWplY3QocikKICAgICAgICByZWplY3Q6IGZ1bmN0aW9uIHJlamVjdChyKSB7CiAgICAgICAgICB2YXIgY2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KHRoaXMpOwogICAgICAgICAgdmFyICQkcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAgICAgICAkJHJlamVjdChyKTsKICAgICAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAoTElCUkFSWSB8fCAhVVNFX05BVElWRSksIFBST01JU0UsIHsKICAgICAgICAvLyAyNS40LjQuNiBQcm9taXNlLnJlc29sdmUoeCkKICAgICAgICByZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKHgpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZShMSUJSQVJZICYmIHRoaXMgPT09IFdyYXBwZXIgPyAkUHJvbWlzZSA6IHRoaXMsIHgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgICRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIShVU0VfTkFUSVZFICYmIF9fd2VicGFja19yZXF1aXJlX18oNjMpKGZ1bmN0aW9uIChpdGVyKSB7CiAgICAgICAgJFByb21pc2UuYWxsKGl0ZXIpWydjYXRjaCddKGVtcHR5KTsKICAgICAgfSkpLCBQUk9NSVNFLCB7CiAgICAgICAgLy8gMjUuNC40LjEgUHJvbWlzZS5hbGwoaXRlcmFibGUpCiAgICAgICAgYWxsOiBmdW5jdGlvbiBhbGwoaXRlcmFibGUpIHsKICAgICAgICAgIHZhciBDID0gdGhpczsKICAgICAgICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoQyk7CiAgICAgICAgICB2YXIgcmVzb2x2ZSA9IGNhcGFiaWxpdHkucmVzb2x2ZTsKICAgICAgICAgIHZhciByZWplY3QgPSBjYXBhYmlsaXR5LnJlamVjdDsKICAgICAgICAgIHZhciByZXN1bHQgPSBwZXJmb3JtKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHZhbHVlcyA9IFtdOwogICAgICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgICAgICB2YXIgcmVtYWluaW5nID0gMTsKICAgICAgICAgICAgZm9yT2YoaXRlcmFibGUsIGZhbHNlLCBmdW5jdGlvbiAocHJvbWlzZSkgewogICAgICAgICAgICAgIHZhciAkaW5kZXggPSBpbmRleCsrOwogICAgICAgICAgICAgIHZhciBhbHJlYWR5Q2FsbGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgdmFsdWVzLnB1c2godW5kZWZpbmVkKTsKICAgICAgICAgICAgICByZW1haW5pbmcrKzsKICAgICAgICAgICAgICBDLnJlc29sdmUocHJvbWlzZSkudGhlbihmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmIChhbHJlYWR5Q2FsbGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBhbHJlYWR5Q2FsbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZhbHVlc1skaW5kZXhdID0gdmFsdWU7CiAgICAgICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7CiAgICAgICAgICAgICAgfSwgcmVqZWN0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC0tcmVtYWluaW5nIHx8IHJlc29sdmUodmFsdWVzKTsKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKHJlc3VsdC5lKSByZWplY3QocmVzdWx0LnYpOwogICAgICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICB9LAogICAgICAgIC8vIDI1LjQuNC40IFByb21pc2UucmFjZShpdGVyYWJsZSkKICAgICAgICByYWNlOiBmdW5jdGlvbiByYWNlKGl0ZXJhYmxlKSB7CiAgICAgICAgICB2YXIgQyA9IHRoaXM7CiAgICAgICAgICB2YXIgY2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KEMpOwogICAgICAgICAgdmFyIHJlamVjdCA9IGNhcGFiaWxpdHkucmVqZWN0OwogICAgICAgICAgdmFyIHJlc3VsdCA9IHBlcmZvcm0oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmb3JPZihpdGVyYWJsZSwgZmFsc2UsIGZ1bmN0aW9uIChwcm9taXNlKSB7CiAgICAgICAgICAgICAgQy5yZXNvbHZlKHByb21pc2UpLnRoZW4oY2FwYWJpbGl0eS5yZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKHJlc3VsdC5lKSByZWplY3QocmVzdWx0LnYpOwogICAgICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDExMCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBDb25zdHJ1Y3RvciwgbmFtZSwgZm9yYmlkZGVuRmllbGQpIHsKICAgICAgICBpZiAoIShpdCBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSB8fCBmb3JiaWRkZW5GaWVsZCAhPT0gdW5kZWZpbmVkICYmIGZvcmJpZGRlbkZpZWxkIGluIGl0KSB7CiAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IobmFtZSArICc6IGluY29ycmVjdCBpbnZvY2F0aW9uIScpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGl0OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMTEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgY3R4ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7CgogICAgICB2YXIgY2FsbCA9IF9fd2VicGFja19yZXF1aXJlX18oNTcpOwoKICAgICAgdmFyIGlzQXJyYXlJdGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1OCk7CgogICAgICB2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwoKICAgICAgdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNyk7CgogICAgICB2YXIgZ2V0SXRlckZuID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Mik7CgogICAgICB2YXIgQlJFQUsgPSB7fTsKICAgICAgdmFyIFJFVFVSTiA9IHt9OwoKICAgICAgdmFyIGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdGVyYWJsZSwgZW50cmllcywgZm4sIHRoYXQsIElURVJBVE9SKSB7CiAgICAgICAgdmFyIGl0ZXJGbiA9IElURVJBVE9SID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGl0ZXJhYmxlOwogICAgICAgIH0gOiBnZXRJdGVyRm4oaXRlcmFibGUpOwogICAgICAgIHZhciBmID0gY3R4KGZuLCB0aGF0LCBlbnRyaWVzID8gMiA6IDEpOwogICAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgICAgdmFyIGxlbmd0aCwgc3RlcCwgaXRlcmF0b3IsIHJlc3VsdDsKICAgICAgICBpZiAodHlwZW9mIGl0ZXJGbiAhPSAnZnVuY3Rpb24nKSB0aHJvdyBUeXBlRXJyb3IoaXRlcmFibGUgKyAnIGlzIG5vdCBpdGVyYWJsZSEnKTsgLy8gZmFzdCBjYXNlIGZvciBhcnJheXMgd2l0aCBkZWZhdWx0IGl0ZXJhdG9yCgogICAgICAgIGlmIChpc0FycmF5SXRlcihpdGVyRm4pKSBmb3IgKGxlbmd0aCA9IHRvTGVuZ3RoKGl0ZXJhYmxlLmxlbmd0aCk7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CiAgICAgICAgICByZXN1bHQgPSBlbnRyaWVzID8gZihhbk9iamVjdChzdGVwID0gaXRlcmFibGVbaW5kZXhdKVswXSwgc3RlcFsxXSkgOiBmKGl0ZXJhYmxlW2luZGV4XSk7CiAgICAgICAgICBpZiAocmVzdWx0ID09PSBCUkVBSyB8fCByZXN1bHQgPT09IFJFVFVSTikgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9IGVsc2UgZm9yIChpdGVyYXRvciA9IGl0ZXJGbi5jYWxsKGl0ZXJhYmxlKTsgIShzdGVwID0gaXRlcmF0b3IubmV4dCgpKS5kb25lOykgewogICAgICAgICAgcmVzdWx0ID0gY2FsbChpdGVyYXRvciwgZiwgc3RlcC52YWx1ZSwgZW50cmllcyk7CiAgICAgICAgICBpZiAocmVzdWx0ID09PSBCUkVBSyB8fCByZXN1bHQgPT09IFJFVFVSTikgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgIH07CgogICAgICBleHBvcnRzLkJSRUFLID0gQlJFQUs7CiAgICAgIGV4cG9ydHMuUkVUVVJOID0gUkVUVVJOOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDExMiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIC8vIGZhc3QgYXBwbHksIGh0dHA6Ly9qc3BlcmYubG5raXQuY29tL2Zhc3QtYXBwbHkvNQogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChmbiwgYXJncywgdGhhdCkgewogICAgICAgIHZhciB1biA9IHRoYXQgPT09IHVuZGVmaW5lZDsKCiAgICAgICAgc3dpdGNoIChhcmdzLmxlbmd0aCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICByZXR1cm4gdW4gPyBmbigpIDogZm4uY2FsbCh0aGF0KTsKCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiB1biA/IGZuKGFyZ3NbMF0pIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdKTsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiB1biA/IGZuKGFyZ3NbMF0sIGFyZ3NbMV0pIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdKTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiB1biA/IGZuKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHJldHVybiB1biA/IGZuKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10pIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmbi5hcHBseSh0aGF0LCBhcmdzKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTEzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogICAgICB2YXIgbWFjcm90YXNrID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MCkuc2V0OwoKICAgICAgdmFyIE9ic2VydmVyID0gZ2xvYmFsLk11dGF0aW9uT2JzZXJ2ZXIgfHwgZ2xvYmFsLldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7CiAgICAgIHZhciBwcm9jZXNzID0gZ2xvYmFsLnByb2Nlc3M7CiAgICAgIHZhciBQcm9taXNlID0gZ2xvYmFsLlByb21pc2U7CiAgICAgIHZhciBpc05vZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKShwcm9jZXNzKSA9PSAncHJvY2Vzcyc7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgaGVhZCwgbGFzdCwgbm90aWZ5OwoKICAgICAgICB2YXIgZmx1c2ggPSBmdW5jdGlvbiBmbHVzaCgpIHsKICAgICAgICAgIHZhciBwYXJlbnQsIGZuOwogICAgICAgICAgaWYgKGlzTm9kZSAmJiAocGFyZW50ID0gcHJvY2Vzcy5kb21haW4pKSBwYXJlbnQuZXhpdCgpOwoKICAgICAgICAgIHdoaWxlIChoZWFkKSB7CiAgICAgICAgICAgIGZuID0gaGVhZC5mbjsKICAgICAgICAgICAgaGVhZCA9IGhlYWQubmV4dDsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZm4oKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIGlmIChoZWFkKSBub3RpZnkoKTtlbHNlIGxhc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGxhc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgICBpZiAocGFyZW50KSBwYXJlbnQuZW50ZXIoKTsKICAgICAgICB9OyAvLyBOb2RlLmpzCgoKICAgICAgICBpZiAoaXNOb2RlKSB7CiAgICAgICAgICBub3RpZnkgPSBmdW5jdGlvbiBub3RpZnkoKSB7CiAgICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2soZmx1c2gpOwogICAgICAgICAgfTsgLy8gYnJvd3NlcnMgd2l0aCBNdXRhdGlvbk9ic2VydmVyLCBleGNlcHQgaU9TIFNhZmFyaSAtIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy8zMzkKCiAgICAgICAgfSBlbHNlIGlmIChPYnNlcnZlciAmJiAhKGdsb2JhbC5uYXZpZ2F0b3IgJiYgZ2xvYmFsLm5hdmlnYXRvci5zdGFuZGFsb25lKSkgewogICAgICAgICAgdmFyIHRvZ2dsZSA9IHRydWU7CiAgICAgICAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnKTsKICAgICAgICAgIG5ldyBPYnNlcnZlcihmbHVzaCkub2JzZXJ2ZShub2RlLCB7CiAgICAgICAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUKICAgICAgICAgIH0pOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldwoKICAgICAgICAgIG5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeSgpIHsKICAgICAgICAgICAgbm9kZS5kYXRhID0gdG9nZ2xlID0gIXRvZ2dsZTsKICAgICAgICAgIH07IC8vIGVudmlyb25tZW50cyB3aXRoIG1heWJlIG5vbi1jb21wbGV0ZWx5IGNvcnJlY3QsIGJ1dCBleGlzdGVudCBQcm9taXNlCgogICAgICAgIH0gZWxzZSBpZiAoUHJvbWlzZSAmJiBQcm9taXNlLnJlc29sdmUpIHsKICAgICAgICAgIC8vIFByb21pc2UucmVzb2x2ZSB3aXRob3V0IGFuIGFyZ3VtZW50IHRocm93cyBhbiBlcnJvciBpbiBMRyBXZWJPUyAyCiAgICAgICAgICB2YXIgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpOwoKICAgICAgICAgIG5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeSgpIHsKICAgICAgICAgICAgcHJvbWlzZS50aGVuKGZsdXNoKTsKICAgICAgICAgIH07IC8vIGZvciBvdGhlciBlbnZpcm9ubWVudHMgLSBtYWNyb3Rhc2sgYmFzZWQgb246CiAgICAgICAgICAvLyAtIHNldEltbWVkaWF0ZQogICAgICAgICAgLy8gLSBNZXNzYWdlQ2hhbm5lbAogICAgICAgICAgLy8gLSB3aW5kb3cucG9zdE1lc3NhZwogICAgICAgICAgLy8gLSBvbnJlYWR5c3RhdGVjaGFuZ2UKICAgICAgICAgIC8vIC0gc2V0VGltZW91dAoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkgewogICAgICAgICAgICAvLyBzdHJhbmdlIElFICsgd2VicGFjayBkZXYgc2VydmVyIGJ1ZyAtIHVzZSAuY2FsbChnbG9iYWwpCiAgICAgICAgICAgIG1hY3JvdGFzay5jYWxsKGdsb2JhbCwgZmx1c2gpOwogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoZm4pIHsKICAgICAgICAgIHZhciB0YXNrID0gewogICAgICAgICAgICBmbjogZm4sCiAgICAgICAgICAgIG5leHQ6IHVuZGVmaW5lZAogICAgICAgICAgfTsKICAgICAgICAgIGlmIChsYXN0KSBsYXN0Lm5leHQgPSB0YXNrOwoKICAgICAgICAgIGlmICghaGVhZCkgewogICAgICAgICAgICBoZWFkID0gdGFzazsKICAgICAgICAgICAgbm90aWZ5KCk7CiAgICAgICAgICB9CgogICAgICAgICAgbGFzdCA9IHRhc2s7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTE0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogICAgICB2YXIgbmF2aWdhdG9yID0gZ2xvYmFsLm5hdmlnYXRvcjsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBuYXZpZ2F0b3IgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCAnJzsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMTUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgaGlkZSA9IF9fd2VicGFja19yZXF1aXJlX18oMTEpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodGFyZ2V0LCBzcmMsIHNhZmUpIHsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gc3JjKSB7CiAgICAgICAgICBpZiAoc2FmZSAmJiB0YXJnZXRba2V5XSkgdGFyZ2V0W2tleV0gPSBzcmNba2V5XTtlbHNlIGhpZGUodGFyZ2V0LCBrZXksIHNyY1trZXldKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDExNiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICAgICAgdmFyIGNvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApOwoKICAgICAgdmFyIGRQID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTsKCiAgICAgIHZhciBERVNDUklQVE9SUyA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7CgogICAgICB2YXIgU1BFQ0lFUyA9IF9fd2VicGFja19yZXF1aXJlX18oMikoJ3NwZWNpZXMnKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKEtFWSkgewogICAgICAgIHZhciBDID0gdHlwZW9mIGNvcmVbS0VZXSA9PSAnZnVuY3Rpb24nID8gY29yZVtLRVldIDogZ2xvYmFsW0tFWV07CiAgICAgICAgaWYgKERFU0NSSVBUT1JTICYmIEMgJiYgIUNbU1BFQ0lFU10pIGRQLmYoQywgU1BFQ0lFUywgewogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMTcgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7IC8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLXByb21pc2UtZmluYWxseQoKICAgICAgdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOwoKICAgICAgdmFyIGNvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApOwoKICAgICAgdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogICAgICB2YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1OSk7CgogICAgICB2YXIgcHJvbWlzZVJlc29sdmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYyKTsKCiAgICAgICRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5SLCAnUHJvbWlzZScsIHsKICAgICAgICAnZmluYWxseSc6IGZ1bmN0aW9uIF9maW5hbGx5KG9uRmluYWxseSkgewogICAgICAgICAgdmFyIEMgPSBzcGVjaWVzQ29uc3RydWN0b3IodGhpcywgY29yZS5Qcm9taXNlIHx8IGdsb2JhbC5Qcm9taXNlKTsKICAgICAgICAgIHZhciBpc0Z1bmN0aW9uID0gdHlwZW9mIG9uRmluYWxseSA9PSAnZnVuY3Rpb24nOwogICAgICAgICAgcmV0dXJuIHRoaXMudGhlbihpc0Z1bmN0aW9uID8gZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlKEMsIG9uRmluYWxseSgpKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4geDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IDogb25GaW5hbGx5LCBpc0Z1bmN0aW9uID8gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlKEMsIG9uRmluYWxseSgpKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gOiBvbkZpbmFsbHkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTE4ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOyAvLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1wcm9taXNlLXRyeQoKICAgICAgdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOwoKICAgICAgdmFyIG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Myk7CgogICAgICB2YXIgcGVyZm9ybSA9IF9fd2VicGFja19yZXF1aXJlX18oNjEpOwoKICAgICAgJGV4cG9ydCgkZXhwb3J0LlMsICdQcm9taXNlJywgewogICAgICAgICd0cnknOiBmdW5jdGlvbiBfdHJ5KGNhbGxiYWNrZm4pIHsKICAgICAgICAgIHZhciBwcm9taXNlQ2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5LmYodGhpcyk7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gcGVyZm9ybShjYWxsYmFja2ZuKTsKICAgICAgICAgIChyZXN1bHQuZSA/IHByb21pc2VDYXBhYmlsaXR5LnJlamVjdCA6IHByb21pc2VDYXBhYmlsaXR5LnJlc29sdmUpKHJlc3VsdC52KTsKICAgICAgICAgIHJldHVybiBwcm9taXNlQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTE5ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgImRlZmF1bHQiOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyMCksCiAgICAgICAgX19lc01vZHVsZTogdHJ1ZQogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDEyMCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMTIxKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKS5PYmplY3QuYXNzaWduOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDEyMSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIDE5LjEuMy4xIE9iamVjdC5hc3NpZ24odGFyZ2V0LCBzb3VyY2UpCiAgICAgIHZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTsKCiAgICAgICRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GLCAnT2JqZWN0JywgewogICAgICAgIGFzc2lnbjogX193ZWJwYWNrX3JlcXVpcmVfXygxMjIpCiAgICAgIH0pOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDEyMiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsgLy8gMTkuMS4yLjEgT2JqZWN0LmFzc2lnbih0YXJnZXQsIHNvdXJjZSwgLi4uKQoKICAgICAgdmFyIERFU0NSSVBUT1JTID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKCiAgICAgIHZhciBnZXRLZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMik7CgogICAgICB2YXIgZ09QUyA9IF9fd2VicGFja19yZXF1aXJlX18oNDQpOwoKICAgICAgdmFyIHBJRSA9IF9fd2VicGFja19yZXF1aXJlX18oMjgpOwoKICAgICAgdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNyk7CgogICAgICB2YXIgSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNTQpOwoKICAgICAgdmFyICRhc3NpZ24gPSBPYmplY3QuYXNzaWduOyAvLyBzaG91bGQgd29yayB3aXRoIHN5bWJvbHMgYW5kIHNob3VsZCBoYXZlIGRldGVybWluaXN0aWMgcHJvcGVydHkgb3JkZXIgKFY4IGJ1ZykKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gISRhc3NpZ24gfHwgX193ZWJwYWNrX3JlcXVpcmVfXygxNCkoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBBID0ge307CiAgICAgICAgdmFyIEIgPSB7fTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmCgogICAgICAgIHZhciBTID0gU3ltYm9sKCk7CiAgICAgICAgdmFyIEsgPSAnYWJjZGVmZ2hpamtsbW5vcHFyc3QnOwogICAgICAgIEFbU10gPSA3OwogICAgICAgIEsuc3BsaXQoJycpLmZvckVhY2goZnVuY3Rpb24gKGspIHsKICAgICAgICAgIEJba10gPSBrOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiAkYXNzaWduKHt9LCBBKVtTXSAhPSA3IHx8IE9iamVjdC5rZXlzKCRhc3NpZ24oe30sIEIpKS5qb2luKCcnKSAhPSBLOwogICAgICB9KSA/IGZ1bmN0aW9uIGFzc2lnbih0YXJnZXQsIHNvdXJjZSkgewogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnMKICAgICAgICB2YXIgVCA9IHRvT2JqZWN0KHRhcmdldCk7CiAgICAgICAgdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICAgIHZhciBpbmRleCA9IDE7CiAgICAgICAgdmFyIGdldFN5bWJvbHMgPSBnT1BTLmY7CiAgICAgICAgdmFyIGlzRW51bSA9IHBJRS5mOwoKICAgICAgICB3aGlsZSAoYUxlbiA+IGluZGV4KSB7CiAgICAgICAgICB2YXIgUyA9IElPYmplY3QoYXJndW1lbnRzW2luZGV4KytdKTsKICAgICAgICAgIHZhciBrZXlzID0gZ2V0U3ltYm9scyA/IGdldEtleXMoUykuY29uY2F0KGdldFN5bWJvbHMoUykpIDogZ2V0S2V5cyhTKTsKICAgICAgICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgICAgICAgIHZhciBqID0gMDsKICAgICAgICAgIHZhciBrZXk7CgogICAgICAgICAgd2hpbGUgKGxlbmd0aCA+IGopIHsKICAgICAgICAgICAga2V5ID0ga2V5c1tqKytdOwogICAgICAgICAgICBpZiAoIURFU0NSSVBUT1JTIHx8IGlzRW51bS5jYWxsKFMsIGtleSkpIFRba2V5XSA9IFNba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBUOwogICAgICB9IDogJGFzc2lnbjsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMjMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyNCk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkuT2JqZWN0LmdldFByb3RvdHlwZU9mOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDEyNCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIDE5LjEuMi45IE9iamVjdC5nZXRQcm90b3R5cGVPZihPKQogICAgICB2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3KTsKCiAgICAgIHZhciAkZ2V0UHJvdG90eXBlT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU2KTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oNjUpKCdnZXRQcm90b3R5cGVPZicsIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gZ2V0UHJvdG90eXBlT2YoaXQpIHsKICAgICAgICAgIHJldHVybiAkZ2V0UHJvdG90eXBlT2YodG9PYmplY3QoaXQpKTsKICAgICAgICB9OwogICAgICB9KTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTI1ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgImRlZmF1bHQiOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyNiksCiAgICAgICAgX19lc01vZHVsZTogdHJ1ZQogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDEyNiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMjApOwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygyNyk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNDUpLmYoJ2l0ZXJhdG9yJyk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTI3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgImRlZmF1bHQiOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCksCiAgICAgICAgX19lc01vZHVsZTogdHJ1ZQogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDEyOCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMTI5KTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oNTApOwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygxMzQpOwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygxMzUpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApLlN5bWJvbDsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMjkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7IC8vIEVDTUFTY3JpcHQgNiBzeW1ib2xzIHNoaW0KCiAgICAgIHZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICAgICAgdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTIpOwoKICAgICAgdmFyIERFU0NSSVBUT1JTID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKCiAgICAgIHZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTsKCiAgICAgIHZhciByZWRlZmluZSA9IF9fd2VicGFja19yZXF1aXJlX18oNTIpOwoKICAgICAgdmFyIE1FVEEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzMCkuS0VZOwoKICAgICAgdmFyICRmYWlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMTQpOwoKICAgICAgdmFyIHNoYXJlZCA9IF9fd2VicGFja19yZXF1aXJlX18oMzkpOwoKICAgICAgdmFyIHNldFRvU3RyaW5nVGFnID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNik7CgogICAgICB2YXIgdWlkID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNSk7CgogICAgICB2YXIgd2tzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTsKCiAgICAgIHZhciB3a3NFeHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1KTsKCiAgICAgIHZhciB3a3NEZWZpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2KTsKCiAgICAgIHZhciBlbnVtS2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oMTMxKTsKCiAgICAgIHZhciBpc0FycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMzIpOwoKICAgICAgdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCiAgICAgIHZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTApOwoKICAgICAgdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNyk7CgogICAgICB2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNik7CgogICAgICB2YXIgdG9QcmltaXRpdmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMyKTsKCiAgICAgIHZhciBjcmVhdGVEZXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOSk7CgogICAgICB2YXIgX2NyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMzYpOwoKICAgICAgdmFyIGdPUE5FeHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzMyk7CgogICAgICB2YXIgJEdPUEQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY5KTsKCiAgICAgIHZhciAkR09QUyA9IF9fd2VicGFja19yZXF1aXJlX18oNDQpOwoKICAgICAgdmFyICREUCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7CgogICAgICB2YXIgJGtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIyKTsKCiAgICAgIHZhciBnT1BEID0gJEdPUEQuZjsKICAgICAgdmFyIGRQID0gJERQLmY7CiAgICAgIHZhciBnT1BOID0gZ09QTkV4dC5mOwogICAgICB2YXIgJFN5bWJvbCA9IGdsb2JhbC5TeW1ib2w7CiAgICAgIHZhciAkSlNPTiA9IGdsb2JhbC5KU09OOwoKICAgICAgdmFyIF9zdHJpbmdpZnkgPSAkSlNPTiAmJiAkSlNPTi5zdHJpbmdpZnk7CgogICAgICB2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7CiAgICAgIHZhciBISURERU4gPSB3a3MoJ19oaWRkZW4nKTsKICAgICAgdmFyIFRPX1BSSU1JVElWRSA9IHdrcygndG9QcmltaXRpdmUnKTsKICAgICAgdmFyIGlzRW51bSA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlOwogICAgICB2YXIgU3ltYm9sUmVnaXN0cnkgPSBzaGFyZWQoJ3N5bWJvbC1yZWdpc3RyeScpOwogICAgICB2YXIgQWxsU3ltYm9scyA9IHNoYXJlZCgnc3ltYm9scycpOwogICAgICB2YXIgT1BTeW1ib2xzID0gc2hhcmVkKCdvcC1zeW1ib2xzJyk7CiAgICAgIHZhciBPYmplY3RQcm90byA9IE9iamVjdFtQUk9UT1RZUEVdOwogICAgICB2YXIgVVNFX05BVElWRSA9IHR5cGVvZiAkU3ltYm9sID09ICdmdW5jdGlvbicgJiYgISEkR09QUy5mOwogICAgICB2YXIgUU9iamVjdCA9IGdsb2JhbC5RT2JqZWN0OyAvLyBEb24ndCB1c2Ugc2V0dGVycyBpbiBRdCBTY3JpcHQsIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy8xNzMKCiAgICAgIHZhciBzZXR0ZXIgPSAhUU9iamVjdCB8fCAhUU9iamVjdFtQUk9UT1RZUEVdIHx8ICFRT2JqZWN0W1BST1RPVFlQRV0uZmluZENoaWxkOyAvLyBmYWxsYmFjayBmb3Igb2xkIEFuZHJvaWQsIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvdjgvaXNzdWVzL2RldGFpbD9pZD02ODcKCiAgICAgIHZhciBzZXRTeW1ib2xEZXNjID0gREVTQ1JJUFRPUlMgJiYgJGZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX2NyZWF0ZShkUCh7fSwgJ2EnLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIGRQKHRoaXMsICdhJywgewogICAgICAgICAgICAgIHZhbHVlOiA3CiAgICAgICAgICAgIH0pLmE7CiAgICAgICAgICB9CiAgICAgICAgfSkpLmEgIT0gNzsKICAgICAgfSkgPyBmdW5jdGlvbiAoaXQsIGtleSwgRCkgewogICAgICAgIHZhciBwcm90b0Rlc2MgPSBnT1BEKE9iamVjdFByb3RvLCBrZXkpOwogICAgICAgIGlmIChwcm90b0Rlc2MpIGRlbGV0ZSBPYmplY3RQcm90b1trZXldOwogICAgICAgIGRQKGl0LCBrZXksIEQpOwogICAgICAgIGlmIChwcm90b0Rlc2MgJiYgaXQgIT09IE9iamVjdFByb3RvKSBkUChPYmplY3RQcm90bywga2V5LCBwcm90b0Rlc2MpOwogICAgICB9IDogZFA7CgogICAgICB2YXIgd3JhcCA9IGZ1bmN0aW9uIHdyYXAodGFnKSB7CiAgICAgICAgdmFyIHN5bSA9IEFsbFN5bWJvbHNbdGFnXSA9IF9jcmVhdGUoJFN5bWJvbFtQUk9UT1RZUEVdKTsKCiAgICAgICAgc3ltLl9rID0gdGFnOwogICAgICAgIHJldHVybiBzeW07CiAgICAgIH07CgogICAgICB2YXIgaXNTeW1ib2wgPSBVU0VfTkFUSVZFICYmIF90eXBlb2Y0KCRTeW1ib2wuaXRlcmF0b3IpID09ICdzeW1ib2wnID8gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIF90eXBlb2Y0KGl0KSA9PSAnc3ltYm9sJzsKICAgICAgfSA6IGZ1bmN0aW9uIChpdCkgewogICAgICAgIHJldHVybiBpdCBpbnN0YW5jZW9mICRTeW1ib2w7CiAgICAgIH07CgogICAgICB2YXIgJGRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoaXQsIGtleSwgRCkgewogICAgICAgIGlmIChpdCA9PT0gT2JqZWN0UHJvdG8pICRkZWZpbmVQcm9wZXJ0eShPUFN5bWJvbHMsIGtleSwgRCk7CiAgICAgICAgYW5PYmplY3QoaXQpOwogICAgICAgIGtleSA9IHRvUHJpbWl0aXZlKGtleSwgdHJ1ZSk7CiAgICAgICAgYW5PYmplY3QoRCk7CgogICAgICAgIGlmIChoYXMoQWxsU3ltYm9scywga2V5KSkgewogICAgICAgICAgaWYgKCFELmVudW1lcmFibGUpIHsKICAgICAgICAgICAgaWYgKCFoYXMoaXQsIEhJRERFTikpIGRQKGl0LCBISURERU4sIGNyZWF0ZURlc2MoMSwge30pKTsKICAgICAgICAgICAgaXRbSElEREVOXVtrZXldID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChoYXMoaXQsIEhJRERFTikgJiYgaXRbSElEREVOXVtrZXldKSBpdFtISURERU5dW2tleV0gPSBmYWxzZTsKICAgICAgICAgICAgRCA9IF9jcmVhdGUoRCwgewogICAgICAgICAgICAgIGVudW1lcmFibGU6IGNyZWF0ZURlc2MoMCwgZmFsc2UpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBzZXRTeW1ib2xEZXNjKGl0LCBrZXksIEQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRQKGl0LCBrZXksIEQpOwogICAgICB9OwoKICAgICAgdmFyICRkZWZpbmVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyhpdCwgUCkgewogICAgICAgIGFuT2JqZWN0KGl0KTsKICAgICAgICB2YXIga2V5cyA9IGVudW1LZXlzKFAgPSB0b0lPYmplY3QoUCkpOwogICAgICAgIHZhciBpID0gMDsKICAgICAgICB2YXIgbCA9IGtleXMubGVuZ3RoOwogICAgICAgIHZhciBrZXk7CgogICAgICAgIHdoaWxlIChsID4gaSkgewogICAgICAgICAgJGRlZmluZVByb3BlcnR5KGl0LCBrZXkgPSBrZXlzW2krK10sIFBba2V5XSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaXQ7CiAgICAgIH07CgogICAgICB2YXIgJGNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZShpdCwgUCkgewogICAgICAgIHJldHVybiBQID09PSB1bmRlZmluZWQgPyBfY3JlYXRlKGl0KSA6ICRkZWZpbmVQcm9wZXJ0aWVzKF9jcmVhdGUoaXQpLCBQKTsKICAgICAgfTsKCiAgICAgIHZhciAkcHJvcGVydHlJc0VudW1lcmFibGUgPSBmdW5jdGlvbiBwcm9wZXJ0eUlzRW51bWVyYWJsZShrZXkpIHsKICAgICAgICB2YXIgRSA9IGlzRW51bS5jYWxsKHRoaXMsIGtleSA9IHRvUHJpbWl0aXZlKGtleSwgdHJ1ZSkpOwogICAgICAgIGlmICh0aGlzID09PSBPYmplY3RQcm90byAmJiBoYXMoQWxsU3ltYm9scywga2V5KSAmJiAhaGFzKE9QU3ltYm9scywga2V5KSkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBFIHx8ICFoYXModGhpcywga2V5KSB8fCAhaGFzKEFsbFN5bWJvbHMsIGtleSkgfHwgaGFzKHRoaXMsIEhJRERFTikgJiYgdGhpc1tISURERU5dW2tleV0gPyBFIDogdHJ1ZTsKICAgICAgfTsKCiAgICAgIHZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpIHsKICAgICAgICBpdCA9IHRvSU9iamVjdChpdCk7CiAgICAgICAga2V5ID0gdG9QcmltaXRpdmUoa2V5LCB0cnVlKTsKICAgICAgICBpZiAoaXQgPT09IE9iamVjdFByb3RvICYmIGhhcyhBbGxTeW1ib2xzLCBrZXkpICYmICFoYXMoT1BTeW1ib2xzLCBrZXkpKSByZXR1cm47CiAgICAgICAgdmFyIEQgPSBnT1BEKGl0LCBrZXkpOwogICAgICAgIGlmIChEICYmIGhhcyhBbGxTeW1ib2xzLCBrZXkpICYmICEoaGFzKGl0LCBISURERU4pICYmIGl0W0hJRERFTl1ba2V5XSkpIEQuZW51bWVyYWJsZSA9IHRydWU7CiAgICAgICAgcmV0dXJuIEQ7CiAgICAgIH07CgogICAgICB2YXIgJGdldE93blByb3BlcnR5TmFtZXMgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKGl0KSB7CiAgICAgICAgdmFyIG5hbWVzID0gZ09QTih0b0lPYmplY3QoaXQpKTsKICAgICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgdmFyIGkgPSAwOwogICAgICAgIHZhciBrZXk7CgogICAgICAgIHdoaWxlIChuYW1lcy5sZW5ndGggPiBpKSB7CiAgICAgICAgICBpZiAoIWhhcyhBbGxTeW1ib2xzLCBrZXkgPSBuYW1lc1tpKytdKSAmJiBrZXkgIT0gSElEREVOICYmIGtleSAhPSBNRVRBKSByZXN1bHQucHVzaChrZXkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKCiAgICAgIHZhciAkZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlTeW1ib2xzKGl0KSB7CiAgICAgICAgdmFyIElTX09QID0gaXQgPT09IE9iamVjdFByb3RvOwogICAgICAgIHZhciBuYW1lcyA9IGdPUE4oSVNfT1AgPyBPUFN5bWJvbHMgOiB0b0lPYmplY3QoaXQpKTsKICAgICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgdmFyIGkgPSAwOwogICAgICAgIHZhciBrZXk7CgogICAgICAgIHdoaWxlIChuYW1lcy5sZW5ndGggPiBpKSB7CiAgICAgICAgICBpZiAoaGFzKEFsbFN5bWJvbHMsIGtleSA9IG5hbWVzW2krK10pICYmIChJU19PUCA/IGhhcyhPYmplY3RQcm90bywga2V5KSA6IHRydWUpKSByZXN1bHQucHVzaChBbGxTeW1ib2xzW2tleV0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsgLy8gMTkuNC4xLjEgU3ltYm9sKFtkZXNjcmlwdGlvbl0pCgoKICAgICAgaWYgKCFVU0VfTkFUSVZFKSB7CiAgICAgICAgJFN5bWJvbCA9IGZ1bmN0aW9uIF9TeW1ib2wyKCkgewogICAgICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiAkU3ltYm9sKSB0aHJvdyBUeXBlRXJyb3IoJ1N5bWJvbCBpcyBub3QgYSBjb25zdHJ1Y3RvciEnKTsKICAgICAgICAgIHZhciB0YWcgPSB1aWQoYXJndW1lbnRzLmxlbmd0aCA+IDAgPyBhcmd1bWVudHNbMF0gOiB1bmRlZmluZWQpOwoKICAgICAgICAgIHZhciAkc2V0ID0gZnVuY3Rpb24gJHNldCh2YWx1ZSkgewogICAgICAgICAgICBpZiAodGhpcyA9PT0gT2JqZWN0UHJvdG8pICRzZXQuY2FsbChPUFN5bWJvbHMsIHZhbHVlKTsKICAgICAgICAgICAgaWYgKGhhcyh0aGlzLCBISURERU4pICYmIGhhcyh0aGlzW0hJRERFTl0sIHRhZykpIHRoaXNbSElEREVOXVt0YWddID0gZmFsc2U7CiAgICAgICAgICAgIHNldFN5bWJvbERlc2ModGhpcywgdGFnLCBjcmVhdGVEZXNjKDEsIHZhbHVlKSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIGlmIChERVNDUklQVE9SUyAmJiBzZXR0ZXIpIHNldFN5bWJvbERlc2MoT2JqZWN0UHJvdG8sIHRhZywgewogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgIHNldDogJHNldAogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gd3JhcCh0YWcpOwogICAgICAgIH07CgogICAgICAgIHJlZGVmaW5lKCRTeW1ib2xbUFJPVE9UWVBFXSwgJ3RvU3RyaW5nJywgZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fazsKICAgICAgICB9KTsKICAgICAgICAkR09QRC5mID0gJGdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICAgICAgICAkRFAuZiA9ICRkZWZpbmVQcm9wZXJ0eTsKICAgICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDY4KS5mID0gZ09QTkV4dC5mID0gJGdldE93blByb3BlcnR5TmFtZXM7CiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygyOCkuZiA9ICRwcm9wZXJ0eUlzRW51bWVyYWJsZTsKICAgICAgICAkR09QUy5mID0gJGdldE93blByb3BlcnR5U3ltYm9sczsKCiAgICAgICAgaWYgKERFU0NSSVBUT1JTICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKSkgewogICAgICAgICAgcmVkZWZpbmUoT2JqZWN0UHJvdG8sICdwcm9wZXJ0eUlzRW51bWVyYWJsZScsICRwcm9wZXJ0eUlzRW51bWVyYWJsZSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICB3a3NFeHQuZiA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICByZXR1cm4gd3JhcCh3a3MobmFtZSkpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgICRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsIHsKICAgICAgICBTeW1ib2w6ICRTeW1ib2wKICAgICAgfSk7CgogICAgICBmb3IgKHZhciBlczZTeW1ib2xzID0gLy8gMTkuNC4yLjIsIDE5LjQuMi4zLCAxOS40LjIuNCwgMTkuNC4yLjYsIDE5LjQuMi44LCAxOS40LjIuOSwgMTkuNC4yLjEwLCAxOS40LjIuMTEsIDE5LjQuMi4xMiwgMTkuNC4yLjEzLCAxOS40LjIuMTQKICAgICAgJ2hhc0luc3RhbmNlLGlzQ29uY2F0U3ByZWFkYWJsZSxpdGVyYXRvcixtYXRjaCxyZXBsYWNlLHNlYXJjaCxzcGVjaWVzLHNwbGl0LHRvUHJpbWl0aXZlLHRvU3RyaW5nVGFnLHVuc2NvcGFibGVzJy5zcGxpdCgnLCcpLCBqID0gMDsgZXM2U3ltYm9scy5sZW5ndGggPiBqOykgewogICAgICAgIHdrcyhlczZTeW1ib2xzW2orK10pOwogICAgICB9CgogICAgICBmb3IgKHZhciB3ZWxsS25vd25TeW1ib2xzID0gJGtleXMod2tzLnN0b3JlKSwgayA9IDA7IHdlbGxLbm93blN5bWJvbHMubGVuZ3RoID4gazspIHsKICAgICAgICB3a3NEZWZpbmUod2VsbEtub3duU3ltYm9sc1trKytdKTsKICAgICAgfQoKICAgICAgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhVVNFX05BVElWRSwgJ1N5bWJvbCcsIHsKICAgICAgICAvLyAxOS40LjIuMSBTeW1ib2wuZm9yKGtleSkKICAgICAgICAnZm9yJzogZnVuY3Rpb24gX2ZvcihrZXkpIHsKICAgICAgICAgIHJldHVybiBoYXMoU3ltYm9sUmVnaXN0cnksIGtleSArPSAnJykgPyBTeW1ib2xSZWdpc3RyeVtrZXldIDogU3ltYm9sUmVnaXN0cnlba2V5XSA9ICRTeW1ib2woa2V5KTsKICAgICAgICB9LAogICAgICAgIC8vIDE5LjQuMi41IFN5bWJvbC5rZXlGb3Ioc3ltKQogICAgICAgIGtleUZvcjogZnVuY3Rpb24ga2V5Rm9yKHN5bSkgewogICAgICAgICAgaWYgKCFpc1N5bWJvbChzeW0pKSB0aHJvdyBUeXBlRXJyb3Ioc3ltICsgJyBpcyBub3QgYSBzeW1ib2whJyk7CgogICAgICAgICAgZm9yICh2YXIga2V5IGluIFN5bWJvbFJlZ2lzdHJ5KSB7CiAgICAgICAgICAgIGlmIChTeW1ib2xSZWdpc3RyeVtrZXldID09PSBzeW0pIHJldHVybiBrZXk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB1c2VTZXR0ZXI6IGZ1bmN0aW9uIHVzZVNldHRlcigpIHsKICAgICAgICAgIHNldHRlciA9IHRydWU7CiAgICAgICAgfSwKICAgICAgICB1c2VTaW1wbGU6IGZ1bmN0aW9uIHVzZVNpbXBsZSgpIHsKICAgICAgICAgIHNldHRlciA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgICRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsICdPYmplY3QnLCB7CiAgICAgICAgLy8gMTkuMS4yLjIgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKQogICAgICAgIGNyZWF0ZTogJGNyZWF0ZSwKICAgICAgICAvLyAxOS4xLjIuNCBPYmplY3QuZGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcykKICAgICAgICBkZWZpbmVQcm9wZXJ0eTogJGRlZmluZVByb3BlcnR5LAogICAgICAgIC8vIDE5LjEuMi4zIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKE8sIFByb3BlcnRpZXMpCiAgICAgICAgZGVmaW5lUHJvcGVydGllczogJGRlZmluZVByb3BlcnRpZXMsCiAgICAgICAgLy8gMTkuMS4yLjYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKQogICAgICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogJGdldE93blByb3BlcnR5RGVzY3JpcHRvciwKICAgICAgICAvLyAxOS4xLjIuNyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhPKQogICAgICAgIGdldE93blByb3BlcnR5TmFtZXM6ICRnZXRPd25Qcm9wZXJ0eU5hbWVzLAogICAgICAgIC8vIDE5LjEuMi44IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoTykKICAgICAgICBnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6ICRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMKICAgICAgfSk7IC8vIENocm9tZSAzOCBhbmQgMzkgYE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHNgIGZhaWxzIG9uIHByaW1pdGl2ZXMKICAgICAgLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzQ0MwoKICAgICAgdmFyIEZBSUxTX09OX1BSSU1JVElWRVMgPSAkZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICAgICRHT1BTLmYoMSk7CiAgICAgIH0pOwogICAgICAkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqIEZBSUxTX09OX1BSSU1JVElWRVMsICdPYmplY3QnLCB7CiAgICAgICAgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpIHsKICAgICAgICAgIHJldHVybiAkR09QUy5mKHRvT2JqZWN0KGl0KSk7CiAgICAgICAgfQogICAgICB9KTsgLy8gMjQuMy4yIEpTT04uc3RyaW5naWZ5KHZhbHVlIFssIHJlcGxhY2VyIFssIHNwYWNlXV0pCgogICAgICAkSlNPTiAmJiAkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICghVVNFX05BVElWRSB8fCAkZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBTID0gJFN5bWJvbCgpOyAvLyBNUyBFZGdlIGNvbnZlcnRzIHN5bWJvbCB2YWx1ZXMgdG8gSlNPTiBhcyB7fQogICAgICAgIC8vIFdlYktpdCBjb252ZXJ0cyBzeW1ib2wgdmFsdWVzIHRvIEpTT04gYXMgbnVsbAogICAgICAgIC8vIFY4IHRocm93cyBvbiBib3hlZCBzeW1ib2xzCgogICAgICAgIHJldHVybiBfc3RyaW5naWZ5KFtTXSkgIT0gJ1tudWxsXScgfHwgX3N0cmluZ2lmeSh7CiAgICAgICAgICBhOiBTCiAgICAgICAgfSkgIT0gJ3t9JyB8fCBfc3RyaW5naWZ5KE9iamVjdChTKSkgIT0gJ3t9JzsKICAgICAgfSkpLCAnSlNPTicsIHsKICAgICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uIHN0cmluZ2lmeShpdCkgewogICAgICAgICAgdmFyIGFyZ3MgPSBbaXRdOwogICAgICAgICAgdmFyIGkgPSAxOwogICAgICAgICAgdmFyIHJlcGxhY2VyLCAkcmVwbGFjZXI7CgogICAgICAgICAgd2hpbGUgKGFyZ3VtZW50cy5sZW5ndGggPiBpKSB7CiAgICAgICAgICAgIGFyZ3MucHVzaChhcmd1bWVudHNbaSsrXSk7CiAgICAgICAgICB9CgogICAgICAgICAgJHJlcGxhY2VyID0gcmVwbGFjZXIgPSBhcmdzWzFdOwogICAgICAgICAgaWYgKCFpc09iamVjdChyZXBsYWNlcikgJiYgaXQgPT09IHVuZGVmaW5lZCB8fCBpc1N5bWJvbChpdCkpIHJldHVybjsgLy8gSUU4IHJldHVybnMgc3RyaW5nIG9uIHVuZGVmaW5lZAoKICAgICAgICAgIGlmICghaXNBcnJheShyZXBsYWNlcikpIHJlcGxhY2VyID0gZnVuY3Rpb24gcmVwbGFjZXIoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICBpZiAodHlwZW9mICRyZXBsYWNlciA9PSAnZnVuY3Rpb24nKSB2YWx1ZSA9ICRyZXBsYWNlci5jYWxsKHRoaXMsIGtleSwgdmFsdWUpOwogICAgICAgICAgICBpZiAoIWlzU3ltYm9sKHZhbHVlKSkgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfTsKICAgICAgICAgIGFyZ3NbMV0gPSByZXBsYWNlcjsKICAgICAgICAgIHJldHVybiBfc3RyaW5naWZ5LmFwcGx5KCRKU09OLCBhcmdzKTsKICAgICAgICB9CiAgICAgIH0pOyAvLyAxOS40LjMuNCBTeW1ib2wucHJvdG90eXBlW0BAdG9QcmltaXRpdmVdKGhpbnQpCgogICAgICAkU3ltYm9sW1BST1RPVFlQRV1bVE9fUFJJTUlUSVZFXSB8fCBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKSgkU3ltYm9sW1BST1RPVFlQRV0sIFRPX1BSSU1JVElWRSwgJFN5bWJvbFtQUk9UT1RZUEVdLnZhbHVlT2YpOyAvLyAxOS40LjMuNSBTeW1ib2wucHJvdG90eXBlW0BAdG9TdHJpbmdUYWddCgogICAgICBzZXRUb1N0cmluZ1RhZygkU3ltYm9sLCAnU3ltYm9sJyk7IC8vIDIwLjIuMS45IE1hdGhbQEB0b1N0cmluZ1RhZ10KCiAgICAgIHNldFRvU3RyaW5nVGFnKE1hdGgsICdNYXRoJywgdHJ1ZSk7IC8vIDI0LjMuMyBKU09OW0BAdG9TdHJpbmdUYWddCgogICAgICBzZXRUb1N0cmluZ1RhZyhnbG9iYWwuSlNPTiwgJ0pTT04nLCB0cnVlKTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMzAgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgTUVUQSA9IF9fd2VicGFja19yZXF1aXJlX18oMjUpKCdtZXRhJyk7CgogICAgICB2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKCiAgICAgIHZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsKCiAgICAgIHZhciBzZXREZXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KS5mOwoKICAgICAgdmFyIGlkID0gMDsKCiAgICAgIHZhciBpc0V4dGVuc2libGUgPSBPYmplY3QuaXNFeHRlbnNpYmxlIHx8IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfTsKCiAgICAgIHZhciBGUkVFWkUgPSAhX193ZWJwYWNrX3JlcXVpcmVfXygxNCkoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBpc0V4dGVuc2libGUoT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zKHt9KSk7CiAgICAgIH0pOwoKICAgICAgdmFyIHNldE1ldGEgPSBmdW5jdGlvbiBzZXRNZXRhKGl0KSB7CiAgICAgICAgc2V0RGVzYyhpdCwgTUVUQSwgewogICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgaTogJ08nICsgKytpZCwKICAgICAgICAgICAgLy8gb2JqZWN0IElECiAgICAgICAgICAgIHc6IHt9IC8vIHdlYWsgY29sbGVjdGlvbnMgSURzCgogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgdmFyIGZhc3RLZXkgPSBmdW5jdGlvbiBmYXN0S2V5KGl0LCBjcmVhdGUpIHsKICAgICAgICAvLyByZXR1cm4gcHJpbWl0aXZlIHdpdGggcHJlZml4CiAgICAgICAgaWYgKCFpc09iamVjdChpdCkpIHJldHVybiBfdHlwZW9mNChpdCkgPT0gJ3N5bWJvbCcgPyBpdCA6ICh0eXBlb2YgaXQgPT0gJ3N0cmluZycgPyAnUycgOiAnUCcpICsgaXQ7CgogICAgICAgIGlmICghaGFzKGl0LCBNRVRBKSkgewogICAgICAgICAgLy8gY2FuJ3Qgc2V0IG1ldGFkYXRhIHRvIHVuY2F1Z2h0IGZyb3plbiBvYmplY3QKICAgICAgICAgIGlmICghaXNFeHRlbnNpYmxlKGl0KSkgcmV0dXJuICdGJzsgLy8gbm90IG5lY2Vzc2FyeSB0byBhZGQgbWV0YWRhdGEKCiAgICAgICAgICBpZiAoIWNyZWF0ZSkgcmV0dXJuICdFJzsgLy8gYWRkIG1pc3NpbmcgbWV0YWRhdGEKCiAgICAgICAgICBzZXRNZXRhKGl0KTsgLy8gcmV0dXJuIG9iamVjdCBJRAogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGl0W01FVEFdLmk7CiAgICAgIH07CgogICAgICB2YXIgZ2V0V2VhayA9IGZ1bmN0aW9uIGdldFdlYWsoaXQsIGNyZWF0ZSkgewogICAgICAgIGlmICghaGFzKGl0LCBNRVRBKSkgewogICAgICAgICAgLy8gY2FuJ3Qgc2V0IG1ldGFkYXRhIHRvIHVuY2F1Z2h0IGZyb3plbiBvYmplY3QKICAgICAgICAgIGlmICghaXNFeHRlbnNpYmxlKGl0KSkgcmV0dXJuIHRydWU7IC8vIG5vdCBuZWNlc3NhcnkgdG8gYWRkIG1ldGFkYXRhCgogICAgICAgICAgaWYgKCFjcmVhdGUpIHJldHVybiBmYWxzZTsgLy8gYWRkIG1pc3NpbmcgbWV0YWRhdGEKCiAgICAgICAgICBzZXRNZXRhKGl0KTsgLy8gcmV0dXJuIGhhc2ggd2VhayBjb2xsZWN0aW9ucyBJRHMKICAgICAgICB9CgogICAgICAgIHJldHVybiBpdFtNRVRBXS53OwogICAgICB9OyAvLyBhZGQgbWV0YWRhdGEgb24gZnJlZXplLWZhbWlseSBtZXRob2RzIGNhbGxpbmcKCgogICAgICB2YXIgb25GcmVlemUgPSBmdW5jdGlvbiBvbkZyZWV6ZShpdCkgewogICAgICAgIGlmIChGUkVFWkUgJiYgbWV0YS5ORUVEICYmIGlzRXh0ZW5zaWJsZShpdCkgJiYgIWhhcyhpdCwgTUVUQSkpIHNldE1ldGEoaXQpOwogICAgICAgIHJldHVybiBpdDsKICAgICAgfTsKCiAgICAgIHZhciBtZXRhID0gbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgS0VZOiBNRVRBLAogICAgICAgIE5FRUQ6IGZhbHNlLAogICAgICAgIGZhc3RLZXk6IGZhc3RLZXksCiAgICAgICAgZ2V0V2VhazogZ2V0V2VhaywKICAgICAgICBvbkZyZWV6ZTogb25GcmVlemUKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMzEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBhbGwgZW51bWVyYWJsZSBvYmplY3Qga2V5cywgaW5jbHVkZXMgc3ltYm9scwogICAgICB2YXIgZ2V0S2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oMjIpOwoKICAgICAgdmFyIGdPUFMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ0KTsKCiAgICAgIHZhciBwSUUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4KTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IGdldEtleXMoaXQpOwogICAgICAgIHZhciBnZXRTeW1ib2xzID0gZ09QUy5mOwoKICAgICAgICBpZiAoZ2V0U3ltYm9scykgewogICAgICAgICAgdmFyIHN5bWJvbHMgPSBnZXRTeW1ib2xzKGl0KTsKICAgICAgICAgIHZhciBpc0VudW0gPSBwSUUuZjsKICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgIHZhciBrZXk7CgogICAgICAgICAgd2hpbGUgKHN5bWJvbHMubGVuZ3RoID4gaSkgewogICAgICAgICAgICBpZiAoaXNFbnVtLmNhbGwoaXQsIGtleSA9IHN5bWJvbHNbaSsrXSkpIHJlc3VsdC5wdXNoKGtleSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMzIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyA3LjIuMiBJc0FycmF5KGFyZ3VtZW50KQogICAgICB2YXIgY29mID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMyk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gaXNBcnJheShhcmcpIHsKICAgICAgICByZXR1cm4gY29mKGFyZykgPT0gJ0FycmF5JzsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTMzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gZmFsbGJhY2sgZm9yIElFMTEgYnVnZ3kgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgd2l0aCBpZnJhbWUgYW5kIHdpbmRvdwogICAgICB2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNik7CgogICAgICB2YXIgZ09QTiA9IF9fd2VicGFja19yZXF1aXJlX18oNjgpLmY7CgogICAgICB2YXIgdG9TdHJpbmcgPSB7fS50b1N0cmluZzsKICAgICAgdmFyIHdpbmRvd05hbWVzID0gKHR5cGVvZiB3aW5kb3cgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mNCh3aW5kb3cpKSA9PSAnb2JqZWN0JyAmJiB3aW5kb3cgJiYgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh3aW5kb3cpIDogW107CgogICAgICB2YXIgZ2V0V2luZG93TmFtZXMgPSBmdW5jdGlvbiBnZXRXaW5kb3dOYW1lcyhpdCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gZ09QTihpdCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmV0dXJuIHdpbmRvd05hbWVzLnNsaWNlKCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgbW9kdWxlLmV4cG9ydHMuZiA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5TmFtZXMoaXQpIHsKICAgICAgICByZXR1cm4gd2luZG93TmFtZXMgJiYgdG9TdHJpbmcuY2FsbChpdCkgPT0gJ1tvYmplY3QgV2luZG93XScgPyBnZXRXaW5kb3dOYW1lcyhpdCkgOiBnT1BOKHRvSU9iamVjdChpdCkpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMzQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2KSgnYXN5bmNJdGVyYXRvcicpOwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMzUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2KSgnb2JzZXJ2YWJsZScpOwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMzYgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICAiZGVmYXVsdCI6IF9fd2VicGFja19yZXF1aXJlX18oMTM3KSwKICAgICAgICBfX2VzTW9kdWxlOiB0cnVlCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTM3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygxMzgpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApLk9iamVjdC5zZXRQcm90b3R5cGVPZjsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMzggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyAxOS4xLjMuMTkgT2JqZWN0LnNldFByb3RvdHlwZU9mKE8sIHByb3RvKQogICAgICB2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7CgogICAgICAkZXhwb3J0KCRleHBvcnQuUywgJ09iamVjdCcsIHsKICAgICAgICBzZXRQcm90b3R5cGVPZjogX193ZWJwYWNrX3JlcXVpcmVfXygxMzkpLnNldAogICAgICB9KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMzkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBXb3JrcyB3aXRoIF9fcHJvdG9fXyBvbmx5LiBPbGQgdjggY2FuJ3Qgd29yayB3aXRoIG51bGwgcHJvdG8gb2JqZWN0cy4KCiAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvICovCiAgICAgIHZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTApOwoKICAgICAgdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCiAgICAgIHZhciBjaGVjayA9IGZ1bmN0aW9uIGNoZWNrKE8sIHByb3RvKSB7CiAgICAgICAgYW5PYmplY3QoTyk7CiAgICAgICAgaWYgKCFpc09iamVjdChwcm90bykgJiYgcHJvdG8gIT09IG51bGwpIHRocm93IFR5cGVFcnJvcihwcm90byArICI6IGNhbid0IHNldCBhcyBwcm90b3R5cGUhIik7CiAgICAgIH07CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICBzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoJ19fcHJvdG9fXycgaW4ge30gPyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lCiAgICAgICAgZnVuY3Rpb24gKHRlc3QsIGJ1Z2d5LCBzZXQpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHNldCA9IF9fd2VicGFja19yZXF1aXJlX18oMTMpKEZ1bmN0aW9uLmNhbGwsIF9fd2VicGFja19yZXF1aXJlX18oNjkpLmYoT2JqZWN0LnByb3RvdHlwZSwgJ19fcHJvdG9fXycpLnNldCwgMik7CiAgICAgICAgICAgIHNldCh0ZXN0LCBbXSk7CiAgICAgICAgICAgIGJ1Z2d5ID0gISh0ZXN0IGluc3RhbmNlb2YgQXJyYXkpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBidWdneSA9IHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIHNldFByb3RvdHlwZU9mKE8sIHByb3RvKSB7CiAgICAgICAgICAgIGNoZWNrKE8sIHByb3RvKTsKICAgICAgICAgICAgaWYgKGJ1Z2d5KSBPLl9fcHJvdG9fXyA9IHByb3RvO2Vsc2Ugc2V0KE8sIHByb3RvKTsKICAgICAgICAgICAgcmV0dXJuIE87CiAgICAgICAgICB9OwogICAgICAgIH0oe30sIGZhbHNlKSA6IHVuZGVmaW5lZCksCiAgICAgICAgY2hlY2s6IGNoZWNrCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTQwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgImRlZmF1bHQiOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDE0MSksCiAgICAgICAgX19lc01vZHVsZTogdHJ1ZQogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE0MSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMTQyKTsKCiAgICAgIHZhciAkT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKS5PYmplY3Q7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGNyZWF0ZShQLCBEKSB7CiAgICAgICAgcmV0dXJuICRPYmplY3QuY3JlYXRlKFAsIEQpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxNDIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7IC8vIDE5LjEuMi4yIC8gMTUuMi4zLjUgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKQoKCiAgICAgICRleHBvcnQoJGV4cG9ydC5TLCAnT2JqZWN0JywgewogICAgICAgIGNyZWF0ZTogX193ZWJwYWNrX3JlcXVpcmVfXygzNikKICAgICAgfSk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTQzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwoKICAgICAgdmFyIF9GbGlwTW92ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMTQ0KTsKCiAgICAgIHZhciBfRmxpcE1vdmUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfRmxpcE1vdmUpOwoKICAgICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICAgICAgICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgICAgICAgImRlZmF1bHQiOiBvYmoKICAgICAgICB9OwogICAgICB9CgogICAgICBleHBvcnRzWyJkZWZhdWx0Il0gPSBfRmxpcE1vdmUyWyJkZWZhdWx0Il07CiAgICAgIC8qKgogICAgICAgKiBSZWFjdCBGbGlwIE1vdmUKICAgICAgICogKGMpIDIwMTYtcHJlc2VudCBKb3NodWEgQ29tZWF1CiAgICAgICAqLwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTQ0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwoKICAgICAgdmFyIF9zbGljZWRUb0FycmF5ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIHNsaWNlSXRlcmF0b3IoYXJyLCBpKSB7CiAgICAgICAgICB2YXIgX2FyciA9IFtdOwogICAgICAgICAgdmFyIF9uID0gdHJ1ZTsKICAgICAgICAgIHZhciBfZCA9IGZhbHNlOwogICAgICAgICAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKICAgICAgICAgICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgICAgICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfZCA9IHRydWU7CiAgICAgICAgICAgIF9lID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSkgX2lbInJldHVybiJdKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBfYXJyOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcnIsIGkpIHsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgICAgICAgICAgcmV0dXJuIGFycjsKICAgICAgICAgIH0gZWxzZSBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpKSB7CiAgICAgICAgICAgIHJldHVybiBzbGljZUl0ZXJhdG9yKGFyciwgaSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSgpOwoKICAgICAgdmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgIH07CgogICAgICB2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgICAgICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgICAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICAgICAgICBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogICAgICAgICAgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgICAgICAgICByZXR1cm4gQ29uc3RydWN0b3I7CiAgICAgICAgfTsKICAgICAgfSgpOwoKICAgICAgdmFyIF9yZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgogICAgICB2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMTQ1KTsKCiAgICAgIHZhciBfcHJvcENvbnZlcnRlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTQ2KTsKCiAgICAgIHZhciBfcHJvcENvbnZlcnRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9wcm9wQ29udmVydGVyKTsKCiAgICAgIHZhciBfZG9tTWFuaXB1bGF0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNDkpOwoKICAgICAgdmFyIF9oZWxwZXJzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Nyk7CgogICAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogICAgICAgIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICAgICAgICAiZGVmYXVsdCI6IG9iagogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICAgICAgICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CiAgICAgICAgaWYgKCFzZWxmKSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNhbGwgJiYgKF90eXBlb2Y0KGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikgPyBjYWxsIDogc2VsZjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgICAgICAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIF90eXBlb2Y0KHN1cGVyQ2xhc3MpKTsKICAgICAgICB9CgogICAgICAgIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgICAgICAgY29uc3RydWN0b3I6IHsKICAgICAgICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsKICAgICAgfQogICAgICAvKioKICAgICAgICogUmVhY3QgRmxpcCBNb3ZlCiAgICAgICAqIChjKSAyMDE2LXByZXNlbnQgSm9zaHVhIENvbWVhdQogICAgICAgKgogICAgICAgKiBGb3IgaW5mb3JtYXRpb24gb24gaG93IHRoaXMgY29kZSBpcyBsYWlkIG91dCwgY2hlY2sgb3V0IENPREVfVE9VUi5tZAogICAgICAgKi8KCiAgICAgIC8qIGVzbGludC1kaXNhYmxlIHJlYWN0L3Byb3AtdHlwZXMgKi8KCgogICAgICB2YXIgdHJhbnNpdGlvbkVuZCA9ICgwLCBfZG9tTWFuaXB1bGF0aW9uLndoaWNoVHJhbnNpdGlvbkV2ZW50KSgpOwogICAgICB2YXIgbm9Ccm93c2VyU3VwcG9ydCA9ICF0cmFuc2l0aW9uRW5kOwoKICAgICAgZnVuY3Rpb24gZ2V0S2V5KGNoaWxkRGF0YSkgewogICAgICAgIHJldHVybiBjaGlsZERhdGEua2V5IHx8ICcnOwogICAgICB9CgogICAgICB2YXIgRmxpcE1vdmUgPSBmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogICAgICAgIF9pbmhlcml0cyhGbGlwTW92ZSwgX0NvbXBvbmVudCk7CgogICAgICAgIGZ1bmN0aW9uIEZsaXBNb3ZlKCkgewogICAgICAgICAgdmFyIF9yZWY7CgogICAgICAgICAgdmFyIF90ZW1wLCBfdGhpcywgX3JldDsKCiAgICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRmxpcE1vdmUpOwoKICAgICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgICAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF9yZXQgPSAoX3RlbXAgPSAoX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoX3JlZiA9IEZsaXBNb3ZlLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoRmxpcE1vdmUpKS5jYWxsLmFwcGx5KF9yZWYsIFt0aGlzXS5jb25jYXQoYXJncykpKSwgX3RoaXMpLCBfdGhpcy5zdGF0ZSA9IHsKICAgICAgICAgICAgY2hpbGRyZW46IF9yZWFjdC5DaGlsZHJlbi50b0FycmF5KF90aGlzLnByb3BzLmNoaWxkcmVuKS5tYXAoZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgICAgICByZXR1cm4gX2V4dGVuZHMoe30sIGVsZW1lbnQsIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsCiAgICAgICAgICAgICAgICBhcHBlYXJpbmc6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgIH0sIF90aGlzLmNoaWxkcmVuRGF0YSA9IHt9LCBfdGhpcy5wYXJlbnREYXRhID0gewogICAgICAgICAgICBkb21Ob2RlOiBudWxsLAogICAgICAgICAgICBib3VuZGluZ0JveDogbnVsbAogICAgICAgICAgfSwgX3RoaXMuaGVpZ2h0UGxhY2Vob2xkZXJEYXRhID0gewogICAgICAgICAgICBkb21Ob2RlOiBudWxsCiAgICAgICAgICB9LCBfdGhpcy5yZW1haW5pbmdBbmltYXRpb25zID0gMCwgX3RoaXMuY2hpbGRyZW5Ub0FuaW1hdGUgPSBbXSwgX3RoaXMucnVuQW5pbWF0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgZHluYW1pY0NoaWxkcmVuID0gX3RoaXMuc3RhdGUuY2hpbGRyZW4uZmlsdGVyKF90aGlzLmRvZXNDaGlsZE5lZWRUb0JlQW5pbWF0ZWQpOwoKICAgICAgICAgICAgZHluYW1pY0NoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkLCBuKSB7CiAgICAgICAgICAgICAgX3RoaXMucmVtYWluaW5nQW5pbWF0aW9ucyArPSAxOwoKICAgICAgICAgICAgICBfdGhpcy5jaGlsZHJlblRvQW5pbWF0ZS5wdXNoKGdldEtleShjaGlsZCkpOwoKICAgICAgICAgICAgICBfdGhpcy5hbmltYXRlQ2hpbGQoY2hpbGQsIG4pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgX3RoaXMucHJvcHMub25TdGFydEFsbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgIF90aGlzLmNhbGxDaGlsZHJlbkhvb2soX3RoaXMucHJvcHMub25TdGFydEFsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF90aGlzLmRvZXNDaGlsZE5lZWRUb0JlQW5pbWF0ZWQgPSBmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGRvZXNuJ3QgaGF2ZSBhIGtleSwgaXQncyBhbiBpbW1vdmFibGUgY2hpbGQgKG9uZSB0aGF0IHdlCiAgICAgICAgICAgIC8vIGRvIG5vdCB3YW50IHRvIGRvIEZMSVAgc3R1ZmYgdG8uKQogICAgICAgICAgICBpZiAoIWdldEtleShjaGlsZCkpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjaGlsZERhdGEgPSBfdGhpcy5nZXRDaGlsZERhdGEoZ2V0S2V5KGNoaWxkKSk7CgogICAgICAgICAgICB2YXIgY2hpbGREb21Ob2RlID0gY2hpbGREYXRhLmRvbU5vZGU7CiAgICAgICAgICAgIHZhciBjaGlsZEJvdW5kaW5nQm94ID0gY2hpbGREYXRhLmJvdW5kaW5nQm94OwogICAgICAgICAgICB2YXIgcGFyZW50Qm91bmRpbmdCb3ggPSBfdGhpcy5wYXJlbnREYXRhLmJvdW5kaW5nQm94OwoKICAgICAgICAgICAgaWYgKCFjaGlsZERvbU5vZGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfdGhpcyRwcm9wcyA9IF90aGlzLnByb3BzLAogICAgICAgICAgICAgICAgYXBwZWFyQW5pbWF0aW9uID0gX3RoaXMkcHJvcHMuYXBwZWFyQW5pbWF0aW9uLAogICAgICAgICAgICAgICAgZW50ZXJBbmltYXRpb24gPSBfdGhpcyRwcm9wcy5lbnRlckFuaW1hdGlvbiwKICAgICAgICAgICAgICAgIGxlYXZlQW5pbWF0aW9uID0gX3RoaXMkcHJvcHMubGVhdmVBbmltYXRpb24sCiAgICAgICAgICAgICAgICBnZXRQb3NpdGlvbiA9IF90aGlzJHByb3BzLmdldFBvc2l0aW9uOwogICAgICAgICAgICB2YXIgaXNBcHBlYXJpbmdXaXRoQW5pbWF0aW9uID0gY2hpbGQuYXBwZWFyaW5nICYmIGFwcGVhckFuaW1hdGlvbjsKICAgICAgICAgICAgdmFyIGlzRW50ZXJpbmdXaXRoQW5pbWF0aW9uID0gY2hpbGQuZW50ZXJpbmcgJiYgZW50ZXJBbmltYXRpb247CiAgICAgICAgICAgIHZhciBpc0xlYXZpbmdXaXRoQW5pbWF0aW9uID0gY2hpbGQubGVhdmluZyAmJiBsZWF2ZUFuaW1hdGlvbjsKCiAgICAgICAgICAgIGlmIChpc0FwcGVhcmluZ1dpdGhBbmltYXRpb24gfHwgaXNFbnRlcmluZ1dpdGhBbmltYXRpb24gfHwgaXNMZWF2aW5nV2l0aEFuaW1hdGlvbikgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IC8vIElmIGl0IGlzbid0IGVudGVyaW5nL2xlYXZpbmcsIHdlIHdhbnQgdG8gYW5pbWF0ZSBpdCBpZiBpdCdzCiAgICAgICAgICAgIC8vIG9uLXNjcmVlbiBwb3NpdGlvbiBoYXMgY2hhbmdlZC4KCgogICAgICAgICAgICB2YXIgX2dldFBvc2l0aW9uRGVsdGEgPSAoMCwgX2RvbU1hbmlwdWxhdGlvbi5nZXRQb3NpdGlvbkRlbHRhKSh7CiAgICAgICAgICAgICAgY2hpbGREb21Ob2RlOiBjaGlsZERvbU5vZGUsCiAgICAgICAgICAgICAgY2hpbGRCb3VuZGluZ0JveDogY2hpbGRCb3VuZGluZ0JveCwKICAgICAgICAgICAgICBwYXJlbnRCb3VuZGluZ0JveDogcGFyZW50Qm91bmRpbmdCb3gsCiAgICAgICAgICAgICAgZ2V0UG9zaXRpb246IGdldFBvc2l0aW9uCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgX2dldFBvc2l0aW9uRGVsdGEyID0gX3NsaWNlZFRvQXJyYXkoX2dldFBvc2l0aW9uRGVsdGEsIDIpLAogICAgICAgICAgICAgICAgZFggPSBfZ2V0UG9zaXRpb25EZWx0YTJbMF0sCiAgICAgICAgICAgICAgICBkWSA9IF9nZXRQb3NpdGlvbkRlbHRhMlsxXTsKCiAgICAgICAgICAgIHJldHVybiBkWCAhPT0gMCB8fCBkWSAhPT0gMDsKICAgICAgICAgIH0sIF90ZW1wKSwgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oX3RoaXMsIF9yZXQpOwogICAgICAgIH0gLy8gQ29weSBwcm9wcy5jaGlsZHJlbiBpbnRvIHN0YXRlLgogICAgICAgIC8vIFRvIHVuZGVyc3RhbmQgd2h5IHRoaXMgaXMgaW1wb3J0YW50IChhbmQgbm90IGFuIGFudGktcGF0dGVybiksIGNvbnNpZGVyCiAgICAgICAgLy8gaG93ICJsZWF2ZSIgYW5pbWF0aW9ucyB3b3JrLiBBbiBpdGVtIGhhcyAibGVmdCIgd2hlbiB0aGUgY29tcG9uZW50CiAgICAgICAgLy8gcmVjZWl2ZXMgYSBuZXcgc2V0IG9mIHByb3BzIHRoYXQgZG8gTk9UIGNvbnRhaW4gdGhlIGl0ZW0uCiAgICAgICAgLy8gSWYgd2UganVzdCByZW5kZXIgdGhlIHByb3BzIGFzLWlzLCB0aGUgaXRlbSB3b3VsZCBpbnN0YW50bHkgZGlzYXBwZWFyLgogICAgICAgIC8vIFdlIHdhbnQgdG8ga2VlcCB0aGUgaXRlbSByZW5kZXJlZCBmb3IgYSBsaXR0bGUgd2hpbGUsIHVudGlsIGl0cyBhbmltYXRpb24KICAgICAgICAvLyBjYW4gY29tcGxldGUuIEJlY2F1c2Ugd2UgY2Fubm90IG11dGF0ZSBwcm9wcywgd2UgbWFrZSBgc3RhdGVgIHRoZSBzb3VyY2UKICAgICAgICAvLyBvZiB0cnV0aC4KICAgICAgICAvLyBGbGlwTW92ZSBuZWVkcyB0byBrbm93IHF1aXRlIGEgYml0IGFib3V0IGl0cyBjaGlsZHJlbiBpbiBvcmRlciB0byBkbwogICAgICAgIC8vIGl0cyBqb2IuIFdlIHN0b3JlIHRoZXNlIGFzIGEgcHJvcGVydHkgb24gdGhlIGluc3RhbmNlLiBXZSdyZSBub3QgdXNpbmcKICAgICAgICAvLyBzdGF0ZSwgYmVjYXVzZSB3ZSBkb24ndCB3YW50IGNoYW5nZXMgdG8gdHJpZ2dlciByZS1yZW5kZXJzLCB3ZSBqdXN0CiAgICAgICAgLy8gbmVlZCBhIHBsYWNlIHRvIGtlZXAgdGhlIGRhdGEgZm9yIHJlZmVyZW5jZSwgd2hlbiBjaGFuZ2VzIGhhcHBlbi4KICAgICAgICAvLyBUaGlzIGZpZWxkIHNob3VsZCBub3QgYmUgYWNjZXNzZWQgZGlyZWN0bHkuIEluc3RlYWQsIHVzZSBnZXRDaGlsZERhdGEsCiAgICAgICAgLy8gcHV0Q2hpbGREYXRhLCBldGMuLi4KICAgICAgICAvLyBTaW1pbGFybHksIHRyYWNrIHRoZSBkb20gbm9kZSBhbmQgYm94IG9mIG91ciBwYXJlbnQgZWxlbWVudC4KICAgICAgICAvLyBJZiBgbWFpbnRhaW5Db250YWluZXJIZWlnaHRgIHByb3AgaXMgc2V0IHRvIHRydWUsIHdlJ2xsIGNyZWF0ZSBhCiAgICAgICAgLy8gcGxhY2Vob2xkZXIgZWxlbWVudCB3aGljaCBvY2N1cGllcyBzcGFjZSBzbyB0aGF0IHRoZSBwYXJlbnQgaGVpZ2h0CiAgICAgICAgLy8gZG9lc24ndCBjaGFuZ2Ugd2hlbiBpdGVtcyBhcmUgcmVtb3ZlZCBmcm9tIHRoZSBkb2N1bWVudCBmbG93ICh3aGljaAogICAgICAgIC8vIGhhcHBlbnMgZHVyaW5nIGxlYXZlIGFuaW1hdGlvbnMpCiAgICAgICAgLy8gS2VlcCB0cmFjayBvZiByZW1haW5pbmcgYW5pbWF0aW9ucyBzbyB3ZSBrbm93IHdoZW4gdG8gZmlyZSB0aGUKICAgICAgICAvLyBhbGwtZmluaXNoZWQgY2FsbGJhY2ssIGFuZCBjbGVhbiB1cCBhZnRlciBvdXJzZWx2ZXMuCiAgICAgICAgLy8gTk9URTogd2UgY2FuJ3Qgc2ltcGx5IHVzZSBjaGlsZHJlblRvQW5pbWF0ZS5sZW5ndGggdG8gdHJhY2sgcmVtYWluaW5nCiAgICAgICAgLy8gYW5pbWF0aW9ucywgYmVjYXVzZSB3ZSBuZWVkIHRvIG1haW50YWluIHRoZSBsaXN0IG9mIGFuaW1hdGluZyBjaGlsZHJlbiwKICAgICAgICAvLyB0byBwYXNzIHRvIHRoZSBgb25GaW5pc2hBbGxgIGhhbmRsZXIuCgoKICAgICAgICBfY3JlYXRlQ2xhc3MoRmxpcE1vdmUsIFt7CiAgICAgICAgICBrZXk6ICdjb21wb25lbnREaWRNb3VudCcsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgICAgICAgIC8vIFJ1biBvdXIgYGFwcGVhckFuaW1hdGlvbmAgaWYgaXQgd2FzIHJlcXVlc3RlZCwgcmlnaHQgYWZ0ZXIgdGhlCiAgICAgICAgICAgIC8vIGNvbXBvbmVudCBtb3VudHMuCiAgICAgICAgICAgIHZhciBzaG91bGRUcmlnZ2VyRkxJUCA9IHRoaXMucHJvcHMuYXBwZWFyQW5pbWF0aW9uICYmICF0aGlzLmlzQW5pbWF0aW9uRGlzYWJsZWQodGhpcy5wcm9wcyk7CgogICAgICAgICAgICBpZiAoc2hvdWxkVHJpZ2dlckZMSVApIHsKICAgICAgICAgICAgICB0aGlzLnByZXBGb3JBbmltYXRpb24oKTsKICAgICAgICAgICAgICB0aGlzLnJ1bkFuaW1hdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcycsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHsKICAgICAgICAgICAgLy8gV2hlbiB0aGUgY29tcG9uZW50IGlzIGhhbmRlZCBuZXcgcHJvcHMsIHdlIG5lZWQgdG8gZmlndXJlIG91dCB0aGUKICAgICAgICAgICAgLy8gInJlc3RpbmciIHBvc2l0aW9uIG9mIGFsbCBjdXJyZW50bHktcmVuZGVyZWQgRE9NIG5vZGVzLgogICAgICAgICAgICAvLyBXZSBzdG9yZSB0aGF0IGRhdGEgaW4gdGhpcy5wYXJlbnQgYW5kIHRoaXMuY2hpbGRyZW4sCiAgICAgICAgICAgIC8vIHNvIGl0IGNhbiBiZSB1c2VkIGxhdGVyIHRvIHdvcmsgb3V0IHRoZSBhbmltYXRpb24uCiAgICAgICAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdCb3hDYWNoZXMoKTsgLy8gQ29udmVydCBvcGFxdWUgY2hpbGRyZW4gb2JqZWN0IHRvIGFycmF5LgoKICAgICAgICAgICAgdmFyIG5leHRDaGlsZHJlbiA9IF9yZWFjdC5DaGlsZHJlbi50b0FycmF5KG5leHRQcm9wcy5jaGlsZHJlbik7IC8vIE5leHQsIHdlIG5lZWQgdG8gdXBkYXRlIG91ciBzdGF0ZSwgc28gdGhhdCBpdCBjb250YWlucyBvdXIgbmV3IHNldCBvZgogICAgICAgICAgICAvLyBjaGlsZHJlbi4gSWYgYW5pbWF0aW9uIGlzIGRpc2FibGVkIG9yIHVuc3VwcG9ydGVkLCB0aGlzIGlzIGVhc3k7CiAgICAgICAgICAgIC8vIHdlIGp1c3QgY29weSBvdXIgcHJvcHMgaW50byBzdGF0ZS4KICAgICAgICAgICAgLy8gQXNzdW1pbmcgdGhhdCB3ZSBjYW4gYW5pbWF0ZSwgdGhvdWdoLCB3ZSBoYXZlIHRvIGRvIHNvbWUgd29yay4KICAgICAgICAgICAgLy8gRXNzZW50aWFsbHksIHdlIHdhbnQgdG8ga2VlcCBqdXN0LWRlbGV0ZWQgbm9kZXMgaW4gdGhlIERPTSBmb3IgYSBiaXQKICAgICAgICAgICAgLy8gbG9uZ2VyLCBzbyB0aGF0IHdlIGNhbiBhbmltYXRlIHRoZW0gYXdheS4KCgogICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5pc0FuaW1hdGlvbkRpc2FibGVkKG5leHRQcm9wcykgPyBuZXh0Q2hpbGRyZW4ubWFwKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX2V4dGVuZHMoe30sIGVsZW1lbnQsIHsKICAgICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSkgOiB0aGlzLmNhbGN1bGF0ZU5leHRTZXRPZkNoaWxkcmVuKG5leHRDaGlsZHJlbikKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnY29tcG9uZW50RGlkVXBkYXRlJywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRVcGRhdGUocHJldmlvdXNQcm9wcykgewogICAgICAgICAgICAvLyBJZiB0aGUgY2hpbGRyZW4gaGF2ZSBiZWVuIHJlLWFycmFuZ2VkLCBtb3ZlZCwgb3IgYWRkZWQvcmVtb3ZlZCwKICAgICAgICAgICAgLy8gdHJpZ2dlciB0aGUgbWFpbiBGTElQIGFuaW1hdGlvbi4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gSU1QT1JUQU5UOiBXZSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBjaGlsZHJlbiBoYXZlIGFjdHVhbGx5IGNoYW5nZWQuCiAgICAgICAgICAgIC8vIEF0IHRoZSBlbmQgb2YgdGhlIHRyYW5zaXRpb24sIHdlIGNsZWFuIHVwIG5vZGVzIHRoYXQgbmVlZCB0byBiZSByZW1vdmVkLgogICAgICAgICAgICB2YXIgb2xkQ2hpbGRyZW5LZXlzID0gX3JlYWN0LkNoaWxkcmVuLnRvQXJyYXkodGhpcy5wcm9wcy5jaGlsZHJlbikubWFwKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGQua2V5OwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBuZXh0Q2hpbGRyZW5LZXlzID0gX3JlYWN0LkNoaWxkcmVuLnRvQXJyYXkocHJldmlvdXNQcm9wcy5jaGlsZHJlbikubWFwKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGQua2V5OwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBzaG91bGRUcmlnZ2VyRkxJUCA9ICEoMCwgX2hlbHBlcnMuYXJyYXlzRXF1YWwpKG9sZENoaWxkcmVuS2V5cywgbmV4dENoaWxkcmVuS2V5cykgJiYgIXRoaXMuaXNBbmltYXRpb25EaXNhYmxlZCh0aGlzLnByb3BzKTsKCiAgICAgICAgICAgIGlmIChzaG91bGRUcmlnZ2VyRkxJUCkgewogICAgICAgICAgICAgIHRoaXMucHJlcEZvckFuaW1hdGlvbigpOwogICAgICAgICAgICAgIHRoaXMucnVuQW5pbWF0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdjYWxjdWxhdGVOZXh0U2V0T2ZDaGlsZHJlbicsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2FsY3VsYXRlTmV4dFNldE9mQ2hpbGRyZW4obmV4dENoaWxkcmVuKSB7CiAgICAgICAgICAgIHZhciBfdGhpczIgPSB0aGlzOyAvLyBXZSB3YW50IHRvOgogICAgICAgICAgICAvLyAgIC0gTWFyayBhbGwgbmV3IGNoaWxkcmVuIGFzIGBlbnRlcmluZ2AKICAgICAgICAgICAgLy8gICAtIFB1bGwgaW4gcHJldmlvdXMgY2hpbGRyZW4gdGhhdCBhcmVuJ3QgaW4gbmV4dENoaWxkcmVuLCBhbmQgbWFyayB0aGVtCiAgICAgICAgICAgIC8vICAgICBhcyBgbGVhdmluZ2AKICAgICAgICAgICAgLy8gICAtIFByZXNlcnZlIHRoZSBuZXh0Q2hpbGRyZW4gbGlzdCBvcmRlciwgd2l0aCBsZWF2aW5nIGNoaWxkcmVuIGluIHRoZWlyCiAgICAgICAgICAgIC8vICAgICBhcHByb3ByaWF0ZSBwbGFjZXMuCiAgICAgICAgICAgIC8vCgoKICAgICAgICAgICAgdmFyIHVwZGF0ZWRDaGlsZHJlbiA9IG5leHRDaGlsZHJlbi5tYXAoZnVuY3Rpb24gKG5leHRDaGlsZCkgewogICAgICAgICAgICAgIHZhciBjaGlsZCA9IF90aGlzMi5maW5kQ2hpbGRCeUtleShuZXh0Q2hpbGQua2V5IHx8ICcnKTsgLy8gSWYgdGhlIGN1cnJlbnQgY2hpbGQgZGlkIGV4aXN0LCBidXQgaXQgd2FzIGluIHRoZSBtaWRzdCBvZiBsZWF2aW5nLAogICAgICAgICAgICAgIC8vIHdlIHdhbnQgdG8gdHJlYXQgaXQgYXMgdGhvdWdoIGl0J3MgZW50ZXJpbmcKCgogICAgICAgICAgICAgIHZhciBpc0VudGVyaW5nID0gIWNoaWxkIHx8IGNoaWxkLmxlYXZpbmc7CiAgICAgICAgICAgICAgcmV0dXJuIF9leHRlbmRzKHt9LCBuZXh0Q2hpbGQsIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQ6IG5leHRDaGlsZCwKICAgICAgICAgICAgICAgIGVudGVyaW5nOiBpc0VudGVyaW5nCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOyAvLyBUaGlzIGlzIHRyaWNreS4gV2Ugd2FudCB0byBrZWVwIHRoZSBuZXh0Q2hpbGRyZW4ncyBvcmRlcmluZywgYnV0IHdpdGgKICAgICAgICAgICAgLy8gYW55IGp1c3QtcmVtb3ZlZCBpdGVtcyBtYWludGFpbmluZyB0aGVpciBvcmlnaW5hbCBwb3NpdGlvbi4KICAgICAgICAgICAgLy8gZWcuCiAgICAgICAgICAgIC8vICAgdGhpcy5zdGF0ZS5jaGlsZHJlbiAgPSBbIDEsIDIsIDMsIDQgXQogICAgICAgICAgICAvLyAgIG5leHRDaGlsZHJlbiAgICAgICAgID0gWyAzLCAxIF0KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gSW4gdGhpcyBleGFtcGxlLCB3ZSd2ZSByZW1vdmVkIHRoZSAnMicgJiAnNCcKICAgICAgICAgICAgLy8gV2Ugd2FudCB0byBlbmQgdXAgd2l0aDogIFsgMiwgMywgMSwgNCBdCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIFRvIGFjY29tcGxpc2ggdGhhdCwgd2UnbGwgaXRlcmF0ZSB0aHJvdWdoIHRoaXMuc3RhdGUuY2hpbGRyZW4uIHdoZW5ldmVyCiAgICAgICAgICAgIC8vIHdlIGZpbmQgYSBtYXRjaCwgd2UnbGwgYXBwZW5kIG91ciBgbGVhdmluZ2AgZmxhZyB0byBpdCwgYW5kIGluc2VydCBpdAogICAgICAgICAgICAvLyBpbnRvIHRoZSBuZXh0Q2hpbGRyZW4gaW4gaXRzIE9SSUdJTkFMIHBvc2l0aW9uLiBOb3RlIHRoYXQsIGFzIHdlIGtlZXAKICAgICAgICAgICAgLy8gaW5zZXJ0aW5nIG9sZCBpdGVtcyBpbnRvIHRoZSBuZXcgbGlzdCwgdGhlICJvcmlnaW5hbCIgcG9zaXRpb24gd2lsbAogICAgICAgICAgICAvLyBrZWVwIGluY3JlbWVudGluZy4KCiAgICAgICAgICAgIHZhciBudW1PZkNoaWxkcmVuTGVhdmluZyA9IDA7CiAgICAgICAgICAgIHRoaXMuc3RhdGUuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQsIGluZGV4KSB7CiAgICAgICAgICAgICAgdmFyIGlzTGVhdmluZyA9ICFuZXh0Q2hpbGRyZW4uZmluZChmdW5jdGlvbiAoX3JlZjIpIHsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBfcmVmMi5rZXk7CiAgICAgICAgICAgICAgICByZXR1cm4ga2V5ID09PSBnZXRLZXkoY2hpbGQpOwogICAgICAgICAgICAgIH0pOyAvLyBJZiB0aGUgY2hpbGQgaXNuJ3QgbGVhdmluZyAob3IsIGlmIHRoZXJlIGlzIG5vIGxlYXZlIGFuaW1hdGlvbiksCiAgICAgICAgICAgICAgLy8gd2UgZG9uJ3QgbmVlZCB0byBhZGQgaXQgaW50byB0aGUgc3RhdGUgY2hpbGRyZW4uCgogICAgICAgICAgICAgIGlmICghaXNMZWF2aW5nIHx8ICFfdGhpczIucHJvcHMubGVhdmVBbmltYXRpb24pIHJldHVybjsKCiAgICAgICAgICAgICAgdmFyIG5leHRDaGlsZCA9IF9leHRlbmRzKHt9LCBjaGlsZCwgewogICAgICAgICAgICAgICAgbGVhdmluZzogdHJ1ZQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICB2YXIgbmV4dENoaWxkSW5kZXggPSBpbmRleCArIG51bU9mQ2hpbGRyZW5MZWF2aW5nOwogICAgICAgICAgICAgIHVwZGF0ZWRDaGlsZHJlbi5zcGxpY2UobmV4dENoaWxkSW5kZXgsIDAsIG5leHRDaGlsZCk7CiAgICAgICAgICAgICAgbnVtT2ZDaGlsZHJlbkxlYXZpbmcgKz0gMTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiB1cGRhdGVkQ2hpbGRyZW47CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAncHJlcEZvckFuaW1hdGlvbicsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcHJlcEZvckFuaW1hdGlvbigpIHsKICAgICAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7IC8vIE91ciBhbmltYXRpb24gcHJlcCBjb25zaXN0cyBvZjoKICAgICAgICAgICAgLy8gLSByZW1vdmUgY2hpbGRyZW4gdGhhdCBhcmUgbGVhdmluZyBmcm9tIHRoZSBET00gZmxvdywgc28gdGhhdCB0aGUgbmV3CiAgICAgICAgICAgIC8vICAgbGF5b3V0IGNhbiBiZSBhY2N1cmF0ZWx5IGNhbGN1bGF0ZWQsCiAgICAgICAgICAgIC8vIC0gdXBkYXRlIHRoZSBwbGFjZWhvbGRlciBjb250YWluZXIgaGVpZ2h0LCBpZiBuZWVkZWQsIHRvIGVuc3VyZSB0aGF0CiAgICAgICAgICAgIC8vICAgdGhlIHBhcmVudCdzIGhlaWdodCBkb2Vzbid0IGNvbGxhcHNlLgoKCiAgICAgICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzLAogICAgICAgICAgICAgICAgbGVhdmVBbmltYXRpb24gPSBfcHJvcHMubGVhdmVBbmltYXRpb24sCiAgICAgICAgICAgICAgICBtYWludGFpbkNvbnRhaW5lckhlaWdodCA9IF9wcm9wcy5tYWludGFpbkNvbnRhaW5lckhlaWdodCwKICAgICAgICAgICAgICAgIGdldFBvc2l0aW9uID0gX3Byb3BzLmdldFBvc2l0aW9uOyAvLyB3ZSBuZWVkIHRvIG1ha2UgYWxsIGxlYXZpbmcgbm9kZXMgImludmlzaWJsZSIgdG8gdGhlIGxheW91dCBjYWxjdWxhdGlvbnMKICAgICAgICAgICAgLy8gdGhhdCB3aWxsIHRha2UgcGxhY2UgaW4gdGhlIG5leHQgc3RlcCAodGhpcy5ydW5BbmltYXRpb24pLgoKICAgICAgICAgICAgaWYgKGxlYXZlQW5pbWF0aW9uKSB7CiAgICAgICAgICAgICAgdmFyIGxlYXZpbmdDaGlsZHJlbiA9IHRoaXMuc3RhdGUuY2hpbGRyZW4uZmlsdGVyKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkLmxlYXZpbmc7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgbGVhdmluZ0NoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGxlYXZpbmdDaGlsZCkgewogICAgICAgICAgICAgICAgdmFyIGNoaWxkRGF0YSA9IF90aGlzMy5nZXRDaGlsZERhdGEoZ2V0S2V5KGxlYXZpbmdDaGlsZCkpOyAvLyBXZSBuZWVkIHRvIHRha2UgdGhlIGl0ZW1zIG91dCBvZiB0aGUgImZsb3ciIG9mIHRoZSBkb2N1bWVudCwgc28gdGhhdAogICAgICAgICAgICAgICAgLy8gaXRzIHNpYmxpbmdzIGNhbiBtb3ZlIHRvIHRha2UgaXRzIHBsYWNlLgoKCiAgICAgICAgICAgICAgICBpZiAoY2hpbGREYXRhLmJvdW5kaW5nQm94KSB7CiAgICAgICAgICAgICAgICAgICgwLCBfZG9tTWFuaXB1bGF0aW9uLnJlbW92ZU5vZGVGcm9tRE9NRmxvdykoY2hpbGREYXRhLCBfdGhpczMucHJvcHMudmVydGljYWxBbGlnbm1lbnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAobWFpbnRhaW5Db250YWluZXJIZWlnaHQgJiYgdGhpcy5oZWlnaHRQbGFjZWhvbGRlckRhdGEuZG9tTm9kZSkgewogICAgICAgICAgICAgICAgKDAsIF9kb21NYW5pcHVsYXRpb24udXBkYXRlSGVpZ2h0UGxhY2Vob2xkZXIpKHsKICAgICAgICAgICAgICAgICAgZG9tTm9kZTogdGhpcy5oZWlnaHRQbGFjZWhvbGRlckRhdGEuZG9tTm9kZSwKICAgICAgICAgICAgICAgICAgcGFyZW50RGF0YTogdGhpcy5wYXJlbnREYXRhLAogICAgICAgICAgICAgICAgICBnZXRQb3NpdGlvbjogZ2V0UG9zaXRpb24KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAvLyBGb3IgYWxsIGNoaWxkcmVuIG5vdCBpbiB0aGUgbWlkZGxlIG9mIGVudGVyaW5nIG9yIGxlYXZpbmcsCiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcmVzZXQgdGhlIHRyYW5zaXRpb24sIHNvIHRoYXQgdGhlIE5FVyBzaHVmZmxlIHN0YXJ0cyBmcm9tCiAgICAgICAgICAgIC8vIHRoZSByaWdodCBwbGFjZS4KCgogICAgICAgICAgICB0aGlzLnN0YXRlLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICAgICAgdmFyIF9nZXRDaGlsZERhdGEgPSBfdGhpczMuZ2V0Q2hpbGREYXRhKGdldEtleShjaGlsZCkpLAogICAgICAgICAgICAgICAgICBkb21Ob2RlID0gX2dldENoaWxkRGF0YS5kb21Ob2RlOyAvLyBJZ25vcmUgY2hpbGRyZW4gdGhhdCBkb24ndCByZW5kZXIgRE9NIG5vZGVzIChlZy4gYnkgcmV0dXJuaW5nIG51bGwpCgoKICAgICAgICAgICAgICBpZiAoIWRvbU5vZGUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghY2hpbGQuZW50ZXJpbmcgJiYgIWNoaWxkLmxlYXZpbmcpIHsKICAgICAgICAgICAgICAgICgwLCBfZG9tTWFuaXB1bGF0aW9uLmFwcGx5U3R5bGVzVG9ET01Ob2RlKSh7CiAgICAgICAgICAgICAgICAgIGRvbU5vZGU6IGRvbU5vZGUsCiAgICAgICAgICAgICAgICAgIHN0eWxlczogewogICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb246ICcnCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnYW5pbWF0ZUNoaWxkJywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhbmltYXRlQ2hpbGQoY2hpbGQsIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIF9nZXRDaGlsZERhdGEyID0gdGhpcy5nZXRDaGlsZERhdGEoZ2V0S2V5KGNoaWxkKSksCiAgICAgICAgICAgICAgICBkb21Ob2RlID0gX2dldENoaWxkRGF0YTIuZG9tTm9kZTsKCiAgICAgICAgICAgIGlmICghZG9tTm9kZSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSAvLyBBcHBseSB0aGUgcmVsZXZhbnQgc3R5bGUgZm9yIHRoaXMgRE9NIG5vZGUKICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgb2Zmc2V0IGZyb20gaXRzIGFjdHVhbCBET00gcG9zaXRpb24uCiAgICAgICAgICAgIC8vIGVnLiBpZiBhbiBpdGVtIGhhcyBiZWVuIHJlLXJlbmRlcmVkIDIwcHggbG93ZXIsIHdlIHdhbnQgdG8gYXBwbHkgYQogICAgICAgICAgICAvLyBzdHlsZSBvZiAndHJhbnNmb3JtOiB0cmFuc2xhdGUoLTIwcHgpJywgc28gdGhhdCBpdCBhcHBlYXJzIHRvIGJlIHdoZXJlCiAgICAgICAgICAgIC8vIGl0IHN0YXJ0ZWQuCiAgICAgICAgICAgIC8vIEluIEZMSVAgdGVybWlub2xvZ3ksIHRoaXMgaXMgdGhlICdJbnZlcnQnIHN0YWdlLgoKCiAgICAgICAgICAgICgwLCBfZG9tTWFuaXB1bGF0aW9uLmFwcGx5U3R5bGVzVG9ET01Ob2RlKSh7CiAgICAgICAgICAgICAgZG9tTm9kZTogZG9tTm9kZSwKICAgICAgICAgICAgICBzdHlsZXM6IHRoaXMuY29tcHV0ZUluaXRpYWxTdHlsZXMoY2hpbGQpCiAgICAgICAgICAgIH0pOyAvLyBTdGFydCBieSBpbnZva2luZyB0aGUgb25TdGFydCBjYWxsYmFjayBmb3IgdGhpcyBjaGlsZC4KCiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLm9uU3RhcnQpIHRoaXMucHJvcHMub25TdGFydChjaGlsZCwgZG9tTm9kZSk7IC8vIE5leHQsIGFuaW1hdGUgdGhlIGl0ZW0gZnJvbSBpdCdzIGFydGlmaWNpYWxseS1vZmZzZXQgcG9zaXRpb24gdG8gaXRzCiAgICAgICAgICAgIC8vIG5ldywgbmF0dXJhbCBwb3NpdGlvbi4KCiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vIE5PVEUsIFJFOiB0aGUgZG91YmxlLXJlcXVlc3RBbmltYXRpb25GcmFtZToKICAgICAgICAgICAgICAgIC8vIFNhZGx5LCB0aGlzIGlzIHRoZSBtb3N0IGJyb3dzZXItY29tcGF0aWJsZSB3YXkgdG8gZG8gdGhpcyBJJ3ZlIGZvdW5kLgogICAgICAgICAgICAgICAgLy8gRXNzZW50aWFsbHkgd2UgbmVlZCB0byBzZXQgdGhlIGluaXRpYWwgc3R5bGVzIG91dHNpZGUgb2YgYW55IHJlcXVlc3QKICAgICAgICAgICAgICAgIC8vIGNhbGxiYWNrcyB0byBhdm9pZCBiYXRjaGluZyB0aGVtLiBUaGVuLCBhIGZyYW1lIG5lZWRzIHRvIHBhc3Mgd2l0aAogICAgICAgICAgICAgICAgLy8gdGhlIHN0eWxlcyBhYm92ZSByZW5kZXJlZC4gVGhlbiwgb24gdGhlIHNlY29uZCBmcmFtZSwgd2UgY2FuIGFwcGx5CiAgICAgICAgICAgICAgICAvLyBvdXIgZmluYWwgc3R5bGVzIHRvIHBlcmZvcm0gdGhlIGFuaW1hdGlvbi4KICAgICAgICAgICAgICAgIC8vIE91ciBmaXJzdCBvcmRlciBvZiBidXNpbmVzcyBpcyB0byAidW5kbyIgdGhlIHN0eWxlcyBhcHBsaWVkIGluIHRoZQogICAgICAgICAgICAgICAgLy8gcHJldmlvdXMgZnJhbWVzLCB3aGlsZSBhbHNvIGFkZGluZyBhIGB0cmFuc2l0aW9uYCBwcm9wZXJ0eS4KICAgICAgICAgICAgICAgIC8vIFRoaXMgd2F5LCB0aGUgaXRlbSB3aWxsIHNtb290aGx5IHRyYW5zaXRpb24gZnJvbSBpdHMgb2xkIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAvLyB0byBpdHMgbmV3IHBvc2l0aW9uLgogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGZsb3d0eXBlL3JlcXVpcmUtdmFyaWFibGUtdHlwZQogICAgICAgICAgICAgICAgdmFyIHN0eWxlcyA9IHsKICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogKDAsIF9kb21NYW5pcHVsYXRpb24uY3JlYXRlVHJhbnNpdGlvblN0cmluZykoaW5kZXgsIF90aGlzNC5wcm9wcyksCiAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogJycsCiAgICAgICAgICAgICAgICAgIG9wYWNpdHk6ICcnCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGlmIChjaGlsZC5hcHBlYXJpbmcgJiYgX3RoaXM0LnByb3BzLmFwcGVhckFuaW1hdGlvbikgewogICAgICAgICAgICAgICAgICBzdHlsZXMgPSBfZXh0ZW5kcyh7fSwgc3R5bGVzLCBfdGhpczQucHJvcHMuYXBwZWFyQW5pbWF0aW9uLnRvKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hpbGQuZW50ZXJpbmcgJiYgX3RoaXM0LnByb3BzLmVudGVyQW5pbWF0aW9uKSB7CiAgICAgICAgICAgICAgICAgIHN0eWxlcyA9IF9leHRlbmRzKHt9LCBzdHlsZXMsIF90aGlzNC5wcm9wcy5lbnRlckFuaW1hdGlvbi50byk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoaWxkLmxlYXZpbmcgJiYgX3RoaXM0LnByb3BzLmxlYXZlQW5pbWF0aW9uKSB7CiAgICAgICAgICAgICAgICAgIHN0eWxlcyA9IF9leHRlbmRzKHt9LCBzdHlsZXMsIF90aGlzNC5wcm9wcy5sZWF2ZUFuaW1hdGlvbi50byk7CiAgICAgICAgICAgICAgICB9IC8vIEluIEZMSVAgdGVybWlub2xvZ3ksIHRoaXMgaXMgdGhlICdQbGF5JyBzdGFnZS4KCgogICAgICAgICAgICAgICAgKDAsIF9kb21NYW5pcHVsYXRpb24uYXBwbHlTdHlsZXNUb0RPTU5vZGUpKHsKICAgICAgICAgICAgICAgICAgZG9tTm9kZTogZG9tTm9kZSwKICAgICAgICAgICAgICAgICAgc3R5bGVzOiBzdHlsZXMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5iaW5kVHJhbnNpdGlvbkVuZEhhbmRsZXIoY2hpbGQpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2JpbmRUcmFuc2l0aW9uRW5kSGFuZGxlcicsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYmluZFRyYW5zaXRpb25FbmRIYW5kbGVyKGNoaWxkKSB7CiAgICAgICAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIF9nZXRDaGlsZERhdGEzID0gdGhpcy5nZXRDaGlsZERhdGEoZ2V0S2V5KGNoaWxkKSksCiAgICAgICAgICAgICAgICBkb21Ob2RlID0gX2dldENoaWxkRGF0YTMuZG9tTm9kZTsKCiAgICAgICAgICAgIGlmICghZG9tTm9kZSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSAvLyBUaGUgb25GaW5pc2ggY2FsbGJhY2sgbmVlZHMgdG8gYmUgYm91bmQgdG8gdGhlIHRyYW5zaXRpb25FbmQgZXZlbnQuCiAgICAgICAgICAgIC8vIFdlIGFsc28gbmVlZCB0byB1bmJpbmQgaXQgd2hlbiB0aGUgdHJhbnNpdGlvbiBjb21wbGV0ZXMsIHNvIHRoaXMgdWdseQogICAgICAgICAgICAvLyBpbmxpbmUgZnVuY3Rpb24gaXMgcmVxdWlyZWQgKHdlIG5lZWQgaXQgaGVyZSBzbyBpdCBjbG9zZXMgb3ZlcgogICAgICAgICAgICAvLyBkZXBlbmRlbnQgdmFyaWFibGVzIGBjaGlsZGAgYW5kIGBkb21Ob2RlYCkKCgogICAgICAgICAgICB2YXIgdHJhbnNpdGlvbkVuZEhhbmRsZXIgPSBmdW5jdGlvbiB0cmFuc2l0aW9uRW5kSGFuZGxlcihldikgewogICAgICAgICAgICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB0aGlzIGhhbmRsZXIgaXMgZmlyZWQgbm90IG9uIG91ciBwcmltYXJ5IHRyYW5zaXRpb24sCiAgICAgICAgICAgICAgLy8gYnV0IG9uIGEgbmVzdGVkIHRyYW5zaXRpb24gKGVnLiBhIGhvdmVyIGVmZmVjdCkuIElnbm9yZSB0aGVzZSBjYXNlcy4KICAgICAgICAgICAgICBpZiAoZXYudGFyZ2V0ICE9PSBkb21Ob2RlKSByZXR1cm47IC8vIFJlbW92ZSB0aGUgJ3RyYW5zaXRpb24nIGlubGluZSBzdHlsZSB3ZSBhZGRlZC4gVGhpcyBpcyBjbGVhbnVwLgoKICAgICAgICAgICAgICBkb21Ob2RlLnN0eWxlLnRyYW5zaXRpb24gPSAnJzsgLy8gVHJpZ2dlciBhbnkgYXBwbGljYWJsZSBvbkZpbmlzaC9vbkZpbmlzaEFsbCBob29rcwoKICAgICAgICAgICAgICBfdGhpczUudHJpZ2dlckZpbmlzaEhvb2tzKGNoaWxkLCBkb21Ob2RlKTsKCiAgICAgICAgICAgICAgZG9tTm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKHRyYW5zaXRpb25FbmQsIHRyYW5zaXRpb25FbmRIYW5kbGVyKTsKCiAgICAgICAgICAgICAgaWYgKGNoaWxkLmxlYXZpbmcpIHsKICAgICAgICAgICAgICAgIF90aGlzNS5yZW1vdmVDaGlsZERhdGEoZ2V0S2V5KGNoaWxkKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZG9tTm9kZS5hZGRFdmVudExpc3RlbmVyKHRyYW5zaXRpb25FbmQsIHRyYW5zaXRpb25FbmRIYW5kbGVyKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICd0cmlnZ2VyRmluaXNoSG9va3MnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRyaWdnZXJGaW5pc2hIb29rcyhjaGlsZCwgZG9tTm9kZSkgewogICAgICAgICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLm9uRmluaXNoKSB0aGlzLnByb3BzLm9uRmluaXNoKGNoaWxkLCBkb21Ob2RlKTsgLy8gUmVkdWNlIHRoZSBudW1iZXIgb2YgY2hpbGRyZW4gd2UgbmVlZCB0byBhbmltYXRlIGJ5IDEsCiAgICAgICAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIHRlbGwgd2hlbiBhbGwgY2hpbGRyZW4gaGF2ZSBmaW5pc2hlZC4KCiAgICAgICAgICAgIHRoaXMucmVtYWluaW5nQW5pbWF0aW9ucyAtPSAxOwoKICAgICAgICAgICAgaWYgKHRoaXMucmVtYWluaW5nQW5pbWF0aW9ucyA9PT0gMCkgewogICAgICAgICAgICAgIC8vIFJlbW92ZSBhbnkgaXRlbXMgZnJvbSB0aGUgRE9NIHRoYXQgaGF2ZSBsZWZ0LCBhbmQgcmVzZXQgYGVudGVyaW5nYC4KICAgICAgICAgICAgICB2YXIgbmV4dENoaWxkcmVuID0gdGhpcy5zdGF0ZS5jaGlsZHJlbi5maWx0ZXIoZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgICAgICAgICAgICB2YXIgbGVhdmluZyA9IF9yZWYzLmxlYXZpbmc7CiAgICAgICAgICAgICAgICByZXR1cm4gIWxlYXZpbmc7CiAgICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX2V4dGVuZHMoe30sIGl0ZW0sIHsKICAgICAgICAgICAgICAgICAgYXBwZWFyaW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgZW50ZXJpbmc6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBuZXh0Q2hpbGRyZW4KICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIF90aGlzNi5wcm9wcy5vbkZpbmlzaEFsbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgICBfdGhpczYuY2FsbENoaWxkcmVuSG9vayhfdGhpczYucHJvcHMub25GaW5pc2hBbGwpOwogICAgICAgICAgICAgICAgfSAvLyBSZXNldCBvdXIgdmFyaWFibGVzIGZvciB0aGUgbmV4dCBpdGVyYXRpb24KCgogICAgICAgICAgICAgICAgX3RoaXM2LmNoaWxkcmVuVG9BbmltYXRlID0gW107CiAgICAgICAgICAgICAgfSk7IC8vIElmIHRoZSBwbGFjZWhvbGRlciB3YXMgaG9sZGluZyB0aGUgY29udGFpbmVyIG9wZW4gd2hpbGUgZWxlbWVudHMgd2VyZQogICAgICAgICAgICAgIC8vIGxlYXZpbmcsIHdlIHdlIGNhbiBub3cgc2V0IGl0cyBoZWlnaHQgdG8gemVyby4KCiAgICAgICAgICAgICAgaWYgKHRoaXMuaGVpZ2h0UGxhY2Vob2xkZXJEYXRhLmRvbU5vZGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuaGVpZ2h0UGxhY2Vob2xkZXJEYXRhLmRvbU5vZGUuc3R5bGUuaGVpZ2h0ID0gJzAnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2NhbGxDaGlsZHJlbkhvb2snLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNhbGxDaGlsZHJlbkhvb2soaG9vaykgewogICAgICAgICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgICAgICAgICB2YXIgZG9tTm9kZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5jaGlsZHJlblRvQW5pbWF0ZS5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZEtleSkgewogICAgICAgICAgICAgIC8vIElmIHRoaXMgd2FzIGFuIGV4aXQgYW5pbWF0aW9uLCB0aGUgY2hpbGQgbWF5IG5vIGxvbmdlciBleGlzdC4KICAgICAgICAgICAgICAvLyBJZiBzbywgc2tpcCBpdC4KICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBfdGhpczcuZmluZENoaWxkQnlLZXkoY2hpbGRLZXkpOwoKICAgICAgICAgICAgICBpZiAoIWNoaWxkKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKGNoaWxkKTsKCiAgICAgICAgICAgICAgaWYgKF90aGlzNy5oYXNDaGlsZERhdGEoY2hpbGRLZXkpKSB7CiAgICAgICAgICAgICAgICBkb21Ob2Rlcy5wdXNoKF90aGlzNy5nZXRDaGlsZERhdGEoY2hpbGRLZXkpLmRvbU5vZGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGhvb2soZWxlbWVudHMsIGRvbU5vZGVzKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICd1cGRhdGVCb3VuZGluZ0JveENhY2hlcycsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlQm91bmRpbmdCb3hDYWNoZXMoKSB7CiAgICAgICAgICAgIHZhciBfdGhpczggPSB0aGlzOyAvLyBUaGlzIGlzIHRoZSBPTkxZIHBsYWNlIHRoYXQgcGFyZW50RGF0YSBhbmQgY2hpbGRyZW5EYXRhJ3MKICAgICAgICAgICAgLy8gYm91bmRpbmcgYm94ZXMgYXJlIHVwZGF0ZWQuIFRoZXkgd2lsbCBiZSBjYWxjdWxhdGVkIGF0IG90aGVyIHRpbWVzCiAgICAgICAgICAgIC8vIHRvIGJlIGNvbXBhcmVkIHRvIHRoaXMgdmFsdWUsIGJ1dCBpdCdzIGltcG9ydGFudCB0aGF0IHRoZSBjYWNoZSBpcwogICAgICAgICAgICAvLyB1cGRhdGVkIG9uY2UgcGVyIHVwZGF0ZS4KCgogICAgICAgICAgICB2YXIgcGFyZW50RG9tTm9kZSA9IHRoaXMucGFyZW50RGF0YS5kb21Ob2RlOwoKICAgICAgICAgICAgaWYgKCFwYXJlbnREb21Ob2RlKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnBhcmVudERhdGEuYm91bmRpbmdCb3ggPSB0aGlzLnByb3BzLmdldFBvc2l0aW9uKHBhcmVudERvbU5vZGUpOwogICAgICAgICAgICB0aGlzLnN0YXRlLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICAgICAgdmFyIGNoaWxkS2V5ID0gZ2V0S2V5KGNoaWxkKTsgLy8gSXQgaXMgcG9zc2libGUgdGhhdCBhIGNoaWxkIGRvZXMgbm90IGhhdmUgYSBga2V5YCBwcm9wZXJ0eTsKICAgICAgICAgICAgICAvLyBJZ25vcmUgdGhlc2UgY2hpbGRyZW4sIHRoZXkgZG9uJ3QgbmVlZCB0byBiZSBtb3ZlZC4KCiAgICAgICAgICAgICAgaWYgKCFjaGlsZEtleSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gSW4gdmVyeSByYXJlIGNpcmN1bXN0YW5jZXMsIGZvciByZWFzb25zIHVua25vd24sIHRoZSByZWYgaXMgbmV2ZXIKICAgICAgICAgICAgICAvLyBwb3B1bGF0ZWQgZm9yIGNlcnRhaW4gY2hpbGRyZW4uIEluIHRoaXMgY2FzZSwgYXZvaWQgZG9pbmcgdGhpcyB1cGRhdGUuCiAgICAgICAgICAgICAgLy8gc2VlOiBodHRwczovL2dpdGh1Yi5jb20vam9zaHdjb21lYXUvcmVhY3QtZmxpcC1tb3ZlL3B1bGwvOTEKCgogICAgICAgICAgICAgIGlmICghX3RoaXM4Lmhhc0NoaWxkRGF0YShjaGlsZEtleSkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBjaGlsZERhdGEgPSBfdGhpczguZ2V0Q2hpbGREYXRhKGNoaWxkS2V5KTsgLy8gSWYgdGhlIGNoaWxkIGVsZW1lbnQgcmV0dXJucyBudWxsLCB3ZSBuZWVkIHRvIGF2b2lkIHRyeWluZyB0bwogICAgICAgICAgICAgIC8vIGFjY291bnQgZm9yIGl0CgoKICAgICAgICAgICAgICBpZiAoIWNoaWxkRGF0YS5kb21Ob2RlIHx8ICFjaGlsZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXM4LnNldENoaWxkRGF0YShjaGlsZEtleSwgewogICAgICAgICAgICAgICAgYm91bmRpbmdCb3g6ICgwLCBfZG9tTWFuaXB1bGF0aW9uLmdldFJlbGF0aXZlQm91bmRpbmdCb3gpKHsKICAgICAgICAgICAgICAgICAgY2hpbGREb21Ob2RlOiBjaGlsZERhdGEuZG9tTm9kZSwKICAgICAgICAgICAgICAgICAgcGFyZW50RG9tTm9kZTogcGFyZW50RG9tTm9kZSwKICAgICAgICAgICAgICAgICAgZ2V0UG9zaXRpb246IF90aGlzOC5wcm9wcy5nZXRQb3NpdGlvbgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnY29tcHV0ZUluaXRpYWxTdHlsZXMnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXB1dGVJbml0aWFsU3R5bGVzKGNoaWxkKSB7CiAgICAgICAgICAgIGlmIChjaGlsZC5hcHBlYXJpbmcpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5hcHBlYXJBbmltYXRpb24gPyB0aGlzLnByb3BzLmFwcGVhckFuaW1hdGlvbi5mcm9tIDoge307CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hpbGQuZW50ZXJpbmcpIHsKICAgICAgICAgICAgICBpZiAoIXRoaXMucHJvcHMuZW50ZXJBbmltYXRpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICAgICAgICB9IC8vIElmIHRoaXMgY2hpbGQgd2FzIGluIHRoZSBtaWRkbGUgb2YgbGVhdmluZywgaXQgc3RpbGwgaGFzIGl0cwogICAgICAgICAgICAgIC8vIGFic29sdXRlIHBvc2l0aW9uaW5nIHN0eWxlcyBhcHBsaWVkLiBXZSBuZWVkIHRvIHVuZG8gdGhvc2UuCgoKICAgICAgICAgICAgICByZXR1cm4gX2V4dGVuZHMoewogICAgICAgICAgICAgICAgcG9zaXRpb246ICcnLAogICAgICAgICAgICAgICAgdG9wOiAnJywKICAgICAgICAgICAgICAgIGxlZnQ6ICcnLAogICAgICAgICAgICAgICAgcmlnaHQ6ICcnLAogICAgICAgICAgICAgICAgYm90dG9tOiAnJwogICAgICAgICAgICAgIH0sIHRoaXMucHJvcHMuZW50ZXJBbmltYXRpb24uZnJvbSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hpbGQubGVhdmluZykgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BzLmxlYXZlQW5pbWF0aW9uID8gdGhpcy5wcm9wcy5sZWF2ZUFuaW1hdGlvbi5mcm9tIDoge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjaGlsZERhdGEgPSB0aGlzLmdldENoaWxkRGF0YShnZXRLZXkoY2hpbGQpKTsKICAgICAgICAgICAgdmFyIGNoaWxkRG9tTm9kZSA9IGNoaWxkRGF0YS5kb21Ob2RlOwogICAgICAgICAgICB2YXIgY2hpbGRCb3VuZGluZ0JveCA9IGNoaWxkRGF0YS5ib3VuZGluZ0JveDsKICAgICAgICAgICAgdmFyIHBhcmVudEJvdW5kaW5nQm94ID0gdGhpcy5wYXJlbnREYXRhLmJvdW5kaW5nQm94OwoKICAgICAgICAgICAgaWYgKCFjaGlsZERvbU5vZGUpIHsKICAgICAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfZ2V0UG9zaXRpb25EZWx0YTMgPSAoMCwgX2RvbU1hbmlwdWxhdGlvbi5nZXRQb3NpdGlvbkRlbHRhKSh7CiAgICAgICAgICAgICAgY2hpbGREb21Ob2RlOiBjaGlsZERvbU5vZGUsCiAgICAgICAgICAgICAgY2hpbGRCb3VuZGluZ0JveDogY2hpbGRCb3VuZGluZ0JveCwKICAgICAgICAgICAgICBwYXJlbnRCb3VuZGluZ0JveDogcGFyZW50Qm91bmRpbmdCb3gsCiAgICAgICAgICAgICAgZ2V0UG9zaXRpb246IHRoaXMucHJvcHMuZ2V0UG9zaXRpb24KICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBfZ2V0UG9zaXRpb25EZWx0YTQgPSBfc2xpY2VkVG9BcnJheShfZ2V0UG9zaXRpb25EZWx0YTMsIDIpLAogICAgICAgICAgICAgICAgZFggPSBfZ2V0UG9zaXRpb25EZWx0YTRbMF0sCiAgICAgICAgICAgICAgICBkWSA9IF9nZXRQb3NpdGlvbkRlbHRhNFsxXTsKCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlKCcgKyBkWCArICdweCwgJyArIGRZICsgJ3B4KScKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXMKCiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnaXNBbmltYXRpb25EaXNhYmxlZCcsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNBbmltYXRpb25EaXNhYmxlZChwcm9wcykgewogICAgICAgICAgICAvLyBJZiB0aGUgY29tcG9uZW50IGlzIGV4cGxpY2l0bHkgcGFzc2VkIGEgYGRpc2FibGVBbGxBbmltYXRpb25zYCBmbGFnLAogICAgICAgICAgICAvLyB3ZSBjYW4gc2tpcCB0aGlzIHdob2xlIHByb2Nlc3MuIFNpbWlsYXJseSwgaWYgYWxsIG9mIHRoZSBudW1iZXJzIGhhdmUKICAgICAgICAgICAgLy8gYmVlbiBzZXQgdG8gMCwgdGhlcmUgaXMgbm8gcG9pbnQgaW4gdHJ5aW5nIHRvIGFuaW1hdGU7IGRvaW5nIHNvIHdvdWxkCiAgICAgICAgICAgIC8vIG9ubHkgY2F1c2UgYSBmbGlja2VyIChhbmQgdGhlIGludGVudCBpcyBwcm9iYWJseSB0byBkaXNhYmxlIGFuaW1hdGlvbnMpCiAgICAgICAgICAgIC8vIFdlIGNhbiBhbHNvIHNraXAgdGhpcyByaWdhbWFyb2xlIGlmIHRoZXJlJ3Mgbm8gYnJvd3NlciBzdXBwb3J0IGZvciBpdC4KICAgICAgICAgICAgcmV0dXJuIG5vQnJvd3NlclN1cHBvcnQgfHwgcHJvcHMuZGlzYWJsZUFsbEFuaW1hdGlvbnMgfHwgcHJvcHMuZHVyYXRpb24gPT09IDAgJiYgcHJvcHMuZGVsYXkgPT09IDAgJiYgcHJvcHMuc3RhZ2dlckR1cmF0aW9uQnkgPT09IDAgJiYgcHJvcHMuc3RhZ2dlckRlbGF5QnkgPT09IDA7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnZmluZENoaWxkQnlLZXknLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRDaGlsZEJ5S2V5KGtleSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5jaGlsZHJlbi5maW5kKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgICAgIHJldHVybiBnZXRLZXkoY2hpbGQpID09PSBrZXk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2hhc0NoaWxkRGF0YScsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaGFzQ2hpbGREYXRhKGtleSkgewogICAgICAgICAgICAvLyBPYmplY3QgaGFzIHNvbWUgYnVpbHQtaW4gcHJvcGVydGllcyBvbiBpdHMgcHJvdG90eXBlLCBzdWNoIGFzIHRvU3RyaW5nLiAgaGFzT3duUHJvcGVydHkgbWFrZXMKICAgICAgICAgICAgLy8gc3VyZSB0aGF0IGtleSBpcyBwcmVzZW50IG9uIGNoaWxkcmVuRGF0YSBpdHNlbGYsIG5vdCBvbiBpdHMgcHJvdG90eXBlLgogICAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuY2hpbGRyZW5EYXRhLCBrZXkpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2dldENoaWxkRGF0YScsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2hpbGREYXRhKGtleSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5oYXNDaGlsZERhdGEoa2V5KSA/IHRoaXMuY2hpbGRyZW5EYXRhW2tleV0gOiB7fTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdzZXRDaGlsZERhdGEnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldENoaWxkRGF0YShrZXksIGRhdGEpIHsKICAgICAgICAgICAgdGhpcy5jaGlsZHJlbkRhdGFba2V5XSA9IF9leHRlbmRzKHt9LCB0aGlzLmdldENoaWxkRGF0YShrZXkpLCBkYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdyZW1vdmVDaGlsZERhdGEnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUNoaWxkRGF0YShrZXkpIHsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2hpbGRyZW5EYXRhW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAnY3JlYXRlSGVpZ2h0UGxhY2Vob2xkZXInLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUhlaWdodFBsYWNlaG9sZGVyKCkgewogICAgICAgICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgICAgICAgIHZhciB0eXBlTmFtZSA9IHRoaXMucHJvcHMudHlwZU5hbWU7IC8vIElmIHJlcXVlc3RlZCwgY3JlYXRlIGFuIGludmlzaWJsZSBlbGVtZW50IGF0IHRoZSBlbmQgb2YgdGhlIGxpc3QuCiAgICAgICAgICAgIC8vIEl0cyBoZWlnaHQgd2lsbCBiZSBtb2RpZmllZCB0byBwcmV2ZW50IHRoZSBjb250YWluZXIgZnJvbSBjb2xsYXBzaW5nCiAgICAgICAgICAgIC8vIHByZW1hdHVyZWx5LgoKICAgICAgICAgICAgdmFyIGlzQ29udGFpbmVyQUxpc3QgPSB0eXBlTmFtZSA9PT0gJ3VsJyB8fCB0eXBlTmFtZSA9PT0gJ29sJzsKICAgICAgICAgICAgdmFyIHBsYWNlaG9sZGVyVHlwZSA9IGlzQ29udGFpbmVyQUxpc3QgPyAnbGknIDogJ2Rpdic7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudChwbGFjZWhvbGRlclR5cGUsIHsKICAgICAgICAgICAgICBrZXk6ICdoZWlnaHQtcGxhY2Vob2xkZXInLAogICAgICAgICAgICAgIHJlZjogZnVuY3Rpb24gcmVmKGRvbU5vZGUpIHsKICAgICAgICAgICAgICAgIF90aGlzOS5oZWlnaHRQbGFjZWhvbGRlckRhdGEuZG9tTm9kZSA9IGRvbU5vZGU7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ2hpZGRlbicsCiAgICAgICAgICAgICAgICBoZWlnaHQ6IDAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2NoaWxkcmVuV2l0aFJlZnMnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNoaWxkcmVuV2l0aFJlZnMoKSB7CiAgICAgICAgICAgIHZhciBfdGhpczEwID0gdGhpczsgLy8gV2UgbmVlZCB0byBjbG9uZSB0aGUgcHJvdmlkZWQgY2hpbGRyZW4sIGNhcHR1cmluZyBhIHJlZmVyZW5jZSB0byB0aGUKICAgICAgICAgICAgLy8gdW5kZXJseWluZyBET00gbm9kZS4gRmxpcCBNb3ZlIG5lZWRzIHRvIHVzZSB0aGUgUmVhY3QgZXNjYXBlIGhhdGNoZXMgdG8KICAgICAgICAgICAgLy8gYmUgYWJsZSB0byBkbyBpdHMgY2FsY3VsYXRpb25zLgoKCiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmNoaWxkcmVuLm1hcChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsiZGVmYXVsdCJdLmNsb25lRWxlbWVudChjaGlsZC5lbGVtZW50LCB7CiAgICAgICAgICAgICAgICByZWY6IGZ1bmN0aW9uIHJlZihlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgIC8vIFN0YXRlbGVzcyBGdW5jdGlvbmFsIENvbXBvbmVudHMgYXJlIG5vdCBzdXBwb3J0ZWQgYnkgRmxpcE1vdmUsCiAgICAgICAgICAgICAgICAgIC8vIGJlY2F1c2UgdGhleSBkb24ndCBoYXZlIGluc3RhbmNlcy4KICAgICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgZG9tTm9kZSA9ICgwLCBfZG9tTWFuaXB1bGF0aW9uLmdldE5hdGl2ZU5vZGUpKGVsZW1lbnQpOwoKICAgICAgICAgICAgICAgICAgX3RoaXMxMC5zZXRDaGlsZERhdGEoZ2V0S2V5KGNoaWxkKSwgewogICAgICAgICAgICAgICAgICAgIGRvbU5vZGU6IGRvbU5vZGUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ3JlbmRlcicsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICAgICAgICB2YXIgX3Byb3BzMiA9IHRoaXMucHJvcHMsCiAgICAgICAgICAgICAgICB0eXBlTmFtZSA9IF9wcm9wczIudHlwZU5hbWUsCiAgICAgICAgICAgICAgICBkZWxlZ2F0ZWQgPSBfcHJvcHMyLmRlbGVnYXRlZCwKICAgICAgICAgICAgICAgIGxlYXZlQW5pbWF0aW9uID0gX3Byb3BzMi5sZWF2ZUFuaW1hdGlvbiwKICAgICAgICAgICAgICAgIG1haW50YWluQ29udGFpbmVySGVpZ2h0ID0gX3Byb3BzMi5tYWludGFpbkNvbnRhaW5lckhlaWdodDsKCiAgICAgICAgICAgIHZhciBwcm9wcyA9IF9leHRlbmRzKHt9LCBkZWxlZ2F0ZWQsIHsKICAgICAgICAgICAgICByZWY6IGZ1bmN0aW9uIHJlZihub2RlKSB7CiAgICAgICAgICAgICAgICBfdGhpczExLnBhcmVudERhdGEuZG9tTm9kZSA9IG5vZGU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW5XaXRoUmVmcygpOwoKICAgICAgICAgICAgaWYgKGxlYXZlQW5pbWF0aW9uICYmIG1haW50YWluQ29udGFpbmVySGVpZ2h0KSB7CiAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLmNyZWF0ZUhlaWdodFBsYWNlaG9sZGVyKCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQodHlwZU5hbWUsIHByb3BzLCBjaGlsZHJlbik7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwoKICAgICAgICByZXR1cm4gRmxpcE1vdmU7CiAgICAgIH0oX3JlYWN0LkNvbXBvbmVudCk7CgogICAgICBleHBvcnRzWyJkZWZhdWx0Il0gPSAoMCwgX3Byb3BDb252ZXJ0ZXIyWyJkZWZhdWx0Il0pKEZsaXBNb3ZlKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTQ1ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOyAvLyBAbm9mbG93CgogICAgICAvKioKICAgICAgICogUmVhY3QgRmxpcCBNb3ZlIC0gUG9seWZpbGxzCiAgICAgICAqIChjKSAyMDE2LXByZXNlbnQgSm9zaHVhIENvbWVhdQogICAgICAgKi8KCiAgICAgIC8qIGVzbGludC1kaXNhYmxlICovCgogICAgICBpZiAoIUFycmF5LnByb3RvdHlwZS5maW5kKSB7CiAgICAgICAgQXJyYXkucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbiAocHJlZGljYXRlKSB7CiAgICAgICAgICBpZiAodGhpcyA9PT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheS5wcm90b3R5cGUuZmluZCBjYWxsZWQgb24gbnVsbCBvciB1bmRlZmluZWQnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodHlwZW9mIHByZWRpY2F0ZSAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdwcmVkaWNhdGUgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGxpc3QgPSBPYmplY3QodGhpcyk7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gbGlzdC5sZW5ndGggPj4+IDA7CiAgICAgICAgICB2YXIgdGhpc0FyZyA9IGFyZ3VtZW50c1sxXTsKICAgICAgICAgIHZhciB2YWx1ZSA9IHZvaWQgMDsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhbHVlID0gbGlzdFtpXTsKCiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUuY2FsbCh0aGlzQXJnLCB2YWx1ZSwgaSwgbGlzdCkpIHsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlmICghQXJyYXkucHJvdG90eXBlLmV2ZXJ5KSB7CiAgICAgICAgQXJyYXkucHJvdG90eXBlLmV2ZXJ5ID0gZnVuY3Rpb24gKGNhbGxiYWNrZm4sIHRoaXNBcmcpIHsKICAgICAgICAgICd1c2Ugc3RyaWN0JzsKCiAgICAgICAgICB2YXIgVCwgazsKCiAgICAgICAgICBpZiAodGhpcyA9PSBudWxsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3RoaXMgaXMgbnVsbCBvciBub3QgZGVmaW5lZCcpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBPID0gT2JqZWN0KHRoaXMpOwogICAgICAgICAgdmFyIGxlbiA9IE8ubGVuZ3RoID4+PiAwOwoKICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2tmbiAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIFQgPSB0aGlzQXJnOwogICAgICAgICAgfQoKICAgICAgICAgIGsgPSAwOwoKICAgICAgICAgIHdoaWxlIChrIDwgbGVuKSB7CiAgICAgICAgICAgIHZhciBrVmFsdWU7CgogICAgICAgICAgICBpZiAoayBpbiBPKSB7CiAgICAgICAgICAgICAga1ZhbHVlID0gT1trXTsKICAgICAgICAgICAgICB2YXIgdGVzdFJlc3VsdCA9IGNhbGxiYWNrZm4uY2FsbChULCBrVmFsdWUsIGssIE8pOwoKICAgICAgICAgICAgICBpZiAoIXRlc3RSZXN1bHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGsrKzsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9OwogICAgICB9CgogICAgICBpZiAoIUFycmF5LmlzQXJyYXkpIHsKICAgICAgICBBcnJheS5pc0FycmF5ID0gZnVuY3Rpb24gKGFyZykgewogICAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhcmcpID09PSAnW29iamVjdCBBcnJheV0nOwogICAgICAgIH07CiAgICAgIH0KICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTQ2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8KCiAgICAgIChmdW5jdGlvbiAocHJvY2VzcykgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgICAgIHZhbHVlOiB0cnVlCiAgICAgICAgfSk7CgogICAgICAgIHZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mNChTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIiA/IGZ1bmN0aW9uIChvYmopIHsKICAgICAgICAgIHJldHVybiBfdHlwZW9mNChvYmopOwogICAgICAgIH0gOiBmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiBfdHlwZW9mNChvYmopOwogICAgICAgIH07CgogICAgICAgIHZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsKICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgIH07CgogICAgICAgIHZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICAgICAgICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgICAgICAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgICAgICAgICBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogICAgICAgICAgICBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgICAgICAgICAgcmV0dXJuIENvbnN0cnVjdG9yOwogICAgICAgICAgfTsKICAgICAgICB9KCk7CgogICAgICAgIHZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKICAgICAgICB2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTsKCiAgICAgICAgdmFyIF9lcnJvck1lc3NhZ2VzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNDcpOwoKICAgICAgICB2YXIgX2VudGVyTGVhdmVQcmVzZXRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNDgpOwoKICAgICAgICB2YXIgX2hlbHBlcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ3KTsKCiAgICAgICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICAgICAgICAgIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICAgICAgICAgICJkZWZhdWx0Ijogb2JqCiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgICAgICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CiAgICAgICAgICBpZiAoIXNlbGYpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gY2FsbCAmJiAoX3R5cGVvZjQoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSA/IGNhbGwgOiBzZWxmOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyBfdHlwZW9mNChzdXBlckNsYXNzKSk7CiAgICAgICAgICB9CgogICAgICAgICAgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgICAgICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmVhY3QgRmxpcCBNb3ZlIHwgcHJvcENvbnZlcnRlcgogICAgICAgICAqIChjKSAyMDE2LXByZXNlbnQgSm9zaHVhIENvbWVhdQogICAgICAgICAqCiAgICAgICAgICogQWJzdHJhY3RlZCBhd2F5IGEgYnVuY2ggb2YgdGhlIG1lc3N5IGJ1c2luZXNzIHdpdGggcHJvcHMuCiAgICAgICAgICogICAtIHByb3BzIGZsb3cgdHlwZXMgYW5kIGRlZmF1bHRQcm9wcwogICAgICAgICAqICAgLSBUeXBlIGNvbnZlcnNpb24gKFdlIGFjY2VwdCAnc3RyaW5nJyBhbmQgJ251bWJlcicgdmFsdWVzIGZvciBkdXJhdGlvbiwKICAgICAgICAgKiAgICAgZGVsYXksIGFuZCBvdGhlciBmaWVsZHMsIGJ1dCB3ZSBhY3R1YWxseSBuZWVkIHRoZW0gdG8gYmUgaW50cy4pCiAgICAgICAgICogICAtIENoaWxkcmVuIGNvbnZlcnNpb24gKHdlIG5lZWQgdGhlIGNoaWxkcmVuIHRvIGJlIGFuIGFycmF5LiBNYXkgbm90IGFsd2F5cwogICAgICAgICAqICAgICBiZSwgaWYgYSBzaW5nbGUgY2hpbGQgaXMgcGFzc2VkIGluLikKICAgICAgICAgKiAgIC0gUmVzb2x2aW5nIGFuaW1hdGlvbiBwcmVzZXRzIGludG8gdGhlaXIgYmFzZSBDU1Mgc3R5bGVzCiAgICAgICAgICovCgogICAgICAgIC8qIGVzbGludC1kaXNhYmxlIGJsb2NrLXNjb3BlZC12YXIgKi8KCgogICAgICAgIHZhciBub2RlRW52ID0gdm9pZCAwOwoKICAgICAgICB0cnkgewogICAgICAgICAgbm9kZUVudiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIG5vZGVFbnYgPSAnZGV2ZWxvcG1lbnQnOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcHJvcENvbnZlcnRlcihDb21wb3NlZENvbXBvbmVudCkgewogICAgICAgICAgdmFyIF9jbGFzcywgX3RlbXA7CgogICAgICAgICAgcmV0dXJuIF90ZW1wID0gX2NsYXNzID0gZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICAgICAgICAgICAgX2luaGVyaXRzKEZsaXBNb3ZlUHJvcENvbnZlcnRlciwgX0NvbXBvbmVudCk7CgogICAgICAgICAgICBmdW5jdGlvbiBGbGlwTW92ZVByb3BDb252ZXJ0ZXIoKSB7CiAgICAgICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEZsaXBNb3ZlUHJvcENvbnZlcnRlcik7CgogICAgICAgICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoRmxpcE1vdmVQcm9wQ29udmVydGVyLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoRmxpcE1vdmVQcm9wQ29udmVydGVyKSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jcmVhdGVDbGFzcyhGbGlwTW92ZVByb3BDb252ZXJ0ZXIsIFt7CiAgICAgICAgICAgICAga2V5OiAnY2hlY2tGb3JTdGF0ZWxlc3NGdW5jdGlvbmFsQ29tcG9uZW50cycsCiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXMKICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tGb3JTdGF0ZWxlc3NGdW5jdGlvbmFsQ29tcG9uZW50cyhjaGlsZHJlbikgewogICAgICAgICAgICAgICAgLy8gU2tpcCBhbGwgY29uc29sZSB3YXJuaW5ncyBpbiBwcm9kdWN0aW9uLgogICAgICAgICAgICAgICAgLy8gQmFpbCBlYXJseSwgdG8gYXZvaWQgdW5uZWNlc3Nhcnkgd29yay4KICAgICAgICAgICAgICAgIGlmIChub2RlRW52ID09PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSAvLyBGbGlwTW92ZSBkb2VzIG5vdCBzdXBwb3J0IHN0YXRlbGVzcyBmdW5jdGlvbmFsIGNvbXBvbmVudHMuCiAgICAgICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgYW55IHN1cHBsaWVkIGNvbXBvbmVudHMgd29uJ3Qgd29yay4KICAgICAgICAgICAgICAgIC8vIElmIHRoZSBjaGlsZCBkb2Vzbid0IGhhdmUgYSBrZXksIGl0IG1lYW5zIHdlIGFyZW4ndCBhbmltYXRpbmcgaXQuCiAgICAgICAgICAgICAgICAvLyBJdCdzIGFsbG93ZWQgdG8gYmUgYW4gU0ZDLCBzaW5jZSB3ZSBpZ25vcmUgaXQuCgoKICAgICAgICAgICAgICAgIHZhciBjaGlsZEFycmF5ID0gX3JlYWN0LkNoaWxkcmVuLnRvQXJyYXkoY2hpbGRyZW4pOwoKICAgICAgICAgICAgICAgIHZhciBub1N0YXRlbGVzcyA9IGNoaWxkQXJyYXkuZXZlcnkoZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAhKDAsIF9oZWxwZXJzLmlzRWxlbWVudEFuU0ZDKShjaGlsZCkgfHwgdHlwZW9mIGNoaWxkLmtleSA9PT0gJ3VuZGVmaW5lZCc7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoIW5vU3RhdGVsZXNzKSB7CiAgICAgICAgICAgICAgICAgICgwLCBfZXJyb3JNZXNzYWdlcy5zdGF0ZWxlc3NGdW5jdGlvbmFsQ29tcG9uZW50U3VwcGxpZWQpKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAga2V5OiAnY29udmVydFByb3BzJywKICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY29udmVydFByb3BzKHByb3BzKSB7CiAgICAgICAgICAgICAgICB2YXIgd29ya2luZ1Byb3BzID0gewogICAgICAgICAgICAgICAgICAvLyBleHBsaWNpdGx5IGJ5cGFzcyB0aGUgcHJvcHMgdGhhdCBkb24ndCBuZWVkIGNvbnZlcnNpb24KICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IHByb3BzLmNoaWxkcmVuLAogICAgICAgICAgICAgICAgICBlYXNpbmc6IHByb3BzLmVhc2luZywKICAgICAgICAgICAgICAgICAgb25TdGFydDogcHJvcHMub25TdGFydCwKICAgICAgICAgICAgICAgICAgb25GaW5pc2g6IHByb3BzLm9uRmluaXNoLAogICAgICAgICAgICAgICAgICBvblN0YXJ0QWxsOiBwcm9wcy5vblN0YXJ0QWxsLAogICAgICAgICAgICAgICAgICBvbkZpbmlzaEFsbDogcHJvcHMub25GaW5pc2hBbGwsCiAgICAgICAgICAgICAgICAgIHR5cGVOYW1lOiBwcm9wcy50eXBlTmFtZSwKICAgICAgICAgICAgICAgICAgZGlzYWJsZUFsbEFuaW1hdGlvbnM6IHByb3BzLmRpc2FibGVBbGxBbmltYXRpb25zLAogICAgICAgICAgICAgICAgICBnZXRQb3NpdGlvbjogcHJvcHMuZ2V0UG9zaXRpb24sCiAgICAgICAgICAgICAgICAgIG1haW50YWluQ29udGFpbmVySGVpZ2h0OiBwcm9wcy5tYWludGFpbkNvbnRhaW5lckhlaWdodCwKICAgICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbm1lbnQ6IHByb3BzLnZlcnRpY2FsQWxpZ25tZW50LAogICAgICAgICAgICAgICAgICAvLyBEbyBzdHJpbmctdG8taW50IGNvbnZlcnNpb24gZm9yIGFsbCB0aW1pbmctcmVsYXRlZCBwcm9wcwogICAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5jb252ZXJ0VGltaW5nUHJvcCgnZHVyYXRpb24nKSwKICAgICAgICAgICAgICAgICAgZGVsYXk6IHRoaXMuY29udmVydFRpbWluZ1Byb3AoJ2RlbGF5JyksCiAgICAgICAgICAgICAgICAgIHN0YWdnZXJEdXJhdGlvbkJ5OiB0aGlzLmNvbnZlcnRUaW1pbmdQcm9wKCdzdGFnZ2VyRHVyYXRpb25CeScpLAogICAgICAgICAgICAgICAgICBzdGFnZ2VyRGVsYXlCeTogdGhpcy5jb252ZXJ0VGltaW5nUHJvcCgnc3RhZ2dlckRlbGF5QnknKSwKICAgICAgICAgICAgICAgICAgLy8gT3VyIGVudGVyL2xlYXZlIGFuaW1hdGlvbnMgY2FuIGJlIHNwZWNpZmllZCBhcyBib29sZWFuIChkZWZhdWx0IG9yCiAgICAgICAgICAgICAgICAgIC8vIGRpc2FibGVkKSwgc3RyaW5nIChwcmVzZXQgbmFtZSksIG9yIG9iamVjdCAoYWN0dWFsIGFuaW1hdGlvbiB2YWx1ZXMpLgogICAgICAgICAgICAgICAgICAvLyBMZXQncyBzdGFuZGFyZGl6ZSB0aGlzIHNvIHRoYXQgdGhleSdyZSBhbHdheXMgb2JqZWN0cwogICAgICAgICAgICAgICAgICBhcHBlYXJBbmltYXRpb246IHRoaXMuY29udmVydEFuaW1hdGlvblByb3AocHJvcHMuYXBwZWFyQW5pbWF0aW9uLCBfZW50ZXJMZWF2ZVByZXNldHMuYXBwZWFyUHJlc2V0cyksCiAgICAgICAgICAgICAgICAgIGVudGVyQW5pbWF0aW9uOiB0aGlzLmNvbnZlcnRBbmltYXRpb25Qcm9wKHByb3BzLmVudGVyQW5pbWF0aW9uLCBfZW50ZXJMZWF2ZVByZXNldHMuZW50ZXJQcmVzZXRzKSwKICAgICAgICAgICAgICAgICAgbGVhdmVBbmltYXRpb246IHRoaXMuY29udmVydEFuaW1hdGlvblByb3AocHJvcHMubGVhdmVBbmltYXRpb24sIF9lbnRlckxlYXZlUHJlc2V0cy5sZWF2ZVByZXNldHMpLAogICAgICAgICAgICAgICAgICBkZWxlZ2F0ZWQ6IHt9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdGhpcy5jaGVja0ZvclN0YXRlbGVzc0Z1bmN0aW9uYWxDb21wb25lbnRzKHdvcmtpbmdQcm9wcy5jaGlsZHJlbik7IC8vIEFjY2VwdCBgZGlzYWJsZUFuaW1hdGlvbnNgLCBidXQgYWRkIGEgZGVwcmVjYXRpb24gd2FybmluZwoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcHJvcHMuZGlzYWJsZUFuaW1hdGlvbnMgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgIGlmIChub2RlRW52ICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAoMCwgX2Vycm9yTWVzc2FnZXMuZGVwcmVjYXRlZERpc2FibGVBbmltYXRpb25zKSgpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB3b3JraW5nUHJvcHMuZGlzYWJsZUFsbEFuaW1hdGlvbnMgPSBwcm9wcy5kaXNhYmxlQW5pbWF0aW9uczsKICAgICAgICAgICAgICAgIH0gLy8gR2F0aGVyIGFueSBhZGRpdGlvbmFsIHByb3BzOwogICAgICAgICAgICAgICAgLy8gdGhleSB3aWxsIGJlIGRlbGVnYXRlZCB0byB0aGUgUmVhY3RFbGVtZW50IGNyZWF0ZWQuCgoKICAgICAgICAgICAgICAgIHZhciBwcmltYXJ5UHJvcEtleXMgPSBPYmplY3Qua2V5cyh3b3JraW5nUHJvcHMpOwogICAgICAgICAgICAgICAgdmFyIGRlbGVnYXRlZFByb3BzID0gKDAsIF9oZWxwZXJzLm9taXQpKHRoaXMucHJvcHMsIHByaW1hcnlQcm9wS2V5cyk7IC8vIFRoZSBGbGlwTW92ZSBjb250YWluZXIgZWxlbWVudCBuZWVkcyB0byBoYXZlIGEgbm9uLXN0YXRpYyBwb3NpdGlvbi4KICAgICAgICAgICAgICAgIC8vIFdlIHVzZSBgcmVsYXRpdmVgIGJ5IGRlZmF1bHQsIGJ1dCBpdCBjYW4gYmUgb3ZlcnJpZGRlbiBieSB0aGUgdXNlci4KICAgICAgICAgICAgICAgIC8vIE5vdyB0aGF0IHdlJ3JlIGRlbGVnYXRpbmcgcHJvcHMsIHdlIG5lZWQgdG8gbWVyZ2UgdGhpcyBpbi4KCiAgICAgICAgICAgICAgICBkZWxlZ2F0ZWRQcm9wcy5zdHlsZSA9IF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScKICAgICAgICAgICAgICAgIH0sIGRlbGVnYXRlZFByb3BzLnN0eWxlKTsKICAgICAgICAgICAgICAgIHdvcmtpbmdQcm9wcy5kZWxlZ2F0ZWQgPSBkZWxlZ2F0ZWRQcm9wczsKICAgICAgICAgICAgICAgIHJldHVybiB3b3JraW5nUHJvcHM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAga2V5OiAnY29udmVydFRpbWluZ1Byb3AnLAogICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb252ZXJ0VGltaW5nUHJvcChwcm9wKSB7CiAgICAgICAgICAgICAgICB2YXIgcmF3VmFsdWUgPSB0aGlzLnByb3BzW3Byb3BdOwogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gdHlwZW9mIHJhd1ZhbHVlID09PSAnbnVtYmVyJyA/IHJhd1ZhbHVlIDogcGFyc2VJbnQocmF3VmFsdWUsIDEwKTsKCiAgICAgICAgICAgICAgICBpZiAoaXNOYU4odmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgIHZhciBkZWZhdWx0VmFsdWUgPSBGbGlwTW92ZVByb3BDb252ZXJ0ZXIuZGVmYXVsdFByb3BzW3Byb3BdOwoKICAgICAgICAgICAgICAgICAgaWYgKG5vZGVFbnYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICAgICAgICAgICgwLCBfZXJyb3JNZXNzYWdlcy5pbnZhbGlkVHlwZUZvclRpbWluZ1Byb3ApKHsKICAgICAgICAgICAgICAgICAgICAgIHByb3A6IHByb3AsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcmF3VmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IGRlZmF1bHRWYWx1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgICB9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzCgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAga2V5OiAnY29udmVydEFuaW1hdGlvblByb3AnLAogICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb252ZXJ0QW5pbWF0aW9uUHJvcChhbmltYXRpb24sIHByZXNldHMpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGFuaW1hdGlvbiA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoYW5pbWF0aW9uKSkgewogICAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBpdCdzIHRydWUsIHdlIHdhbnQgdG8gdXNlIHRoZSBkZWZhdWx0IHByZXNldC4KICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGl0J3MgZmFsc2UsIHdlIHdhbnQgdG8gdXNlIHRoZSAnbm9uZScgcHJlc2V0LgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByZXNldHNbYW5pbWF0aW9uID8gX2VudGVyTGVhdmVQcmVzZXRzLmRlZmF1bHRQcmVzZXQgOiBfZW50ZXJMZWF2ZVByZXNldHMuZGlzYWJsZVByZXNldF07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJlc2V0S2V5cyA9IE9iamVjdC5rZXlzKHByZXNldHMpOwoKICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmVzZXRLZXlzLmluZGV4T2YoYW5pbWF0aW9uKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGVFbnYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICgwLCBfZXJyb3JNZXNzYWdlcy5pbnZhbGlkRW50ZXJMZWF2ZVByZXNldCkoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGFuaW1hdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdGFibGVWYWx1ZXM6IHByZXNldEtleXMuam9pbignLCAnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogX2VudGVyTGVhdmVQcmVzZXRzLmRlZmF1bHRQcmVzZXQKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByZXNldHNbX2VudGVyTGVhdmVQcmVzZXRzLmRlZmF1bHRQcmVzZXRdOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmVzZXRzW2FuaW1hdGlvbl07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW5pbWF0aW9uOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBrZXk6ICdyZW5kZXInLAogICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoQ29tcG9zZWRDb21wb25lbnQsIHRoaXMuY29udmVydFByb3BzKHRoaXMucHJvcHMpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dKTsKCiAgICAgICAgICAgIHJldHVybiBGbGlwTW92ZVByb3BDb252ZXJ0ZXI7CiAgICAgICAgICB9KF9yZWFjdC5Db21wb25lbnQpLCBfY2xhc3MuZGVmYXVsdFByb3BzID0gewogICAgICAgICAgICBlYXNpbmc6ICdlYXNlLWluLW91dCcsCiAgICAgICAgICAgIGR1cmF0aW9uOiAzNTAsCiAgICAgICAgICAgIGRlbGF5OiAwLAogICAgICAgICAgICBzdGFnZ2VyRHVyYXRpb25CeTogMCwKICAgICAgICAgICAgc3RhZ2dlckRlbGF5Qnk6IDAsCiAgICAgICAgICAgIHR5cGVOYW1lOiAnZGl2JywKICAgICAgICAgICAgZW50ZXJBbmltYXRpb246IF9lbnRlckxlYXZlUHJlc2V0cy5kZWZhdWx0UHJlc2V0LAogICAgICAgICAgICBsZWF2ZUFuaW1hdGlvbjogX2VudGVyTGVhdmVQcmVzZXRzLmRlZmF1bHRQcmVzZXQsCiAgICAgICAgICAgIGRpc2FibGVBbGxBbmltYXRpb25zOiBmYWxzZSwKICAgICAgICAgICAgZ2V0UG9zaXRpb246IGZ1bmN0aW9uIGdldFBvc2l0aW9uKG5vZGUpIHsKICAgICAgICAgICAgICByZXR1cm4gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbWFpbnRhaW5Db250YWluZXJIZWlnaHQ6IGZhbHNlLAogICAgICAgICAgICB2ZXJ0aWNhbEFsaWdubWVudDogJ3RvcCcKICAgICAgICAgIH0sIF90ZW1wOwogICAgICAgIH0KCiAgICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gcHJvcENvbnZlcnRlcjsKICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKICAgICAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8KICAgICAgfSkuY2FsbChleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpKTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxNDcgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CgogICAgICBmdW5jdGlvbiB3YXJuT25jZShtc2cpIHsKICAgICAgICB2YXIgaGFzV2FybmVkID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICghaGFzV2FybmVkKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2Fybihtc2cpOwogICAgICAgICAgICBoYXNXYXJuZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHZhciBzdGF0ZWxlc3NGdW5jdGlvbmFsQ29tcG9uZW50U3VwcGxpZWQgPSBleHBvcnRzLnN0YXRlbGVzc0Z1bmN0aW9uYWxDb21wb25lbnRTdXBwbGllZCA9IHdhcm5PbmNlKCdcbj4+IEVycm9yLCB2aWEgcmVhY3QtZmxpcC1tb3ZlIDw8XG5cbllvdSBwcm92aWRlZCBhIHN0YXRlbGVzcyBmdW5jdGlvbmFsIGNvbXBvbmVudCBhcyBhIGNoaWxkIHRvIDxGbGlwTW92ZT4uIFVuZm9ydHVuYXRlbHksIFNGQ3MgYXJlblwndCBzdXBwb3J0ZWQsIGJlY2F1c2UgRmxpcCBNb3ZlIG5lZWRzIGFjY2VzcyB0byB0aGUgYmFja2luZyBpbnN0YW5jZXMgdmlhIHJlZnMsIGFuZCBTRkNzIGRvblwndCBoYXZlIGEgcHVibGljIGluc3RhbmNlIHRoYXQgaG9sZHMgdGhhdCBpbmZvLlxuXG5QbGVhc2Ugd3JhcCB5b3VyIGNvbXBvbmVudHMgaW4gYSBuYXRpdmUgZWxlbWVudCAoZWcuIDxkaXY+KSwgb3IgYSBub24tZnVuY3Rpb25hbCBjb21wb25lbnQuXG4nKTsKCiAgICAgIHZhciBpbnZhbGlkVHlwZUZvclRpbWluZ1Byb3AgPSBleHBvcnRzLmludmFsaWRUeXBlRm9yVGltaW5nUHJvcCA9IGZ1bmN0aW9uIGludmFsaWRUeXBlRm9yVGltaW5nUHJvcChhcmdzKSB7CiAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ1xuPj4gRXJyb3IsIHZpYSByZWFjdC1mbGlwLW1vdmUgPDxcblxuVGhlIHByb3AgeW91IHByb3ZpZGVkIGZvciBcJycgKyBhcmdzLnByb3AgKyAnXCcgaXMgaW52YWxpZC4gSXQgbmVlZHMgdG8gYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLCBvciBhIHN0cmluZyB0aGF0IGNhbiBiZSByZXNvbHZlZCB0byBhIG51bWJlci4gVGhlIHZhbHVlIHlvdSBwcm92aWRlZCBpcyBcJycgKyBhcmdzLnZhbHVlICsgJ1wnLlxuXG5BcyBhIHJlc3VsdCwgIHRoZSBkZWZhdWx0IHZhbHVlIGZvciB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHVzZWQsIHdoaWNoIGlzIFwnJyArIGFyZ3MuZGVmYXVsdFZhbHVlICsgJ1wnLlxuJyk7CiAgICAgIH07CgogICAgICB2YXIgZGVwcmVjYXRlZERpc2FibGVBbmltYXRpb25zID0gZXhwb3J0cy5kZXByZWNhdGVkRGlzYWJsZUFuaW1hdGlvbnMgPSB3YXJuT25jZSgnXG4+PiBXYXJuaW5nLCB2aWEgcmVhY3QtZmxpcC1tb3ZlIDw8XG5cblRoZSBcJ2Rpc2FibGVBbmltYXRpb25zXCcgcHJvcCB5b3UgcHJvdmlkZWQgaXMgZGVwcmVjYXRlZC4gUGxlYXNlIHN3aXRjaCB0byB1c2UgXCdkaXNhYmxlQWxsQW5pbWF0aW9uc1wnLlxuXG5UaGlzIHdpbGwgYmVjb21lIGEgc2lsZW50IGVycm9yIGluIGZ1dHVyZSB2ZXJzaW9ucyBvZiByZWFjdC1mbGlwLW1vdmUuXG4nKTsKCiAgICAgIHZhciBpbnZhbGlkRW50ZXJMZWF2ZVByZXNldCA9IGV4cG9ydHMuaW52YWxpZEVudGVyTGVhdmVQcmVzZXQgPSBmdW5jdGlvbiBpbnZhbGlkRW50ZXJMZWF2ZVByZXNldChhcmdzKSB7CiAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ1xuPj4gRXJyb3IsIHZpYSByZWFjdC1mbGlwLW1vdmUgPDxcblxuVGhlIGVudGVyL2xlYXZlIHByZXNldCB5b3UgcHJvdmlkZWQgaXMgaW52YWxpZC4gV2UgZG9uXCd0IGN1cnJlbnRseSBoYXZlIGEgXCcnICsgYXJncy52YWx1ZSArICcgcHJlc2V0LlwnXG5cbkFjY2VwdGFibGUgdmFsdWVzIGFyZSAnICsgYXJncy5hY2NlcHRhYmxlVmFsdWVzICsgJy4gVGhlIGRlZmF1bHQgdmFsdWUgb2YgXCcnICsgYXJncy5kZWZhdWx0VmFsdWUgKyAnXCcgd2lsbCBiZSB1c2VkLlxuJyk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE0OCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgICB2YWx1ZTogdHJ1ZQogICAgICB9KTsKICAgICAgdmFyIGVudGVyUHJlc2V0cyA9IGV4cG9ydHMuZW50ZXJQcmVzZXRzID0gewogICAgICAgIGVsZXZhdG9yOiB7CiAgICAgICAgICBmcm9tOiB7CiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3NjYWxlKDApJywKICAgICAgICAgICAgb3BhY2l0eTogJzAnCiAgICAgICAgICB9LAogICAgICAgICAgdG86IHsKICAgICAgICAgICAgdHJhbnNmb3JtOiAnJywKICAgICAgICAgICAgb3BhY2l0eTogJycKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGZhZGU6IHsKICAgICAgICAgIGZyb206IHsKICAgICAgICAgICAgb3BhY2l0eTogJzAnCiAgICAgICAgICB9LAogICAgICAgICAgdG86IHsKICAgICAgICAgICAgb3BhY2l0eTogJycKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFjY29yZGlvblZlcnRpY2FsOiB7CiAgICAgICAgICBmcm9tOiB7CiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3NjYWxlWSgwKScsCiAgICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogJ2NlbnRlciB0b3AnCiAgICAgICAgICB9LAogICAgICAgICAgdG86IHsKICAgICAgICAgICAgdHJhbnNmb3JtOiAnJywKICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiAnY2VudGVyIHRvcCcKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFjY29yZGlvbkhvcml6b250YWw6IHsKICAgICAgICAgIGZyb206IHsKICAgICAgICAgICAgdHJhbnNmb3JtOiAnc2NhbGVYKDApJywKICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiAnbGVmdCBjZW50ZXInCiAgICAgICAgICB9LAogICAgICAgICAgdG86IHsKICAgICAgICAgICAgdHJhbnNmb3JtOiAnJywKICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiAnbGVmdCBjZW50ZXInCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBub25lOiBudWxsCiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBSZWFjdCBGbGlwIE1vdmUgfCBlbnRlckxlYXZlUHJlc2V0cwogICAgICAgKiAoYykgMjAxNi1wcmVzZW50IEpvc2h1YSBDb21lYXUKICAgICAgICoKICAgICAgICogVGhpcyBjb250YWlucyB0aGUgbWFzdGVyIGxpc3Qgb2YgcHJlc2V0cyBhdmFpbGFibGUgZm9yIGVudGVyL2xlYXZlIGFuaW1hdGlvbnMsCiAgICAgICAqIGFsb25nIHdpdGggdGhlIG1hcHBpbmcgYmV0d2VlbiBwcmVzZXQgYW5kIHN0eWxlcy4KICAgICAgICovCgogICAgICB2YXIgbGVhdmVQcmVzZXRzID0gZXhwb3J0cy5sZWF2ZVByZXNldHMgPSB7CiAgICAgICAgZWxldmF0b3I6IHsKICAgICAgICAgIGZyb206IHsKICAgICAgICAgICAgdHJhbnNmb3JtOiAnc2NhbGUoMSknLAogICAgICAgICAgICBvcGFjaXR5OiAnMScKICAgICAgICAgIH0sCiAgICAgICAgICB0bzogewogICAgICAgICAgICB0cmFuc2Zvcm06ICdzY2FsZSgwKScsCiAgICAgICAgICAgIG9wYWNpdHk6ICcwJwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZmFkZTogewogICAgICAgICAgZnJvbTogewogICAgICAgICAgICBvcGFjaXR5OiAnMScKICAgICAgICAgIH0sCiAgICAgICAgICB0bzogewogICAgICAgICAgICBvcGFjaXR5OiAnMCcKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFjY29yZGlvblZlcnRpY2FsOiB7CiAgICAgICAgICBmcm9tOiB7CiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3NjYWxlWSgxKScsCiAgICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogJ2NlbnRlciB0b3AnCiAgICAgICAgICB9LAogICAgICAgICAgdG86IHsKICAgICAgICAgICAgdHJhbnNmb3JtOiAnc2NhbGVZKDApJywKICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiAnY2VudGVyIHRvcCcKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFjY29yZGlvbkhvcml6b250YWw6IHsKICAgICAgICAgIGZyb206IHsKICAgICAgICAgICAgdHJhbnNmb3JtOiAnc2NhbGVYKDEpJywKICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiAnbGVmdCBjZW50ZXInCiAgICAgICAgICB9LAogICAgICAgICAgdG86IHsKICAgICAgICAgICAgdHJhbnNmb3JtOiAnc2NhbGVYKDApJywKICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiAnbGVmdCBjZW50ZXInCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBub25lOiBudWxsCiAgICAgIH07IC8vIEZvciBub3csIGFwcGVhclByZXNldHMgd2lsbCBiZSBpZGVudGljYWwgdG8gZW50ZXJQcmVzZXRzLgogICAgICAvLyBBc3NpZ25pbmcgYSBjdXN0b20gZXhwb3J0IGluIGNhc2Ugd2UgZXZlciB3YW50IHRvIGFkZCBhcHBlYXItc3BlY2lmaWMgb25lcy4KCiAgICAgIHZhciBhcHBlYXJQcmVzZXRzID0gZXhwb3J0cy5hcHBlYXJQcmVzZXRzID0gZW50ZXJQcmVzZXRzOyAvLyBFbWJhcnJhc3NpbmdseSBlbm91Z2gsIHYyLjAgbGF1bmNoZWQgd2l0aCB0eXBvJ2VkIHByZXNldCBuYW1lcy4KICAgICAgLy8gVG8gYXZvaWQgcGVubmluZyBhIG5ldyBtYWpvciB2ZXJzaW9uIG92ZXIgc29tZXRoaW5nIHNvIGluY29uc2VxdWVudGlhbCwKICAgICAgLy8gd2UncmUgc3VwcG9ydGluZyBib3RoIHNwZWxsaW5ncy4gSW4gYSBmdXR1cmUgdmVyc2lvbiwgdGhlc2UgYWx0ZXJuYXRpdmVzCiAgICAgIC8vIG1heSBiZSBkZXByZWNhdGVkLgogICAgICAvLyAkRmxvd0ZpeE1lCgogICAgICBlbnRlclByZXNldHMuYWNjb3JkaWFuVmVydGljYWwgPSBlbnRlclByZXNldHMuYWNjb3JkaW9uVmVydGljYWw7IC8vICRGbG93Rml4TWUKCiAgICAgIGVudGVyUHJlc2V0cy5hY2NvcmRpYW5Ib3Jpem9udGFsID0gZW50ZXJQcmVzZXRzLmFjY29yZGlvbkhvcml6b250YWw7IC8vICRGbG93Rml4TWUKCiAgICAgIGxlYXZlUHJlc2V0cy5hY2NvcmRpYW5WZXJ0aWNhbCA9IGxlYXZlUHJlc2V0cy5hY2NvcmRpb25WZXJ0aWNhbDsgLy8gJEZsb3dGaXhNZQoKICAgICAgbGVhdmVQcmVzZXRzLmFjY29yZGlhbkhvcml6b250YWwgPSBsZWF2ZVByZXNldHMuYWNjb3JkaW9uSG9yaXpvbnRhbDsKICAgICAgdmFyIGRlZmF1bHRQcmVzZXQgPSBleHBvcnRzLmRlZmF1bHRQcmVzZXQgPSAnZWxldmF0b3InOwogICAgICB2YXIgZGlzYWJsZVByZXNldCA9IGV4cG9ydHMuZGlzYWJsZVByZXNldCA9ICdub25lJzsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxNDkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CiAgICAgIGV4cG9ydHMuY3JlYXRlVHJhbnNpdGlvblN0cmluZyA9IGV4cG9ydHMuZ2V0TmF0aXZlTm9kZSA9IGV4cG9ydHMudXBkYXRlSGVpZ2h0UGxhY2Vob2xkZXIgPSBleHBvcnRzLnJlbW92ZU5vZGVGcm9tRE9NRmxvdyA9IGV4cG9ydHMuZ2V0UG9zaXRpb25EZWx0YSA9IGV4cG9ydHMuZ2V0UmVsYXRpdmVCb3VuZGluZ0JveCA9IHVuZGVmaW5lZDsKCiAgICAgIHZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgewogICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwoKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsKICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsKICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICB9OwogICAgICAvKioKICAgICAgICogUmVhY3QgRmxpcCBNb3ZlCiAgICAgICAqIChjKSAyMDE2LXByZXNlbnQgSm9zaHVhIENvbWVhdQogICAgICAgKgogICAgICAgKiBUaGVzZSBtZXRob2RzIHJlYWQgZnJvbSBhbmQgd3JpdGUgdG8gdGhlIERPTS4KICAgICAgICogVGhleSBhbG1vc3QgYWx3YXlzIGhhdmUgc2lkZSBlZmZlY3RzLCBhbmQgd2lsbCBob3BlZnVsbHkgYmVjb21lIHRoZQogICAgICAgKiBvbmx5IHNwb3QgaW4gdGhlIGNvZGViYXNlIHdpdGggaW1wdXJlIGZ1bmN0aW9ucy4KICAgICAgICovCgoKICAgICAgZXhwb3J0cy5hcHBseVN0eWxlc1RvRE9NTm9kZSA9IGFwcGx5U3R5bGVzVG9ET01Ob2RlOwogICAgICBleHBvcnRzLndoaWNoVHJhbnNpdGlvbkV2ZW50ID0gd2hpY2hUcmFuc2l0aW9uRXZlbnQ7CgogICAgICB2YXIgX3JlYWN0RG9tID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsKCiAgICAgIHZhciBfaGVscGVycyA9IF9fd2VicGFja19yZXF1aXJlX18oNDcpOwoKICAgICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogICAgICAgIGlmIChrZXkgaW4gb2JqKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb2JqW2tleV0gPSB2YWx1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvYmo7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFwcGx5U3R5bGVzVG9ET01Ob2RlKF9yZWYpIHsKICAgICAgICB2YXIgZG9tTm9kZSA9IF9yZWYuZG9tTm9kZSwKICAgICAgICAgICAgc3R5bGVzID0gX3JlZi5zdHlsZXM7IC8vIENhbid0IGp1c3QgZG8gYW4gb2JqZWN0IG1lcmdlIGJlY2F1c2UgZG9tTm9kZS5zdHlsZXMgaXMgbm8gcmVndWxhciBvYmplY3QuCiAgICAgICAgLy8gTmVlZCB0byBkbyBpdCB0aGlzIHdheSBmb3IgdGhlIGVuZ2luZSB0byBmaXJlIGl0cyBgc2V0YCBsaXN0ZW5lcnMuCgogICAgICAgIE9iamVjdC5rZXlzKHN0eWxlcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICBkb21Ob2RlLnN0eWxlLnNldFByb3BlcnR5KCgwLCBfaGVscGVycy5oeXBoZW5hdGUpKGtleSksIHN0eWxlc1trZXldKTsKICAgICAgICB9KTsKICAgICAgfSAvLyBNb2RpZmllZCBmcm9tIE1vZGVybml6cgoKCiAgICAgIGZ1bmN0aW9uIHdoaWNoVHJhbnNpdGlvbkV2ZW50KCkgewogICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IHsKICAgICAgICAgIHRyYW5zaXRpb246ICd0cmFuc2l0aW9uZW5kJywKICAgICAgICAgICctby10cmFuc2l0aW9uJzogJ29UcmFuc2l0aW9uRW5kJywKICAgICAgICAgICctbW96LXRyYW5zaXRpb24nOiAndHJhbnNpdGlvbmVuZCcsCiAgICAgICAgICAnLXdlYmtpdC10cmFuc2l0aW9uJzogJ3dlYmtpdFRyYW5zaXRpb25FbmQnCiAgICAgICAgfTsgLy8gSWYgd2UncmUgcnVubmluZyBpbiBhIGJyb3dzZXJsZXNzIGVudmlyb25tZW50IChlZy4gU1NSKSwgaXQgZG9lc24ndCBhcHBseS4KICAgICAgICAvLyBSZXR1cm4gYSBwbGFjZWhvbGRlciBzdHJpbmcsIGZvciBjb25zaXN0ZW50IHR5cGUgcmV0dXJuLgoKICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykgcmV0dXJuICcnOwogICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zha2VlbGVtZW50Jyk7CiAgICAgICAgdmFyIG1hdGNoID0gT2JqZWN0LmtleXModHJhbnNpdGlvbnMpLmZpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBlbC5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKHQpICE9PSB1bmRlZmluZWQ7CiAgICAgICAgfSk7IC8vIElmIG5vIGB0cmFuc2l0aW9uYCBpcyBmb3VuZCwgd2UgbXVzdCBiZSBydW5uaW5nIGluIGEgYnJvd3NlciBzbyBhbmNpZW50LAogICAgICAgIC8vIFJlYWN0IGl0c2VsZiB3b24ndCBydW4uIFJldHVybiBhbiBlbXB0eSBzdHJpbmcsIGZvciBjb25zaXN0ZW50IHR5cGUgcmV0dXJuCgogICAgICAgIHJldHVybiBtYXRjaCA/IHRyYW5zaXRpb25zW21hdGNoXSA6ICcnOwogICAgICB9CgogICAgICB2YXIgZ2V0UmVsYXRpdmVCb3VuZGluZ0JveCA9IGV4cG9ydHMuZ2V0UmVsYXRpdmVCb3VuZGluZ0JveCA9IGZ1bmN0aW9uIGdldFJlbGF0aXZlQm91bmRpbmdCb3goX3JlZjIpIHsKICAgICAgICB2YXIgY2hpbGREb21Ob2RlID0gX3JlZjIuY2hpbGREb21Ob2RlLAogICAgICAgICAgICBwYXJlbnREb21Ob2RlID0gX3JlZjIucGFyZW50RG9tTm9kZSwKICAgICAgICAgICAgZ2V0UG9zaXRpb24gPSBfcmVmMi5nZXRQb3NpdGlvbjsKICAgICAgICB2YXIgcGFyZW50Qm94ID0gZ2V0UG9zaXRpb24ocGFyZW50RG9tTm9kZSk7CgogICAgICAgIHZhciBfZ2V0UG9zaXRpb24gPSBnZXRQb3NpdGlvbihjaGlsZERvbU5vZGUpLAogICAgICAgICAgICB0b3AgPSBfZ2V0UG9zaXRpb24udG9wLAogICAgICAgICAgICBsZWZ0ID0gX2dldFBvc2l0aW9uLmxlZnQsCiAgICAgICAgICAgIHJpZ2h0ID0gX2dldFBvc2l0aW9uLnJpZ2h0LAogICAgICAgICAgICBib3R0b20gPSBfZ2V0UG9zaXRpb24uYm90dG9tLAogICAgICAgICAgICB3aWR0aCA9IF9nZXRQb3NpdGlvbi53aWR0aCwKICAgICAgICAgICAgaGVpZ2h0ID0gX2dldFBvc2l0aW9uLmhlaWdodDsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRvcDogdG9wIC0gcGFyZW50Qm94LnRvcCwKICAgICAgICAgIGxlZnQ6IGxlZnQgLSBwYXJlbnRCb3gubGVmdCwKICAgICAgICAgIHJpZ2h0OiBwYXJlbnRCb3gucmlnaHQgLSByaWdodCwKICAgICAgICAgIGJvdHRvbTogcGFyZW50Qm94LmJvdHRvbSAtIGJvdHRvbSwKICAgICAgICAgIHdpZHRoOiB3aWR0aCwKICAgICAgICAgIGhlaWdodDogaGVpZ2h0CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgLyoqIGdldFBvc2l0aW9uRGVsdGEKICAgICAgICogVGhpcyBtZXRob2QgcmV0dXJucyB0aGUgZGVsdGEgYmV0d2VlbiB0d28gYm91bmRpbmcgYm94ZXMsIHRvIGZpZ3VyZSBvdXQKICAgICAgICogaG93IG1hbnkgcGl4ZWxzIG9uIGVhY2ggYXhpcyB0aGUgZWxlbWVudCBoYXMgbW92ZWQuCiAgICAgICAqCiAgICAgICAqLwoKCiAgICAgIHZhciBnZXRQb3NpdGlvbkRlbHRhID0gZXhwb3J0cy5nZXRQb3NpdGlvbkRlbHRhID0gZnVuY3Rpb24gZ2V0UG9zaXRpb25EZWx0YShfcmVmMykgewogICAgICAgIHZhciBjaGlsZERvbU5vZGUgPSBfcmVmMy5jaGlsZERvbU5vZGUsCiAgICAgICAgICAgIGNoaWxkQm91bmRpbmdCb3ggPSBfcmVmMy5jaGlsZEJvdW5kaW5nQm94LAogICAgICAgICAgICBwYXJlbnRCb3VuZGluZ0JveCA9IF9yZWYzLnBhcmVudEJvdW5kaW5nQm94LAogICAgICAgICAgICBnZXRQb3NpdGlvbiA9IF9yZWYzLmdldFBvc2l0aW9uOyAvLyBURU1QOiBBIG15c3RlcnkgYnVnIGlzIHNvbWV0aW1lcyBjYXVzaW5nIHVubmVjZXNzYXJ5IGJvdW5kaW5nQm94ZXMgdG8KCiAgICAgICAgdmFyIGRlZmF1bHRCb3ggPSB7CiAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICBsZWZ0OiAwLAogICAgICAgICAgcmlnaHQ6IDAsCiAgICAgICAgICBib3R0b206IDAsCiAgICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgICB3aWR0aDogMAogICAgICAgIH07IC8vIE91ciBvbGQgYm94IGlzIGl0cyBsYXN0IGNhbGN1bGF0ZWQgcG9zaXRpb24sIGRlcml2ZWQgb24gbW91bnQgb3IgYXQgdGhlCiAgICAgICAgLy8gc3RhcnQgb2YgdGhlIHByZXZpb3VzIGFuaW1hdGlvbi4KCiAgICAgICAgdmFyIG9sZFJlbGF0aXZlQm94ID0gY2hpbGRCb3VuZGluZ0JveCB8fCBkZWZhdWx0Qm94OwogICAgICAgIHZhciBwYXJlbnRCb3ggPSBwYXJlbnRCb3VuZGluZ0JveCB8fCBkZWZhdWx0Qm94OyAvLyBPdXIgbmV3IGJveCBpcyB0aGUgbmV3IGZpbmFsIHJlc3RpbmcgcGxhY2U6IFdoZXJlIHdlIGV4cGVjdCBpdCB0byB3aW5kIHVwCiAgICAgICAgLy8gYWZ0ZXIgdGhlIGFuaW1hdGlvbi4gRmlyc3Qgd2UgZ2V0IHRoZSBib3ggaW4gYWJzb2x1dGUgdGVybXMgKEFLQSByZWxhdGl2ZQogICAgICAgIC8vIHRvIHRoZSB2aWV3cG9ydCksIGFuZCB0aGVuIHdlIGNhbGN1bGF0ZSBpdHMgcmVsYXRpdmUgYm94IChyZWxhdGl2ZSB0byB0aGUKICAgICAgICAvLyBwYXJlbnQgY29udGFpbmVyKQoKICAgICAgICB2YXIgbmV3QWJzb2x1dGVCb3ggPSBnZXRQb3NpdGlvbihjaGlsZERvbU5vZGUpOwogICAgICAgIHZhciBuZXdSZWxhdGl2ZUJveCA9IHsKICAgICAgICAgIHRvcDogbmV3QWJzb2x1dGVCb3gudG9wIC0gcGFyZW50Qm94LnRvcCwKICAgICAgICAgIGxlZnQ6IG5ld0Fic29sdXRlQm94LmxlZnQgLSBwYXJlbnRCb3gubGVmdAogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFtvbGRSZWxhdGl2ZUJveC5sZWZ0IC0gbmV3UmVsYXRpdmVCb3gubGVmdCwgb2xkUmVsYXRpdmVCb3gudG9wIC0gbmV3UmVsYXRpdmVCb3gudG9wXTsKICAgICAgfTsKICAgICAgLyoqIHJlbW92ZU5vZGVGcm9tRE9NRmxvdwogICAgICAgKiBUaGlzIG1ldGhvZCBkb2VzIHNvbWV0aGluZyB2ZXJ5IHNuZWFreTogaXQgcmVtb3ZlcyBhIERPTSBub2RlIGZyb20gdGhlCiAgICAgICAqIGRvY3VtZW50IGZsb3csIGJ1dCB3aXRob3V0IGFjdHVhbGx5IGNoYW5naW5nIGl0cyBvbi1zY3JlZW4gcG9zaXRpb24uCiAgICAgICAqCiAgICAgICAqIEl0IHdvcmtzIGJ5IGNhbGN1bGF0aW5nIHdoZXJlIHRoZSBub2RlIGlzLCBhbmQgdGhlbiBhcHBseWluZyBzdHlsZXMKICAgICAgICogc28gdGhhdCBpdCB3aW5kcyB1cCBiZWluZyBwb3NpdGlvbmVkIGFic29sdXRlbHksIGJ1dCBpbiBleGFjdGx5IHRoZQogICAgICAgKiBzYW1lIHBsYWNlLgogICAgICAgKgogICAgICAgKiBUaGlzIGlzIGEgdml0YWwgcGFydCBvZiB0aGUgRkxJUCB0ZWNobmlxdWUuCiAgICAgICAqLwoKCiAgICAgIHZhciByZW1vdmVOb2RlRnJvbURPTUZsb3cgPSBleHBvcnRzLnJlbW92ZU5vZGVGcm9tRE9NRmxvdyA9IGZ1bmN0aW9uIHJlbW92ZU5vZGVGcm9tRE9NRmxvdyhjaGlsZERhdGEsIHZlcnRpY2FsQWxpZ25tZW50KSB7CiAgICAgICAgdmFyIGRvbU5vZGUgPSBjaGlsZERhdGEuZG9tTm9kZSwKICAgICAgICAgICAgYm91bmRpbmdCb3ggPSBjaGlsZERhdGEuYm91bmRpbmdCb3g7CgogICAgICAgIGlmICghZG9tTm9kZSB8fCAhYm91bmRpbmdCb3gpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIEZvciB0aGlzIHRvIHdvcmssIHdlIGhhdmUgdG8gb2Zmc2V0IGFueSBnaXZlbiBgbWFyZ2luYC4KCgogICAgICAgIHZhciBjb21wdXRlZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGRvbU5vZGUpOyAvLyBXZSBuZWVkIHRvIGNsZWFuIHVwIG1hcmdpbnMsIGJ5IGNvbnZlcnRpbmcgYW5kIHJlbW92aW5nIHN1ZmZpeDoKICAgICAgICAvLyBlZy4gJzIxcHgnIC0+IDIxCgogICAgICAgIHZhciBtYXJnaW5BdHRycyA9IFsnbWFyZ2luLXRvcCcsICdtYXJnaW4tbGVmdCcsICdtYXJnaW4tcmlnaHQnXTsKICAgICAgICB2YXIgbWFyZ2lucyA9IG1hcmdpbkF0dHJzLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBtYXJnaW4pIHsKICAgICAgICAgIHZhciBwcm9wZXJ0eVZhbCA9IGNvbXB1dGVkLmdldFByb3BlcnR5VmFsdWUobWFyZ2luKTsKICAgICAgICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgYWNjLCBfZGVmaW5lUHJvcGVydHkoe30sIG1hcmdpbiwgTnVtYmVyKHByb3BlcnR5VmFsLnJlcGxhY2UoJ3B4JywgJycpKSkpOwogICAgICAgIH0sIHt9KTsgLy8gSWYgd2UncmUgYm90dG9tLWFsaWduZWQsIHdlIG5lZWQgdG8gYWRkIHRoZSBoZWlnaHQgb2YgdGhlIGNoaWxkIHRvIGl0cwogICAgICAgIC8vIHRvcCBvZmZzZXQuIFRoaXMgaXMgYmVjYXVzZSwgd2hlbiB0aGUgY29udGFpbmVyIGlzIGJvdHRvbS1hbGlnbmVkLCBpdHMKICAgICAgICAvLyBoZWlnaHQgc2hyaW5rcyBmcm9tIHRoZSB0b3AsIG5vdCB0aGUgYm90dG9tLiBXZSdyZSByZW1vdmluZyB0aGlzIG5vZGUKICAgICAgICAvLyBmcm9tIHRoZSBmbG93LCBzbyB0aGUgdG9wIGlzIGdvaW5nIHRvIGRyb3AgYnkgaXRzIGhlaWdodC4KCiAgICAgICAgdmFyIHRvcE9mZnNldCA9IHZlcnRpY2FsQWxpZ25tZW50ID09PSAnYm90dG9tJyA/IGJvdW5kaW5nQm94LnRvcCAtIGJvdW5kaW5nQm94LmhlaWdodCA6IGJvdW5kaW5nQm94LnRvcDsKICAgICAgICB2YXIgc3R5bGVzID0gewogICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICB0b3A6IHRvcE9mZnNldCAtIG1hcmdpbnNbJ21hcmdpbi10b3AnXSArICdweCcsCiAgICAgICAgICBsZWZ0OiBib3VuZGluZ0JveC5sZWZ0IC0gbWFyZ2luc1snbWFyZ2luLWxlZnQnXSArICdweCcsCiAgICAgICAgICByaWdodDogYm91bmRpbmdCb3gucmlnaHQgLSBtYXJnaW5zWydtYXJnaW4tcmlnaHQnXSArICdweCcKICAgICAgICB9OwogICAgICAgIGFwcGx5U3R5bGVzVG9ET01Ob2RlKHsKICAgICAgICAgIGRvbU5vZGU6IGRvbU5vZGUsCiAgICAgICAgICBzdHlsZXM6IHN0eWxlcwogICAgICAgIH0pOwogICAgICB9OwogICAgICAvKiogdXBkYXRlSGVpZ2h0UGxhY2Vob2xkZXIKICAgICAgICogQW4gb3B0aW9uYWwgcHJvcGVydHkgdG8gRmxpcE1vdmUgaXMgYSBgbWFpbnRhaW5Db250YWluZXJIZWlnaHRgIGJvb2xlYW4uCiAgICAgICAqIFRoaXMgcHJvcGVydHkgY3JlYXRlcyBhIG5vZGUgdGhhdCBmaWxscyBzcGFjZSwgc28gdGhhdCB0aGUgcGFyZW50CiAgICAgICAqIGNvbnRhaW5lciBkb2Vzbid0IGNvbGxhcHNlIHdoZW4gaXRzIGNoaWxkcmVuIGFyZSByZW1vdmVkIGZyb20gdGhlCiAgICAgICAqIGRvY3VtZW50IGZsb3cuCiAgICAgICAqLwoKCiAgICAgIHZhciB1cGRhdGVIZWlnaHRQbGFjZWhvbGRlciA9IGV4cG9ydHMudXBkYXRlSGVpZ2h0UGxhY2Vob2xkZXIgPSBmdW5jdGlvbiB1cGRhdGVIZWlnaHRQbGFjZWhvbGRlcihfcmVmNCkgewogICAgICAgIHZhciBkb21Ob2RlID0gX3JlZjQuZG9tTm9kZSwKICAgICAgICAgICAgcGFyZW50RGF0YSA9IF9yZWY0LnBhcmVudERhdGEsCiAgICAgICAgICAgIGdldFBvc2l0aW9uID0gX3JlZjQuZ2V0UG9zaXRpb247CiAgICAgICAgdmFyIHBhcmVudERvbU5vZGUgPSBwYXJlbnREYXRhLmRvbU5vZGU7CiAgICAgICAgdmFyIHBhcmVudEJvdW5kaW5nQm94ID0gcGFyZW50RGF0YS5ib3VuZGluZ0JveDsKCiAgICAgICAgaWYgKCFwYXJlbnREb21Ob2RlIHx8ICFwYXJlbnRCb3VuZGluZ0JveCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gV2UgbmVlZCB0byBmaW5kIHRoZSBoZWlnaHQgb2YgdGhlIGNvbnRhaW5lciAqd2l0aG91dCogdGhlIHBsYWNlaG9sZGVyLgogICAgICAgIC8vIFNpbmNlIGl0J3MgcG9zc2libGUgdGhhdCB0aGUgcGxhY2Vob2xkZXIgbWlnaHQgYWxyZWFkeSBiZSBwcmVzZW50LAogICAgICAgIC8vIHdlIGZpcnN0IHNldCBpdHMgaGVpZ2h0IHRvIDAuCiAgICAgICAgLy8gVGhpcyBhbGxvd3MgdGhlIGNvbnRhaW5lciB0byBjb2xsYXBzZSBkb3duIHRvIHRoZSBzaXplIG9mIGp1c3QgaXRzCiAgICAgICAgLy8gY29udGVudCAocGx1cyBjb250YWluZXIgcGFkZGluZyBvciBib3JkZXJzIGlmIGFueSkuCgoKICAgICAgICBhcHBseVN0eWxlc1RvRE9NTm9kZSh7CiAgICAgICAgICBkb21Ob2RlOiBkb21Ob2RlLAogICAgICAgICAgc3R5bGVzOiB7CiAgICAgICAgICAgIGhlaWdodDogJzAnCiAgICAgICAgICB9CiAgICAgICAgfSk7IC8vIEZpbmQgdGhlIGRpc3RhbmNlIGJ5IHdoaWNoIHRoZSBjb250YWluZXIgd291bGQgYmUgY29sbGFwc2VkIGJ5IGVsZW1lbnRzCiAgICAgICAgLy8gbGVhdmluZy4gV2UgY29tcGFyZSB0aGUgZnJlc2hseS1hdmFpbGFibGUgcGFyZW50IGhlaWdodCB3aXRoIHRoZSBvcmlnaW5hbCwKICAgICAgICAvLyBjYWNoZWQgY29udGFpbmVyIGhlaWdodC4KCiAgICAgICAgdmFyIG9yaWdpbmFsUGFyZW50SGVpZ2h0ID0gcGFyZW50Qm91bmRpbmdCb3guaGVpZ2h0OwogICAgICAgIHZhciBjb2xsYXBzZWRQYXJlbnRIZWlnaHQgPSBnZXRQb3NpdGlvbihwYXJlbnREb21Ob2RlKS5oZWlnaHQ7CiAgICAgICAgdmFyIHJlZHVjdGlvbkluSGVpZ2h0ID0gb3JpZ2luYWxQYXJlbnRIZWlnaHQgLSBjb2xsYXBzZWRQYXJlbnRIZWlnaHQ7IC8vIElmIHRoZSBjb250YWluZXIgaGFzIGJlY29tZSBzaG9ydGVyLCB1cGRhdGUgdGhlIHBhZGRpbmcgZWxlbWVudCdzCiAgICAgICAgLy8gaGVpZ2h0IHRvIHRha2UgdXAgdGhlIGRpZmZlcmVuY2UuIE90aGVyd2lzZSBzZXQgaXRzIGhlaWdodCB0byB6ZXJvLAogICAgICAgIC8vIHNvIHRoYXQgaXQgaGFzIG5vIGVmZmVjdC4KCiAgICAgICAgdmFyIHN0eWxlcyA9IHsKICAgICAgICAgIGhlaWdodDogcmVkdWN0aW9uSW5IZWlnaHQgPiAwID8gcmVkdWN0aW9uSW5IZWlnaHQgKyAncHgnIDogJzAnCiAgICAgICAgfTsKICAgICAgICBhcHBseVN0eWxlc1RvRE9NTm9kZSh7CiAgICAgICAgICBkb21Ob2RlOiBkb21Ob2RlLAogICAgICAgICAgc3R5bGVzOiBzdHlsZXMKICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIHZhciBnZXROYXRpdmVOb2RlID0gZXhwb3J0cy5nZXROYXRpdmVOb2RlID0gZnVuY3Rpb24gZ2V0TmF0aXZlTm9kZShlbGVtZW50KSB7CiAgICAgICAgLy8gV2hlbiBydW5uaW5nIGluIGEgd2luZG93bGVzcyBlbnZpcm9ubWVudCwgYWJvcnQhCiAgICAgICAgaWYgKHR5cGVvZiBIVE1MRWxlbWVudCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0gLy8gYGVsZW1lbnRgIG1heSBhbHJlYWR5IGJlIGEgbmF0aXZlIG5vZGUuCgoKICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7CiAgICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgICB9IC8vIFdoaWxlIFJlYWN0RE9NJ3MgYGZpbmRET01Ob2RlYCBpcyBkaXNjb3VyYWdlZCwgaXQncyB0aGUgb25seQogICAgICAgIC8vIHB1YmxpY2x5LWV4cG9zZWQgd2F5IHRvIGZpbmQgdGhlIHVuZGVybHlpbmcgRE9NIG5vZGUgZm9yCiAgICAgICAgLy8gY29tcG9zaXRlIGNvbXBvbmVudHMuCgoKICAgICAgICB2YXIgZm91bmROb2RlID0gKDAsIF9yZWFjdERvbS5maW5kRE9NTm9kZSkoZWxlbWVudCk7CgogICAgICAgIGlmICghKGZvdW5kTm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkgewogICAgICAgICAgLy8gVGV4dCBub2RlcyBhcmUgbm90IHN1cHBvcnRlZAogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZm91bmROb2RlOwogICAgICB9OwoKICAgICAgdmFyIGNyZWF0ZVRyYW5zaXRpb25TdHJpbmcgPSBleHBvcnRzLmNyZWF0ZVRyYW5zaXRpb25TdHJpbmcgPSBmdW5jdGlvbiBjcmVhdGVUcmFuc2l0aW9uU3RyaW5nKGluZGV4LCBwcm9wcykgewogICAgICAgIHZhciBkZWxheSA9IHByb3BzLmRlbGF5LAogICAgICAgICAgICBkdXJhdGlvbiA9IHByb3BzLmR1cmF0aW9uOwogICAgICAgIHZhciBzdGFnZ2VyRHVyYXRpb25CeSA9IHByb3BzLnN0YWdnZXJEdXJhdGlvbkJ5LAogICAgICAgICAgICBzdGFnZ2VyRGVsYXlCeSA9IHByb3BzLnN0YWdnZXJEZWxheUJ5LAogICAgICAgICAgICBlYXNpbmcgPSBwcm9wcy5lYXNpbmc7CiAgICAgICAgZGVsYXkgKz0gaW5kZXggKiBzdGFnZ2VyRGVsYXlCeTsKICAgICAgICBkdXJhdGlvbiArPSBpbmRleCAqIHN0YWdnZXJEdXJhdGlvbkJ5OwogICAgICAgIHZhciBjc3NQcm9wZXJ0aWVzID0gWyd0cmFuc2Zvcm0nLCAnb3BhY2l0eSddOwogICAgICAgIHJldHVybiBjc3NQcm9wZXJ0aWVzLm1hcChmdW5jdGlvbiAocHJvcCkgewogICAgICAgICAgcmV0dXJuIHByb3AgKyAnICcgKyBkdXJhdGlvbiArICdtcyAnICsgZWFzaW5nICsgJyAnICsgZGVsYXkgKyAnbXMnOwogICAgICAgIH0pLmpvaW4oJywgJyk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE1MCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18sIF9fV0VCUEFDS19BTURfREVGSU5FX0FSUkFZX18sIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fOwogICAgICAvKiEKICAgICAgQXV0b3NpemUgMy4wLjIxCiAgICAgIGxpY2Vuc2U6IE1JVAogICAgICBodHRwOi8vd3d3LmphY2tsbW9vcmUuY29tL2F1dG9zaXplCiAgICAgICovCgoKICAgICAgKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKICAgICAgICBpZiAodHJ1ZSkgewogICAgICAgICAgIShfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fID0gW2V4cG9ydHMsIG1vZHVsZV0sIF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXyA9IGZhY3RvcnksIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fID0gdHlwZW9mIF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXyA9PT0gJ2Z1bmN0aW9uJyA/IF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXy5hcHBseShleHBvcnRzLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fKSA6IF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXywgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gIT09IHVuZGVmaW5lZCAmJiAobW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXykpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICBmYWN0b3J5KGV4cG9ydHMsIG1vZHVsZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBtb2QgPSB7CiAgICAgICAgICAgIGV4cG9ydHM6IHt9CiAgICAgICAgICB9OwogICAgICAgICAgZmFjdG9yeShtb2QuZXhwb3J0cywgbW9kKTsKICAgICAgICAgIGdsb2JhbC5hdXRvc2l6ZSA9IG1vZC5leHBvcnRzOwogICAgICAgIH0KICAgICAgfSkodGhpcywgZnVuY3Rpb24gKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICAgICd1c2Ugc3RyaWN0JzsKCiAgICAgICAgdmFyIG1hcCA9IHR5cGVvZiBNYXAgPT09ICJmdW5jdGlvbiIgPyBuZXcgTWFwKCkgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIga2V5cyA9IFtdOwogICAgICAgICAgdmFyIHZhbHVlcyA9IFtdOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaGFzOiBmdW5jdGlvbiBoYXMoa2V5KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGtleXMuaW5kZXhPZihrZXkpID4gLTE7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KGtleSkgewogICAgICAgICAgICAgIHJldHVybiB2YWx1ZXNba2V5cy5pbmRleE9mKGtleSldOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgaWYgKGtleXMuaW5kZXhPZihrZXkpID09PSAtMSkgewogICAgICAgICAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAnZGVsZXRlJzogZnVuY3Rpb24gX2RlbGV0ZShrZXkpIHsKICAgICAgICAgICAgICB2YXIgaW5kZXggPSBrZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgICAgICAgIGtleXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgICAgIHZhbHVlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9KCk7CgogICAgICAgIHZhciBjcmVhdGVFdmVudCA9IGZ1bmN0aW9uIGNyZWF0ZUV2ZW50KG5hbWUpIHsKICAgICAgICAgIHJldHVybiBuZXcgRXZlbnQobmFtZSwgewogICAgICAgICAgICBidWJibGVzOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9OwoKICAgICAgICB0cnkgewogICAgICAgICAgbmV3IEV2ZW50KCd0ZXN0Jyk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgLy8gSUUgZG9lcyBub3Qgc3VwcG9ydCBgbmV3IEV2ZW50KClgCiAgICAgICAgICBjcmVhdGVFdmVudCA9IGZ1bmN0aW9uIGNyZWF0ZUV2ZW50KG5hbWUpIHsKICAgICAgICAgICAgdmFyIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudCcpOwogICAgICAgICAgICBldnQuaW5pdEV2ZW50KG5hbWUsIHRydWUsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIGV2dDsKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhc3NpZ24odGEpIHsKICAgICAgICAgIGlmICghdGEgfHwgIXRhLm5vZGVOYW1lIHx8IHRhLm5vZGVOYW1lICE9PSAnVEVYVEFSRUEnIHx8IG1hcC5oYXModGEpKSByZXR1cm47CiAgICAgICAgICB2YXIgaGVpZ2h0T2Zmc2V0ID0gbnVsbDsKICAgICAgICAgIHZhciBjbGllbnRXaWR0aCA9IHRhLmNsaWVudFdpZHRoOwogICAgICAgICAgdmFyIGNhY2hlZEhlaWdodCA9IG51bGw7CgogICAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdmFyIHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGEsIG51bGwpOwoKICAgICAgICAgICAgaWYgKHN0eWxlLnJlc2l6ZSA9PT0gJ3ZlcnRpY2FsJykgewogICAgICAgICAgICAgIHRhLnN0eWxlLnJlc2l6ZSA9ICdub25lJzsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdHlsZS5yZXNpemUgPT09ICdib3RoJykgewogICAgICAgICAgICAgIHRhLnN0eWxlLnJlc2l6ZSA9ICdob3Jpem9udGFsJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHN0eWxlLmJveFNpemluZyA9PT0gJ2NvbnRlbnQtYm94JykgewogICAgICAgICAgICAgIGhlaWdodE9mZnNldCA9IC0ocGFyc2VGbG9hdChzdHlsZS5wYWRkaW5nVG9wKSArIHBhcnNlRmxvYXQoc3R5bGUucGFkZGluZ0JvdHRvbSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGhlaWdodE9mZnNldCA9IHBhcnNlRmxvYXQoc3R5bGUuYm9yZGVyVG9wV2lkdGgpICsgcGFyc2VGbG9hdChzdHlsZS5ib3JkZXJCb3R0b21XaWR0aCk7CiAgICAgICAgICAgIH0gLy8gRml4IHdoZW4gYSB0ZXh0YXJlYSBpcyBub3Qgb24gZG9jdW1lbnQgYm9keSBhbmQgaGVpZ2h0T2Zmc2V0IGlzIE5vdCBhIE51bWJlcgoKCiAgICAgICAgICAgIGlmIChpc05hTihoZWlnaHRPZmZzZXQpKSB7CiAgICAgICAgICAgICAgaGVpZ2h0T2Zmc2V0ID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdXBkYXRlKCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY2hhbmdlT3ZlcmZsb3codmFsdWUpIHsKICAgICAgICAgICAgewogICAgICAgICAgICAgIC8vIENocm9tZS9TYWZhcmktc3BlY2lmaWMgZml4OgogICAgICAgICAgICAgIC8vIFdoZW4gdGhlIHRleHRhcmVhIHktb3ZlcmZsb3cgaXMgaGlkZGVuLCBDaHJvbWUvU2FmYXJpIGRvIG5vdCByZWZsb3cgdGhlIHRleHQgdG8gYWNjb3VudCBmb3IgdGhlIHNwYWNlCiAgICAgICAgICAgICAgLy8gbWFkZSBhdmFpbGFibGUgYnkgcmVtb3ZpbmcgdGhlIHNjcm9sbGJhci4gVGhlIGZvbGxvd2luZyBmb3JjZXMgdGhlIG5lY2Vzc2FyeSB0ZXh0IHJlZmxvdy4KICAgICAgICAgICAgICB2YXIgd2lkdGggPSB0YS5zdHlsZS53aWR0aDsKICAgICAgICAgICAgICB0YS5zdHlsZS53aWR0aCA9ICcwcHgnOyAvLyBGb3JjZSByZWZsb3c6CgogICAgICAgICAgICAgIC8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi8KCiAgICAgICAgICAgICAgdGEub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgICAgLyoganNoaW50IGlnbm9yZTplbmQgKi8KCiAgICAgICAgICAgICAgdGEuc3R5bGUud2lkdGggPSB3aWR0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0YS5zdHlsZS5vdmVyZmxvd1kgPSB2YWx1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRQYXJlbnRPdmVyZmxvd3MoZWwpIHsKICAgICAgICAgICAgdmFyIGFyciA9IFtdOwoKICAgICAgICAgICAgd2hpbGUgKGVsICYmIGVsLnBhcmVudE5vZGUgJiYgZWwucGFyZW50Tm9kZSBpbnN0YW5jZW9mIEVsZW1lbnQpIHsKICAgICAgICAgICAgICBpZiAoZWwucGFyZW50Tm9kZS5zY3JvbGxUb3ApIHsKICAgICAgICAgICAgICAgIGFyci5wdXNoKHsKICAgICAgICAgICAgICAgICAgbm9kZTogZWwucGFyZW50Tm9kZSwKICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiBlbC5wYXJlbnROb2RlLnNjcm9sbFRvcAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBlbCA9IGVsLnBhcmVudE5vZGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBhcnI7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmVzaXplKCkgewogICAgICAgICAgICB2YXIgb3JpZ2luYWxIZWlnaHQgPSB0YS5zdHlsZS5oZWlnaHQ7CiAgICAgICAgICAgIHZhciBvdmVyZmxvd3MgPSBnZXRQYXJlbnRPdmVyZmxvd3ModGEpOwogICAgICAgICAgICB2YXIgZG9jVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7IC8vIE5lZWRlZCBmb3IgTW9iaWxlIElFICh0aWNrZXQgIzI0MCkKCiAgICAgICAgICAgIHRhLnN0eWxlLmhlaWdodCA9ICdhdXRvJzsKICAgICAgICAgICAgdmFyIGVuZEhlaWdodCA9IHRhLnNjcm9sbEhlaWdodCArIGhlaWdodE9mZnNldDsKCiAgICAgICAgICAgIGlmICh0YS5zY3JvbGxIZWlnaHQgPT09IDApIHsKICAgICAgICAgICAgICAvLyBJZiB0aGUgc2Nyb2xsSGVpZ2h0IGlzIDAsIHRoZW4gdGhlIGVsZW1lbnQgcHJvYmFibHkgaGFzIGRpc3BsYXk6bm9uZSBvciBpcyBkZXRhY2hlZCBmcm9tIHRoZSBET00uCiAgICAgICAgICAgICAgdGEuc3R5bGUuaGVpZ2h0ID0gb3JpZ2luYWxIZWlnaHQ7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0YS5zdHlsZS5oZWlnaHQgPSBlbmRIZWlnaHQgKyAncHgnOyAvLyB1c2VkIHRvIGNoZWNrIGlmIGFuIHVwZGF0ZSBpcyBhY3R1YWxseSBuZWNlc3Nhcnkgb24gd2luZG93LnJlc2l6ZQoKICAgICAgICAgICAgY2xpZW50V2lkdGggPSB0YS5jbGllbnRXaWR0aDsgLy8gcHJldmVudHMgc2Nyb2xsLXBvc2l0aW9uIGp1bXBpbmcKCiAgICAgICAgICAgIG92ZXJmbG93cy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICAgIGVsLm5vZGUuc2Nyb2xsVG9wID0gZWwuc2Nyb2xsVG9wOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChkb2NUb3ApIHsKICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gZG9jVG9wOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlKCkgewogICAgICAgICAgICByZXNpemUoKTsKICAgICAgICAgICAgdmFyIHN0eWxlSGVpZ2h0ID0gTWF0aC5yb3VuZChwYXJzZUZsb2F0KHRhLnN0eWxlLmhlaWdodCkpOwogICAgICAgICAgICB2YXIgY29tcHV0ZWQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0YSwgbnVsbCk7IC8vIFVzaW5nIG9mZnNldEhlaWdodCBhcyBhIHJlcGxhY2VtZW50IGZvciBjb21wdXRlZC5oZWlnaHQgaW4gSUUsIGJlY2F1c2UgSUUgZG9lcyBub3QgYWNjb3VudCB1c2Ugb2YgYm9yZGVyLWJveAoKICAgICAgICAgICAgdmFyIGFjdHVhbEhlaWdodCA9IGNvbXB1dGVkLmJveFNpemluZyA9PT0gJ2NvbnRlbnQtYm94JyA/IE1hdGgucm91bmQocGFyc2VGbG9hdChjb21wdXRlZC5oZWlnaHQpKSA6IHRhLm9mZnNldEhlaWdodDsgLy8gVGhlIGFjdHVhbCBoZWlnaHQgbm90IG1hdGNoaW5nIHRoZSBzdHlsZSBoZWlnaHQgKHNldCB2aWEgdGhlIHJlc2l6ZSBtZXRob2QpIGluZGljYXRlcyB0aGF0CiAgICAgICAgICAgIC8vIHRoZSBtYXgtaGVpZ2h0IGhhcyBiZWVuIGV4Y2VlZGVkLCBpbiB3aGljaCBjYXNlIHRoZSBvdmVyZmxvdyBzaG91bGQgYmUgYWxsb3dlZC4KCiAgICAgICAgICAgIGlmIChhY3R1YWxIZWlnaHQgIT09IHN0eWxlSGVpZ2h0KSB7CiAgICAgICAgICAgICAgaWYgKGNvbXB1dGVkLm92ZXJmbG93WSA9PT0gJ2hpZGRlbicpIHsKICAgICAgICAgICAgICAgIGNoYW5nZU92ZXJmbG93KCdzY3JvbGwnKTsKICAgICAgICAgICAgICAgIHJlc2l6ZSgpOwogICAgICAgICAgICAgICAgYWN0dWFsSGVpZ2h0ID0gY29tcHV0ZWQuYm94U2l6aW5nID09PSAnY29udGVudC1ib3gnID8gTWF0aC5yb3VuZChwYXJzZUZsb2F0KHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRhLCBudWxsKS5oZWlnaHQpKSA6IHRhLm9mZnNldEhlaWdodDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gTm9ybWFsbHkga2VlcCBvdmVyZmxvdyBzZXQgdG8gaGlkZGVuLCB0byBhdm9pZCBmbGFzaCBvZiBzY3JvbGxiYXIgYXMgdGhlIHRleHRhcmVhIGV4cGFuZHMuCiAgICAgICAgICAgICAgaWYgKGNvbXB1dGVkLm92ZXJmbG93WSAhPT0gJ2hpZGRlbicpIHsKICAgICAgICAgICAgICAgIGNoYW5nZU92ZXJmbG93KCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHJlc2l6ZSgpOwogICAgICAgICAgICAgICAgYWN0dWFsSGVpZ2h0ID0gY29tcHV0ZWQuYm94U2l6aW5nID09PSAnY29udGVudC1ib3gnID8gTWF0aC5yb3VuZChwYXJzZUZsb2F0KHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRhLCBudWxsKS5oZWlnaHQpKSA6IHRhLm9mZnNldEhlaWdodDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjYWNoZWRIZWlnaHQgIT09IGFjdHVhbEhlaWdodCkgewogICAgICAgICAgICAgIGNhY2hlZEhlaWdodCA9IGFjdHVhbEhlaWdodDsKICAgICAgICAgICAgICB2YXIgZXZ0ID0gY3JlYXRlRXZlbnQoJ2F1dG9zaXplOnJlc2l6ZWQnKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHRhLmRpc3BhdGNoRXZlbnQoZXZ0KTsKICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsvLyBGaXJlZm94IHdpbGwgdGhyb3cgYW4gZXJyb3Igb24gZGlzcGF0Y2hFdmVudCBmb3IgYSBkZXRhY2hlZCBlbGVtZW50CiAgICAgICAgICAgICAgICAvLyBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD04ODkzNzYKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcGFnZVJlc2l6ZSA9IGZ1bmN0aW9uIHBhZ2VSZXNpemUoKSB7CiAgICAgICAgICAgIGlmICh0YS5jbGllbnRXaWR0aCAhPT0gY2xpZW50V2lkdGgpIHsKICAgICAgICAgICAgICB1cGRhdGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICB2YXIgZGVzdHJveSA9IGZ1bmN0aW9uIChzdHlsZSkgewogICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgcGFnZVJlc2l6ZSwgZmFsc2UpOwogICAgICAgICAgICB0YS5yZW1vdmVFdmVudExpc3RlbmVyKCdpbnB1dCcsIHVwZGF0ZSwgZmFsc2UpOwogICAgICAgICAgICB0YS5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXl1cCcsIHVwZGF0ZSwgZmFsc2UpOwogICAgICAgICAgICB0YS5yZW1vdmVFdmVudExpc3RlbmVyKCdhdXRvc2l6ZTpkZXN0cm95JywgZGVzdHJveSwgZmFsc2UpOwogICAgICAgICAgICB0YS5yZW1vdmVFdmVudExpc3RlbmVyKCdhdXRvc2l6ZTp1cGRhdGUnLCB1cGRhdGUsIGZhbHNlKTsKICAgICAgICAgICAgT2JqZWN0LmtleXMoc3R5bGUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICAgIHRhLnN0eWxlW2tleV0gPSBzdHlsZVtrZXldOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbWFwWydkZWxldGUnXSh0YSk7CiAgICAgICAgICB9LmJpbmQodGEsIHsKICAgICAgICAgICAgaGVpZ2h0OiB0YS5zdHlsZS5oZWlnaHQsCiAgICAgICAgICAgIHJlc2l6ZTogdGEuc3R5bGUucmVzaXplLAogICAgICAgICAgICBvdmVyZmxvd1k6IHRhLnN0eWxlLm92ZXJmbG93WSwKICAgICAgICAgICAgb3ZlcmZsb3dYOiB0YS5zdHlsZS5vdmVyZmxvd1gsCiAgICAgICAgICAgIHdvcmRXcmFwOiB0YS5zdHlsZS53b3JkV3JhcAogICAgICAgICAgfSk7CgogICAgICAgICAgdGEuYWRkRXZlbnRMaXN0ZW5lcignYXV0b3NpemU6ZGVzdHJveScsIGRlc3Ryb3ksIGZhbHNlKTsgLy8gSUU5IGRvZXMgbm90IGZpcmUgb25wcm9wZXJ0eWNoYW5nZSBvciBvbmlucHV0IGZvciBkZWxldGlvbnMsCiAgICAgICAgICAvLyBzbyBiaW5kaW5nIHRvIG9ua2V5dXAgdG8gY2F0Y2ggbW9zdCBvZiB0aG9zZSBldmVudHMuCiAgICAgICAgICAvLyBUaGVyZSBpcyBubyB3YXkgdGhhdCBJIGtub3cgb2YgdG8gZGV0ZWN0IHNvbWV0aGluZyBsaWtlICdjdXQnIGluIElFOS4KCiAgICAgICAgICBpZiAoJ29ucHJvcGVydHljaGFuZ2UnIGluIHRhICYmICdvbmlucHV0JyBpbiB0YSkgewogICAgICAgICAgICB0YS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHVwZGF0ZSwgZmFsc2UpOwogICAgICAgICAgfQoKICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBwYWdlUmVzaXplLCBmYWxzZSk7CiAgICAgICAgICB0YS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHVwZGF0ZSwgZmFsc2UpOwogICAgICAgICAgdGEuYWRkRXZlbnRMaXN0ZW5lcignYXV0b3NpemU6dXBkYXRlJywgdXBkYXRlLCBmYWxzZSk7CiAgICAgICAgICB0YS5zdHlsZS5vdmVyZmxvd1ggPSAnaGlkZGVuJzsKICAgICAgICAgIHRhLnN0eWxlLndvcmRXcmFwID0gJ2JyZWFrLXdvcmQnOwogICAgICAgICAgbWFwLnNldCh0YSwgewogICAgICAgICAgICBkZXN0cm95OiBkZXN0cm95LAogICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZQogICAgICAgICAgfSk7CiAgICAgICAgICBpbml0KCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkZXN0cm95KHRhKSB7CiAgICAgICAgICB2YXIgbWV0aG9kcyA9IG1hcC5nZXQodGEpOwoKICAgICAgICAgIGlmIChtZXRob2RzKSB7CiAgICAgICAgICAgIG1ldGhvZHMuZGVzdHJveSgpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKHRhKSB7CiAgICAgICAgICB2YXIgbWV0aG9kcyA9IG1hcC5nZXQodGEpOwoKICAgICAgICAgIGlmIChtZXRob2RzKSB7CiAgICAgICAgICAgIG1ldGhvZHMudXBkYXRlKCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgYXV0b3NpemUgPSBudWxsOyAvLyBEbyBub3RoaW5nIGluIE5vZGUuanMgZW52aXJvbm1lbnQgYW5kIElFOCAob3IgbG93ZXIpCgogICAgICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2Ygd2luZG93LmdldENvbXB1dGVkU3R5bGUgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIGF1dG9zaXplID0gZnVuY3Rpb24gYXV0b3NpemUoZWwpIHsKICAgICAgICAgICAgcmV0dXJuIGVsOwogICAgICAgICAgfTsKCiAgICAgICAgICBhdXRvc2l6ZS5kZXN0cm95ID0gZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgIHJldHVybiBlbDsKICAgICAgICAgIH07CgogICAgICAgICAgYXV0b3NpemUudXBkYXRlID0gZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgIHJldHVybiBlbDsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGF1dG9zaXplID0gZnVuY3Rpb24gYXV0b3NpemUoZWwsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKGVsKSB7CiAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChlbC5sZW5ndGggPyBlbCA6IFtlbF0sIGZ1bmN0aW9uICh4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYXNzaWduKHgsIG9wdGlvbnMpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZWw7CiAgICAgICAgICB9OwoKICAgICAgICAgIGF1dG9zaXplLmRlc3Ryb3kgPSBmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgaWYgKGVsKSB7CiAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChlbC5sZW5ndGggPyBlbCA6IFtlbF0sIGRlc3Ryb3kpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZWw7CiAgICAgICAgICB9OwoKICAgICAgICAgIGF1dG9zaXplLnVwZGF0ZSA9IGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICBpZiAoZWwpIHsKICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGVsLmxlbmd0aCA/IGVsIDogW2VsXSwgdXBkYXRlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGVsOwogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIG1vZHVsZS5leHBvcnRzID0gYXV0b3NpemU7CiAgICAgIH0pOwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxNTEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CgogICAgICBleHBvcnRzWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAobGFuZ3VhZ2UpIHsKICAgICAgICByZXR1cm4gbmV3IF9wb2x5Z2xvdDJbImRlZmF1bHQiXSh7CiAgICAgICAgICBwaHJhc2VzOiBpMThuTWFwW2xhbmd1YWdlXSB8fCBpMThuTWFwLmVuLAogICAgICAgICAgbG9jYWxlOiBsYW5ndWFnZQogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgdmFyIF9wb2x5Z2xvdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTUyKTsKCiAgICAgIHZhciBfcG9seWdsb3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcG9seWdsb3QpOwoKICAgICAgdmFyIF96aENOID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNTMpOwoKICAgICAgdmFyIF96aENOMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3poQ04pOwoKICAgICAgdmFyIF96aFRXID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNTQpOwoKICAgICAgdmFyIF96aFRXMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3poVFcpOwoKICAgICAgdmFyIF9lbiA9IF9fd2VicGFja19yZXF1aXJlX18oMTU1KTsKCiAgICAgIHZhciBfZW4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZW4pOwoKICAgICAgdmFyIF9lc0VTID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNTYpOwoKICAgICAgdmFyIF9lc0VTMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2VzRVMpOwoKICAgICAgdmFyIF9mciA9IF9fd2VicGFja19yZXF1aXJlX18oMTU3KTsKCiAgICAgIHZhciBfZnIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZnIpOwoKICAgICAgdmFyIF9ydSA9IF9fd2VicGFja19yZXF1aXJlX18oMTU4KTsKCiAgICAgIHZhciBfcnUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcnUpOwoKICAgICAgdmFyIF9kZSA9IF9fd2VicGFja19yZXF1aXJlX18oMTU5KTsKCiAgICAgIHZhciBfZGUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZGUpOwoKICAgICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICAgICAgICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgICAgICAgImRlZmF1bHQiOiBvYmoKICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgaTE4bk1hcCA9IHsKICAgICAgICAnemgnOiBfemhDTjJbImRlZmF1bHQiXSwKICAgICAgICAnemgtQ04nOiBfemhDTjJbImRlZmF1bHQiXSwKICAgICAgICAnemgtVFcnOiBfemhUVzJbImRlZmF1bHQiXSwKICAgICAgICAnZW4nOiBfZW4yWyJkZWZhdWx0Il0sCiAgICAgICAgJ2VzLUVTJzogX2VzRVMyWyJkZWZhdWx0Il0sCiAgICAgICAgJ2ZyJzogX2ZyMlsiZGVmYXVsdCJdLAogICAgICAgICdydSc6IF9ydTJbImRlZmF1bHQiXSwKICAgICAgICAnZGUnOiBfZGUyWyJkZWZhdWx0Il0KICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxNTIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXywgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX187IC8vICAgICAoYykgMjAxMiBBaXJibmIsIEluYy4KICAgICAgLy8KICAgICAgLy8gICAgIHBvbHlnbG90LmpzIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBCU0QKICAgICAgLy8gICAgIGxpY2Vuc2UuIEZvciBhbGwgbGljZW5zaW5nIGluZm9ybWF0aW9uLCBkZXRhaWxzLCBhbmQgZG9jdW1lbnRpb246CiAgICAgIC8vICAgICBodHRwOi8vYWlyYm5iLmdpdGh1Yi5jb20vcG9seWdsb3QuanMKICAgICAgLy8KICAgICAgLy8KICAgICAgLy8gUG9seWdsb3QuanMgaXMgYW4gSTE4biBoZWxwZXIgbGlicmFyeSB3cml0dGVuIGluIEphdmFTY3JpcHQsIG1hZGUgdG8KICAgICAgLy8gd29yayBib3RoIGluIHRoZSBicm93c2VyIGFuZCBpbiBOb2RlLiBJdCBwcm92aWRlcyBhIHNpbXBsZSBzb2x1dGlvbiBmb3IKICAgICAgLy8gaW50ZXJwb2xhdGlvbiBhbmQgcGx1cmFsaXphdGlvbiwgYmFzZWQgb2ZmIG9mIEFpcmJuYidzCiAgICAgIC8vIGV4cGVyaWVuY2UgYWRkaW5nIEkxOG4gZnVuY3Rpb25hbGl0eSB0byBpdHMgQmFja2JvbmUuanMgYW5kIE5vZGUgYXBwcy4KICAgICAgLy8KICAgICAgLy8gUG9seWxnbG90IGlzIGFnbm9zdGljIHRvIHlvdXIgdHJhbnNsYXRpb24gYmFja2VuZC4gSXQgZG9lc24ndCBwZXJmb3JtIGFueQogICAgICAvLyB0cmFuc2xhdGlvbjsgaXQgc2ltcGx5IGdpdmVzIHlvdSBhIHdheSB0byBtYW5hZ2UgdHJhbnNsYXRlZCBwaHJhc2VzIGZyb20KICAgICAgLy8geW91ciBjbGllbnQtIG9yIHNlcnZlci1zaWRlIEphdmFTY3JpcHQgYXBwbGljYXRpb24uCiAgICAgIC8vCgoKICAgICAgKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICAgICAgaWYgKHRydWUpIHsKICAgICAgICAgICEoX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXyA9IFtdLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkocm9vdCk7CiAgICAgICAgICB9LmFwcGx5KGV4cG9ydHMsIF9fV0VCUEFDS19BTURfREVGSU5FX0FSUkFZX18pLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyAhPT0gdW5kZWZpbmVkICYmIChtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fKSk7CiAgICAgICAgfSBlbHNlIGlmIChfdHlwZW9mNChleHBvcnRzKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyb290KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcm9vdC5Qb2x5Z2xvdCA9IGZhY3Rvcnkocm9vdCk7CiAgICAgICAgfQogICAgICB9KSh0aGlzLCBmdW5jdGlvbiAocm9vdCkgewogICAgICAgICd1c2Ugc3RyaWN0JzsgLy8gIyMjIFBvbHlnbG90IGNsYXNzIGNvbnN0cnVjdG9yCgogICAgICAgIGZ1bmN0aW9uIFBvbHlnbG90KG9wdGlvbnMpIHsKICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgdGhpcy5waHJhc2VzID0ge307CiAgICAgICAgICB0aGlzLmV4dGVuZChvcHRpb25zLnBocmFzZXMgfHwge30pOwogICAgICAgICAgdGhpcy5jdXJyZW50TG9jYWxlID0gb3B0aW9ucy5sb2NhbGUgfHwgJ2VuJzsKICAgICAgICAgIHRoaXMuYWxsb3dNaXNzaW5nID0gISFvcHRpb25zLmFsbG93TWlzc2luZzsKICAgICAgICAgIHRoaXMud2FybiA9IG9wdGlvbnMud2FybiB8fCB3YXJuOwogICAgICAgIH0gLy8gIyMjIFZlcnNpb24KCgogICAgICAgIFBvbHlnbG90LlZFUlNJT04gPSAnMC40LjMnOyAvLyAjIyMgcG9seWdsb3QubG9jYWxlKFtsb2NhbGVdKQogICAgICAgIC8vCiAgICAgICAgLy8gR2V0IG9yIHNldCBsb2NhbGUuIEludGVybmFsbHksIFBvbHlnbG90IG9ubHkgdXNlcyBsb2NhbGUgZm9yIHBsdXJhbGl6YXRpb24uCgogICAgICAgIFBvbHlnbG90LnByb3RvdHlwZS5sb2NhbGUgPSBmdW5jdGlvbiAobmV3TG9jYWxlKSB7CiAgICAgICAgICBpZiAobmV3TG9jYWxlKSB0aGlzLmN1cnJlbnRMb2NhbGUgPSBuZXdMb2NhbGU7CiAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50TG9jYWxlOwogICAgICAgIH07IC8vICMjIyBwb2x5Z2xvdC5leHRlbmQocGhyYXNlcykKICAgICAgICAvLwogICAgICAgIC8vIFVzZSBgZXh0ZW5kYCB0byB0ZWxsIFBvbHlnbG90IGhvdyB0byB0cmFuc2xhdGUgYSBnaXZlbiBrZXkuCiAgICAgICAgLy8KICAgICAgICAvLyAgICAgcG9seWdsb3QuZXh0ZW5kKHsKICAgICAgICAvLyAgICAgICAiaGVsbG8iOiAiSGVsbG8iLAogICAgICAgIC8vICAgICAgICJoZWxsb19uYW1lIjogIkhlbGxvLCAle25hbWV9IgogICAgICAgIC8vICAgICB9KTsKICAgICAgICAvLwogICAgICAgIC8vIFRoZSBrZXkgY2FuIGJlIGFueSBzdHJpbmcuICBGZWVsIGZyZWUgdG8gY2FsbCBgZXh0ZW5kYCBtdWx0aXBsZSB0aW1lczsKICAgICAgICAvLyBpdCB3aWxsIG92ZXJyaWRlIGFueSBwaHJhc2VzIHdpdGggdGhlIHNhbWUga2V5LCBidXQgbGVhdmUgZXhpc3RpbmcgcGhyYXNlcwogICAgICAgIC8vIHVudG91Y2hlZC4KICAgICAgICAvLwogICAgICAgIC8vIEl0IGlzIGFsc28gcG9zc2libGUgdG8gcGFzcyBuZXN0ZWQgcGhyYXNlIG9iamVjdHMsIHdoaWNoIGdldCBmbGF0dGVuZWQKICAgICAgICAvLyBpbnRvIGFuIG9iamVjdCB3aXRoIHRoZSBuZXN0ZWQga2V5cyBjb25jYXRlbmF0ZWQgdXNpbmcgZG90IG5vdGF0aW9uLgogICAgICAgIC8vCiAgICAgICAgLy8gICAgIHBvbHlnbG90LmV4dGVuZCh7CiAgICAgICAgLy8gICAgICAgIm5hdiI6IHsKICAgICAgICAvLyAgICAgICAgICJoZWxsbyI6ICJIZWxsbyIsCiAgICAgICAgLy8gICAgICAgICAiaGVsbG9fbmFtZSI6ICJIZWxsbywgJXtuYW1lfSIsCiAgICAgICAgLy8gICAgICAgICAic2lkZWJhciI6IHsKICAgICAgICAvLyAgICAgICAgICAgIndlbGNvbWUiOiAiV2VsY29tZSIKICAgICAgICAvLyAgICAgICAgIH0KICAgICAgICAvLyAgICAgICB9CiAgICAgICAgLy8gICAgIH0pOwogICAgICAgIC8vCiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKHBvbHlnbG90LnBocmFzZXMpOwogICAgICAgIC8vICAgICAvLyB7CiAgICAgICAgLy8gICAgIC8vICAgJ25hdi5oZWxsbyc6ICdIZWxsbycsCiAgICAgICAgLy8gICAgIC8vICAgJ25hdi5oZWxsb19uYW1lJzogJ0hlbGxvLCAle25hbWV9JywKICAgICAgICAvLyAgICAgLy8gICAnbmF2LnNpZGViYXIud2VsY29tZSc6ICdXZWxjb21lJwogICAgICAgIC8vICAgICAvLyB9CiAgICAgICAgLy8KICAgICAgICAvLyBgZXh0ZW5kYCBhY2NlcHRzIGFuIG9wdGlvbmFsIHNlY29uZCBhcmd1bWVudCwgYHByZWZpeGAsIHdoaWNoIGNhbiBiZSB1c2VkCiAgICAgICAgLy8gdG8gcHJlZml4IGV2ZXJ5IGtleSBpbiB0aGUgcGhyYXNlcyBvYmplY3Qgd2l0aCBzb21lIHN0cmluZywgdXNpbmcgZG90CiAgICAgICAgLy8gbm90YXRpb24uCiAgICAgICAgLy8KICAgICAgICAvLyAgICAgcG9seWdsb3QuZXh0ZW5kKHsKICAgICAgICAvLyAgICAgICAiaGVsbG8iOiAiSGVsbG8iLAogICAgICAgIC8vICAgICAgICJoZWxsb19uYW1lIjogIkhlbGxvLCAle25hbWV9IgogICAgICAgIC8vICAgICB9LCAibmF2Iik7CiAgICAgICAgLy8KICAgICAgICAvLyAgICAgY29uc29sZS5sb2cocG9seWdsb3QucGhyYXNlcyk7CiAgICAgICAgLy8gICAgIC8vIHsKICAgICAgICAvLyAgICAgLy8gICAnbmF2LmhlbGxvJzogJ0hlbGxvJywKICAgICAgICAvLyAgICAgLy8gICAnbmF2LmhlbGxvX25hbWUnOiAnSGVsbG8sICV7bmFtZX0nCiAgICAgICAgLy8gICAgIC8vIH0KICAgICAgICAvLwogICAgICAgIC8vIFRoaXMgZmVhdHVyZSBpcyB1c2VkIGludGVybmFsbHkgdG8gc3VwcG9ydCBuZXN0ZWQgcGhyYXNlIG9iamVjdHMuCgoKICAgICAgICBQb2x5Z2xvdC5wcm90b3R5cGUuZXh0ZW5kID0gZnVuY3Rpb24gKG1vcmVQaHJhc2VzLCBwcmVmaXgpIHsKICAgICAgICAgIHZhciBwaHJhc2U7CgogICAgICAgICAgZm9yICh2YXIga2V5IGluIG1vcmVQaHJhc2VzKSB7CiAgICAgICAgICAgIGlmIChtb3JlUGhyYXNlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgcGhyYXNlID0gbW9yZVBocmFzZXNba2V5XTsKICAgICAgICAgICAgICBpZiAocHJlZml4KSBrZXkgPSBwcmVmaXggKyAnLicgKyBrZXk7CgogICAgICAgICAgICAgIGlmIChfdHlwZW9mNChwaHJhc2UpID09PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgdGhpcy5leHRlbmQocGhyYXNlLCBrZXkpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnBocmFzZXNba2V5XSA9IHBocmFzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OyAvLyAjIyMgcG9seWdsb3QuY2xlYXIoKQogICAgICAgIC8vCiAgICAgICAgLy8gQ2xlYXJzIGFsbCBwaHJhc2VzLiBVc2VmdWwgZm9yIHNwZWNpYWwgY2FzZXMsIHN1Y2ggYXMgZnJlZWluZwogICAgICAgIC8vIHVwIG1lbW9yeSBpZiB5b3UgaGF2ZSBsb3RzIG9mIHBocmFzZXMgYnV0IG5vIGxvbmdlciBuZWVkIHRvCiAgICAgICAgLy8gcGVyZm9ybSBhbnkgdHJhbnNsYXRpb24uIEFsc28gdXNlZCBpbnRlcm5hbGx5IGJ5IGByZXBsYWNlYC4KCgogICAgICAgIFBvbHlnbG90LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoaXMucGhyYXNlcyA9IHt9OwogICAgICAgIH07IC8vICMjIyBwb2x5Z2xvdC5yZXBsYWNlKHBocmFzZXMpCiAgICAgICAgLy8KICAgICAgICAvLyBDb21wbGV0ZWx5IHJlcGxhY2UgdGhlIGV4aXN0aW5nIHBocmFzZXMgd2l0aCBhIG5ldyBzZXQgb2YgcGhyYXNlcy4KICAgICAgICAvLyBOb3JtYWxseSwganVzdCB1c2UgYGV4dGVuZGAgdG8gYWRkIG1vcmUgcGhyYXNlcywgYnV0IHVuZGVyIGNlcnRhaW4KICAgICAgICAvLyBjaXJjdW1zdGFuY2VzLCB5b3UgbWF5IHdhbnQgdG8gbWFrZSBzdXJlIG5vIG9sZCBwaHJhc2VzIGFyZSBseWluZyBhcm91bmQuCgoKICAgICAgICBQb2x5Z2xvdC5wcm90b3R5cGUucmVwbGFjZSA9IGZ1bmN0aW9uIChuZXdQaHJhc2VzKSB7CiAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICB0aGlzLmV4dGVuZChuZXdQaHJhc2VzKTsKICAgICAgICB9OyAvLyAjIyMgcG9seWdsb3QudChrZXksIG9wdGlvbnMpCiAgICAgICAgLy8KICAgICAgICAvLyBUaGUgbW9zdC11c2VkIG1ldGhvZC4gUHJvdmlkZSBhIGtleSwgYW5kIGB0YCB3aWxsIHJldHVybiB0aGUKICAgICAgICAvLyBwaHJhc2UuCiAgICAgICAgLy8KICAgICAgICAvLyAgICAgcG9seWdsb3QudCgiaGVsbG8iKTsKICAgICAgICAvLyAgICAgPT4gIkhlbGxvIgogICAgICAgIC8vCiAgICAgICAgLy8gVGhlIHBocmFzZSB2YWx1ZSBpcyBwcm92aWRlZCBmaXJzdCBieSBhIGNhbGwgdG8gYHBvbHlnbG90LmV4dGVuZCgpYCBvcgogICAgICAgIC8vIGBwb2x5Z2xvdC5yZXBsYWNlKClgLgogICAgICAgIC8vCiAgICAgICAgLy8gUGFzcyBpbiBhbiBvYmplY3QgYXMgdGhlIHNlY29uZCBhcmd1bWVudCB0byBwZXJmb3JtIGludGVycG9sYXRpb24uCiAgICAgICAgLy8KICAgICAgICAvLyAgICAgcG9seWdsb3QudCgiaGVsbG9fbmFtZSIsIHtuYW1lOiAiU3Bpa2UifSk7CiAgICAgICAgLy8gICAgID0+ICJIZWxsbywgU3Bpa2UiCiAgICAgICAgLy8KICAgICAgICAvLyBJZiB5b3UgbGlrZSwgeW91IGNhbiBwcm92aWRlIGEgZGVmYXVsdCB2YWx1ZSBpbiBjYXNlIHRoZSBwaHJhc2UgaXMgbWlzc2luZy4KICAgICAgICAvLyBVc2UgdGhlIHNwZWNpYWwgb3B0aW9uIGtleSAiXyIgdG8gc3BlY2lmeSBhIGRlZmF1bHQuCiAgICAgICAgLy8KICAgICAgICAvLyAgICAgcG9seWdsb3QudCgiaV9saWtlX3RvX3dyaXRlX2luX2xhbmd1YWdlIiwgewogICAgICAgIC8vICAgICAgIF86ICJJIGxpa2UgdG8gd3JpdGUgaW4gJXtsYW5ndWFnZX0uIiwKICAgICAgICAvLyAgICAgICBsYW5ndWFnZTogIkphdmFTY3JpcHQiCiAgICAgICAgLy8gICAgIH0pOwogICAgICAgIC8vICAgICA9PiAiSSBsaWtlIHRvIHdyaXRlIGluIEphdmFTY3JpcHQuIgogICAgICAgIC8vCgoKICAgICAgICBQb2x5Z2xvdC5wcm90b3R5cGUudCA9IGZ1bmN0aW9uIChrZXksIG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBwaHJhc2UsIHJlc3VsdDsKICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zID09IG51bGwgPyB7fSA6IG9wdGlvbnM7IC8vIGFsbG93IG51bWJlciBhcyBhIHBsdXJhbGl6YXRpb24gc2hvcnRjdXQKCiAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgICAgICAgc21hcnRfY291bnQ6IG9wdGlvbnMKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodHlwZW9mIHRoaXMucGhyYXNlc1trZXldID09PSAnc3RyaW5nJykgewogICAgICAgICAgICBwaHJhc2UgPSB0aGlzLnBocmFzZXNba2V5XTsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9wdGlvbnMuXyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgcGhyYXNlID0gb3B0aW9ucy5fOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFsbG93TWlzc2luZykgewogICAgICAgICAgICBwaHJhc2UgPSBrZXk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLndhcm4oJ01pc3NpbmcgdHJhbnNsYXRpb24gZm9yIGtleTogIicgKyBrZXkgKyAnIicpOwogICAgICAgICAgICByZXN1bHQgPSBrZXk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHR5cGVvZiBwaHJhc2UgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIG9wdGlvbnMgPSBjbG9uZShvcHRpb25zKTsKICAgICAgICAgICAgcmVzdWx0ID0gY2hvb3NlUGx1cmFsRm9ybShwaHJhc2UsIHRoaXMuY3VycmVudExvY2FsZSwgb3B0aW9ucy5zbWFydF9jb3VudCk7CiAgICAgICAgICAgIHJlc3VsdCA9IGludGVycG9sYXRlKHJlc3VsdCwgb3B0aW9ucyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9OyAvLyAjIyMgcG9seWdsb3QuaGFzKGtleSkKICAgICAgICAvLwogICAgICAgIC8vIENoZWNrIGlmIHBvbHlnbG90IGhhcyBhIHRyYW5zbGF0aW9uIGZvciBnaXZlbiBrZXkKCgogICAgICAgIFBvbHlnbG90LnByb3RvdHlwZS5oYXMgPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICByZXR1cm4ga2V5IGluIHRoaXMucGhyYXNlczsKICAgICAgICB9OyAvLyAjIyMjIFBsdXJhbGl6YXRpb24gbWV0aG9kcwogICAgICAgIC8vIFRoZSBzdHJpbmcgdGhhdCBzZXBhcmF0ZXMgdGhlIGRpZmZlcmVudCBwaHJhc2UgcG9zc2liaWxpdGllcy4KCgogICAgICAgIHZhciBkZWxpbWV0ZXIgPSAnfHx8fCc7IC8vIE1hcHBpbmcgZnJvbSBwbHVyYWxpemF0aW9uIGdyb3VwIHBsdXJhbCBsb2dpYy4KCiAgICAgICAgdmFyIHBsdXJhbFR5cGVzID0gewogICAgICAgICAgY2hpbmVzZTogZnVuY3Rpb24gY2hpbmVzZShuKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgfSwKICAgICAgICAgIGdlcm1hbjogZnVuY3Rpb24gZ2VybWFuKG4pIHsKICAgICAgICAgICAgcmV0dXJuIG4gIT09IDEgPyAxIDogMDsKICAgICAgICAgIH0sCiAgICAgICAgICBmcmVuY2g6IGZ1bmN0aW9uIGZyZW5jaChuKSB7CiAgICAgICAgICAgIHJldHVybiBuID4gMSA/IDEgOiAwOwogICAgICAgICAgfSwKICAgICAgICAgIHJ1c3NpYW46IGZ1bmN0aW9uIHJ1c3NpYW4obikgewogICAgICAgICAgICByZXR1cm4gbiAlIDEwID09PSAxICYmIG4gJSAxMDAgIT09IDExID8gMCA6IG4gJSAxMCA+PSAyICYmIG4gJSAxMCA8PSA0ICYmIChuICUgMTAwIDwgMTAgfHwgbiAlIDEwMCA+PSAyMCkgPyAxIDogMjsKICAgICAgICAgIH0sCiAgICAgICAgICBjemVjaDogZnVuY3Rpb24gY3plY2gobikgewogICAgICAgICAgICByZXR1cm4gbiA9PT0gMSA/IDAgOiBuID49IDIgJiYgbiA8PSA0ID8gMSA6IDI7CiAgICAgICAgICB9LAogICAgICAgICAgcG9saXNoOiBmdW5jdGlvbiBwb2xpc2gobikgewogICAgICAgICAgICByZXR1cm4gbiA9PT0gMSA/IDAgOiBuICUgMTAgPj0gMiAmJiBuICUgMTAgPD0gNCAmJiAobiAlIDEwMCA8IDEwIHx8IG4gJSAxMDAgPj0gMjApID8gMSA6IDI7CiAgICAgICAgICB9LAogICAgICAgICAgaWNlbGFuZGljOiBmdW5jdGlvbiBpY2VsYW5kaWMobikgewogICAgICAgICAgICByZXR1cm4gbiAlIDEwICE9PSAxIHx8IG4gJSAxMDAgPT09IDExID8gMSA6IDA7CiAgICAgICAgICB9CiAgICAgICAgfTsgLy8gTWFwcGluZyBmcm9tIHBsdXJhbGl6YXRpb24gZ3JvdXAgdG8gaW5kaXZpZHVhbCBsb2NhbGVzLgoKICAgICAgICB2YXIgcGx1cmFsVHlwZVRvTGFuZ3VhZ2VzID0gewogICAgICAgICAgY2hpbmVzZTogWydmYScsICdpZCcsICdqYScsICdrbycsICdsbycsICdtcycsICd0aCcsICd0cicsICd6aCddLAogICAgICAgICAgZ2VybWFuOiBbJ2RhJywgJ2RlJywgJ2VuJywgJ2VzJywgJ2ZpJywgJ2VsJywgJ2hlJywgJ2h1JywgJ2l0JywgJ25sJywgJ25vJywgJ3B0JywgJ3N2J10sCiAgICAgICAgICBmcmVuY2g6IFsnZnInLCAndGwnLCAncHQtYnInXSwKICAgICAgICAgIHJ1c3NpYW46IFsnaHInLCAncnUnXSwKICAgICAgICAgIGN6ZWNoOiBbJ2NzJ10sCiAgICAgICAgICBwb2xpc2g6IFsncGwnXSwKICAgICAgICAgIGljZWxhbmRpYzogWydpcyddCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gbGFuZ1RvVHlwZU1hcChtYXBwaW5nKSB7CiAgICAgICAgICB2YXIgdHlwZSwKICAgICAgICAgICAgICBsYW5ncywKICAgICAgICAgICAgICBsLAogICAgICAgICAgICAgIHJldCA9IHt9OwoKICAgICAgICAgIGZvciAodHlwZSBpbiBtYXBwaW5nKSB7CiAgICAgICAgICAgIGlmIChtYXBwaW5nLmhhc093blByb3BlcnR5KHR5cGUpKSB7CiAgICAgICAgICAgICAgbGFuZ3MgPSBtYXBwaW5nW3R5cGVdOwoKICAgICAgICAgICAgICBmb3IgKGwgaW4gbGFuZ3MpIHsKICAgICAgICAgICAgICAgIHJldFtsYW5nc1tsXV0gPSB0eXBlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfSAvLyBUcmltIGEgc3RyaW5nLgoKCiAgICAgICAgZnVuY3Rpb24gdHJpbShzdHIpIHsKICAgICAgICAgIHZhciB0cmltUmUgPSAvXlxzK3xccyskL2c7CiAgICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UodHJpbVJlLCAnJyk7CiAgICAgICAgfSAvLyBCYXNlZCBvbiBhIHBocmFzZSB0ZXh0IHRoYXQgY29udGFpbnMgYG5gIHBsdXJhbCBmb3JtcyBzZXBhcmF0ZWQKICAgICAgICAvLyBieSBgZGVsaW1ldGVyYCwgYSBgbG9jYWxlYCwgYW5kIGEgYGNvdW50YCwgY2hvb3NlIHRoZSBjb3JyZWN0CiAgICAgICAgLy8gcGx1cmFsIGZvcm0sIG9yIG5vbmUgaWYgYGNvdW50YCBpcyBgbnVsbGAuCgoKICAgICAgICBmdW5jdGlvbiBjaG9vc2VQbHVyYWxGb3JtKHRleHQsIGxvY2FsZSwgY291bnQpIHsKICAgICAgICAgIHZhciByZXQsIHRleHRzLCBjaG9zZW5UZXh0OwoKICAgICAgICAgIGlmIChjb3VudCAhPSBudWxsICYmIHRleHQpIHsKICAgICAgICAgICAgdGV4dHMgPSB0ZXh0LnNwbGl0KGRlbGltZXRlcik7CiAgICAgICAgICAgIGNob3NlblRleHQgPSB0ZXh0c1twbHVyYWxUeXBlSW5kZXgobG9jYWxlLCBjb3VudCldIHx8IHRleHRzWzBdOwogICAgICAgICAgICByZXQgPSB0cmltKGNob3NlblRleHQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0ID0gdGV4dDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcGx1cmFsVHlwZU5hbWUobG9jYWxlKSB7CiAgICAgICAgICB2YXIgbGFuZ1RvUGx1cmFsVHlwZSA9IGxhbmdUb1R5cGVNYXAocGx1cmFsVHlwZVRvTGFuZ3VhZ2VzKTsKICAgICAgICAgIHJldHVybiBsYW5nVG9QbHVyYWxUeXBlW2xvY2FsZV0gfHwgbGFuZ1RvUGx1cmFsVHlwZS5lbjsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHBsdXJhbFR5cGVJbmRleChsb2NhbGUsIGNvdW50KSB7CiAgICAgICAgICByZXR1cm4gcGx1cmFsVHlwZXNbcGx1cmFsVHlwZU5hbWUobG9jYWxlKV0oY291bnQpOwogICAgICAgIH0gLy8gIyMjIGludGVycG9sYXRlCiAgICAgICAgLy8KICAgICAgICAvLyBEb2VzIHRoZSBkaXJ0eSB3b3JrLiBDcmVhdGVzIGEgYFJlZ0V4cGAgb2JqZWN0IGZvciBlYWNoCiAgICAgICAgLy8gaW50ZXJwb2xhdGlvbiBwbGFjZWhvbGRlci4KCgogICAgICAgIGZ1bmN0aW9uIGludGVycG9sYXRlKHBocmFzZSwgb3B0aW9ucykgewogICAgICAgICAgZm9yICh2YXIgYXJnIGluIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKGFyZyAhPT0gJ18nICYmIG9wdGlvbnMuaGFzT3duUHJvcGVydHkoYXJnKSkgewogICAgICAgICAgICAgIC8vIFdlIGNyZWF0ZSBhIG5ldyBgUmVnRXhwYCBlYWNoIHRpbWUgaW5zdGVhZCBvZiB1c2luZyBhIG1vcmUtZWZmaWNpZW50CiAgICAgICAgICAgICAgLy8gc3RyaW5nIHJlcGxhY2Ugc28gdGhhdCB0aGUgc2FtZSBhcmd1bWVudCBjYW4gYmUgcmVwbGFjZWQgbXVsdGlwbGUgdGltZXMKICAgICAgICAgICAgICAvLyBpbiB0aGUgc2FtZSBwaHJhc2UuCiAgICAgICAgICAgICAgcGhyYXNlID0gcGhyYXNlLnJlcGxhY2UobmV3IFJlZ0V4cCgnJVxceycgKyBhcmcgKyAnXFx9JywgJ2cnKSwgb3B0aW9uc1thcmddKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBwaHJhc2U7CiAgICAgICAgfSAvLyAjIyMgd2FybgogICAgICAgIC8vCiAgICAgICAgLy8gUHJvdmlkZXMgYSB3YXJuaW5nIGluIHRoZSBjb25zb2xlIGlmIGEgcGhyYXNlIGtleSBpcyBtaXNzaW5nLgoKCiAgICAgICAgZnVuY3Rpb24gd2FybihtZXNzYWdlKSB7CiAgICAgICAgICByb290LmNvbnNvbGUgJiYgcm9vdC5jb25zb2xlLndhcm4gJiYgcm9vdC5jb25zb2xlLndhcm4oJ1dBUk5JTkc6ICcgKyBtZXNzYWdlKTsKICAgICAgICB9IC8vICMjIyBjbG9uZQogICAgICAgIC8vCiAgICAgICAgLy8gQ2xvbmUgYW4gb2JqZWN0LgoKCiAgICAgICAgZnVuY3Rpb24gY2xvbmUoc291cmNlKSB7CiAgICAgICAgICB2YXIgcmV0ID0ge307CgogICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHsKICAgICAgICAgICAgcmV0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gUG9seWdsb3Q7CiAgICAgIH0pOwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxNTMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICAiaW5pdCI6ICJHaXRhbGsg5Yqg6L295LitIC4uLiIsCiAgICAgICAgIm5vLWZvdW5kLXJlbGF0ZWQiOiAi5pyq5om+5Yiw55u45YWz55qEICV7bGlua30g6L+b6KGM6K+E6K66IiwKICAgICAgICAicGxlYXNlLWNvbnRhY3QiOiAi6K+36IGU57O7ICV7dXNlcn0g5Yid5aeL5YyW5Yib5bu6IiwKICAgICAgICAiaW5pdC1pc3N1ZSI6ICLliJ3lp4vljJYgSXNzdWUiLAogICAgICAgICJsZWF2ZS1hLWNvbW1lbnQiOiAi6K+054K55LuA5LmIIiwKICAgICAgICAicHJldmlldyI6ICLpooTop4giLAogICAgICAgICJlZGl0IjogIue8lui+kSIsCiAgICAgICAgImNvbW1lbnQiOiAi6K+E6K66IiwKICAgICAgICAic3VwcG9ydC1tYXJrZG93biI6ICLmlK/mjIEgTWFya2Rvd24g6K+t5rOVIiwKICAgICAgICAibG9naW4td2l0aC1naXRodWIiOiAi5L2/55SoIEdpdEh1YiDnmbvlvZUiLAogICAgICAgICJmaXJzdC1jb21tZW50LXBlcnNvbiI6ICLmnaXlgZrnrKzkuIDkuKrnlZnoqIDnmoTkurrlkKfvvIEiLAogICAgICAgICJjb21tZW50ZWQiOiAi5Y+R6KGo5LqOIiwKICAgICAgICAibG9hZC1tb3JlIjogIuWKoOi9veabtOWkmiIsCiAgICAgICAgImNvdW50cyI6ICIle2NvdW50c30g5p2h6K+E6K66IiwKICAgICAgICAic29ydC1hc2MiOiAi5LuO5pen5Yiw5paw5o6S5bqPIiwKICAgICAgICAic29ydC1kZXNjIjogIuS7juaWsOWIsOaXp+aOkuW6jyIsCiAgICAgICAgImxvZ291dCI6ICLms6jplIAiLAogICAgICAgICJhbm9ueW1vdXMiOiAi5pyq55m75b2V55So5oi3IgogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE1NCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgICJpbml0IjogIkdpdGFsayDovInlhaXkuK3igKYiLAogICAgICAgICJuby1mb3VuZC1yZWxhdGVkIjogIuacquaJvuWIsOebuOmXnOeahCAle2xpbmt9IiwKICAgICAgICAicGxlYXNlLWNvbnRhY3QiOiAi6KuL6IGv57WhICV7dXNlcn0g5Yid5aeL5YyW6KmV6KuWIiwKICAgICAgICAiaW5pdC1pc3N1ZSI6ICLliJ3lp4vljJYgSXNzdWUiLAogICAgICAgICJsZWF2ZS1hLWNvbW1lbnQiOiAi5a+r6bue5LuA6bq8IiwKICAgICAgICAicHJldmlldyI6ICLpoJDopr0iLAogICAgICAgICJlZGl0IjogIue3qOi8ryIsCiAgICAgICAgImNvbW1lbnQiOiAi6KmV6KuWIiwKICAgICAgICAic3VwcG9ydC1tYXJrZG93biI6ICLmlK/mj7QgTWFya2Rvd24g6Kqe5rOVIiwKICAgICAgICAibG9naW4td2l0aC1naXRodWIiOiAi5L2/55SoIEdpdEh1YiDnmbvlhaUiLAogICAgICAgICJmaXJzdC1jb21tZW50LXBlcnNvbiI6ICLmiJDngrrpppblgIvnlZnoqIDnmoTkurrlkKfvvIEiLAogICAgICAgICJjb21tZW50ZWQiOiAi6KmV6KuW5pa8IiwKICAgICAgICAibG9hZC1tb3JlIjogIui8ieWFpeabtOWkmiIsCiAgICAgICAgImNvdW50cyI6ICIle2NvdW50c30g562G6KmV6KuWIiwKICAgICAgICAic29ydC1hc2MiOiAi5b6e6IiK6Iez5paw5o6S5bqPIiwKICAgICAgICAic29ydC1kZXNjIjogIuW+nuaWsOiHs+iIiuaOkuW6jyIsCiAgICAgICAgImxvZ291dCI6ICLnmbvlh7oiLAogICAgICAgICJhbm9ueW1vdXMiOiAi6Kiq5a6iIgogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE1NSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgICJpbml0IjogIkdpdGFsa2luZyAuLi4iLAogICAgICAgICJuby1mb3VuZC1yZWxhdGVkIjogIlJlbGF0ZWQgJXtsaW5rfSBub3QgZm91bmQiLAogICAgICAgICJwbGVhc2UtY29udGFjdCI6ICJQbGVhc2UgY29udGFjdCAle3VzZXJ9IHRvIGluaXRpYWxpemUgdGhlIGNvbW1lbnQiLAogICAgICAgICJpbml0LWlzc3VlIjogIkluaXQgSXNzdWUiLAogICAgICAgICJsZWF2ZS1hLWNvbW1lbnQiOiAiTGVhdmUgYSBjb21tZW50IiwKICAgICAgICAicHJldmlldyI6ICJQcmV2aWV3IiwKICAgICAgICAiZWRpdCI6ICJFZGl0IiwKICAgICAgICAiY29tbWVudCI6ICJDb21tZW50IiwKICAgICAgICAic3VwcG9ydC1tYXJrZG93biI6ICJNYXJrZG93biBpcyBzdXBwb3J0ZWQiLAogICAgICAgICJsb2dpbi13aXRoLWdpdGh1YiI6ICJMb2dpbiB3aXRoIEdpdEh1YiIsCiAgICAgICAgImZpcnN0LWNvbW1lbnQtcGVyc29uIjogIkJlIHRoZSBmaXJzdCBwZXJzb24gdG8gbGVhdmUgYSBjb21tZW50ISIsCiAgICAgICAgImNvbW1lbnRlZCI6ICJjb21tZW50ZWQiLAogICAgICAgICJsb2FkLW1vcmUiOiAiTG9hZCBtb3JlIiwKICAgICAgICAiY291bnRzIjogIiV7Y291bnRzfSBjb21tZW50IHx8fHwgJXtjb3VudHN9IGNvbW1lbnRzIiwKICAgICAgICAic29ydC1hc2MiOiAiU29ydCBieSBPbGRlc3QiLAogICAgICAgICJzb3J0LWRlc2MiOiAiU29ydCBieSBMYXRlc3QiLAogICAgICAgICJsb2dvdXQiOiAiTG9nb3V0IiwKICAgICAgICAiYW5vbnltb3VzIjogIkFub255bW91cyIKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxNTYgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICAiaW5pdCI6ICJHaXRhbGtpbmcgLi4uIiwKICAgICAgICAibm8tZm91bmQtcmVsYXRlZCI6ICJMaW5rICV7bGlua30gbm8gZW5jb250cmFkbyIsCiAgICAgICAgInBsZWFzZS1jb250YWN0IjogIlBvciBmYXZvciBjb250YWN0YSBjb24gJXt1c2VyfSBwYXJhIGluaWNpYWxpemFyIGVsIGNvbWVudGFyaW8iLAogICAgICAgICJpbml0LWlzc3VlIjogIkluaWNpYXIgSXNzdWUiLAogICAgICAgICJsZWF2ZS1hLWNvbW1lbnQiOiAiRGVqYSB1biBjb21lbnRhcmlvIiwKICAgICAgICAicHJldmlldyI6ICJBdmFuY2UiLAogICAgICAgICJlZGl0IjogIkVkaXRhciIsCiAgICAgICAgImNvbW1lbnQiOiAiQ29tZW50YXJpbyIsCiAgICAgICAgInN1cHBvcnQtbWFya2Rvd24iOiAiTWFya2Rvd24gZXMgc29wb3J0YWRvIiwKICAgICAgICAibG9naW4td2l0aC1naXRodWIiOiAiRW50cmFyIGNvbiBHaXRIdWIiLAogICAgICAgICJmaXJzdC1jb21tZW50LXBlcnNvbiI6ICJTw6kgZWwgcHJpbWVybyBlbiBkZWphciB1biBjb21lbnRhcmlvISIsCiAgICAgICAgImNvbW1lbnRlZCI6ICJjb21lbnTDsyIsCiAgICAgICAgImxvYWQtbW9yZSI6ICJDYXJnYXIgbcOhcyIsCiAgICAgICAgImNvdW50cyI6ICIle2NvdW50c30gY29tZW50YXJpbyB8fHx8ICV7Y291bnRzfSBjb21lbnRhcmlvcyIsCiAgICAgICAgInNvcnQtYXNjIjogIk9yZGVuYXIgcG9yIEFudGlndW9zIiwKICAgICAgICAic29ydC1kZXNjIjogIk9yZGVuYXIgcG9yIFJlY2llbnRlcyIsCiAgICAgICAgImxvZ291dCI6ICJTYWxpciIsCiAgICAgICAgImFub255bW91cyI6ICJBbsOzbmltbyIKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxNTcgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICAiaW5pdCI6ICJHaXRhbGtpbmcgLi4uIiwKICAgICAgICAibm8tZm91bmQtcmVsYXRlZCI6ICJMaWVuICV7bGlua30gbm9uIHRyb3V2w6kiLAogICAgICAgICJwbGVhc2UtY29udGFjdCI6ICJT4oCZaWwgdm91cyBwbGHDrnQgY29udGFjdGV6ICV7dXNlcn0gcG91ciBpbml0aWFsaXNlciBsZXMgY29tbWVudGFpcmVzIiwKICAgICAgICAiaW5pdC1pc3N1ZSI6ICJJbml0aWFsaXNhdGlvbiBkZXMgaXNzdWVzIiwKICAgICAgICAibGVhdmUtYS1jb21tZW50IjogIkxhaXNzZXIgdW4gY29tbWVudGFpcmUiLAogICAgICAgICJwcmV2aWV3IjogIkFwZXLDp3UiLAogICAgICAgICJlZGl0IjogIk1vZGlmaWVyIiwKICAgICAgICAiY29tbWVudCI6ICJDb21tZW50YWlyZSIsCiAgICAgICAgInN1cHBvcnQtbWFya2Rvd24iOiAiTWFya2Rvd24gZXN0IHN1cHBvcnTDqSIsCiAgICAgICAgImxvZ2luLXdpdGgtZ2l0aHViIjogIlNlIGNvbm5lY3RlciBhdmVjIEdpdEh1YiIsCiAgICAgICAgImZpcnN0LWNvbW1lbnQtcGVyc29uIjogIsOKdHJlIGxlIHByZW1pZXIgw6AgbGFpc3NlciB1biBjb21tZW50YWlyZSAhIiwKICAgICAgICAiY29tbWVudGVkIjogImNvbW1lbnRlciIsCiAgICAgICAgImxvYWQtbW9yZSI6ICJDaGFyZ2VyIHBsdXMiLAogICAgICAgICJjb3VudHMiOiAiJXtjb3VudHN9IGNvbW1lbnRhaXJlIHx8fHwgJXtjb3VudHN9IGNvbW1lbnRhaXJlcyIsCiAgICAgICAgInNvcnQtYXNjIjogIlRyaWVyIHBhciBwbHVzIGFuY2llbiIsCiAgICAgICAgInNvcnQtZGVzYyI6ICJUcmllciBwYXIgcGx1cyByw6ljZW50IiwKICAgICAgICAibG9nb3V0IjogIkTDqWNvbm5leGlvbiIsCiAgICAgICAgImFub255bW91cyI6ICJBbm9ueW1lIgogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE1OCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgICJpbml0IjogIkdpdGFsa2luZyAuLi4iLAogICAgICAgICJuby1mb3VuZC1yZWxhdGVkIjogItCh0LLRj9C30LDQvdC90YvQtSAle2xpbmt9INC90LUg0L3QsNC50LTQtdC90YsiLAogICAgICAgICJwbGVhc2UtY29udGFjdCI6ICLQn9C+0LbQsNC70YPQudGB0YLQsCwg0YHQstGP0LbQuNGC0LXRgdGMINGBICV7dXNlcn0g0YfRgtC+0LHRiyDQuNC90LjRhtC40LDQu9C40LfQuNGA0L7QstCw0YLRjCDQutC+0LzQvNC10L3RgtCw0YDQuNC5IiwKICAgICAgICAiaW5pdC1pc3N1ZSI6ICLQktGL0L/Rg9GB0Log0LjQvdC40YbQuNCw0LvQuNC30LDRhtC40LgiLAogICAgICAgICJsZWF2ZS1hLWNvbW1lbnQiOiAi0J7RgdGC0LDQstC40YLRjCDQutC+0LzQvNC10L3RgtCw0YDQuNC5IiwKICAgICAgICAicHJldmlldyI6ICLQn9GA0LXQtNCy0LDRgNC40YLQtdC70YzQvdGL0Lkg0L/RgNC+0YHQvNC+0YLRgCIsCiAgICAgICAgImVkaXQiOiAiUNC10LTQsNC60YLQuNGA0L7QstCw0YLRjCIsCiAgICAgICAgImNvbW1lbnQiOiAi0JrQvtC80LzQtdC90YLQsNGA0LjQuSIsCiAgICAgICAgInN1cHBvcnQtbWFya2Rvd24iOiAi0J/QvtC00LTQtdGA0LbQuNCy0LDQtdGC0YHRjyBNYXJrZG93biIsCiAgICAgICAgImxvZ2luLXdpdGgtZ2l0aHViIjogItCS0YXQvtC0INGH0LXRgNC10LcgR2l0SHViIiwKICAgICAgICAiZmlyc3QtY29tbWVudC1wZXJzb24iOiAi0JHRg9C00YzRgtC1INC/0LXRgNCy0YvQvCwg0LrRgtC+INC+0YHRgtCw0LLQuNC7INC60L7QvNC80LXQvdGC0LDRgNC40LkiLAogICAgICAgICJjb21tZW50ZWQiOiAi0L/RgNC+0LrQvtC80LzQtdC90YLQuNGA0L7QstCw0L3QvdGL0LkiLAogICAgICAgICJsb2FkLW1vcmUiOiAi0JfQsNCz0YDRg9C30LjRgtGMINC10YnRkSIsCiAgICAgICAgImNvdW50cyI6ICIle2NvdW50c30g0LrQvtC80LzQtdC90YLQsNGA0LjQuSB8fHx8ICV7Y291bnRzfSDQutC+0LzQvNC10L3RgtCw0YDRjNC10LIiLAogICAgICAgICJzb3J0LWFzYyI6ICLQodC+0YDRgtC40YDQvtCy0LDRgtGMINC/0L4g0YHRgtCw0YDRi9C8IiwKICAgICAgICAic29ydC1kZXNjIjogItCh0L7RgNGC0LjRgNC+0LLQsNGC0Ywg0L/QviDQv9C+0YHQu9C10LTQvdC40LwiLAogICAgICAgICJsb2dvdXQiOiAi0JLRi9GF0L7QtCIsCiAgICAgICAgImFub255bW91cyI6ICLQkNC90L7QvdC40LzQvdGL0LkiCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTU5ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgImluaXQiOiAiR2l0YWxraW5nIC4uLiIsCiAgICAgICAgIm5vLWZvdW5kLXJlbGF0ZWQiOiAiWnVnZWjDtnJpZ2VyICV7bGlua30gbmljaHQgZ2VmdW5kZW4iLAogICAgICAgICJwbGVhc2UtY29udGFjdCI6ICJCaXR0ZSBrb250YWt0aWVyZSAle3VzZXJ9IHVtIGRlbiBLb21tZW50YXIgenUgaW5pdGlhbGlzaWVyZW4iLAogICAgICAgICJpbml0LWlzc3VlIjogIkluaXRpYWxpc2llcmUgSXNzdWUiLAogICAgICAgICJsZWF2ZS1hLWNvbW1lbnQiOiAiSGludGVybGFzc2UgZWluZW4gS29tbWVudGFyIiwKICAgICAgICAicHJldmlldyI6ICJWb3JzY2hhdSIsCiAgICAgICAgImVkaXQiOiAiRWRpdGllcmVuIiwKICAgICAgICAiY29tbWVudCI6ICJLb21tZW50aWVyZW4iLAogICAgICAgICJzdXBwb3J0LW1hcmtkb3duIjogIk1hcmtkb3duIHdpcmQgdW50ZXJzdMO8dHp0IiwKICAgICAgICAibG9naW4td2l0aC1naXRodWIiOiAiTWl0IEdpdEh1Yi1BY2NvdW50IGFubWVsZGVuIiwKICAgICAgICAiZmlyc3QtY29tbWVudC1wZXJzb24iOiAiU2VpIGRpZSBlcnN0ZSBQZXJzb24sIHdlbGNoZSBlaW5lbiBLb21tZW50YXIgaGludGVybMOkc3N0ISIsCiAgICAgICAgImNvbW1lbnRlZCI6ICJrb21tZW50aWVydGUiLAogICAgICAgICJsb2FkLW1vcmUiOiAiWmVpZ2UgbWVociIsCiAgICAgICAgImNvdW50cyI6ICIle2NvdW50c30gS29tbWVudGFyIHx8fHwgJXtjb3VudHN9IEtvbW1lbnRhcmUiLAogICAgICAgICJzb3J0LWFzYyI6ICLDhGx0ZXN0ZSB6dWVyc3QiLAogICAgICAgICJzb3J0LWRlc2MiOiAiTmV1c3RlIHp1ZXJzdCIsCiAgICAgICAgImxvZ291dCI6ICJBYm1lbGRlbiIsCiAgICAgICAgImFub255bW91cyI6ICJBbm9ueW0iCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTYwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsvLyByZW1vdmVkIGJ5IGV4dHJhY3QtdGV4dC13ZWJwYWNrLXBsdWdpbgoKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxNjEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICAiZGVmYXVsdCI6IF9fd2VicGFja19yZXF1aXJlX18oMTYyKSwKICAgICAgICBfX2VzTW9kdWxlOiB0cnVlCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTYyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygxNjMpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApLk9iamVjdC5rZXlzOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE2MyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIDE5LjEuMi4xNCBPYmplY3Qua2V5cyhPKQogICAgICB2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3KTsKCiAgICAgIHZhciAka2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oMjIpOwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXyg2NSkoJ2tleXMnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGtleXMoaXQpIHsKICAgICAgICAgIHJldHVybiAka2V5cyh0b09iamVjdChpdCkpOwogICAgICAgIH07CiAgICAgIH0pOwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxNjQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwoKICAgICAgdmFyIF9pc0l0ZXJhYmxlMiA9IF9fd2VicGFja19yZXF1aXJlX18oMTY1KTsKCiAgICAgIHZhciBfaXNJdGVyYWJsZTMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pc0l0ZXJhYmxlMik7CgogICAgICB2YXIgX2dldEl0ZXJhdG9yMiA9IF9fd2VicGFja19yZXF1aXJlX18oMTY4KTsKCiAgICAgIHZhciBfZ2V0SXRlcmF0b3IzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZ2V0SXRlcmF0b3IyKTsKCiAgICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgICAgICAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgICAgICAgICJkZWZhdWx0Ijogb2JqCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIHNsaWNlSXRlcmF0b3IoYXJyLCBpKSB7CiAgICAgICAgICB2YXIgX2FyciA9IFtdOwogICAgICAgICAgdmFyIF9uID0gdHJ1ZTsKICAgICAgICAgIHZhciBfZCA9IGZhbHNlOwogICAgICAgICAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pID0gKDAsIF9nZXRJdGVyYXRvcjNbImRlZmF1bHQiXSkoYXJyKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKICAgICAgICAgICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgICAgICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfZCA9IHRydWU7CiAgICAgICAgICAgIF9lID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSkgX2lbInJldHVybiJdKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBfYXJyOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcnIsIGkpIHsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgICAgICAgICAgcmV0dXJuIGFycjsKICAgICAgICAgIH0gZWxzZSBpZiAoKDAsIF9pc0l0ZXJhYmxlM1siZGVmYXVsdCJdKShPYmplY3QoYXJyKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHNsaWNlSXRlcmF0b3IoYXJyLCBpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9KCk7CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE2NSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgICJkZWZhdWx0IjogX193ZWJwYWNrX3JlcXVpcmVfXygxNjYpLAogICAgICAgIF9fZXNNb2R1bGU6IHRydWUKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxNjYgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDI3KTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMjApOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2Nyk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTY3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGNsYXNzb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxKTsKCiAgICAgIHZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMikoJ2l0ZXJhdG9yJyk7CgogICAgICB2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkuaXNJdGVyYWJsZSA9IGZ1bmN0aW9uIChpdCkgewogICAgICAgIHZhciBPID0gT2JqZWN0KGl0KTsKICAgICAgICByZXR1cm4gT1tJVEVSQVRPUl0gIT09IHVuZGVmaW5lZCB8fCAnQEBpdGVyYXRvcicgaW4gTyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zCiAgICAgICAgfHwgSXRlcmF0b3JzLmhhc093blByb3BlcnR5KGNsYXNzb2YoTykpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxNjggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICAiZGVmYXVsdCI6IF9fd2VicGFja19yZXF1aXJlX18oMTY5KSwKICAgICAgICBfX2VzTW9kdWxlOiB0cnVlCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTY5ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygyNyk7CgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNzApOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE3MCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNik7CgogICAgICB2YXIgZ2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Mik7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkuZ2V0SXRlcmF0b3IgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICB2YXIgaXRlckZuID0gZ2V0KGl0KTsKICAgICAgICBpZiAodHlwZW9mIGl0ZXJGbiAhPSAnZnVuY3Rpb24nKSB0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBpdGVyYWJsZSEnKTsKICAgICAgICByZXR1cm4gYW5PYmplY3QoaXRlckZuLmNhbGwoaXQpKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTcxICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3Mik7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTcyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgdmFyIHV0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsKCiAgICAgIHZhciBiaW5kID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3Mik7CgogICAgICB2YXIgQXhpb3MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3Myk7CgogICAgICB2YXIgbWVyZ2VDb25maWcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc4KTsKCiAgICAgIHZhciBkZWZhdWx0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNzUpOwogICAgICAvKioKICAgICAgICogQ3JlYXRlIGFuIGluc3RhbmNlIG9mIEF4aW9zCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0Q29uZmlnIFRoZSBkZWZhdWx0IGNvbmZpZyBmb3IgdGhlIGluc3RhbmNlCiAgICAgICAqIEByZXR1cm4ge0F4aW9zfSBBIG5ldyBpbnN0YW5jZSBvZiBBeGlvcwogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBjcmVhdGVJbnN0YW5jZShkZWZhdWx0Q29uZmlnKSB7CiAgICAgICAgdmFyIGNvbnRleHQgPSBuZXcgQXhpb3MoZGVmYXVsdENvbmZpZyk7CiAgICAgICAgdmFyIGluc3RhbmNlID0gYmluZChBeGlvcy5wcm90b3R5cGUucmVxdWVzdCwgY29udGV4dCk7IC8vIENvcHkgYXhpb3MucHJvdG90eXBlIHRvIGluc3RhbmNlCgogICAgICAgIHV0aWxzLmV4dGVuZChpbnN0YW5jZSwgQXhpb3MucHJvdG90eXBlLCBjb250ZXh0KTsgLy8gQ29weSBjb250ZXh0IHRvIGluc3RhbmNlCgogICAgICAgIHV0aWxzLmV4dGVuZChpbnN0YW5jZSwgY29udGV4dCk7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlOwogICAgICB9IC8vIENyZWF0ZSB0aGUgZGVmYXVsdCBpbnN0YW5jZSB0byBiZSBleHBvcnRlZAoKCiAgICAgIHZhciBheGlvcyA9IGNyZWF0ZUluc3RhbmNlKGRlZmF1bHRzKTsgLy8gRXhwb3NlIEF4aW9zIGNsYXNzIHRvIGFsbG93IGNsYXNzIGluaGVyaXRhbmNlCgogICAgICBheGlvcy5BeGlvcyA9IEF4aW9zOyAvLyBGYWN0b3J5IGZvciBjcmVhdGluZyBuZXcgaW5zdGFuY2VzCgogICAgICBheGlvcy5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUoaW5zdGFuY2VDb25maWcpIHsKICAgICAgICByZXR1cm4gY3JlYXRlSW5zdGFuY2UobWVyZ2VDb25maWcoYXhpb3MuZGVmYXVsdHMsIGluc3RhbmNlQ29uZmlnKSk7CiAgICAgIH07IC8vIEV4cG9zZSBDYW5jZWwgJiBDYW5jZWxUb2tlbgoKCiAgICAgIGF4aW9zLkNhbmNlbCA9IF9fd2VicGFja19yZXF1aXJlX18oNzkpOwogICAgICBheGlvcy5DYW5jZWxUb2tlbiA9IF9fd2VicGFja19yZXF1aXJlX18oMTg2KTsKICAgICAgYXhpb3MuaXNDYW5jZWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc0KTsgLy8gRXhwb3NlIGFsbC9zcHJlYWQKCiAgICAgIGF4aW9zLmFsbCA9IGZ1bmN0aW9uIGFsbChwcm9taXNlcykgewogICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgICAgIH07CgogICAgICBheGlvcy5zcHJlYWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4Nyk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gYXhpb3M7IC8vIEFsbG93IHVzZSBvZiBkZWZhdWx0IGltcG9ydCBzeW50YXggaW4gVHlwZVNjcmlwdAoKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IGF4aW9zOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE3MyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciB1dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7CgogICAgICB2YXIgYnVpbGRVUkwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDczKTsKCiAgICAgIHZhciBJbnRlcmNlcHRvck1hbmFnZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3NCk7CgogICAgICB2YXIgZGlzcGF0Y2hSZXF1ZXN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNzUpOwoKICAgICAgdmFyIG1lcmdlQ29uZmlnID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3OCk7CiAgICAgIC8qKgogICAgICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgQXhpb3MKICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGluc3RhbmNlQ29uZmlnIFRoZSBkZWZhdWx0IGNvbmZpZyBmb3IgdGhlIGluc3RhbmNlCiAgICAgICAqLwoKCiAgICAgIGZ1bmN0aW9uIEF4aW9zKGluc3RhbmNlQ29uZmlnKSB7CiAgICAgICAgdGhpcy5kZWZhdWx0cyA9IGluc3RhbmNlQ29uZmlnOwogICAgICAgIHRoaXMuaW50ZXJjZXB0b3JzID0gewogICAgICAgICAgcmVxdWVzdDogbmV3IEludGVyY2VwdG9yTWFuYWdlcigpLAogICAgICAgICAgcmVzcG9uc2U6IG5ldyBJbnRlcmNlcHRvck1hbmFnZXIoKQogICAgICAgIH07CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIERpc3BhdGNoIGEgcmVxdWVzdAogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIFRoZSBjb25maWcgc3BlY2lmaWMgZm9yIHRoaXMgcmVxdWVzdCAobWVyZ2VkIHdpdGggdGhpcy5kZWZhdWx0cykKICAgICAgICovCgoKICAgICAgQXhpb3MucHJvdG90eXBlLnJlcXVlc3QgPSBmdW5jdGlvbiByZXF1ZXN0KGNvbmZpZykgewogICAgICAgIC8qZXNsaW50IG5vLXBhcmFtLXJlYXNzaWduOjAqLwogICAgICAgIC8vIEFsbG93IGZvciBheGlvcygnZXhhbXBsZS91cmwnWywgY29uZmlnXSkgYSBsYSBmZXRjaCBBUEkKICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIGNvbmZpZyA9IGFyZ3VtZW50c1sxXSB8fCB7fTsKICAgICAgICAgIGNvbmZpZy51cmwgPSBhcmd1bWVudHNbMF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTsKICAgICAgICB9CgogICAgICAgIGNvbmZpZyA9IG1lcmdlQ29uZmlnKHRoaXMuZGVmYXVsdHMsIGNvbmZpZyk7IC8vIFNldCBjb25maWcubWV0aG9kCgogICAgICAgIGlmIChjb25maWcubWV0aG9kKSB7CiAgICAgICAgICBjb25maWcubWV0aG9kID0gY29uZmlnLm1ldGhvZC50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5kZWZhdWx0cy5tZXRob2QpIHsKICAgICAgICAgIGNvbmZpZy5tZXRob2QgPSB0aGlzLmRlZmF1bHRzLm1ldGhvZC50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25maWcubWV0aG9kID0gJ2dldCc7CiAgICAgICAgfSAvLyBIb29rIHVwIGludGVyY2VwdG9ycyBtaWRkbGV3YXJlCgoKICAgICAgICB2YXIgY2hhaW4gPSBbZGlzcGF0Y2hSZXF1ZXN0LCB1bmRlZmluZWRdOwogICAgICAgIHZhciBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKGNvbmZpZyk7CiAgICAgICAgdGhpcy5pbnRlcmNlcHRvcnMucmVxdWVzdC5mb3JFYWNoKGZ1bmN0aW9uIHVuc2hpZnRSZXF1ZXN0SW50ZXJjZXB0b3JzKGludGVyY2VwdG9yKSB7CiAgICAgICAgICBjaGFpbi51bnNoaWZ0KGludGVyY2VwdG9yLmZ1bGZpbGxlZCwgaW50ZXJjZXB0b3IucmVqZWN0ZWQpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLmZvckVhY2goZnVuY3Rpb24gcHVzaFJlc3BvbnNlSW50ZXJjZXB0b3JzKGludGVyY2VwdG9yKSB7CiAgICAgICAgICBjaGFpbi5wdXNoKGludGVyY2VwdG9yLmZ1bGZpbGxlZCwgaW50ZXJjZXB0b3IucmVqZWN0ZWQpOwogICAgICAgIH0pOwoKICAgICAgICB3aGlsZSAoY2hhaW4ubGVuZ3RoKSB7CiAgICAgICAgICBwcm9taXNlID0gcHJvbWlzZS50aGVuKGNoYWluLnNoaWZ0KCksIGNoYWluLnNoaWZ0KCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHByb21pc2U7CiAgICAgIH07CgogICAgICBBeGlvcy5wcm90b3R5cGUuZ2V0VXJpID0gZnVuY3Rpb24gZ2V0VXJpKGNvbmZpZykgewogICAgICAgIGNvbmZpZyA9IG1lcmdlQ29uZmlnKHRoaXMuZGVmYXVsdHMsIGNvbmZpZyk7CiAgICAgICAgcmV0dXJuIGJ1aWxkVVJMKGNvbmZpZy51cmwsIGNvbmZpZy5wYXJhbXMsIGNvbmZpZy5wYXJhbXNTZXJpYWxpemVyKS5yZXBsYWNlKC9eXD8vLCAnJyk7CiAgICAgIH07IC8vIFByb3ZpZGUgYWxpYXNlcyBmb3Igc3VwcG9ydGVkIHJlcXVlc3QgbWV0aG9kcwoKCiAgICAgIHV0aWxzLmZvckVhY2goWydkZWxldGUnLCAnZ2V0JywgJ2hlYWQnLCAnb3B0aW9ucyddLCBmdW5jdGlvbiBmb3JFYWNoTWV0aG9kTm9EYXRhKG1ldGhvZCkgewogICAgICAgIC8qZXNsaW50IGZ1bmMtbmFtZXM6MCovCiAgICAgICAgQXhpb3MucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbiAodXJsLCBjb25maWcpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QodXRpbHMubWVyZ2UoY29uZmlnIHx8IHt9LCB7CiAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLAogICAgICAgICAgICB1cmw6IHVybAogICAgICAgICAgfSkpOwogICAgICAgIH07CiAgICAgIH0pOwogICAgICB1dGlscy5mb3JFYWNoKFsncG9zdCcsICdwdXQnLCAncGF0Y2gnXSwgZnVuY3Rpb24gZm9yRWFjaE1ldGhvZFdpdGhEYXRhKG1ldGhvZCkgewogICAgICAgIC8qZXNsaW50IGZ1bmMtbmFtZXM6MCovCiAgICAgICAgQXhpb3MucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbiAodXJsLCBkYXRhLCBjb25maWcpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QodXRpbHMubWVyZ2UoY29uZmlnIHx8IHt9LCB7CiAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLAogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgZGF0YTogZGF0YQogICAgICAgICAgfSkpOwogICAgICAgIH07CiAgICAgIH0pOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IEF4aW9zOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE3NCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciB1dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7CgogICAgICBmdW5jdGlvbiBJbnRlcmNlcHRvck1hbmFnZXIoKSB7CiAgICAgICAgdGhpcy5oYW5kbGVycyA9IFtdOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBBZGQgYSBuZXcgaW50ZXJjZXB0b3IgdG8gdGhlIHN0YWNrCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bGZpbGxlZCBUaGUgZnVuY3Rpb24gdG8gaGFuZGxlIGB0aGVuYCBmb3IgYSBgUHJvbWlzZWAKICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcmVqZWN0ZWQgVGhlIGZ1bmN0aW9uIHRvIGhhbmRsZSBgcmVqZWN0YCBmb3IgYSBgUHJvbWlzZWAKICAgICAgICoKICAgICAgICogQHJldHVybiB7TnVtYmVyfSBBbiBJRCB1c2VkIHRvIHJlbW92ZSBpbnRlcmNlcHRvciBsYXRlcgogICAgICAgKi8KCgogICAgICBJbnRlcmNlcHRvck1hbmFnZXIucHJvdG90eXBlLnVzZSA9IGZ1bmN0aW9uIHVzZShmdWxmaWxsZWQsIHJlamVjdGVkKSB7CiAgICAgICAgdGhpcy5oYW5kbGVycy5wdXNoKHsKICAgICAgICAgIGZ1bGZpbGxlZDogZnVsZmlsbGVkLAogICAgICAgICAgcmVqZWN0ZWQ6IHJlamVjdGVkCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlcnMubGVuZ3RoIC0gMTsKICAgICAgfTsKICAgICAgLyoqCiAgICAgICAqIFJlbW92ZSBhbiBpbnRlcmNlcHRvciBmcm9tIHRoZSBzdGFjawogICAgICAgKgogICAgICAgKiBAcGFyYW0ge051bWJlcn0gaWQgVGhlIElEIHRoYXQgd2FzIHJldHVybmVkIGJ5IGB1c2VgCiAgICAgICAqLwoKCiAgICAgIEludGVyY2VwdG9yTWFuYWdlci5wcm90b3R5cGUuZWplY3QgPSBmdW5jdGlvbiBlamVjdChpZCkgewogICAgICAgIGlmICh0aGlzLmhhbmRsZXJzW2lkXSkgewogICAgICAgICAgdGhpcy5oYW5kbGVyc1tpZF0gPSBudWxsOwogICAgICAgIH0KICAgICAgfTsKICAgICAgLyoqCiAgICAgICAqIEl0ZXJhdGUgb3ZlciBhbGwgdGhlIHJlZ2lzdGVyZWQgaW50ZXJjZXB0b3JzCiAgICAgICAqCiAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHBhcnRpY3VsYXJseSB1c2VmdWwgZm9yIHNraXBwaW5nIG92ZXIgYW55CiAgICAgICAqIGludGVyY2VwdG9ycyB0aGF0IG1heSBoYXZlIGJlY29tZSBgbnVsbGAgY2FsbGluZyBgZWplY3RgLgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gY2FsbCBmb3IgZWFjaCBpbnRlcmNlcHRvcgogICAgICAgKi8KCgogICAgICBJbnRlcmNlcHRvck1hbmFnZXIucHJvdG90eXBlLmZvckVhY2ggPSBmdW5jdGlvbiBmb3JFYWNoKGZuKSB7CiAgICAgICAgdXRpbHMuZm9yRWFjaCh0aGlzLmhhbmRsZXJzLCBmdW5jdGlvbiBmb3JFYWNoSGFuZGxlcihoKSB7CiAgICAgICAgICBpZiAoaCAhPT0gbnVsbCkgewogICAgICAgICAgICBmbihoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gSW50ZXJjZXB0b3JNYW5hZ2VyOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE3NSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciB1dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7CgogICAgICB2YXIgdHJhbnNmb3JtRGF0YSA9IF9fd2VicGFja19yZXF1aXJlX18oMTc2KTsKCiAgICAgIHZhciBpc0NhbmNlbCA9IF9fd2VicGFja19yZXF1aXJlX18oNzQpOwoKICAgICAgdmFyIGRlZmF1bHRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NSk7CiAgICAgIC8qKgogICAgICAgKiBUaHJvd3MgYSBgQ2FuY2VsYCBpZiBjYW5jZWxsYXRpb24gaGFzIGJlZW4gcmVxdWVzdGVkLgogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiB0aHJvd0lmQ2FuY2VsbGF0aW9uUmVxdWVzdGVkKGNvbmZpZykgewogICAgICAgIGlmIChjb25maWcuY2FuY2VsVG9rZW4pIHsKICAgICAgICAgIGNvbmZpZy5jYW5jZWxUb2tlbi50aHJvd0lmUmVxdWVzdGVkKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBEaXNwYXRjaCBhIHJlcXVlc3QgdG8gdGhlIHNlcnZlciB1c2luZyB0aGUgY29uZmlndXJlZCBhZGFwdGVyLgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge29iamVjdH0gY29uZmlnIFRoZSBjb25maWcgdGhhdCBpcyB0byBiZSB1c2VkIGZvciB0aGUgcmVxdWVzdAogICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gVGhlIFByb21pc2UgdG8gYmUgZnVsZmlsbGVkCiAgICAgICAqLwoKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gZGlzcGF0Y2hSZXF1ZXN0KGNvbmZpZykgewogICAgICAgIHRocm93SWZDYW5jZWxsYXRpb25SZXF1ZXN0ZWQoY29uZmlnKTsgLy8gRW5zdXJlIGhlYWRlcnMgZXhpc3QKCiAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTsgLy8gVHJhbnNmb3JtIHJlcXVlc3QgZGF0YQoKICAgICAgICBjb25maWcuZGF0YSA9IHRyYW5zZm9ybURhdGEoY29uZmlnLmRhdGEsIGNvbmZpZy5oZWFkZXJzLCBjb25maWcudHJhbnNmb3JtUmVxdWVzdCk7IC8vIEZsYXR0ZW4gaGVhZGVycwoKICAgICAgICBjb25maWcuaGVhZGVycyA9IHV0aWxzLm1lcmdlKGNvbmZpZy5oZWFkZXJzLmNvbW1vbiB8fCB7fSwgY29uZmlnLmhlYWRlcnNbY29uZmlnLm1ldGhvZF0gfHwge30sIGNvbmZpZy5oZWFkZXJzKTsKICAgICAgICB1dGlscy5mb3JFYWNoKFsnZGVsZXRlJywgJ2dldCcsICdoZWFkJywgJ3Bvc3QnLCAncHV0JywgJ3BhdGNoJywgJ2NvbW1vbiddLCBmdW5jdGlvbiBjbGVhbkhlYWRlckNvbmZpZyhtZXRob2QpIHsKICAgICAgICAgIGRlbGV0ZSBjb25maWcuaGVhZGVyc1ttZXRob2RdOwogICAgICAgIH0pOwogICAgICAgIHZhciBhZGFwdGVyID0gY29uZmlnLmFkYXB0ZXIgfHwgZGVmYXVsdHMuYWRhcHRlcjsKICAgICAgICByZXR1cm4gYWRhcHRlcihjb25maWcpLnRoZW4oZnVuY3Rpb24gb25BZGFwdGVyUmVzb2x1dGlvbihyZXNwb25zZSkgewogICAgICAgICAgdGhyb3dJZkNhbmNlbGxhdGlvblJlcXVlc3RlZChjb25maWcpOyAvLyBUcmFuc2Zvcm0gcmVzcG9uc2UgZGF0YQoKICAgICAgICAgIHJlc3BvbnNlLmRhdGEgPSB0cmFuc2Zvcm1EYXRhKHJlc3BvbnNlLmRhdGEsIHJlc3BvbnNlLmhlYWRlcnMsIGNvbmZpZy50cmFuc2Zvcm1SZXNwb25zZSk7CiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICAgICAgfSwgZnVuY3Rpb24gb25BZGFwdGVyUmVqZWN0aW9uKHJlYXNvbikgewogICAgICAgICAgaWYgKCFpc0NhbmNlbChyZWFzb24pKSB7CiAgICAgICAgICAgIHRocm93SWZDYW5jZWxsYXRpb25SZXF1ZXN0ZWQoY29uZmlnKTsgLy8gVHJhbnNmb3JtIHJlc3BvbnNlIGRhdGEKCiAgICAgICAgICAgIGlmIChyZWFzb24gJiYgcmVhc29uLnJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgcmVhc29uLnJlc3BvbnNlLmRhdGEgPSB0cmFuc2Zvcm1EYXRhKHJlYXNvbi5yZXNwb25zZS5kYXRhLCByZWFzb24ucmVzcG9uc2UuaGVhZGVycywgY29uZmlnLnRyYW5zZm9ybVJlc3BvbnNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZWFzb24pOwogICAgICAgIH0pOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxNzYgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOwogICAgICAvKioKICAgICAgICogVHJhbnNmb3JtIHRoZSBkYXRhIGZvciBhIHJlcXVlc3Qgb3IgYSByZXNwb25zZQogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdHxTdHJpbmd9IGRhdGEgVGhlIGRhdGEgdG8gYmUgdHJhbnNmb3JtZWQKICAgICAgICogQHBhcmFtIHtBcnJheX0gaGVhZGVycyBUaGUgaGVhZGVycyBmb3IgdGhlIHJlcXVlc3Qgb3IgcmVzcG9uc2UKICAgICAgICogQHBhcmFtIHtBcnJheXxGdW5jdGlvbn0gZm5zIEEgc2luZ2xlIGZ1bmN0aW9uIG9yIEFycmF5IG9mIGZ1bmN0aW9ucwogICAgICAgKiBAcmV0dXJucyB7Kn0gVGhlIHJlc3VsdGluZyB0cmFuc2Zvcm1lZCBkYXRhCiAgICAgICAqLwoKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gdHJhbnNmb3JtRGF0YShkYXRhLCBoZWFkZXJzLCBmbnMpIHsKICAgICAgICAvKmVzbGludCBuby1wYXJhbS1yZWFzc2lnbjowKi8KICAgICAgICB1dGlscy5mb3JFYWNoKGZucywgZnVuY3Rpb24gdHJhbnNmb3JtKGZuKSB7CiAgICAgICAgICBkYXRhID0gZm4oZGF0YSwgaGVhZGVycyk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE3NyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciB1dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIG5vcm1hbGl6ZUhlYWRlck5hbWUoaGVhZGVycywgbm9ybWFsaXplZE5hbWUpIHsKICAgICAgICB1dGlscy5mb3JFYWNoKGhlYWRlcnMsIGZ1bmN0aW9uIHByb2Nlc3NIZWFkZXIodmFsdWUsIG5hbWUpIHsKICAgICAgICAgIGlmIChuYW1lICE9PSBub3JtYWxpemVkTmFtZSAmJiBuYW1lLnRvVXBwZXJDYXNlKCkgPT09IG5vcm1hbGl6ZWROYW1lLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgICAgICAgaGVhZGVyc1tub3JtYWxpemVkTmFtZV0gPSB2YWx1ZTsKICAgICAgICAgICAgZGVsZXRlIGhlYWRlcnNbbmFtZV07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE3OCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciBjcmVhdGVFcnJvciA9IF9fd2VicGFja19yZXF1aXJlX18oNzcpOwogICAgICAvKioKICAgICAgICogUmVzb2x2ZSBvciByZWplY3QgYSBQcm9taXNlIGJhc2VkIG9uIHJlc3BvbnNlIHN0YXR1cy4KICAgICAgICoKICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcmVzb2x2ZSBBIGZ1bmN0aW9uIHRoYXQgcmVzb2x2ZXMgdGhlIHByb21pc2UuCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlamVjdCBBIGZ1bmN0aW9uIHRoYXQgcmVqZWN0cyB0aGUgcHJvbWlzZS4KICAgICAgICogQHBhcmFtIHtvYmplY3R9IHJlc3BvbnNlIFRoZSByZXNwb25zZS4KICAgICAgICovCgoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCByZXNwb25zZSkgewogICAgICAgIHZhciB2YWxpZGF0ZVN0YXR1cyA9IHJlc3BvbnNlLmNvbmZpZy52YWxpZGF0ZVN0YXR1czsKCiAgICAgICAgaWYgKCF2YWxpZGF0ZVN0YXR1cyB8fCB2YWxpZGF0ZVN0YXR1cyhyZXNwb25zZS5zdGF0dXMpKSB7CiAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVqZWN0KGNyZWF0ZUVycm9yKCdSZXF1ZXN0IGZhaWxlZCB3aXRoIHN0YXR1cyBjb2RlICcgKyByZXNwb25zZS5zdGF0dXMsIHJlc3BvbnNlLmNvbmZpZywgbnVsbCwgcmVzcG9uc2UucmVxdWVzdCwgcmVzcG9uc2UpKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE3OSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgLyoqCiAgICAgICAqIFVwZGF0ZSBhbiBFcnJvciB3aXRoIHRoZSBzcGVjaWZpZWQgY29uZmlnLCBlcnJvciBjb2RlLCBhbmQgcmVzcG9uc2UuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7RXJyb3J9IGVycm9yIFRoZSBlcnJvciB0byB1cGRhdGUuCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIGNvbmZpZy4KICAgICAgICogQHBhcmFtIHtzdHJpbmd9IFtjb2RlXSBUaGUgZXJyb3IgY29kZSAoZm9yIGV4YW1wbGUsICdFQ09OTkFCT1JURUQnKS4KICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtyZXF1ZXN0XSBUaGUgcmVxdWVzdC4KICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtyZXNwb25zZV0gVGhlIHJlc3BvbnNlLgogICAgICAgKiBAcmV0dXJucyB7RXJyb3J9IFRoZSBlcnJvci4KICAgICAgICovCgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGVuaGFuY2VFcnJvcihlcnJvciwgY29uZmlnLCBjb2RlLCByZXF1ZXN0LCByZXNwb25zZSkgewogICAgICAgIGVycm9yLmNvbmZpZyA9IGNvbmZpZzsKCiAgICAgICAgaWYgKGNvZGUpIHsKICAgICAgICAgIGVycm9yLmNvZGUgPSBjb2RlOwogICAgICAgIH0KCiAgICAgICAgZXJyb3IucmVxdWVzdCA9IHJlcXVlc3Q7CiAgICAgICAgZXJyb3IucmVzcG9uc2UgPSByZXNwb25zZTsKICAgICAgICBlcnJvci5pc0F4aW9zRXJyb3IgPSB0cnVlOwoKICAgICAgICBlcnJvci50b0pTT04gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAvLyBTdGFuZGFyZAogICAgICAgICAgICBtZXNzYWdlOiB0aGlzLm1lc3NhZ2UsCiAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSwKICAgICAgICAgICAgLy8gTWljcm9zb2Z0CiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLAogICAgICAgICAgICBudW1iZXI6IHRoaXMubnVtYmVyLAogICAgICAgICAgICAvLyBNb3ppbGxhCiAgICAgICAgICAgIGZpbGVOYW1lOiB0aGlzLmZpbGVOYW1lLAogICAgICAgICAgICBsaW5lTnVtYmVyOiB0aGlzLmxpbmVOdW1iZXIsCiAgICAgICAgICAgIGNvbHVtbk51bWJlcjogdGhpcy5jb2x1bW5OdW1iZXIsCiAgICAgICAgICAgIHN0YWNrOiB0aGlzLnN0YWNrLAogICAgICAgICAgICAvLyBBeGlvcwogICAgICAgICAgICBjb25maWc6IHRoaXMuY29uZmlnLAogICAgICAgICAgICBjb2RlOiB0aGlzLmNvZGUKICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGVycm9yOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxODAgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgaXNBYnNvbHV0ZVVSTCA9IF9fd2VicGFja19yZXF1aXJlX18oMTgxKTsKCiAgICAgIHZhciBjb21iaW5lVVJMcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTgyKTsKICAgICAgLyoqCiAgICAgICAqIENyZWF0ZXMgYSBuZXcgVVJMIGJ5IGNvbWJpbmluZyB0aGUgYmFzZVVSTCB3aXRoIHRoZSByZXF1ZXN0ZWRVUkwsCiAgICAgICAqIG9ubHkgd2hlbiB0aGUgcmVxdWVzdGVkVVJMIGlzIG5vdCBhbHJlYWR5IGFuIGFic29sdXRlIFVSTC4KICAgICAgICogSWYgdGhlIHJlcXVlc3RVUkwgaXMgYWJzb2x1dGUsIHRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgcmVxdWVzdGVkVVJMIHVudG91Y2hlZC4KICAgICAgICoKICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGJhc2VVUkwgVGhlIGJhc2UgVVJMCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSByZXF1ZXN0ZWRVUkwgQWJzb2x1dGUgb3IgcmVsYXRpdmUgVVJMIHRvIGNvbWJpbmUKICAgICAgICogQHJldHVybnMge3N0cmluZ30gVGhlIGNvbWJpbmVkIGZ1bGwgcGF0aAogICAgICAgKi8KCgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGJ1aWxkRnVsbFBhdGgoYmFzZVVSTCwgcmVxdWVzdGVkVVJMKSB7CiAgICAgICAgaWYgKGJhc2VVUkwgJiYgIWlzQWJzb2x1dGVVUkwocmVxdWVzdGVkVVJMKSkgewogICAgICAgICAgcmV0dXJuIGNvbWJpbmVVUkxzKGJhc2VVUkwsIHJlcXVlc3RlZFVSTCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVxdWVzdGVkVVJMOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxODEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHNwZWNpZmllZCBVUkwgaXMgYWJzb2x1dGUKICAgICAgICoKICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBUaGUgVVJMIHRvIHRlc3QKICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIHNwZWNpZmllZCBVUkwgaXMgYWJzb2x1dGUsIG90aGVyd2lzZSBmYWxzZQogICAgICAgKi8KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gaXNBYnNvbHV0ZVVSTCh1cmwpIHsKICAgICAgICAvLyBBIFVSTCBpcyBjb25zaWRlcmVkIGFic29sdXRlIGlmIGl0IGJlZ2lucyB3aXRoICI8c2NoZW1lPjovLyIgb3IgIi8vIiAocHJvdG9jb2wtcmVsYXRpdmUgVVJMKS4KICAgICAgICAvLyBSRkMgMzk4NiBkZWZpbmVzIHNjaGVtZSBuYW1lIGFzIGEgc2VxdWVuY2Ugb2YgY2hhcmFjdGVycyBiZWdpbm5pbmcgd2l0aCBhIGxldHRlciBhbmQgZm9sbG93ZWQKICAgICAgICAvLyBieSBhbnkgY29tYmluYXRpb24gb2YgbGV0dGVycywgZGlnaXRzLCBwbHVzLCBwZXJpb2QsIG9yIGh5cGhlbi4KICAgICAgICByZXR1cm4gL14oW2Etel1bYS16XGRcK1wtXC5dKjopP1wvXC8vaS50ZXN0KHVybCk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE4MiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgLyoqCiAgICAgICAqIENyZWF0ZXMgYSBuZXcgVVJMIGJ5IGNvbWJpbmluZyB0aGUgc3BlY2lmaWVkIFVSTHMKICAgICAgICoKICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGJhc2VVUkwgVGhlIGJhc2UgVVJMCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSByZWxhdGl2ZVVSTCBUaGUgcmVsYXRpdmUgVVJMCiAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBjb21iaW5lZCBVUkwKICAgICAgICovCgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGNvbWJpbmVVUkxzKGJhc2VVUkwsIHJlbGF0aXZlVVJMKSB7CiAgICAgICAgcmV0dXJuIHJlbGF0aXZlVVJMID8gYmFzZVVSTC5yZXBsYWNlKC9cLyskLywgJycpICsgJy8nICsgcmVsYXRpdmVVUkwucmVwbGFjZSgvXlwvKy8sICcnKSA6IGJhc2VVUkw7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE4MyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciB1dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7IC8vIEhlYWRlcnMgd2hvc2UgZHVwbGljYXRlcyBhcmUgaWdub3JlZCBieSBub2RlCiAgICAgIC8vIGMuZi4gaHR0cHM6Ly9ub2RlanMub3JnL2FwaS9odHRwLmh0bWwjaHR0cF9tZXNzYWdlX2hlYWRlcnMKCgogICAgICB2YXIgaWdub3JlRHVwbGljYXRlT2YgPSBbJ2FnZScsICdhdXRob3JpemF0aW9uJywgJ2NvbnRlbnQtbGVuZ3RoJywgJ2NvbnRlbnQtdHlwZScsICdldGFnJywgJ2V4cGlyZXMnLCAnZnJvbScsICdob3N0JywgJ2lmLW1vZGlmaWVkLXNpbmNlJywgJ2lmLXVubW9kaWZpZWQtc2luY2UnLCAnbGFzdC1tb2RpZmllZCcsICdsb2NhdGlvbicsICdtYXgtZm9yd2FyZHMnLCAncHJveHktYXV0aG9yaXphdGlvbicsICdyZWZlcmVyJywgJ3JldHJ5LWFmdGVyJywgJ3VzZXItYWdlbnQnXTsKICAgICAgLyoqCiAgICAgICAqIFBhcnNlIGhlYWRlcnMgaW50byBhbiBvYmplY3QKICAgICAgICoKICAgICAgICogYGBgCiAgICAgICAqIERhdGU6IFdlZCwgMjcgQXVnIDIwMTQgMDg6NTg6NDkgR01UCiAgICAgICAqIENvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvbgogICAgICAgKiBDb25uZWN0aW9uOiBrZWVwLWFsaXZlCiAgICAgICAqIFRyYW5zZmVyLUVuY29kaW5nOiBjaHVua2VkCiAgICAgICAqIGBgYAogICAgICAgKgogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaGVhZGVycyBIZWFkZXJzIG5lZWRpbmcgdG8gYmUgcGFyc2VkCiAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IEhlYWRlcnMgcGFyc2VkIGludG8gYW4gb2JqZWN0CiAgICAgICAqLwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBwYXJzZUhlYWRlcnMoaGVhZGVycykgewogICAgICAgIHZhciBwYXJzZWQgPSB7fTsKICAgICAgICB2YXIga2V5OwogICAgICAgIHZhciB2YWw7CiAgICAgICAgdmFyIGk7CgogICAgICAgIGlmICghaGVhZGVycykgewogICAgICAgICAgcmV0dXJuIHBhcnNlZDsKICAgICAgICB9CgogICAgICAgIHV0aWxzLmZvckVhY2goaGVhZGVycy5zcGxpdCgnXG4nKSwgZnVuY3Rpb24gcGFyc2VyKGxpbmUpIHsKICAgICAgICAgIGkgPSBsaW5lLmluZGV4T2YoJzonKTsKICAgICAgICAgIGtleSA9IHV0aWxzLnRyaW0obGluZS5zdWJzdHIoMCwgaSkpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICB2YWwgPSB1dGlscy50cmltKGxpbmUuc3Vic3RyKGkgKyAxKSk7CgogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBpZiAocGFyc2VkW2tleV0gJiYgaWdub3JlRHVwbGljYXRlT2YuaW5kZXhPZihrZXkpID49IDApIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChrZXkgPT09ICdzZXQtY29va2llJykgewogICAgICAgICAgICAgIHBhcnNlZFtrZXldID0gKHBhcnNlZFtrZXldID8gcGFyc2VkW2tleV0gOiBbXSkuY29uY2F0KFt2YWxdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBwYXJzZWRba2V5XSA9IHBhcnNlZFtrZXldID8gcGFyc2VkW2tleV0gKyAnLCAnICsgdmFsIDogdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHBhcnNlZDsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTg0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgdmFyIHV0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gdXRpbHMuaXNTdGFuZGFyZEJyb3dzZXJFbnYoKSA/IC8vIFN0YW5kYXJkIGJyb3dzZXIgZW52cyBoYXZlIGZ1bGwgc3VwcG9ydCBvZiB0aGUgQVBJcyBuZWVkZWQgdG8gdGVzdAogICAgICAvLyB3aGV0aGVyIHRoZSByZXF1ZXN0IFVSTCBpcyBvZiB0aGUgc2FtZSBvcmlnaW4gYXMgY3VycmVudCBsb2NhdGlvbi4KICAgICAgZnVuY3Rpb24gc3RhbmRhcmRCcm93c2VyRW52KCkgewogICAgICAgIHZhciBtc2llID0gLyhtc2llfHRyaWRlbnQpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsKICAgICAgICB2YXIgdXJsUGFyc2luZ05vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgdmFyIG9yaWdpblVSTDsKICAgICAgICAvKioKICAgICAgICAqIFBhcnNlIGEgVVJMIHRvIGRpc2NvdmVyIGl0J3MgY29tcG9uZW50cwogICAgICAgICoKICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgVGhlIFVSTCB0byBiZSBwYXJzZWQKICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9CiAgICAgICAgKi8KCiAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZVVSTCh1cmwpIHsKICAgICAgICAgIHZhciBocmVmID0gdXJsOwoKICAgICAgICAgIGlmIChtc2llKSB7CiAgICAgICAgICAgIC8vIElFIG5lZWRzIGF0dHJpYnV0ZSBzZXQgdHdpY2UgdG8gbm9ybWFsaXplIHByb3BlcnRpZXMKICAgICAgICAgICAgdXJsUGFyc2luZ05vZGUuc2V0QXR0cmlidXRlKCdocmVmJywgaHJlZik7CiAgICAgICAgICAgIGhyZWYgPSB1cmxQYXJzaW5nTm9kZS5ocmVmOwogICAgICAgICAgfQoKICAgICAgICAgIHVybFBhcnNpbmdOb2RlLnNldEF0dHJpYnV0ZSgnaHJlZicsIGhyZWYpOyAvLyB1cmxQYXJzaW5nTm9kZSBwcm92aWRlcyB0aGUgVXJsVXRpbHMgaW50ZXJmYWNlIC0gaHR0cDovL3VybC5zcGVjLndoYXR3Zy5vcmcvI3VybHV0aWxzCgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaHJlZjogdXJsUGFyc2luZ05vZGUuaHJlZiwKICAgICAgICAgICAgcHJvdG9jb2w6IHVybFBhcnNpbmdOb2RlLnByb3RvY29sID8gdXJsUGFyc2luZ05vZGUucHJvdG9jb2wucmVwbGFjZSgvOiQvLCAnJykgOiAnJywKICAgICAgICAgICAgaG9zdDogdXJsUGFyc2luZ05vZGUuaG9zdCwKICAgICAgICAgICAgc2VhcmNoOiB1cmxQYXJzaW5nTm9kZS5zZWFyY2ggPyB1cmxQYXJzaW5nTm9kZS5zZWFyY2gucmVwbGFjZSgvXlw/LywgJycpIDogJycsCiAgICAgICAgICAgIGhhc2g6IHVybFBhcnNpbmdOb2RlLmhhc2ggPyB1cmxQYXJzaW5nTm9kZS5oYXNoLnJlcGxhY2UoL14jLywgJycpIDogJycsCiAgICAgICAgICAgIGhvc3RuYW1lOiB1cmxQYXJzaW5nTm9kZS5ob3N0bmFtZSwKICAgICAgICAgICAgcG9ydDogdXJsUGFyc2luZ05vZGUucG9ydCwKICAgICAgICAgICAgcGF0aG5hbWU6IHVybFBhcnNpbmdOb2RlLnBhdGhuYW1lLmNoYXJBdCgwKSA9PT0gJy8nID8gdXJsUGFyc2luZ05vZGUucGF0aG5hbWUgOiAnLycgKyB1cmxQYXJzaW5nTm9kZS5wYXRobmFtZQogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIG9yaWdpblVSTCA9IHJlc29sdmVVUkwod2luZG93LmxvY2F0aW9uLmhyZWYpOwogICAgICAgIC8qKgogICAgICAgICogRGV0ZXJtaW5lIGlmIGEgVVJMIHNoYXJlcyB0aGUgc2FtZSBvcmlnaW4gYXMgdGhlIGN1cnJlbnQgbG9jYXRpb24KICAgICAgICAqCiAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcmVxdWVzdFVSTCBUaGUgVVJMIHRvIHRlc3QKICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIFVSTCBzaGFyZXMgdGhlIHNhbWUgb3JpZ2luLCBvdGhlcndpc2UgZmFsc2UKICAgICAgICAqLwoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gaXNVUkxTYW1lT3JpZ2luKHJlcXVlc3RVUkwpIHsKICAgICAgICAgIHZhciBwYXJzZWQgPSB1dGlscy5pc1N0cmluZyhyZXF1ZXN0VVJMKSA/IHJlc29sdmVVUkwocmVxdWVzdFVSTCkgOiByZXF1ZXN0VVJMOwogICAgICAgICAgcmV0dXJuIHBhcnNlZC5wcm90b2NvbCA9PT0gb3JpZ2luVVJMLnByb3RvY29sICYmIHBhcnNlZC5ob3N0ID09PSBvcmlnaW5VUkwuaG9zdDsKICAgICAgICB9OwogICAgICB9KCkgOiAvLyBOb24gc3RhbmRhcmQgYnJvd3NlciBlbnZzICh3ZWIgd29ya2VycywgcmVhY3QtbmF0aXZlKSBsYWNrIG5lZWRlZCBzdXBwb3J0LgogICAgICBmdW5jdGlvbiBub25TdGFuZGFyZEJyb3dzZXJFbnYoKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGlzVVJMU2FtZU9yaWdpbigpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH07CiAgICAgIH0oKTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxODUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB1dGlscy5pc1N0YW5kYXJkQnJvd3NlckVudigpID8gLy8gU3RhbmRhcmQgYnJvd3NlciBlbnZzIHN1cHBvcnQgZG9jdW1lbnQuY29va2llCiAgICAgIGZ1bmN0aW9uIHN0YW5kYXJkQnJvd3NlckVudigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgd3JpdGU6IGZ1bmN0aW9uIHdyaXRlKG5hbWUsIHZhbHVlLCBleHBpcmVzLCBwYXRoLCBkb21haW4sIHNlY3VyZSkgewogICAgICAgICAgICB2YXIgY29va2llID0gW107CiAgICAgICAgICAgIGNvb2tpZS5wdXNoKG5hbWUgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKTsKCiAgICAgICAgICAgIGlmICh1dGlscy5pc051bWJlcihleHBpcmVzKSkgewogICAgICAgICAgICAgIGNvb2tpZS5wdXNoKCdleHBpcmVzPScgKyBuZXcgRGF0ZShleHBpcmVzKS50b0dNVFN0cmluZygpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHV0aWxzLmlzU3RyaW5nKHBhdGgpKSB7CiAgICAgICAgICAgICAgY29va2llLnB1c2goJ3BhdGg9JyArIHBhdGgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodXRpbHMuaXNTdHJpbmcoZG9tYWluKSkgewogICAgICAgICAgICAgIGNvb2tpZS5wdXNoKCdkb21haW49JyArIGRvbWFpbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWN1cmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICBjb29raWUucHVzaCgnc2VjdXJlJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZS5qb2luKCc7ICcpOwogICAgICAgICAgfSwKICAgICAgICAgIHJlYWQ6IGZ1bmN0aW9uIHJlYWQobmFtZSkgewogICAgICAgICAgICB2YXIgbWF0Y2ggPSBkb2N1bWVudC5jb29raWUubWF0Y2gobmV3IFJlZ0V4cCgnKF58O1xccyopKCcgKyBuYW1lICsgJyk9KFteO10qKScpKTsKICAgICAgICAgICAgcmV0dXJuIG1hdGNoID8gZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoWzNdKSA6IG51bGw7CiAgICAgICAgICB9LAogICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUobmFtZSkgewogICAgICAgICAgICB0aGlzLndyaXRlKG5hbWUsICcnLCBEYXRlLm5vdygpIC0gODY0MDAwMDApOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0oKSA6IC8vIE5vbiBzdGFuZGFyZCBicm93c2VyIGVudiAod2ViIHdvcmtlcnMsIHJlYWN0LW5hdGl2ZSkgbGFjayBuZWVkZWQgc3VwcG9ydC4KICAgICAgZnVuY3Rpb24gbm9uU3RhbmRhcmRCcm93c2VyRW52KCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB3cml0ZTogZnVuY3Rpb24gd3JpdGUoKSB7fSwKICAgICAgICAgIHJlYWQ6IGZ1bmN0aW9uIHJlYWQoKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfSwKICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKCkge30KICAgICAgICB9OwogICAgICB9KCk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTg2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgdmFyIENhbmNlbCA9IF9fd2VicGFja19yZXF1aXJlX18oNzkpOwogICAgICAvKioKICAgICAgICogQSBgQ2FuY2VsVG9rZW5gIGlzIGFuIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIHJlcXVlc3QgY2FuY2VsbGF0aW9uIG9mIGFuIG9wZXJhdGlvbi4KICAgICAgICoKICAgICAgICogQGNsYXNzCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGV4ZWN1dG9yIFRoZSBleGVjdXRvciBmdW5jdGlvbi4KICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gQ2FuY2VsVG9rZW4oZXhlY3V0b3IpIHsKICAgICAgICBpZiAodHlwZW9mIGV4ZWN1dG9yICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdleGVjdXRvciBtdXN0IGJlIGEgZnVuY3Rpb24uJyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVzb2x2ZVByb21pc2U7CiAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gcHJvbWlzZUV4ZWN1dG9yKHJlc29sdmUpIHsKICAgICAgICAgIHJlc29sdmVQcm9taXNlID0gcmVzb2x2ZTsKICAgICAgICB9KTsKICAgICAgICB2YXIgdG9rZW4gPSB0aGlzOwogICAgICAgIGV4ZWN1dG9yKGZ1bmN0aW9uIGNhbmNlbChtZXNzYWdlKSB7CiAgICAgICAgICBpZiAodG9rZW4ucmVhc29uKSB7CiAgICAgICAgICAgIC8vIENhbmNlbGxhdGlvbiBoYXMgYWxyZWFkeSBiZWVuIHJlcXVlc3RlZAogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdG9rZW4ucmVhc29uID0gbmV3IENhbmNlbChtZXNzYWdlKTsKICAgICAgICAgIHJlc29sdmVQcm9taXNlKHRva2VuLnJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIFRocm93cyBhIGBDYW5jZWxgIGlmIGNhbmNlbGxhdGlvbiBoYXMgYmVlbiByZXF1ZXN0ZWQuCiAgICAgICAqLwoKCiAgICAgIENhbmNlbFRva2VuLnByb3RvdHlwZS50aHJvd0lmUmVxdWVzdGVkID0gZnVuY3Rpb24gdGhyb3dJZlJlcXVlc3RlZCgpIHsKICAgICAgICBpZiAodGhpcy5yZWFzb24pIHsKICAgICAgICAgIHRocm93IHRoaXMucmVhc29uOwogICAgICAgIH0KICAgICAgfTsKICAgICAgLyoqCiAgICAgICAqIFJldHVybnMgYW4gb2JqZWN0IHRoYXQgY29udGFpbnMgYSBuZXcgYENhbmNlbFRva2VuYCBhbmQgYSBmdW5jdGlvbiB0aGF0LCB3aGVuIGNhbGxlZCwKICAgICAgICogY2FuY2VscyB0aGUgYENhbmNlbFRva2VuYC4KICAgICAgICovCgoKICAgICAgQ2FuY2VsVG9rZW4uc291cmNlID0gZnVuY3Rpb24gc291cmNlKCkgewogICAgICAgIHZhciBjYW5jZWw7CiAgICAgICAgdmFyIHRva2VuID0gbmV3IENhbmNlbFRva2VuKGZ1bmN0aW9uIGV4ZWN1dG9yKGMpIHsKICAgICAgICAgIGNhbmNlbCA9IGM7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRva2VuOiB0b2tlbiwKICAgICAgICAgIGNhbmNlbDogY2FuY2VsCiAgICAgICAgfTsKICAgICAgfTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gQ2FuY2VsVG9rZW47CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTg3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICAvKioKICAgICAgICogU3ludGFjdGljIHN1Z2FyIGZvciBpbnZva2luZyBhIGZ1bmN0aW9uIGFuZCBleHBhbmRpbmcgYW4gYXJyYXkgZm9yIGFyZ3VtZW50cy4KICAgICAgICoKICAgICAgICogQ29tbW9uIHVzZSBjYXNlIHdvdWxkIGJlIHRvIHVzZSBgRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5YC4KICAgICAgICoKICAgICAgICogIGBgYGpzCiAgICAgICAqICBmdW5jdGlvbiBmKHgsIHksIHopIHt9CiAgICAgICAqICB2YXIgYXJncyA9IFsxLCAyLCAzXTsKICAgICAgICogIGYuYXBwbHkobnVsbCwgYXJncyk7CiAgICAgICAqICBgYGAKICAgICAgICoKICAgICAgICogV2l0aCBgc3ByZWFkYCB0aGlzIGV4YW1wbGUgY2FuIGJlIHJlLXdyaXR0ZW4uCiAgICAgICAqCiAgICAgICAqICBgYGBqcwogICAgICAgKiAgc3ByZWFkKGZ1bmN0aW9uKHgsIHksIHopIHt9KShbMSwgMiwgM10pOwogICAgICAgKiAgYGBgCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0KICAgICAgICovCgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHNwcmVhZChjYWxsYmFjaykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiB3cmFwKGFycikgewogICAgICAgICAgcmV0dXJuIGNhbGxiYWNrLmFwcGx5KG51bGwsIGFycik7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTg4ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwoKICAgICAgdmFyIF9yZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgogICAgICB2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTsKCiAgICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgICAgICAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgICAgICAgICJkZWZhdWx0Ijogb2JqCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICB2YXIgY2xhc3NOYW1lID0gX3JlZi5jbGFzc05hbWUsCiAgICAgICAgICAgIGdldFJlZiA9IF9yZWYuZ2V0UmVmLAogICAgICAgICAgICBvbkNsaWNrID0gX3JlZi5vbkNsaWNrLAogICAgICAgICAgICBvbk1vdXNlRG93biA9IF9yZWYub25Nb3VzZURvd24sCiAgICAgICAgICAgIHRleHQgPSBfcmVmLnRleHQsCiAgICAgICAgICAgIGlzTG9hZGluZyA9IF9yZWYuaXNMb2FkaW5nOwogICAgICAgIHJldHVybiBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgewogICAgICAgICAgcmVmOiBmdW5jdGlvbiByZWYoZWwpIHsKICAgICAgICAgICAgcmV0dXJuIGdldFJlZiAmJiBnZXRSZWYoZWwpOwogICAgICAgICAgfSwKICAgICAgICAgIGNsYXNzTmFtZTogImd0LWJ0biAiICsgY2xhc3NOYW1lLAogICAgICAgICAgb25DbGljazogb25DbGljaywKICAgICAgICAgIG9uTW91c2VEb3duOiBvbk1vdXNlRG93bgogICAgICAgIH0sIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICAgY2xhc3NOYW1lOiAiZ3QtYnRuLXRleHQiCiAgICAgICAgfSwgdGV4dCksIGlzTG9hZGluZyAmJiBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgic3BhbiIsIHsKICAgICAgICAgIGNsYXNzTmFtZTogImd0LWJ0bi1sb2FkaW5nIGd0LXNwaW5uZXIiCiAgICAgICAgfSkpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxODkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CgogICAgICB2YXIgX3JlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsKCiAgICAgIHZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3QpOwoKICAgICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICAgICAgICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgICAgICAgImRlZmF1bHQiOiBvYmoKICAgICAgICB9OwogICAgICB9CgogICAgICBleHBvcnRzWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiAoX3JlZikgewogICAgICAgIHZhciBjbGFzc05hbWUgPSBfcmVmLmNsYXNzTmFtZSwKICAgICAgICAgICAgb25DbGljayA9IF9yZWYub25DbGljaywKICAgICAgICAgICAgdGV4dCA9IF9yZWYudGV4dDsKICAgICAgICByZXR1cm4gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoImEiLCB7CiAgICAgICAgICBjbGFzc05hbWU6ICJndC1hY3Rpb24gIiArIGNsYXNzTmFtZSwKICAgICAgICAgIG9uQ2xpY2s6IG9uQ2xpY2sKICAgICAgICB9LCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgic3BhbiIsIHsKICAgICAgICAgIGNsYXNzTmFtZTogImd0LWFjdGlvbi10ZXh0IgogICAgICAgIH0sIHRleHQpKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTkwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwoKICAgICAgdmFyIF9nZXRQcm90b3R5cGVPZiA9IF9fd2VicGFja19yZXF1aXJlX18oNjQpOwoKICAgICAgdmFyIF9nZXRQcm90b3R5cGVPZjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9nZXRQcm90b3R5cGVPZik7CgogICAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMiA9IF9fd2VicGFja19yZXF1aXJlX18oMjkpOwoKICAgICAgdmFyIF9jbGFzc0NhbGxDaGVjazMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jbGFzc0NhbGxDaGVjazIpOwoKICAgICAgdmFyIF9jcmVhdGVDbGFzczIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMwKTsKCiAgICAgIHZhciBfY3JlYXRlQ2xhc3MzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY3JlYXRlQ2xhc3MyKTsKCiAgICAgIHZhciBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybjIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY2KTsKCiAgICAgIHZhciBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybjMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuMik7CgogICAgICB2YXIgX2luaGVyaXRzMiA9IF9fd2VicGFja19yZXF1aXJlX18oNzApOwoKICAgICAgdmFyIF9pbmhlcml0czMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pbmhlcml0czIpOwoKICAgICAgdmFyIF9yZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgogICAgICB2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTsKCiAgICAgIHZhciBfYXZhdGFyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4MCk7CgogICAgICB2YXIgX2F2YXRhcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9hdmF0YXIpOwoKICAgICAgdmFyIF9zdmcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgxKTsKCiAgICAgIHZhciBfc3ZnMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3N2Zyk7CgogICAgICB2YXIgX2Rpc3RhbmNlX2luX3dvcmRzX3RvX25vdyA9IF9fd2VicGFja19yZXF1aXJlX18oMTk5KTsKCiAgICAgIHZhciBfZGlzdGFuY2VfaW5fd29yZHNfdG9fbm93MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2Rpc3RhbmNlX2luX3dvcmRzX3RvX25vdyk7CgogICAgICB2YXIgX2luZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMTIpOwoKICAgICAgdmFyIF9pbmRleDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pbmRleCk7CgogICAgICB2YXIgX2luZGV4MyA9IF9fd2VicGFja19yZXF1aXJlX18oMjEzKTsKCiAgICAgIHZhciBfaW5kZXg0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaW5kZXgzKTsKCiAgICAgIHZhciBfaW5kZXg1ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMTQpOwoKICAgICAgdmFyIF9pbmRleDYgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pbmRleDUpOwoKICAgICAgdmFyIF9pbmRleDcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxNSk7CgogICAgICB2YXIgX2luZGV4OCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2luZGV4Nyk7CgogICAgICB2YXIgX2luZGV4OSA9IF9fd2VicGFja19yZXF1aXJlX18oMjE2KTsKCiAgICAgIHZhciBfaW5kZXgxMCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2luZGV4OSk7CgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxNyk7CgogICAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogICAgICAgIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICAgICAgICAiZGVmYXVsdCI6IG9iagogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHZhciBaSENOID0gKDAsIF9pbmRleDJbImRlZmF1bHQiXSkoKTsKICAgICAgdmFyIFpIVFcgPSAoMCwgX2luZGV4NFsiZGVmYXVsdCJdKSgpOwogICAgICB2YXIgRVMgPSAoMCwgX2luZGV4NlsiZGVmYXVsdCJdKSgpOwogICAgICB2YXIgRlIgPSAoMCwgX2luZGV4OFsiZGVmYXVsdCJdKSgpOwogICAgICB2YXIgUlUgPSAoMCwgX2luZGV4MTBbImRlZmF1bHQiXSkoKTsKCiAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIHdpbmRvdy5HVF9pMThuX2Rpc3RhbmNlSW5Xb3Jkc0xvY2FsZU1hcCA9IHsKICAgICAgICAgIHpoOiBaSENOLAogICAgICAgICAgJ3poLUNOJzogWkhDTiwKICAgICAgICAgICd6aC1UVyc6IFpIVFcsCiAgICAgICAgICAnZXMtRVMnOiBFUywKICAgICAgICAgIGZyOiBGUiwKICAgICAgICAgIHJ1OiBSVQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHZhciBDb21tZW50ID0gZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICAgICAgICAoMCwgX2luaGVyaXRzM1siZGVmYXVsdCJdKShDb21tZW50LCBfQ29tcG9uZW50KTsKCiAgICAgICAgZnVuY3Rpb24gQ29tbWVudCgpIHsKICAgICAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2szWyJkZWZhdWx0Il0pKHRoaXMsIENvbW1lbnQpOwogICAgICAgICAgcmV0dXJuICgwLCBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybjNbImRlZmF1bHQiXSkodGhpcywgKENvbW1lbnQuX19wcm90b19fIHx8ICgwLCBfZ2V0UHJvdG90eXBlT2YyWyJkZWZhdWx0Il0pKENvbW1lbnQpKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgICAgICB9CgogICAgICAgICgwLCBfY3JlYXRlQ2xhc3MzWyJkZWZhdWx0Il0pKENvbW1lbnQsIFt7CiAgICAgICAgICBrZXk6ICdzaG91bGRDb21wb25lbnRVcGRhdGUnLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNob3VsZENvbXBvbmVudFVwZGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2NvbXBvbmVudERpZE1vdW50JywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHsKICAgICAgICAgICAgdmFyIGNvbW1lbnQgPSB0aGlzLm5vZGU7CiAgICAgICAgICAgIHZhciBlbWFpbFJlc3BvbnNlID0gY29tbWVudC5xdWVyeVNlbGVjdG9yKCcuZW1haWwtaGlkZGVuLXRvZ2dsZT5hJyk7CgogICAgICAgICAgICBpZiAoZW1haWxSZXNwb25zZSkgewogICAgICAgICAgICAgIGVtYWlsUmVzcG9uc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgY29tbWVudC5xdWVyeVNlbGVjdG9yKCcuZW1haWwtaGlkZGVuLXJlcGx5JykuY2xhc3NMaXN0LnRvZ2dsZSgnZXhwYW5kZWQnKTsKICAgICAgICAgICAgICB9LCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ2hhbmRsZUltYWdlRXJyb3JlZCcsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlSW1hZ2VFcnJvcmVkKG9iaikgewogICAgICAgICAgICBvYmoudGFyZ2V0LnNyYyA9ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2dpdGFsa0AxL3NyYy9hc3NldHMvaWNvbi9naXRodWIuc3ZnIjsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICdyZW5kZXInLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgX3Byb3BzID0gdGhpcy5wcm9wcywKICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBfcHJvcHMuY29tbWVudCwKICAgICAgICAgICAgICAgIHVzZXIgPSBfcHJvcHMudXNlciwKICAgICAgICAgICAgICAgIGxhbmd1YWdlID0gX3Byb3BzLmxhbmd1YWdlLAogICAgICAgICAgICAgICAgX3Byb3BzJGNvbW1lbnRlZFRleHQgPSBfcHJvcHMuY29tbWVudGVkVGV4dCwKICAgICAgICAgICAgICAgIGNvbW1lbnRlZFRleHQgPSBfcHJvcHMkY29tbWVudGVkVGV4dCA9PT0gdW5kZWZpbmVkID8gJycgOiBfcHJvcHMkY29tbWVudGVkVGV4dCwKICAgICAgICAgICAgICAgIF9wcm9wcyRhZG1pbiA9IF9wcm9wcy5hZG1pbiwKICAgICAgICAgICAgICAgIGFkbWluID0gX3Byb3BzJGFkbWluID09PSB1bmRlZmluZWQgPyBbXSA6IF9wcm9wcyRhZG1pbiwKICAgICAgICAgICAgICAgIHJlcGx5Q2FsbGJhY2sgPSBfcHJvcHMucmVwbHlDYWxsYmFjaywKICAgICAgICAgICAgICAgIGxpa2VDYWxsYmFjayA9IF9wcm9wcy5saWtlQ2FsbGJhY2s7CiAgICAgICAgICAgIHZhciBlbmFibGVFZGl0ID0gdXNlciAmJiBjb21tZW50LnVzZXIubG9naW4gPT09IHVzZXIubG9naW47CiAgICAgICAgICAgIHZhciBpc0FkbWluID0gfltdLmNvbmNhdChhZG1pbikubWFwKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGEudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfSkuaW5kZXhPZihjb21tZW50LnVzZXIubG9naW4udG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgIHZhciByZWFjdGlvbnMgPSBjb21tZW50LnJlYWN0aW9uczsKICAgICAgICAgICAgdmFyIHJlYWN0aW9uVG90YWxDb3VudCA9ICcnOwoKICAgICAgICAgICAgaWYgKHJlYWN0aW9ucyAmJiByZWFjdGlvbnMudG90YWxDb3VudCkgewogICAgICAgICAgICAgIHJlYWN0aW9uVG90YWxDb3VudCA9IHJlYWN0aW9ucy50b3RhbENvdW50OwoKICAgICAgICAgICAgICBpZiAocmVhY3Rpb25zLnRvdGFsQ291bnQgPT09IDEwMCAmJiByZWFjdGlvbnMucGFnZUluZm8gJiYgcmVhY3Rpb25zLnBhZ2VJbmZvLmhhc05leHRQYWdlKSB7CiAgICAgICAgICAgICAgICByZWFjdGlvblRvdGFsQ291bnQgPSAnMTAwKyc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICByZWY6IGZ1bmN0aW9uIHJlZihub2RlKSB7CiAgICAgICAgICAgICAgICBfdGhpczIubm9kZSA9IG5vZGU7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1jb21tZW50ICcgKyAoaXNBZG1pbiA/ICdndC1jb21tZW50LWFkbWluJyA6ICcnKQogICAgICAgICAgICB9LCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudChfYXZhdGFyMlsiZGVmYXVsdCJdLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3QtY29tbWVudC1hdmF0YXInLAogICAgICAgICAgICAgIHNyYzogY29tbWVudC51c2VyICYmIGNvbW1lbnQudXNlci5hdmF0YXJfdXJsLAogICAgICAgICAgICAgIGFsdDogY29tbWVudC51c2VyICYmIGNvbW1lbnQudXNlci5sb2dpbiwKICAgICAgICAgICAgICBvbkVycm9yOiB0aGlzLmhhbmRsZUltYWdlRXJyb3JlZC5iaW5kKHRoaXMpCiAgICAgICAgICAgIH0pLCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnZGl2JywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWNvbW1lbnQtY29udGVudCcKICAgICAgICAgICAgfSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1jb21tZW50LWhlYWRlcicKICAgICAgICAgICAgfSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1jb21tZW50LWJsb2NrLScgKyAodXNlciA/ICcyJyA6ICcxJykKICAgICAgICAgICAgfSksIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCdhJywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWNvbW1lbnQtdXNlcm5hbWUnLAogICAgICAgICAgICAgIGhyZWY6IGNvbW1lbnQudXNlciAmJiBjb21tZW50LnVzZXIuaHRtbF91cmwKICAgICAgICAgICAgfSwgY29tbWVudC51c2VyICYmIGNvbW1lbnQudXNlci5sb2dpbiksIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCdzcGFuJywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWNvbW1lbnQtdGV4dCcKICAgICAgICAgICAgfSwgY29tbWVudGVkVGV4dCksIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCdzcGFuJywgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWNvbW1lbnQtZGF0ZScKICAgICAgICAgICAgfSwgKDAsIF9kaXN0YW5jZV9pbl93b3Jkc190b19ub3cyWyJkZWZhdWx0Il0pKGNvbW1lbnQuY3JlYXRlZF9hdCwgewogICAgICAgICAgICAgIGFkZFN1ZmZpeDogdHJ1ZSwKICAgICAgICAgICAgICBsb2NhbGU6IHsKICAgICAgICAgICAgICAgIGRpc3RhbmNlSW5Xb3Jkczogd2luZG93LkdUX2kxOG5fZGlzdGFuY2VJbldvcmRzTG9jYWxlTWFwW2xhbmd1YWdlXQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpLCByZWFjdGlvbnMgJiYgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2EnLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3QtY29tbWVudC1saWtlJywKICAgICAgICAgICAgICB0aXRsZTogJ0xpa2UnLAogICAgICAgICAgICAgIG9uQ2xpY2s6IGxpa2VDYWxsYmFjawogICAgICAgICAgICB9LCByZWFjdGlvbnMudmlld2VySGFzUmVhY3RlZCA/IF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KF9zdmcyWyJkZWZhdWx0Il0sIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1pY28taGVhcnQnLAogICAgICAgICAgICAgIG5hbWU6ICdoZWFydF9vbicsCiAgICAgICAgICAgICAgdGV4dDogcmVhY3Rpb25Ub3RhbENvdW50CiAgICAgICAgICAgIH0pIDogX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoX3N2ZzJbImRlZmF1bHQiXSwgewogICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2d0LWljby1oZWFydCcsCiAgICAgICAgICAgICAgbmFtZTogJ2hlYXJ0JywKICAgICAgICAgICAgICB0ZXh0OiByZWFjdGlvblRvdGFsQ291bnQKICAgICAgICAgICAgfSkpLCBlbmFibGVFZGl0ID8gX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2EnLCB7CiAgICAgICAgICAgICAgaHJlZjogY29tbWVudC5odG1sX3VybCwKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1jb21tZW50LWVkaXQnLAogICAgICAgICAgICAgIHRpdGxlOiAnRWRpdCcsCiAgICAgICAgICAgICAgdGFyZ2V0OiAnX2JsYW5rJwogICAgICAgICAgICB9LCBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudChfc3ZnMlsiZGVmYXVsdCJdLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3QtaWNvLWVkaXQnLAogICAgICAgICAgICAgIG5hbWU6ICdlZGl0JwogICAgICAgICAgICB9KSkgOiBfcmVhY3QyWyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgnYScsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1jb21tZW50LXJlcGx5JywKICAgICAgICAgICAgICB0aXRsZTogJ1JlcGx5JywKICAgICAgICAgICAgICBvbkNsaWNrOiByZXBseUNhbGxiYWNrCiAgICAgICAgICAgIH0sIF9yZWFjdDJbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KF9zdmcyWyJkZWZhdWx0Il0sIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1pY28tcmVwbHknLAogICAgICAgICAgICAgIG5hbWU6ICdyZXBseScKICAgICAgICAgICAgfSkpKSwgX3JlYWN0MlsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICdndC1jb21tZW50LWJvZHkgbWFya2Rvd24tYm9keScsCiAgICAgICAgICAgICAgZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw6IHsKICAgICAgICAgICAgICAgIF9faHRtbDogY29tbWVudC5ib2R5X2h0bWwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKSk7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwogICAgICAgIHJldHVybiBDb21tZW50OwogICAgICB9KF9yZWFjdC5Db21wb25lbnQpOwoKICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gQ29tbWVudDsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxOTEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgbWFwID0gewogICAgICAgICIuL2Fycm93X2Rvd24uc3ZnIjogMTkyLAogICAgICAgICIuL2VkaXQuc3ZnIjogMTkzLAogICAgICAgICIuL2dpdGh1Yi5zdmciOiAxOTQsCiAgICAgICAgIi4vaGVhcnQuc3ZnIjogMTk1LAogICAgICAgICIuL2hlYXJ0X29uLnN2ZyI6IDE5NiwKICAgICAgICAiLi9yZXBseS5zdmciOiAxOTcsCiAgICAgICAgIi4vdGlwLnN2ZyI6IDE5OAogICAgICB9OwoKICAgICAgZnVuY3Rpb24gd2VicGFja0NvbnRleHQocmVxKSB7CiAgICAgICAgcmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18od2VicGFja0NvbnRleHRSZXNvbHZlKHJlcSkpOwogICAgICB9CgogICAgICA7CgogICAgICBmdW5jdGlvbiB3ZWJwYWNrQ29udGV4dFJlc29sdmUocmVxKSB7CiAgICAgICAgdmFyIGlkID0gbWFwW3JlcV07CiAgICAgICAgaWYgKCEoaWQgKyAxKSkgLy8gY2hlY2sgZm9yIG51bWJlciBvciBzdHJpbmcKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciICsgcmVxICsgIicuIik7CiAgICAgICAgcmV0dXJuIGlkOwogICAgICB9CgogICAgICA7CgogICAgICB3ZWJwYWNrQ29udGV4dC5rZXlzID0gZnVuY3Rpb24gd2VicGFja0NvbnRleHRLZXlzKCkgewogICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhtYXApOwogICAgICB9OwoKICAgICAgd2VicGFja0NvbnRleHQucmVzb2x2ZSA9IHdlYnBhY2tDb250ZXh0UmVzb2x2ZTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB3ZWJwYWNrQ29udGV4dDsKICAgICAgd2VicGFja0NvbnRleHQuaWQgPSAxOTE7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTkyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAiPHN2ZyB2aWV3Qm94PVwiMCAwIDEwMjQgMTAyNFwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiBwLWlkPVwiMTYxOVwiPjxwYXRoIGQ9XCJNNTExLjg3MiA2NzYuOGMtMC4wMDMgMC0wLjAwNiAwLTAuMDA4IDAtOS4xMzcgMC0xNy4zNzktMy44MjktMjMuMjEtOS45N2wtMjUxLjI3Ny0yNjUuNjE0Yy01LjQxNS01LjcyLTguNzQzLTEzLjQ2NC04Ljc0NC0yMS45ODQgMC0xNy42NzggMTQuMzMtMzIuMDA4IDMyLjAwOC0zMi4wMDggOS4xNTcgMCAxNy40MTYgMy44NDUgMjMuMjUgMTAuMDA5bDIyOC4wNDUgMjQxLjEwMyAyMjguMjI0LTI0MS4wODhjNS44NTUtNi4xNjUgMTQuMTEzLTEwLjAwMSAyMy4yNjYtMTAuMDAxIDguNTE2IDAgMTYuMjU2IDMuMzIgMjEuOTk4IDguNzM2IDEyLjc4NCAxMi4xNDUgMTMuMzYgMzIuNDM0IDEuMjY0IDQ1LjIzM2wtMjUxLjUyIDI2NS42Yy01Ljg0NCA2LjE1NS0xNC4wODYgOS45ODQtMjMuMjIzIDkuOTg0LTAuMDI1IDAtMC4wNTEgMC0wLjA3NiAwelwiIHAtaWQ9XCIxNjIwXCI+PC9wYXRoPjwvc3ZnPiI7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTkzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAiPHN2ZyB2aWV3Qm94PVwiMCAwIDEwMjQgMTAyNFwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIj5cbiAgPHBhdGggZD1cIk03ODUuMzMzMzMzIDg1LjMzMzMzM0M3NzQuNjY2NjY3IDg1LjMzMzMzMyA3NjMuMiA5MC4xMzMzMzMgNzU0LjY2NjY2NyA5OC42NjY2NjdMNjgyLjY2NjY2NyAxNzAuNjY2NjY3IDg1My4zMzMzMzMgMzQxLjMzMzMzMyA5MjUuMzMzMzMzIDI2OS4zMzMzMzNDOTQyLjQgMjUyLjI2NjY2NyA5NDIuNCAyMjIuMTMzMzMzIDkyNS4zMzMzMzMgMjA5LjMzMzMzM0w4MTQuNjY2NjY3IDk4LjY2NjY2N0M4MDYuMTMzMzMzIDkwLjEzMzMzMyA3OTYgODUuMzMzMzMzIDc4NS4zMzMzMzMgODUuMzMzMzMzek02NDAgMjE3LjMzMzMzMyA4NS4zMzMzMzMgNzY4IDg1LjMzMzMzMyA5MzguNjY2NjY3IDI1NiA5MzguNjY2NjY3IDgwNi42NjY2NjcgMzg0IDY0MCAyMTcuMzMzMzMzelwiPjwvcGF0aD5cbjwvc3ZnPlxuIjsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxOTQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9ICI8c3ZnIHZpZXdCb3g9XCIwIDAgMTAyNCAxMDI0XCIgdmVyc2lvbj1cIjEuMVwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIj5cbiAgPHBhdGggZD1cIk02NCA1MjRDNjQgNzE5LjYwMiAxODkuMzU2IDg4NS45MjYgMzY0LjExMyA5NDcuMDE3IDM4Ny42NTc5OSA5NTMgMzg0IDkzNi4xMTUgMzg0IDkyNC43NjdMMzg0IDg0Ny4xMDdDMjQ4LjExOCA4NjMuMDA3IDI0Mi42NzQgNzczLjA1MiAyMzMuNSA3NTguMDAxIDIxNSA3MjYuNTAxIDE3MS41IDcxOC41MDEgMTg0LjUgNzAzLjUwMSAyMTUuNSA2ODcuNTAxIDI0NyA3MDcuNTAxIDI4My41IDc2MS41MDEgMzA5Ljk1NiA4MDAuNjQyIDM2MS4zNjYgNzk0LjA3NSAzODcuNjU4IDc4Ny40OTcgMzkzLjQwMyA3NjMuOTk3IDQwNS42MzcgNzQzLjA0MiA0MjIuMzUzIDcyNi42MzggMjgxLjc3NCA3MDEuNjA5IDIyMyA2MTUuNjcgMjIzIDUxMy41IDIyMyA0NjQuMDUzIDIzOS4zMjIgNDE4LjQwNiAyNzEuNDY1IDM4MS42MjcgMjUxLjE0MiAzMjAuOTI4IDI3My40MjEgMjY5LjE5IDI3Ni4zMzcgMjYxLjQxNSAzMzQuNDU4IDI1Ni4xMzEgMzk0Ljg4OCAzMDIuOTkzIDM5OS41NDkgMzA2LjY4NSA0MzIuNjYzIDI5Ny44MzUgNDcwLjM0MSAyOTMgNTEyLjUgMjkzIDU1NC45MjQgMjkzIDU5Mi44MSAyOTcuODk2IDYyNi4wNzUgMzA2Ljg1MyA2MzcuNDI2IDI5OC4yMTkgNjkzLjQ2IDI1OC4wNTQgNzQ3LjUgMjYyLjk2NiA3NTAuMzgyIDI3MC42NTIgNzcyLjE4NSAzMjEuMjkyIDc1My4wNTggMzgxLjA4MyA3ODUuNTE2IDQxNy45NTYgODAyIDQ2My44MDkgODAyIDUxMy41IDgwMiA2MTUuODc0IDc0Mi45OSA3MDEuOTUzIDYwMS44MDMgNzI2Ljc4NiA2MjUuMzgxIDc1MC4wMDMgNjQwIDc4Mi4yOTUgNjQwIDgxOC4wMDhMNjQwIDkzMC42NTNDNjQwLjc1MiA5MzkuNjI2IDY0MCA5NDguNjY0OTc4IDY1NS4wODYgOTQ4LjY2NSA4MzIuMzQ0IDg4OC45NjIgOTYwIDcyMS4zODkgOTYwIDUyNCA5NjAgMjc2LjU3NiA3NTkuNDI0IDc2IDUxMiA3NiAyNjQuNTc3IDc2IDY0IDI3Ni41NzYgNjQgNTI0WlwiPjwvcGF0aD5cbjwvc3ZnPlxuIjsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxOTUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9ICI8c3ZnIHZpZXdCb3g9XCIwIDAgMTAyNCAxMDI0XCIgdmVyc2lvbj1cIjEuMVwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIj5cbiAgPHBhdGggZD1cIk01MjcuMDYxMzMzIDE2Ni41MjhBMjc3LjMzMzMzMyAyNzcuMzMzMzMzIDAgMCAxIDEwMDAuNjE4NjY3IDM2Mi42NjY2NjdhMjc3LjMzMzMzMyAyNzcuMzMzMzMzIDAgMCAxLTgxLjI4IDE5Ni4xMzg2NjZsLTM3Ny4xNzMzMzQgMzc3LjE3MzMzNGE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAxLTYwLjMzMDY2NiAwbC0zNzcuMTczMzM0LTM3Ny4xNzMzMzRhMjc3LjM3NiAyNzcuMzc2IDAgMCAxIDM5Mi4yNzczMzQtMzkyLjI3NzMzM2wxNS4wNjEzMzMgMTUuMDYxMzMzIDE1LjA2MTMzMy0xNS4wNjEzMzN6IG0yODYuNzIgMzc3LjE3MzMzM2w0NS4yMjY2NjctNDUuMjI2NjY2YTE5MiAxOTIgMCAwIDAtMTM1LjgwOC0zMjcuODkzMzM0IDE5MiAxOTIgMCAwIDAtMTM1LjgwOCA1Ni4zMmwtNDUuMjI2NjY3IDQ1LjIyNjY2N2E0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAxLTYwLjMzMDY2NiAwbC00NS4yMjY2NjctNDUuMjI2NjY3YTE5Mi4wNDI2NjcgMTkyLjA0MjY2NyAwIDAgMC0yNzEuNjE2IDI3MS41NzMzMzRMNTEyIDg0NS40ODI2NjdsMzAxLjc4MTMzMy0zMDEuNzgxMzM0elwiPjwvcGF0aD5cbjwvc3ZnPlxuIjsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxOTYgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9ICI8c3ZnIHQ9XCIxNTEyNDYzMzYzNzI0XCIgdmlld0JveD1cIjAgMCAxMDI0IDEwMjRcIiB2ZXJzaW9uPVwiMS4xXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHhtbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiPlxuICA8cGF0aCBkPVwiTTUyNy4wNjEzMzMgMTY2LjUyOEEyNzcuMzMzMzMzIDI3Ny4zMzMzMzMgMCAwIDEgMTAwMC42MTg2NjcgMzYyLjY2NjY2N2EyNzcuMzMzMzMzIDI3Ny4zMzMzMzMgMCAwIDEtODEuMjggMTk2LjEzODY2NmwtMzc3LjE3MzMzNCAzNzcuMTczMzM0YTQyLjY2NjY2NyA0Mi42NjY2NjcgMCAwIDEtNjAuMzMwNjY2IDBsLTM3Ny4xNzMzMzQtMzc3LjE3MzMzNGEyNzcuMzc2IDI3Ny4zNzYgMCAwIDEgMzkyLjI3NzMzNC0zOTIuMjc3MzMzbDE1LjA2MTMzMyAxNS4wNjEzMzMgMTUuMDYxMzMzLTE1LjA2MTMzM3pcIj48L3BhdGg+XG48L3N2Zz5cbiI7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTk3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAiPHN2ZyB2aWV3Qm94PVwiMCAwIDEzMzIgMTAyNFwiIHZlcnNpb249XCIxLjFcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI+XG4gIDxwYXRoIGQ9XCJNNTI5LjA2NjY2NSAyNzMuMDY2NjY2IDUyOS4wNjY2NjUgMCA1MS4yIDQ3Ny44NjY2NjYgNTI5LjA2NjY2NSA5NTUuNzMzMzM1IDUyOS4wNjY2NjUgNjc1Ljg0Qzg3MC40IDY3NS44NCAxMTA5LjMzMzMzNSA3ODUuMDY2NjY1IDEyODAgMTAyNCAxMjExLjczMzMzNSA2ODIuNjY2NjY1IDEwMDYuOTMzMzM1IDM0MS4zMzMzMzQgNTI5LjA2NjY2NSAyNzMuMDY2NjY2XCI+PC9wYXRoPlxuPC9zdmc+XG4iOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE5OCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gIjxzdmcgdmlld0JveD1cIjAgMCAxMDI0IDEwMjRcIiB2ZXJzaW9uPVwiMS4xXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiPlxuICA8cGF0aCBkPVwiTTUxMiAzNjYuOTQ5NTM1Yy0xNi4wNjU1NTQgMC0yOS45ODIyMTIgMTMuNDA1MDE2LTI5Ljk4MjIxMiAyOS44Nzk4ODRsMCAzNTkuMDcwMjUxYzAgMTYuMTY3ODgyIDEzLjQwNTAxNiAyOS44Nzk4ODQgMjkuOTgyMjEyIDI5Ljg3OTg4NCAxNS45NjMyMjYgMCAyOS44Nzk4ODQtMTMuNDA1MDE2IDI5Ljg3OTg4NC0yOS44Nzk4ODRMNTQxLjg3OTg4NCAzOTYuODI5NDE5QzU0MS44Nzk4ODQgMzgwLjc2Mzg2NSA1MjguNDc0ODY4IDM2Ni45NDk1MzUgNTEyIDM2Ni45NDk1MzVMNTEyIDM2Ni45NDk1MzV6XCJcbiAgICBwLWlkPVwiMzA4M1wiPjwvcGF0aD5cbiAgPHBhdGggZD1cIk00ODIuMDE3Nzg4IDI4Ny42NDUwNDhjMC03Ljc3Njk1NiAzLjI3NDUwOC0xNS41NTM5MTIgOC44MDAyNC0yMS4xODE5NzMgNS41MjU3MzItNS41MjU3MzIgMTMuMzAyNjg4LTguODAwMjQgMjEuMTgxOTczLTguODAwMjQgNy43NzY5NTYgMCAxNS41NTM5MTIgMy4yNzQ1MDggMjEuMDc5NjQ0IDguODAwMjQgNS41MjU3MzIgNS42MjgwNiA4LjgwMDI0IDEzLjQwNTAxNiA4LjgwMDI0IDIxLjE4MTk3MyAwIDcuNzc2OTU2LTMuMjc0NTA4IDE1LjY1NjI0MS04LjgwMDI0IDIxLjE4MTk3My01LjUyNTczMiA1LjUyNTczMi0xMy40MDUwMTYgOC42OTc5MTEtMjEuMDc5NjQ0IDguNjk3OTExLTcuODc5Mjg1IDAtMTUuNjU2MjQxLTMuMjc0NTA4LTIxLjE4MTk3My04LjY5NzkxMUM0ODUuMjkyMjk1IDMwMy4zMDEyODkgNDgyLjAxNzc4OCAyOTUuNTI0MzMzIDQ4Mi4wMTc3ODggMjg3LjY0NTA0OEw0ODIuMDE3Nzg4IDI4Ny42NDUwNDh6XCJcbiAgICBwLWlkPVwiMzA4NFwiPjwvcGF0aD5cbiAgPHBhdGggZD1cIk01MTIgOTQ2Ljg0NDQwOWMtMjM5Ljg1NzcgMC00MzQuODk1NTczLTE5NS4wMzc4NzMtNDM0Ljg5NTU3My00MzQuODk1NTczIDAtMjM5Ljg1NzcgMTk1LjAzNzg3My00MzQuODk1NTczIDQzNC44OTU1NzMtNDM0Ljg5NTU3MyAyMzkuNzU1MzcxIDAgNDM0Ljg5NTU3MyAxOTUuMDM3ODczIDQzNC44OTU1NzMgNDM0Ljg5NTU3M0M5NDYuODk1NTczIDc1MS44MDY1MzUgNzUxLjc1NTM3MSA5NDYuODQ0NDA5IDUxMiA5NDYuODQ0NDA5ek01MTIgMTI2LjE3MDg4Yy0yMTIuNzQwNjgyIDAtMzg1Ljg4MDI4NCAxNzMuMDM3Mjc0LTM4NS44ODAyODQgMzg1Ljc3Nzk1NSAwIDIxMi43NDA2ODIgMTczLjAzNzI3NCAzODUuNzc3OTU1IDM4NS44ODAyODQgMzg1Ljc3Nzk1NSAyMTIuNzQwNjgyIDAgMzg1Ljc3Nzk1NS0xNzMuMDM3Mjc0IDM4NS43Nzc5NTUtMzg1Ljc3Nzk1NUM4OTcuNzc3OTU1IDI5OS4yMDgxNTQgNzI0Ljc0MDY4MiAxMjYuMTcwODggNTEyIDEyNi4xNzA4OHpcIlxuICAgIHAtaWQ9XCIzMDg1XCI+PC9wYXRoPlxuPC9zdmc+XG4iOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDE5OSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBkaXN0YW5jZUluV29yZHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwMCk7CiAgICAgIC8qKgogICAgICAgKiBAY2F0ZWdvcnkgQ29tbW9uIEhlbHBlcnMKICAgICAgICogQHN1bW1hcnkgUmV0dXJuIHRoZSBkaXN0YW5jZSBiZXR3ZWVuIHRoZSBnaXZlbiBkYXRlIGFuZCBub3cgaW4gd29yZHMuCiAgICAgICAqCiAgICAgICAqIEBkZXNjcmlwdGlvbgogICAgICAgKiBSZXR1cm4gdGhlIGRpc3RhbmNlIGJldHdlZW4gdGhlIGdpdmVuIGRhdGUgYW5kIG5vdyBpbiB3b3Jkcy4KICAgICAgICoKICAgICAgICogfCBEaXN0YW5jZSB0byBub3cgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IFJlc3VsdCAgICAgICAgICAgICAgfAogICAgICAgKiB8LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXwtLS0tLS0tLS0tLS0tLS0tLS0tLS18CiAgICAgICAqIHwgMCAuLi4gMzAgc2VjcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBsZXNzIHRoYW4gYSBtaW51dGUgIHwKICAgICAgICogfCAzMCBzZWNzIC4uLiAxIG1pbiAzMCBzZWNzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IDEgbWludXRlICAgICAgICAgICAgfAogICAgICAgKiB8IDEgbWluIDMwIHNlY3MgLi4uIDQ0IG1pbnMgMzAgc2VjcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgWzIuLjQ0XSBtaW51dGVzICAgICB8CiAgICAgICAqIHwgNDQgbWlucyAuLi4gMzAgc2VjcyAuLi4gODkgbWlucyAzMCBzZWNzICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBhYm91dCAxIGhvdXIgICAgICAgIHwKICAgICAgICogfCA4OSBtaW5zIDMwIHNlY3MgLi4uIDIzIGhycyA1OSBtaW5zIDMwIHNlY3MgICAgICAgICAgICAgICAgICAgICAgICB8IGFib3V0IFsyLi4yNF0gaG91cnMgfAogICAgICAgKiB8IDIzIGhycyA1OSBtaW5zIDMwIHNlY3MgLi4uIDQxIGhycyA1OSBtaW5zIDMwIHNlY3MgICAgICAgICAgICAgICAgIHwgMSBkYXkgICAgICAgICAgICAgICB8CiAgICAgICAqIHwgNDEgaHJzIDU5IG1pbnMgMzAgc2VjcyAuLi4gMjkgZGF5cyAyMyBocnMgNTkgbWlucyAzMCBzZWNzICAgICAgICAgfCBbMi4uMzBdIGRheXMgICAgICAgIHwKICAgICAgICogfCAyOSBkYXlzIDIzIGhycyA1OSBtaW5zIDMwIHNlY3MgLi4uIDQ0IGRheXMgMjMgaHJzIDU5IG1pbnMgMzAgc2VjcyB8IGFib3V0IDEgbW9udGggICAgICAgfAogICAgICAgKiB8IDQ0IGRheXMgMjMgaHJzIDU5IG1pbnMgMzAgc2VjcyAuLi4gNTkgZGF5cyAyMyBocnMgNTkgbWlucyAzMCBzZWNzIHwgYWJvdXQgMiBtb250aHMgICAgICB8CiAgICAgICAqIHwgNTkgZGF5cyAyMyBocnMgNTkgbWlucyAzMCBzZWNzIC4uLiAxIHlyICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBbMi4uMTJdIG1vbnRocyAgICAgIHwKICAgICAgICogfCAxIHlyIC4uLiAxIHlyIDMgbW9udGhzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IGFib3V0IDEgeWVhciAgICAgICAgfAogICAgICAgKiB8IDEgeXIgMyBtb250aHMgLi4uIDEgeXIgOSBtb250aCBzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgb3ZlciAxIHllYXIgICAgICAgICB8CiAgICAgICAqIHwgMSB5ciA5IG1vbnRocyAuLi4gMiB5cnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBhbG1vc3QgMiB5ZWFycyAgICAgIHwKICAgICAgICogfCBOIHlycyAuLi4gTiB5cnMgMyBtb250aHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IGFib3V0IE4geWVhcnMgICAgICAgfAogICAgICAgKiB8IE4geXJzIDMgbW9udGhzIC4uLiBOIHlycyA5IG1vbnRocyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgb3ZlciBOIHllYXJzICAgICAgICB8CiAgICAgICAqIHwgTiB5cnMgOSBtb250aHMgLi4uIE4rMSB5cnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBhbG1vc3QgTisxIHllYXJzICAgIHwKICAgICAgICoKICAgICAgICogV2l0aCBgb3B0aW9ucy5pbmNsdWRlU2Vjb25kcyA9PSB0cnVlYDoKICAgICAgICogfCBEaXN0YW5jZSB0byBub3cgICAgIHwgUmVzdWx0ICAgICAgICAgICAgICAgfAogICAgICAgKiB8LS0tLS0tLS0tLS0tLS0tLS0tLS0tfC0tLS0tLS0tLS0tLS0tLS0tLS0tLS18CiAgICAgICAqIHwgMCBzZWNzIC4uLiA1IHNlY3MgICB8IGxlc3MgdGhhbiA1IHNlY29uZHMgIHwKICAgICAgICogfCA1IHNlY3MgLi4uIDEwIHNlY3MgIHwgbGVzcyB0aGFuIDEwIHNlY29uZHMgfAogICAgICAgKiB8IDEwIHNlY3MgLi4uIDIwIHNlY3MgfCBsZXNzIHRoYW4gMjAgc2Vjb25kcyB8CiAgICAgICAqIHwgMjAgc2VjcyAuLi4gNDAgc2VjcyB8IGhhbGYgYSBtaW51dGUgICAgICAgIHwKICAgICAgICogfCA0MCBzZWNzIC4uLiA2MCBzZWNzIHwgbGVzcyB0aGFuIGEgbWludXRlICAgfAogICAgICAgKiB8IDYwIHNlY3MgLi4uIDkwIHNlY3MgfCAxIG1pbnV0ZSAgICAgICAgICAgICB8CiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7RGF0ZXxTdHJpbmd8TnVtYmVyfSBkYXRlIC0gdGhlIGdpdmVuIGRhdGUKICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAtIHRoZSBvYmplY3Qgd2l0aCBvcHRpb25zCiAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuaW5jbHVkZVNlY29uZHM9ZmFsc2VdIC0gZGlzdGFuY2VzIGxlc3MgdGhhbiBhIG1pbnV0ZSBhcmUgbW9yZSBkZXRhaWxlZAogICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmFkZFN1ZmZpeD1mYWxzZV0gLSByZXN1bHQgc3BlY2lmaWVzIGlmIHRoZSBzZWNvbmQgZGF0ZSBpcyBlYXJsaWVyIG9yIGxhdGVyIHRoYW4gdGhlIGZpcnN0CiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucy5sb2NhbGU9ZW5Mb2NhbGVdIC0gdGhlIGxvY2FsZSBvYmplY3QKICAgICAgICogQHJldHVybnMge1N0cmluZ30gdGhlIGRpc3RhbmNlIGluIHdvcmRzCiAgICAgICAqCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIC8vIElmIHRvZGF5IGlzIDEgSmFudWFyeSAyMDE1LCB3aGF0IGlzIHRoZSBkaXN0YW5jZSB0byAyIEp1bHkgMjAxND8KICAgICAgICogdmFyIHJlc3VsdCA9IGRpc3RhbmNlSW5Xb3Jkc1RvTm93KAogICAgICAgKiAgIG5ldyBEYXRlKDIwMTQsIDYsIDIpCiAgICAgICAqICkKICAgICAgICogLy89PiAnNiBtb250aHMnCiAgICAgICAqCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIC8vIElmIG5vdyBpcyAxIEphbnVhcnkgMjAxNSAwMDowMDowMCwKICAgICAgICogLy8gd2hhdCBpcyB0aGUgZGlzdGFuY2UgdG8gMSBKYW51YXJ5IDIwMTUgMDA6MDA6MTUsIGluY2x1ZGluZyBzZWNvbmRzPwogICAgICAgKiB2YXIgcmVzdWx0ID0gZGlzdGFuY2VJbldvcmRzVG9Ob3coCiAgICAgICAqICAgbmV3IERhdGUoMjAxNSwgMCwgMSwgMCwgMCwgMTUpLAogICAgICAgKiAgIHtpbmNsdWRlU2Vjb25kczogdHJ1ZX0KICAgICAgICogKQogICAgICAgKiAvLz0+ICdsZXNzIHRoYW4gMjAgc2Vjb25kcycKICAgICAgICoKICAgICAgICogQGV4YW1wbGUKICAgICAgICogLy8gSWYgdG9kYXkgaXMgMSBKYW51YXJ5IDIwMTUsCiAgICAgICAqIC8vIHdoYXQgaXMgdGhlIGRpc3RhbmNlIHRvIDEgSmFudWFyeSAyMDE2LCB3aXRoIGEgc3VmZml4PwogICAgICAgKiB2YXIgcmVzdWx0ID0gZGlzdGFuY2VJbldvcmRzVG9Ob3coCiAgICAgICAqICAgbmV3IERhdGUoMjAxNiwgMCwgMSksCiAgICAgICAqICAge2FkZFN1ZmZpeDogdHJ1ZX0KICAgICAgICogKQogICAgICAgKiAvLz0+ICdpbiBhYm91dCAxIHllYXInCiAgICAgICAqCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIC8vIElmIHRvZGF5IGlzIDEgSmFudWFyeSAyMDE1LAogICAgICAgKiAvLyB3aGF0IGlzIHRoZSBkaXN0YW5jZSB0byAxIEF1Z3VzdCAyMDE2IGluIEVzcGVyYW50bz8KICAgICAgICogdmFyIGVvTG9jYWxlID0gcmVxdWlyZSgnZGF0ZS1mbnMvbG9jYWxlL2VvJykKICAgICAgICogdmFyIHJlc3VsdCA9IGRpc3RhbmNlSW5Xb3Jkc1RvTm93KAogICAgICAgKiAgIG5ldyBEYXRlKDIwMTYsIDcsIDEpLAogICAgICAgKiAgIHtsb2NhbGU6IGVvTG9jYWxlfQogICAgICAgKiApCiAgICAgICAqIC8vPT4gJ3BsaSBvbCAxIGphcm8nCiAgICAgICAqLwoKCiAgICAgIGZ1bmN0aW9uIGRpc3RhbmNlSW5Xb3Jkc1RvTm93KGRpcnR5RGF0ZSwgZGlydHlPcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIGRpc3RhbmNlSW5Xb3JkcyhEYXRlLm5vdygpLCBkaXJ0eURhdGUsIGRpcnR5T3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZGlzdGFuY2VJbldvcmRzVG9Ob3c7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjAwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGNvbXBhcmVEZXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMDEpOwoKICAgICAgdmFyIHBhcnNlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOCk7CgogICAgICB2YXIgZGlmZmVyZW5jZUluU2Vjb25kcyA9IF9fd2VicGFja19yZXF1aXJlX18oMjAzKTsKCiAgICAgIHZhciBkaWZmZXJlbmNlSW5Nb250aHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwNSk7CgogICAgICB2YXIgZW5Mb2NhbGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwOCk7CgogICAgICB2YXIgTUlOVVRFU19JTl9EQVkgPSAxNDQwOwogICAgICB2YXIgTUlOVVRFU19JTl9BTE1PU1RfVFdPX0RBWVMgPSAyNTIwOwogICAgICB2YXIgTUlOVVRFU19JTl9NT05USCA9IDQzMjAwOwogICAgICB2YXIgTUlOVVRFU19JTl9UV09fTU9OVEhTID0gODY0MDA7CiAgICAgIC8qKgogICAgICAgKiBAY2F0ZWdvcnkgQ29tbW9uIEhlbHBlcnMKICAgICAgICogQHN1bW1hcnkgUmV0dXJuIHRoZSBkaXN0YW5jZSBiZXR3ZWVuIHRoZSBnaXZlbiBkYXRlcyBpbiB3b3Jkcy4KICAgICAgICoKICAgICAgICogQGRlc2NyaXB0aW9uCiAgICAgICAqIFJldHVybiB0aGUgZGlzdGFuY2UgYmV0d2VlbiB0aGUgZ2l2ZW4gZGF0ZXMgaW4gd29yZHMuCiAgICAgICAqCiAgICAgICAqIHwgRGlzdGFuY2UgYmV0d2VlbiBkYXRlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBSZXN1bHQgICAgICAgICAgICAgIHwKICAgICAgICogfC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS18LS0tLS0tLS0tLS0tLS0tLS0tLS0tfAogICAgICAgKiB8IDAgLi4uIDMwIHNlY3MgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgbGVzcyB0aGFuIGEgbWludXRlICB8CiAgICAgICAqIHwgMzAgc2VjcyAuLi4gMSBtaW4gMzAgc2VjcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAxIG1pbnV0ZSAgICAgICAgICAgIHwKICAgICAgICogfCAxIG1pbiAzMCBzZWNzIC4uLiA0NCBtaW5zIDMwIHNlY3MgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IFsyLi40NF0gbWludXRlcyAgICAgfAogICAgICAgKiB8IDQ0IG1pbnMgLi4uIDMwIHNlY3MgLi4uIDg5IG1pbnMgMzAgc2VjcyAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgYWJvdXQgMSBob3VyICAgICAgICB8CiAgICAgICAqIHwgODkgbWlucyAzMCBzZWNzIC4uLiAyMyBocnMgNTkgbWlucyAzMCBzZWNzICAgICAgICAgICAgICAgICAgICAgICAgfCBhYm91dCBbMi4uMjRdIGhvdXJzIHwKICAgICAgICogfCAyMyBocnMgNTkgbWlucyAzMCBzZWNzIC4uLiA0MSBocnMgNTkgbWlucyAzMCBzZWNzICAgICAgICAgICAgICAgICB8IDEgZGF5ICAgICAgICAgICAgICAgfAogICAgICAgKiB8IDQxIGhycyA1OSBtaW5zIDMwIHNlY3MgLi4uIDI5IGRheXMgMjMgaHJzIDU5IG1pbnMgMzAgc2VjcyAgICAgICAgIHwgWzIuLjMwXSBkYXlzICAgICAgICB8CiAgICAgICAqIHwgMjkgZGF5cyAyMyBocnMgNTkgbWlucyAzMCBzZWNzIC4uLiA0NCBkYXlzIDIzIGhycyA1OSBtaW5zIDMwIHNlY3MgfCBhYm91dCAxIG1vbnRoICAgICAgIHwKICAgICAgICogfCA0NCBkYXlzIDIzIGhycyA1OSBtaW5zIDMwIHNlY3MgLi4uIDU5IGRheXMgMjMgaHJzIDU5IG1pbnMgMzAgc2VjcyB8IGFib3V0IDIgbW9udGhzICAgICAgfAogICAgICAgKiB8IDU5IGRheXMgMjMgaHJzIDU5IG1pbnMgMzAgc2VjcyAuLi4gMSB5ciAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgWzIuLjEyXSBtb250aHMgICAgICB8CiAgICAgICAqIHwgMSB5ciAuLi4gMSB5ciAzIG1vbnRocyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBhYm91dCAxIHllYXIgICAgICAgIHwKICAgICAgICogfCAxIHlyIDMgbW9udGhzIC4uLiAxIHlyIDkgbW9udGggcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IG92ZXIgMSB5ZWFyICAgICAgICAgfAogICAgICAgKiB8IDEgeXIgOSBtb250aHMgLi4uIDIgeXJzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgYWxtb3N0IDIgeWVhcnMgICAgICB8CiAgICAgICAqIHwgTiB5cnMgLi4uIE4geXJzIDMgbW9udGhzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBhYm91dCBOIHllYXJzICAgICAgIHwKICAgICAgICogfCBOIHlycyAzIG1vbnRocyAuLi4gTiB5cnMgOSBtb250aHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IG92ZXIgTiB5ZWFycyAgICAgICAgfAogICAgICAgKiB8IE4geXJzIDkgbW9udGhzIC4uLiBOKzEgeXJzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgYWxtb3N0IE4rMSB5ZWFycyAgICB8CiAgICAgICAqCiAgICAgICAqIFdpdGggYG9wdGlvbnMuaW5jbHVkZVNlY29uZHMgPT0gdHJ1ZWA6CiAgICAgICAqIHwgRGlzdGFuY2UgYmV0d2VlbiBkYXRlcyB8IFJlc3VsdCAgICAgICAgICAgICAgIHwKICAgICAgICogfC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tfAogICAgICAgKiB8IDAgc2VjcyAuLi4gNSBzZWNzICAgICAgfCBsZXNzIHRoYW4gNSBzZWNvbmRzICB8CiAgICAgICAqIHwgNSBzZWNzIC4uLiAxMCBzZWNzICAgICB8IGxlc3MgdGhhbiAxMCBzZWNvbmRzIHwKICAgICAgICogfCAxMCBzZWNzIC4uLiAyMCBzZWNzICAgIHwgbGVzcyB0aGFuIDIwIHNlY29uZHMgfAogICAgICAgKiB8IDIwIHNlY3MgLi4uIDQwIHNlY3MgICAgfCBoYWxmIGEgbWludXRlICAgICAgICB8CiAgICAgICAqIHwgNDAgc2VjcyAuLi4gNjAgc2VjcyAgICB8IGxlc3MgdGhhbiBhIG1pbnV0ZSAgIHwKICAgICAgICogfCA2MCBzZWNzIC4uLiA5MCBzZWNzICAgIHwgMSBtaW51dGUgICAgICAgICAgICAgfAogICAgICAgKgogICAgICAgKiBAcGFyYW0ge0RhdGV8U3RyaW5nfE51bWJlcn0gZGF0ZVRvQ29tcGFyZSAtIHRoZSBkYXRlIHRvIGNvbXBhcmUgd2l0aAogICAgICAgKiBAcGFyYW0ge0RhdGV8U3RyaW5nfE51bWJlcn0gZGF0ZSAtIHRoZSBvdGhlciBkYXRlCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSB0aGUgb2JqZWN0IHdpdGggb3B0aW9ucwogICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmluY2x1ZGVTZWNvbmRzPWZhbHNlXSAtIGRpc3RhbmNlcyBsZXNzIHRoYW4gYSBtaW51dGUgYXJlIG1vcmUgZGV0YWlsZWQKICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5hZGRTdWZmaXg9ZmFsc2VdIC0gcmVzdWx0IGluZGljYXRlcyBpZiB0aGUgc2Vjb25kIGRhdGUgaXMgZWFybGllciBvciBsYXRlciB0aGFuIHRoZSBmaXJzdAogICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMubG9jYWxlPWVuTG9jYWxlXSAtIHRoZSBsb2NhbGUgb2JqZWN0CiAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IHRoZSBkaXN0YW5jZSBpbiB3b3JkcwogICAgICAgKgogICAgICAgKiBAZXhhbXBsZQogICAgICAgKiAvLyBXaGF0IGlzIHRoZSBkaXN0YW5jZSBiZXR3ZWVuIDIgSnVseSAyMDE0IGFuZCAxIEphbnVhcnkgMjAxNT8KICAgICAgICogdmFyIHJlc3VsdCA9IGRpc3RhbmNlSW5Xb3JkcygKICAgICAgICogICBuZXcgRGF0ZSgyMDE0LCA2LCAyKSwKICAgICAgICogICBuZXcgRGF0ZSgyMDE1LCAwLCAxKQogICAgICAgKiApCiAgICAgICAqIC8vPT4gJzYgbW9udGhzJwogICAgICAgKgogICAgICAgKiBAZXhhbXBsZQogICAgICAgKiAvLyBXaGF0IGlzIHRoZSBkaXN0YW5jZSBiZXR3ZWVuIDEgSmFudWFyeSAyMDE1IDAwOjAwOjE1CiAgICAgICAqIC8vIGFuZCAxIEphbnVhcnkgMjAxNSAwMDowMDowMCwgaW5jbHVkaW5nIHNlY29uZHM/CiAgICAgICAqIHZhciByZXN1bHQgPSBkaXN0YW5jZUluV29yZHMoCiAgICAgICAqICAgbmV3IERhdGUoMjAxNSwgMCwgMSwgMCwgMCwgMTUpLAogICAgICAgKiAgIG5ldyBEYXRlKDIwMTUsIDAsIDEsIDAsIDAsIDApLAogICAgICAgKiAgIHtpbmNsdWRlU2Vjb25kczogdHJ1ZX0KICAgICAgICogKQogICAgICAgKiAvLz0+ICdsZXNzIHRoYW4gMjAgc2Vjb25kcycKICAgICAgICoKICAgICAgICogQGV4YW1wbGUKICAgICAgICogLy8gV2hhdCBpcyB0aGUgZGlzdGFuY2UgZnJvbSAxIEphbnVhcnkgMjAxNgogICAgICAgKiAvLyB0byAxIEphbnVhcnkgMjAxNSwgd2l0aCBhIHN1ZmZpeD8KICAgICAgICogdmFyIHJlc3VsdCA9IGRpc3RhbmNlSW5Xb3JkcygKICAgICAgICogICBuZXcgRGF0ZSgyMDE2LCAwLCAxKSwKICAgICAgICogICBuZXcgRGF0ZSgyMDE1LCAwLCAxKSwKICAgICAgICogICB7YWRkU3VmZml4OiB0cnVlfQogICAgICAgKiApCiAgICAgICAqIC8vPT4gJ2Fib3V0IDEgeWVhciBhZ28nCiAgICAgICAqCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIC8vIFdoYXQgaXMgdGhlIGRpc3RhbmNlIGJldHdlZW4gMSBBdWd1c3QgMjAxNiBhbmQgMSBKYW51YXJ5IDIwMTUgaW4gRXNwZXJhbnRvPwogICAgICAgKiB2YXIgZW9Mb2NhbGUgPSByZXF1aXJlKCdkYXRlLWZucy9sb2NhbGUvZW8nKQogICAgICAgKiB2YXIgcmVzdWx0ID0gZGlzdGFuY2VJbldvcmRzKAogICAgICAgKiAgIG5ldyBEYXRlKDIwMTYsIDcsIDEpLAogICAgICAgKiAgIG5ldyBEYXRlKDIwMTUsIDAsIDEpLAogICAgICAgKiAgIHtsb2NhbGU6IGVvTG9jYWxlfQogICAgICAgKiApCiAgICAgICAqIC8vPT4gJ3BsaSBvbCAxIGphcm8nCiAgICAgICAqLwoKICAgICAgZnVuY3Rpb24gZGlzdGFuY2VJbldvcmRzKGRpcnR5RGF0ZVRvQ29tcGFyZSwgZGlydHlEYXRlLCBkaXJ0eU9wdGlvbnMpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IGRpcnR5T3B0aW9ucyB8fCB7fTsKICAgICAgICB2YXIgY29tcGFyaXNvbiA9IGNvbXBhcmVEZXNjKGRpcnR5RGF0ZVRvQ29tcGFyZSwgZGlydHlEYXRlKTsKICAgICAgICB2YXIgbG9jYWxlID0gb3B0aW9ucy5sb2NhbGU7CiAgICAgICAgdmFyIGxvY2FsaXplID0gZW5Mb2NhbGUuZGlzdGFuY2VJbldvcmRzLmxvY2FsaXplOwoKICAgICAgICBpZiAobG9jYWxlICYmIGxvY2FsZS5kaXN0YW5jZUluV29yZHMgJiYgbG9jYWxlLmRpc3RhbmNlSW5Xb3Jkcy5sb2NhbGl6ZSkgewogICAgICAgICAgbG9jYWxpemUgPSBsb2NhbGUuZGlzdGFuY2VJbldvcmRzLmxvY2FsaXplOwogICAgICAgIH0KCiAgICAgICAgdmFyIGxvY2FsaXplT3B0aW9ucyA9IHsKICAgICAgICAgIGFkZFN1ZmZpeDogQm9vbGVhbihvcHRpb25zLmFkZFN1ZmZpeCksCiAgICAgICAgICBjb21wYXJpc29uOiBjb21wYXJpc29uCiAgICAgICAgfTsKICAgICAgICB2YXIgZGF0ZUxlZnQsIGRhdGVSaWdodDsKCiAgICAgICAgaWYgKGNvbXBhcmlzb24gPiAwKSB7CiAgICAgICAgICBkYXRlTGVmdCA9IHBhcnNlKGRpcnR5RGF0ZVRvQ29tcGFyZSk7CiAgICAgICAgICBkYXRlUmlnaHQgPSBwYXJzZShkaXJ0eURhdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkYXRlTGVmdCA9IHBhcnNlKGRpcnR5RGF0ZSk7CiAgICAgICAgICBkYXRlUmlnaHQgPSBwYXJzZShkaXJ0eURhdGVUb0NvbXBhcmUpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNlY29uZHMgPSBkaWZmZXJlbmNlSW5TZWNvbmRzKGRhdGVSaWdodCwgZGF0ZUxlZnQpOwogICAgICAgIHZhciBvZmZzZXQgPSBkYXRlUmlnaHQuZ2V0VGltZXpvbmVPZmZzZXQoKSAtIGRhdGVMZWZ0LmdldFRpbWV6b25lT2Zmc2V0KCk7CiAgICAgICAgdmFyIG1pbnV0ZXMgPSBNYXRoLnJvdW5kKHNlY29uZHMgLyA2MCkgLSBvZmZzZXQ7CiAgICAgICAgdmFyIG1vbnRoczsgLy8gMCB1cCB0byAyIG1pbnMKCiAgICAgICAgaWYgKG1pbnV0ZXMgPCAyKSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5pbmNsdWRlU2Vjb25kcykgewogICAgICAgICAgICBpZiAoc2Vjb25kcyA8IDUpIHsKICAgICAgICAgICAgICByZXR1cm4gbG9jYWxpemUoJ2xlc3NUaGFuWFNlY29uZHMnLCA1LCBsb2NhbGl6ZU9wdGlvbnMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNlY29uZHMgPCAxMCkgewogICAgICAgICAgICAgIHJldHVybiBsb2NhbGl6ZSgnbGVzc1RoYW5YU2Vjb25kcycsIDEwLCBsb2NhbGl6ZU9wdGlvbnMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNlY29uZHMgPCAyMCkgewogICAgICAgICAgICAgIHJldHVybiBsb2NhbGl6ZSgnbGVzc1RoYW5YU2Vjb25kcycsIDIwLCBsb2NhbGl6ZU9wdGlvbnMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNlY29uZHMgPCA0MCkgewogICAgICAgICAgICAgIHJldHVybiBsb2NhbGl6ZSgnaGFsZkFNaW51dGUnLCBudWxsLCBsb2NhbGl6ZU9wdGlvbnMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNlY29uZHMgPCA2MCkgewogICAgICAgICAgICAgIHJldHVybiBsb2NhbGl6ZSgnbGVzc1RoYW5YTWludXRlcycsIDEsIGxvY2FsaXplT3B0aW9ucyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIGxvY2FsaXplKCd4TWludXRlcycsIDEsIGxvY2FsaXplT3B0aW9ucyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChtaW51dGVzID09PSAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGxvY2FsaXplKCdsZXNzVGhhblhNaW51dGVzJywgMSwgbG9jYWxpemVPcHRpb25zKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gbG9jYWxpemUoJ3hNaW51dGVzJywgbWludXRlcywgbG9jYWxpemVPcHRpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyAyIG1pbnMgdXAgdG8gMC43NSBocnMKCiAgICAgICAgfSBlbHNlIGlmIChtaW51dGVzIDwgNDUpIHsKICAgICAgICAgIHJldHVybiBsb2NhbGl6ZSgneE1pbnV0ZXMnLCBtaW51dGVzLCBsb2NhbGl6ZU9wdGlvbnMpOyAvLyAwLjc1IGhycyB1cCB0byAxLjUgaHJzCiAgICAgICAgfSBlbHNlIGlmIChtaW51dGVzIDwgOTApIHsKICAgICAgICAgIHJldHVybiBsb2NhbGl6ZSgnYWJvdXRYSG91cnMnLCAxLCBsb2NhbGl6ZU9wdGlvbnMpOyAvLyAxLjUgaHJzIHVwIHRvIDI0IGhycwogICAgICAgIH0gZWxzZSBpZiAobWludXRlcyA8IE1JTlVURVNfSU5fREFZKSB7CiAgICAgICAgICB2YXIgaG91cnMgPSBNYXRoLnJvdW5kKG1pbnV0ZXMgLyA2MCk7CiAgICAgICAgICByZXR1cm4gbG9jYWxpemUoJ2Fib3V0WEhvdXJzJywgaG91cnMsIGxvY2FsaXplT3B0aW9ucyk7IC8vIDEgZGF5IHVwIHRvIDEuNzUgZGF5cwogICAgICAgIH0gZWxzZSBpZiAobWludXRlcyA8IE1JTlVURVNfSU5fQUxNT1NUX1RXT19EQVlTKSB7CiAgICAgICAgICByZXR1cm4gbG9jYWxpemUoJ3hEYXlzJywgMSwgbG9jYWxpemVPcHRpb25zKTsgLy8gMS43NSBkYXlzIHVwIHRvIDMwIGRheXMKICAgICAgICB9IGVsc2UgaWYgKG1pbnV0ZXMgPCBNSU5VVEVTX0lOX01PTlRIKSB7CiAgICAgICAgICB2YXIgZGF5cyA9IE1hdGgucm91bmQobWludXRlcyAvIE1JTlVURVNfSU5fREFZKTsKICAgICAgICAgIHJldHVybiBsb2NhbGl6ZSgneERheXMnLCBkYXlzLCBsb2NhbGl6ZU9wdGlvbnMpOyAvLyAxIG1vbnRoIHVwIHRvIDIgbW9udGhzCiAgICAgICAgfSBlbHNlIGlmIChtaW51dGVzIDwgTUlOVVRFU19JTl9UV09fTU9OVEhTKSB7CiAgICAgICAgICBtb250aHMgPSBNYXRoLnJvdW5kKG1pbnV0ZXMgLyBNSU5VVEVTX0lOX01PTlRIKTsKICAgICAgICAgIHJldHVybiBsb2NhbGl6ZSgnYWJvdXRYTW9udGhzJywgbW9udGhzLCBsb2NhbGl6ZU9wdGlvbnMpOwogICAgICAgIH0KCiAgICAgICAgbW9udGhzID0gZGlmZmVyZW5jZUluTW9udGhzKGRhdGVSaWdodCwgZGF0ZUxlZnQpOyAvLyAyIG1vbnRocyB1cCB0byAxMiBtb250aHMKCiAgICAgICAgaWYgKG1vbnRocyA8IDEyKSB7CiAgICAgICAgICB2YXIgbmVhcmVzdE1vbnRoID0gTWF0aC5yb3VuZChtaW51dGVzIC8gTUlOVVRFU19JTl9NT05USCk7CiAgICAgICAgICByZXR1cm4gbG9jYWxpemUoJ3hNb250aHMnLCBuZWFyZXN0TW9udGgsIGxvY2FsaXplT3B0aW9ucyk7IC8vIDEgeWVhciB1cCB0byBtYXggRGF0ZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgbW9udGhzU2luY2VTdGFydE9mWWVhciA9IG1vbnRocyAlIDEyOwogICAgICAgICAgdmFyIHllYXJzID0gTWF0aC5mbG9vcihtb250aHMgLyAxMik7IC8vIE4geWVhcnMgdXAgdG8gMSB5ZWFycyAzIG1vbnRocwoKICAgICAgICAgIGlmIChtb250aHNTaW5jZVN0YXJ0T2ZZZWFyIDwgMykgewogICAgICAgICAgICByZXR1cm4gbG9jYWxpemUoJ2Fib3V0WFllYXJzJywgeWVhcnMsIGxvY2FsaXplT3B0aW9ucyk7IC8vIE4geWVhcnMgMyBtb250aHMgdXAgdG8gTiB5ZWFycyA5IG1vbnRocwogICAgICAgICAgfSBlbHNlIGlmIChtb250aHNTaW5jZVN0YXJ0T2ZZZWFyIDwgOSkgewogICAgICAgICAgICByZXR1cm4gbG9jYWxpemUoJ292ZXJYWWVhcnMnLCB5ZWFycywgbG9jYWxpemVPcHRpb25zKTsgLy8gTiB5ZWFycyA5IG1vbnRocyB1cCB0byBOIHllYXIgMTIgbW9udGhzCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbG9jYWxpemUoJ2FsbW9zdFhZZWFycycsIHllYXJzICsgMSwgbG9jYWxpemVPcHRpb25zKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZGlzdGFuY2VJbldvcmRzOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDIwMSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBwYXJzZSA9IF9fd2VicGFja19yZXF1aXJlX18oMTgpOwogICAgICAvKioKICAgICAgICogQGNhdGVnb3J5IENvbW1vbiBIZWxwZXJzCiAgICAgICAqIEBzdW1tYXJ5IENvbXBhcmUgdGhlIHR3byBkYXRlcyByZXZlcnNlIGNocm9ub2xvZ2ljYWxseSBhbmQgcmV0dXJuIC0xLCAwIG9yIDEuCiAgICAgICAqCiAgICAgICAqIEBkZXNjcmlwdGlvbgogICAgICAgKiBDb21wYXJlIHRoZSB0d28gZGF0ZXMgYW5kIHJldHVybiAtMSBpZiB0aGUgZmlyc3QgZGF0ZSBpcyBhZnRlciB0aGUgc2Vjb25kLAogICAgICAgKiAxIGlmIHRoZSBmaXJzdCBkYXRlIGlzIGJlZm9yZSB0aGUgc2Vjb25kIG9yIDAgaWYgZGF0ZXMgYXJlIGVxdWFsLgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge0RhdGV8U3RyaW5nfE51bWJlcn0gZGF0ZUxlZnQgLSB0aGUgZmlyc3QgZGF0ZSB0byBjb21wYXJlCiAgICAgICAqIEBwYXJhbSB7RGF0ZXxTdHJpbmd8TnVtYmVyfSBkYXRlUmlnaHQgLSB0aGUgc2Vjb25kIGRhdGUgdG8gY29tcGFyZQogICAgICAgKiBAcmV0dXJucyB7TnVtYmVyfSB0aGUgcmVzdWx0IG9mIHRoZSBjb21wYXJpc29uCiAgICAgICAqCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIC8vIENvbXBhcmUgMTEgRmVicnVhcnkgMTk4NyBhbmQgMTAgSnVseSAxOTg5IHJldmVyc2UgY2hyb25vbG9naWNhbGx5OgogICAgICAgKiB2YXIgcmVzdWx0ID0gY29tcGFyZURlc2MoCiAgICAgICAqICAgbmV3IERhdGUoMTk4NywgMSwgMTEpLAogICAgICAgKiAgIG5ldyBEYXRlKDE5ODksIDYsIDEwKQogICAgICAgKiApCiAgICAgICAqIC8vPT4gMQogICAgICAgKgogICAgICAgKiBAZXhhbXBsZQogICAgICAgKiAvLyBTb3J0IHRoZSBhcnJheSBvZiBkYXRlcyBpbiByZXZlcnNlIGNocm9ub2xvZ2ljYWwgb3JkZXI6CiAgICAgICAqIHZhciByZXN1bHQgPSBbCiAgICAgICAqICAgbmV3IERhdGUoMTk5NSwgNiwgMiksCiAgICAgICAqICAgbmV3IERhdGUoMTk4NywgMSwgMTEpLAogICAgICAgKiAgIG5ldyBEYXRlKDE5ODksIDYsIDEwKQogICAgICAgKiBdLnNvcnQoY29tcGFyZURlc2MpCiAgICAgICAqIC8vPT4gWwogICAgICAgKiAvLyAgIFN1biBKdWwgMDIgMTk5NSAwMDowMDowMCwKICAgICAgICogLy8gICBNb24gSnVsIDEwIDE5ODkgMDA6MDA6MDAsCiAgICAgICAqIC8vICAgV2VkIEZlYiAxMSAxOTg3IDAwOjAwOjAwCiAgICAgICAqIC8vIF0KICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gY29tcGFyZURlc2MoZGlydHlEYXRlTGVmdCwgZGlydHlEYXRlUmlnaHQpIHsKICAgICAgICB2YXIgZGF0ZUxlZnQgPSBwYXJzZShkaXJ0eURhdGVMZWZ0KTsKICAgICAgICB2YXIgdGltZUxlZnQgPSBkYXRlTGVmdC5nZXRUaW1lKCk7CiAgICAgICAgdmFyIGRhdGVSaWdodCA9IHBhcnNlKGRpcnR5RGF0ZVJpZ2h0KTsKICAgICAgICB2YXIgdGltZVJpZ2h0ID0gZGF0ZVJpZ2h0LmdldFRpbWUoKTsKCiAgICAgICAgaWYgKHRpbWVMZWZ0ID4gdGltZVJpZ2h0KSB7CiAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfSBlbHNlIGlmICh0aW1lTGVmdCA8IHRpbWVSaWdodCkgewogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgfQoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBjb21wYXJlRGVzYzsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAyMDIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICAvKioKICAgICAgICogQGNhdGVnb3J5IENvbW1vbiBIZWxwZXJzCiAgICAgICAqIEBzdW1tYXJ5IElzIHRoZSBnaXZlbiBhcmd1bWVudCBhbiBpbnN0YW5jZSBvZiBEYXRlPwogICAgICAgKgogICAgICAgKiBAZGVzY3JpcHRpb24KICAgICAgICogSXMgdGhlIGdpdmVuIGFyZ3VtZW50IGFuIGluc3RhbmNlIG9mIERhdGU/CiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7Kn0gYXJndW1lbnQgLSB0aGUgYXJndW1lbnQgdG8gY2hlY2sKICAgICAgICogQHJldHVybnMge0Jvb2xlYW59IHRoZSBnaXZlbiBhcmd1bWVudCBpcyBhbiBpbnN0YW5jZSBvZiBEYXRlCiAgICAgICAqCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIC8vIElzICdtYXlvbm5haXNlJyBhIERhdGU/CiAgICAgICAqIHZhciByZXN1bHQgPSBpc0RhdGUoJ21heW9ubmFpc2UnKQogICAgICAgKiAvLz0+IGZhbHNlCiAgICAgICAqLwogICAgICBmdW5jdGlvbiBpc0RhdGUoYXJndW1lbnQpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnQgaW5zdGFuY2VvZiBEYXRlOwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGlzRGF0ZTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAyMDMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgZGlmZmVyZW5jZUluTWlsbGlzZWNvbmRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMDQpOwogICAgICAvKioKICAgICAgICogQGNhdGVnb3J5IFNlY29uZCBIZWxwZXJzCiAgICAgICAqIEBzdW1tYXJ5IEdldCB0aGUgbnVtYmVyIG9mIHNlY29uZHMgYmV0d2VlbiB0aGUgZ2l2ZW4gZGF0ZXMuCiAgICAgICAqCiAgICAgICAqIEBkZXNjcmlwdGlvbgogICAgICAgKiBHZXQgdGhlIG51bWJlciBvZiBzZWNvbmRzIGJldHdlZW4gdGhlIGdpdmVuIGRhdGVzLgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge0RhdGV8U3RyaW5nfE51bWJlcn0gZGF0ZUxlZnQgLSB0aGUgbGF0ZXIgZGF0ZQogICAgICAgKiBAcGFyYW0ge0RhdGV8U3RyaW5nfE51bWJlcn0gZGF0ZVJpZ2h0IC0gdGhlIGVhcmxpZXIgZGF0ZQogICAgICAgKiBAcmV0dXJucyB7TnVtYmVyfSB0aGUgbnVtYmVyIG9mIHNlY29uZHMKICAgICAgICoKICAgICAgICogQGV4YW1wbGUKICAgICAgICogLy8gSG93IG1hbnkgc2Vjb25kcyBhcmUgYmV0d2VlbgogICAgICAgKiAvLyAyIEp1bHkgMjAxNCAxMjozMDowNy45OTkgYW5kIDIgSnVseSAyMDE0IDEyOjMwOjIwLjAwMD8KICAgICAgICogdmFyIHJlc3VsdCA9IGRpZmZlcmVuY2VJblNlY29uZHMoCiAgICAgICAqICAgbmV3IERhdGUoMjAxNCwgNiwgMiwgMTIsIDMwLCAyMCwgMCksCiAgICAgICAqICAgbmV3IERhdGUoMjAxNCwgNiwgMiwgMTIsIDMwLCA3LCA5OTkpCiAgICAgICAqICkKICAgICAgICogLy89PiAxMgogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBkaWZmZXJlbmNlSW5TZWNvbmRzKGRpcnR5RGF0ZUxlZnQsIGRpcnR5RGF0ZVJpZ2h0KSB7CiAgICAgICAgdmFyIGRpZmYgPSBkaWZmZXJlbmNlSW5NaWxsaXNlY29uZHMoZGlydHlEYXRlTGVmdCwgZGlydHlEYXRlUmlnaHQpIC8gMTAwMDsKICAgICAgICByZXR1cm4gZGlmZiA+IDAgPyBNYXRoLmZsb29yKGRpZmYpIDogTWF0aC5jZWlsKGRpZmYpOwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGRpZmZlcmVuY2VJblNlY29uZHM7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjA0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIHBhcnNlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOCk7CiAgICAgIC8qKgogICAgICAgKiBAY2F0ZWdvcnkgTWlsbGlzZWNvbmQgSGVscGVycwogICAgICAgKiBAc3VtbWFyeSBHZXQgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgYmV0d2VlbiB0aGUgZ2l2ZW4gZGF0ZXMuCiAgICAgICAqCiAgICAgICAqIEBkZXNjcmlwdGlvbgogICAgICAgKiBHZXQgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgYmV0d2VlbiB0aGUgZ2l2ZW4gZGF0ZXMuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7RGF0ZXxTdHJpbmd8TnVtYmVyfSBkYXRlTGVmdCAtIHRoZSBsYXRlciBkYXRlCiAgICAgICAqIEBwYXJhbSB7RGF0ZXxTdHJpbmd8TnVtYmVyfSBkYXRlUmlnaHQgLSB0aGUgZWFybGllciBkYXRlCiAgICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9IHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzCiAgICAgICAqCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIC8vIEhvdyBtYW55IG1pbGxpc2Vjb25kcyBhcmUgYmV0d2VlbgogICAgICAgKiAvLyAyIEp1bHkgMjAxNCAxMjozMDoyMC42MDAgYW5kIDIgSnVseSAyMDE0IDEyOjMwOjIxLjcwMD8KICAgICAgICogdmFyIHJlc3VsdCA9IGRpZmZlcmVuY2VJbk1pbGxpc2Vjb25kcygKICAgICAgICogICBuZXcgRGF0ZSgyMDE0LCA2LCAyLCAxMiwgMzAsIDIxLCA3MDApLAogICAgICAgKiAgIG5ldyBEYXRlKDIwMTQsIDYsIDIsIDEyLCAzMCwgMjAsIDYwMCkKICAgICAgICogKQogICAgICAgKiAvLz0+IDExMDAKICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gZGlmZmVyZW5jZUluTWlsbGlzZWNvbmRzKGRpcnR5RGF0ZUxlZnQsIGRpcnR5RGF0ZVJpZ2h0KSB7CiAgICAgICAgdmFyIGRhdGVMZWZ0ID0gcGFyc2UoZGlydHlEYXRlTGVmdCk7CiAgICAgICAgdmFyIGRhdGVSaWdodCA9IHBhcnNlKGRpcnR5RGF0ZVJpZ2h0KTsKICAgICAgICByZXR1cm4gZGF0ZUxlZnQuZ2V0VGltZSgpIC0gZGF0ZVJpZ2h0LmdldFRpbWUoKTsKICAgICAgfQoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBkaWZmZXJlbmNlSW5NaWxsaXNlY29uZHM7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjA1ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIHBhcnNlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOCk7CgogICAgICB2YXIgZGlmZmVyZW5jZUluQ2FsZW5kYXJNb250aHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwNik7CgogICAgICB2YXIgY29tcGFyZUFzYyA9IF9fd2VicGFja19yZXF1aXJlX18oMjA3KTsKICAgICAgLyoqCiAgICAgICAqIEBjYXRlZ29yeSBNb250aCBIZWxwZXJzCiAgICAgICAqIEBzdW1tYXJ5IEdldCB0aGUgbnVtYmVyIG9mIGZ1bGwgbW9udGhzIGJldHdlZW4gdGhlIGdpdmVuIGRhdGVzLgogICAgICAgKgogICAgICAgKiBAZGVzY3JpcHRpb24KICAgICAgICogR2V0IHRoZSBudW1iZXIgb2YgZnVsbCBtb250aHMgYmV0d2VlbiB0aGUgZ2l2ZW4gZGF0ZXMuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7RGF0ZXxTdHJpbmd8TnVtYmVyfSBkYXRlTGVmdCAtIHRoZSBsYXRlciBkYXRlCiAgICAgICAqIEBwYXJhbSB7RGF0ZXxTdHJpbmd8TnVtYmVyfSBkYXRlUmlnaHQgLSB0aGUgZWFybGllciBkYXRlCiAgICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9IHRoZSBudW1iZXIgb2YgZnVsbCBtb250aHMKICAgICAgICoKICAgICAgICogQGV4YW1wbGUKICAgICAgICogLy8gSG93IG1hbnkgZnVsbCBtb250aHMgYXJlIGJldHdlZW4gMzEgSmFudWFyeSAyMDE0IGFuZCAxIFNlcHRlbWJlciAyMDE0PwogICAgICAgKiB2YXIgcmVzdWx0ID0gZGlmZmVyZW5jZUluTW9udGhzKAogICAgICAgKiAgIG5ldyBEYXRlKDIwMTQsIDgsIDEpLAogICAgICAgKiAgIG5ldyBEYXRlKDIwMTQsIDAsIDMxKQogICAgICAgKiApCiAgICAgICAqIC8vPT4gNwogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBkaWZmZXJlbmNlSW5Nb250aHMoZGlydHlEYXRlTGVmdCwgZGlydHlEYXRlUmlnaHQpIHsKICAgICAgICB2YXIgZGF0ZUxlZnQgPSBwYXJzZShkaXJ0eURhdGVMZWZ0KTsKICAgICAgICB2YXIgZGF0ZVJpZ2h0ID0gcGFyc2UoZGlydHlEYXRlUmlnaHQpOwogICAgICAgIHZhciBzaWduID0gY29tcGFyZUFzYyhkYXRlTGVmdCwgZGF0ZVJpZ2h0KTsKICAgICAgICB2YXIgZGlmZmVyZW5jZSA9IE1hdGguYWJzKGRpZmZlcmVuY2VJbkNhbGVuZGFyTW9udGhzKGRhdGVMZWZ0LCBkYXRlUmlnaHQpKTsKICAgICAgICBkYXRlTGVmdC5zZXRNb250aChkYXRlTGVmdC5nZXRNb250aCgpIC0gc2lnbiAqIGRpZmZlcmVuY2UpOyAvLyBNYXRoLmFicyhkaWZmIGluIGZ1bGwgbW9udGhzIC0gZGlmZiBpbiBjYWxlbmRhciBtb250aHMpID09PSAxIGlmIGxhc3QgY2FsZW5kYXIgbW9udGggaXMgbm90IGZ1bGwKICAgICAgICAvLyBJZiBzbywgcmVzdWx0IG11c3QgYmUgZGVjcmVhc2VkIGJ5IDEgaW4gYWJzb2x1dGUgdmFsdWUKCiAgICAgICAgdmFyIGlzTGFzdE1vbnRoTm90RnVsbCA9IGNvbXBhcmVBc2MoZGF0ZUxlZnQsIGRhdGVSaWdodCkgPT09IC1zaWduOwogICAgICAgIHJldHVybiBzaWduICogKGRpZmZlcmVuY2UgLSBpc0xhc3RNb250aE5vdEZ1bGwpOwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGRpZmZlcmVuY2VJbk1vbnRoczsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAyMDYgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgcGFyc2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4KTsKICAgICAgLyoqCiAgICAgICAqIEBjYXRlZ29yeSBNb250aCBIZWxwZXJzCiAgICAgICAqIEBzdW1tYXJ5IEdldCB0aGUgbnVtYmVyIG9mIGNhbGVuZGFyIG1vbnRocyBiZXR3ZWVuIHRoZSBnaXZlbiBkYXRlcy4KICAgICAgICoKICAgICAgICogQGRlc2NyaXB0aW9uCiAgICAgICAqIEdldCB0aGUgbnVtYmVyIG9mIGNhbGVuZGFyIG1vbnRocyBiZXR3ZWVuIHRoZSBnaXZlbiBkYXRlcy4KICAgICAgICoKICAgICAgICogQHBhcmFtIHtEYXRlfFN0cmluZ3xOdW1iZXJ9IGRhdGVMZWZ0IC0gdGhlIGxhdGVyIGRhdGUKICAgICAgICogQHBhcmFtIHtEYXRlfFN0cmluZ3xOdW1iZXJ9IGRhdGVSaWdodCAtIHRoZSBlYXJsaWVyIGRhdGUKICAgICAgICogQHJldHVybnMge051bWJlcn0gdGhlIG51bWJlciBvZiBjYWxlbmRhciBtb250aHMKICAgICAgICoKICAgICAgICogQGV4YW1wbGUKICAgICAgICogLy8gSG93IG1hbnkgY2FsZW5kYXIgbW9udGhzIGFyZSBiZXR3ZWVuIDMxIEphbnVhcnkgMjAxNCBhbmQgMSBTZXB0ZW1iZXIgMjAxND8KICAgICAgICogdmFyIHJlc3VsdCA9IGRpZmZlcmVuY2VJbkNhbGVuZGFyTW9udGhzKAogICAgICAgKiAgIG5ldyBEYXRlKDIwMTQsIDgsIDEpLAogICAgICAgKiAgIG5ldyBEYXRlKDIwMTQsIDAsIDMxKQogICAgICAgKiApCiAgICAgICAqIC8vPT4gOAogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiBkaWZmZXJlbmNlSW5DYWxlbmRhck1vbnRocyhkaXJ0eURhdGVMZWZ0LCBkaXJ0eURhdGVSaWdodCkgewogICAgICAgIHZhciBkYXRlTGVmdCA9IHBhcnNlKGRpcnR5RGF0ZUxlZnQpOwogICAgICAgIHZhciBkYXRlUmlnaHQgPSBwYXJzZShkaXJ0eURhdGVSaWdodCk7CiAgICAgICAgdmFyIHllYXJEaWZmID0gZGF0ZUxlZnQuZ2V0RnVsbFllYXIoKSAtIGRhdGVSaWdodC5nZXRGdWxsWWVhcigpOwogICAgICAgIHZhciBtb250aERpZmYgPSBkYXRlTGVmdC5nZXRNb250aCgpIC0gZGF0ZVJpZ2h0LmdldE1vbnRoKCk7CiAgICAgICAgcmV0dXJuIHllYXJEaWZmICogMTIgKyBtb250aERpZmY7CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZGlmZmVyZW5jZUluQ2FsZW5kYXJNb250aHM7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjA3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIHBhcnNlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOCk7CiAgICAgIC8qKgogICAgICAgKiBAY2F0ZWdvcnkgQ29tbW9uIEhlbHBlcnMKICAgICAgICogQHN1bW1hcnkgQ29tcGFyZSB0aGUgdHdvIGRhdGVzIGFuZCByZXR1cm4gLTEsIDAgb3IgMS4KICAgICAgICoKICAgICAgICogQGRlc2NyaXB0aW9uCiAgICAgICAqIENvbXBhcmUgdGhlIHR3byBkYXRlcyBhbmQgcmV0dXJuIDEgaWYgdGhlIGZpcnN0IGRhdGUgaXMgYWZ0ZXIgdGhlIHNlY29uZCwKICAgICAgICogLTEgaWYgdGhlIGZpcnN0IGRhdGUgaXMgYmVmb3JlIHRoZSBzZWNvbmQgb3IgMCBpZiBkYXRlcyBhcmUgZXF1YWwuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7RGF0ZXxTdHJpbmd8TnVtYmVyfSBkYXRlTGVmdCAtIHRoZSBmaXJzdCBkYXRlIHRvIGNvbXBhcmUKICAgICAgICogQHBhcmFtIHtEYXRlfFN0cmluZ3xOdW1iZXJ9IGRhdGVSaWdodCAtIHRoZSBzZWNvbmQgZGF0ZSB0byBjb21wYXJlCiAgICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9IHRoZSByZXN1bHQgb2YgdGhlIGNvbXBhcmlzb24KICAgICAgICoKICAgICAgICogQGV4YW1wbGUKICAgICAgICogLy8gQ29tcGFyZSAxMSBGZWJydWFyeSAxOTg3IGFuZCAxMCBKdWx5IDE5ODk6CiAgICAgICAqIHZhciByZXN1bHQgPSBjb21wYXJlQXNjKAogICAgICAgKiAgIG5ldyBEYXRlKDE5ODcsIDEsIDExKSwKICAgICAgICogICBuZXcgRGF0ZSgxOTg5LCA2LCAxMCkKICAgICAgICogKQogICAgICAgKiAvLz0+IC0xCiAgICAgICAqCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIC8vIFNvcnQgdGhlIGFycmF5IG9mIGRhdGVzOgogICAgICAgKiB2YXIgcmVzdWx0ID0gWwogICAgICAgKiAgIG5ldyBEYXRlKDE5OTUsIDYsIDIpLAogICAgICAgKiAgIG5ldyBEYXRlKDE5ODcsIDEsIDExKSwKICAgICAgICogICBuZXcgRGF0ZSgxOTg5LCA2LCAxMCkKICAgICAgICogXS5zb3J0KGNvbXBhcmVBc2MpCiAgICAgICAqIC8vPT4gWwogICAgICAgKiAvLyAgIFdlZCBGZWIgMTEgMTk4NyAwMDowMDowMCwKICAgICAgICogLy8gICBNb24gSnVsIDEwIDE5ODkgMDA6MDA6MDAsCiAgICAgICAqIC8vICAgU3VuIEp1bCAwMiAxOTk1IDAwOjAwOjAwCiAgICAgICAqIC8vIF0KICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gY29tcGFyZUFzYyhkaXJ0eURhdGVMZWZ0LCBkaXJ0eURhdGVSaWdodCkgewogICAgICAgIHZhciBkYXRlTGVmdCA9IHBhcnNlKGRpcnR5RGF0ZUxlZnQpOwogICAgICAgIHZhciB0aW1lTGVmdCA9IGRhdGVMZWZ0LmdldFRpbWUoKTsKICAgICAgICB2YXIgZGF0ZVJpZ2h0ID0gcGFyc2UoZGlydHlEYXRlUmlnaHQpOwogICAgICAgIHZhciB0aW1lUmlnaHQgPSBkYXRlUmlnaHQuZ2V0VGltZSgpOwoKICAgICAgICBpZiAodGltZUxlZnQgPCB0aW1lUmlnaHQpIHsKICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9IGVsc2UgaWYgKHRpbWVMZWZ0ID4gdGltZVJpZ2h0KSB7CiAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGNvbXBhcmVBc2M7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjA4ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGJ1aWxkRGlzdGFuY2VJbldvcmRzTG9jYWxlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMDkpOwoKICAgICAgdmFyIGJ1aWxkRm9ybWF0TG9jYWxlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMTApOwogICAgICAvKioKICAgICAgICogQGNhdGVnb3J5IExvY2FsZXMKICAgICAgICogQHN1bW1hcnkgRW5nbGlzaCBsb2NhbGUuCiAgICAgICAqLwoKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgIGRpc3RhbmNlSW5Xb3JkczogYnVpbGREaXN0YW5jZUluV29yZHNMb2NhbGUoKSwKICAgICAgICBmb3JtYXQ6IGJ1aWxkRm9ybWF0TG9jYWxlKCkKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAyMDkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBmdW5jdGlvbiBidWlsZERpc3RhbmNlSW5Xb3Jkc0xvY2FsZSgpIHsKICAgICAgICB2YXIgZGlzdGFuY2VJbldvcmRzTG9jYWxlID0gewogICAgICAgICAgbGVzc1RoYW5YU2Vjb25kczogewogICAgICAgICAgICBvbmU6ICdsZXNzIHRoYW4gYSBzZWNvbmQnLAogICAgICAgICAgICBvdGhlcjogJ2xlc3MgdGhhbiB7e2NvdW50fX0gc2Vjb25kcycKICAgICAgICAgIH0sCiAgICAgICAgICB4U2Vjb25kczogewogICAgICAgICAgICBvbmU6ICcxIHNlY29uZCcsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IHNlY29uZHMnCiAgICAgICAgICB9LAogICAgICAgICAgaGFsZkFNaW51dGU6ICdoYWxmIGEgbWludXRlJywKICAgICAgICAgIGxlc3NUaGFuWE1pbnV0ZXM6IHsKICAgICAgICAgICAgb25lOiAnbGVzcyB0aGFuIGEgbWludXRlJywKICAgICAgICAgICAgb3RoZXI6ICdsZXNzIHRoYW4ge3tjb3VudH19IG1pbnV0ZXMnCiAgICAgICAgICB9LAogICAgICAgICAgeE1pbnV0ZXM6IHsKICAgICAgICAgICAgb25lOiAnMSBtaW51dGUnLAogICAgICAgICAgICBvdGhlcjogJ3t7Y291bnR9fSBtaW51dGVzJwogICAgICAgICAgfSwKICAgICAgICAgIGFib3V0WEhvdXJzOiB7CiAgICAgICAgICAgIG9uZTogJ2Fib3V0IDEgaG91cicsCiAgICAgICAgICAgIG90aGVyOiAnYWJvdXQge3tjb3VudH19IGhvdXJzJwogICAgICAgICAgfSwKICAgICAgICAgIHhIb3VyczogewogICAgICAgICAgICBvbmU6ICcxIGhvdXInLAogICAgICAgICAgICBvdGhlcjogJ3t7Y291bnR9fSBob3VycycKICAgICAgICAgIH0sCiAgICAgICAgICB4RGF5czogewogICAgICAgICAgICBvbmU6ICcxIGRheScsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IGRheXMnCiAgICAgICAgICB9LAogICAgICAgICAgYWJvdXRYTW9udGhzOiB7CiAgICAgICAgICAgIG9uZTogJ2Fib3V0IDEgbW9udGgnLAogICAgICAgICAgICBvdGhlcjogJ2Fib3V0IHt7Y291bnR9fSBtb250aHMnCiAgICAgICAgICB9LAogICAgICAgICAgeE1vbnRoczogewogICAgICAgICAgICBvbmU6ICcxIG1vbnRoJywKICAgICAgICAgICAgb3RoZXI6ICd7e2NvdW50fX0gbW9udGhzJwogICAgICAgICAgfSwKICAgICAgICAgIGFib3V0WFllYXJzOiB7CiAgICAgICAgICAgIG9uZTogJ2Fib3V0IDEgeWVhcicsCiAgICAgICAgICAgIG90aGVyOiAnYWJvdXQge3tjb3VudH19IHllYXJzJwogICAgICAgICAgfSwKICAgICAgICAgIHhZZWFyczogewogICAgICAgICAgICBvbmU6ICcxIHllYXInLAogICAgICAgICAgICBvdGhlcjogJ3t7Y291bnR9fSB5ZWFycycKICAgICAgICAgIH0sCiAgICAgICAgICBvdmVyWFllYXJzOiB7CiAgICAgICAgICAgIG9uZTogJ292ZXIgMSB5ZWFyJywKICAgICAgICAgICAgb3RoZXI6ICdvdmVyIHt7Y291bnR9fSB5ZWFycycKICAgICAgICAgIH0sCiAgICAgICAgICBhbG1vc3RYWWVhcnM6IHsKICAgICAgICAgICAgb25lOiAnYWxtb3N0IDEgeWVhcicsCiAgICAgICAgICAgIG90aGVyOiAnYWxtb3N0IHt7Y291bnR9fSB5ZWFycycKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBsb2NhbGl6ZSh0b2tlbiwgY291bnQsIG9wdGlvbnMpIHsKICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgdmFyIHJlc3VsdDsKCiAgICAgICAgICBpZiAodHlwZW9mIGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZVt0b2tlbl0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZVt0b2tlbl07CiAgICAgICAgICB9IGVsc2UgaWYgKGNvdW50ID09PSAxKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZVt0b2tlbl0ub25lOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gZGlzdGFuY2VJbldvcmRzTG9jYWxlW3Rva2VuXS5vdGhlci5yZXBsYWNlKCd7e2NvdW50fX0nLCBjb3VudCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9wdGlvbnMuYWRkU3VmZml4KSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmNvbXBhcmlzb24gPiAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuICdpbiAnICsgcmVzdWx0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiByZXN1bHQgKyAnIGFnbyc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGxvY2FsaXplOiBsb2NhbGl6ZQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gYnVpbGREaXN0YW5jZUluV29yZHNMb2NhbGU7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjEwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGJ1aWxkRm9ybWF0dGluZ1Rva2Vuc1JlZ0V4cCA9IF9fd2VicGFja19yZXF1aXJlX18oMjExKTsKCiAgICAgIGZ1bmN0aW9uIGJ1aWxkRm9ybWF0TG9jYWxlKCkgewogICAgICAgIC8vIE5vdGU6IGluIEVuZ2xpc2gsIHRoZSBuYW1lcyBvZiBkYXlzIG9mIHRoZSB3ZWVrIGFuZCBtb250aHMgYXJlIGNhcGl0YWxpemVkLgogICAgICAgIC8vIElmIHlvdSBhcmUgbWFraW5nIGEgbmV3IGxvY2FsZSBiYXNlZCBvbiB0aGlzIG9uZSwgY2hlY2sgaWYgdGhlIHNhbWUgaXMgdHJ1ZSBmb3IgdGhlIGxhbmd1YWdlIHlvdSdyZSB3b3JraW5nIG9uLgogICAgICAgIC8vIEdlbmVyYWxseSwgZm9ybWF0dGVkIGRhdGVzIHNob3VsZCBsb29rIGxpa2UgdGhleSBhcmUgaW4gdGhlIG1pZGRsZSBvZiBhIHNlbnRlbmNlLAogICAgICAgIC8vIGUuZy4gaW4gU3BhbmlzaCBsYW5ndWFnZSB0aGUgd2Vla2RheXMgYW5kIG1vbnRocyBzaG91bGQgYmUgaW4gdGhlIGxvd2VyY2FzZS4KICAgICAgICB2YXIgbW9udGhzM2NoYXIgPSBbJ0phbicsICdGZWInLCAnTWFyJywgJ0FwcicsICdNYXknLCAnSnVuJywgJ0p1bCcsICdBdWcnLCAnU2VwJywgJ09jdCcsICdOb3YnLCAnRGVjJ107CiAgICAgICAgdmFyIG1vbnRoc0Z1bGwgPSBbJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXTsKICAgICAgICB2YXIgd2Vla2RheXMyY2hhciA9IFsnU3UnLCAnTW8nLCAnVHUnLCAnV2UnLCAnVGgnLCAnRnInLCAnU2EnXTsKICAgICAgICB2YXIgd2Vla2RheXMzY2hhciA9IFsnU3VuJywgJ01vbicsICdUdWUnLCAnV2VkJywgJ1RodScsICdGcmknLCAnU2F0J107CiAgICAgICAgdmFyIHdlZWtkYXlzRnVsbCA9IFsnU3VuZGF5JywgJ01vbmRheScsICdUdWVzZGF5JywgJ1dlZG5lc2RheScsICdUaHVyc2RheScsICdGcmlkYXknLCAnU2F0dXJkYXknXTsKICAgICAgICB2YXIgbWVyaWRpZW1VcHBlcmNhc2UgPSBbJ0FNJywgJ1BNJ107CiAgICAgICAgdmFyIG1lcmlkaWVtTG93ZXJjYXNlID0gWydhbScsICdwbSddOwogICAgICAgIHZhciBtZXJpZGllbUZ1bGwgPSBbJ2EubS4nLCAncC5tLiddOwogICAgICAgIHZhciBmb3JtYXR0ZXJzID0gewogICAgICAgICAgLy8gTW9udGg6IEphbiwgRmViLCAuLi4sIERlYwogICAgICAgICAgJ01NTSc6IGZ1bmN0aW9uIE1NTShkYXRlKSB7CiAgICAgICAgICAgIHJldHVybiBtb250aHMzY2hhcltkYXRlLmdldE1vbnRoKCldOwogICAgICAgICAgfSwKICAgICAgICAgIC8vIE1vbnRoOiBKYW51YXJ5LCBGZWJydWFyeSwgLi4uLCBEZWNlbWJlcgogICAgICAgICAgJ01NTU0nOiBmdW5jdGlvbiBNTU1NKGRhdGUpIHsKICAgICAgICAgICAgcmV0dXJuIG1vbnRoc0Z1bGxbZGF0ZS5nZXRNb250aCgpXTsKICAgICAgICAgIH0sCiAgICAgICAgICAvLyBEYXkgb2Ygd2VlazogU3UsIE1vLCAuLi4sIFNhCiAgICAgICAgICAnZGQnOiBmdW5jdGlvbiBkZChkYXRlKSB7CiAgICAgICAgICAgIHJldHVybiB3ZWVrZGF5czJjaGFyW2RhdGUuZ2V0RGF5KCldOwogICAgICAgICAgfSwKICAgICAgICAgIC8vIERheSBvZiB3ZWVrOiBTdW4sIE1vbiwgLi4uLCBTYXQKICAgICAgICAgICdkZGQnOiBmdW5jdGlvbiBkZGQoZGF0ZSkgewogICAgICAgICAgICByZXR1cm4gd2Vla2RheXMzY2hhcltkYXRlLmdldERheSgpXTsKICAgICAgICAgIH0sCiAgICAgICAgICAvLyBEYXkgb2Ygd2VlazogU3VuZGF5LCBNb25kYXksIC4uLiwgU2F0dXJkYXkKICAgICAgICAgICdkZGRkJzogZnVuY3Rpb24gZGRkZChkYXRlKSB7CiAgICAgICAgICAgIHJldHVybiB3ZWVrZGF5c0Z1bGxbZGF0ZS5nZXREYXkoKV07CiAgICAgICAgICB9LAogICAgICAgICAgLy8gQU0sIFBNCiAgICAgICAgICAnQSc6IGZ1bmN0aW9uIEEoZGF0ZSkgewogICAgICAgICAgICByZXR1cm4gZGF0ZS5nZXRIb3VycygpIC8gMTIgPj0gMSA/IG1lcmlkaWVtVXBwZXJjYXNlWzFdIDogbWVyaWRpZW1VcHBlcmNhc2VbMF07CiAgICAgICAgICB9LAogICAgICAgICAgLy8gYW0sIHBtCiAgICAgICAgICAnYSc6IGZ1bmN0aW9uIGEoZGF0ZSkgewogICAgICAgICAgICByZXR1cm4gZGF0ZS5nZXRIb3VycygpIC8gMTIgPj0gMSA/IG1lcmlkaWVtTG93ZXJjYXNlWzFdIDogbWVyaWRpZW1Mb3dlcmNhc2VbMF07CiAgICAgICAgICB9LAogICAgICAgICAgLy8gYS5tLiwgcC5tLgogICAgICAgICAgJ2FhJzogZnVuY3Rpb24gYWEoZGF0ZSkgewogICAgICAgICAgICByZXR1cm4gZGF0ZS5nZXRIb3VycygpIC8gMTIgPj0gMSA/IG1lcmlkaWVtRnVsbFsxXSA6IG1lcmlkaWVtRnVsbFswXTsKICAgICAgICAgIH0KICAgICAgICB9OyAvLyBHZW5lcmF0ZSBvcmRpbmFsIHZlcnNpb24gb2YgZm9ybWF0dGVyczogTSAtPiBNbywgRCAtPiBEbywgZXRjLgoKICAgICAgICB2YXIgb3JkaW5hbEZvcm1hdHRlcnMgPSBbJ00nLCAnRCcsICdEREQnLCAnZCcsICdRJywgJ1cnXTsKICAgICAgICBvcmRpbmFsRm9ybWF0dGVycy5mb3JFYWNoKGZ1bmN0aW9uIChmb3JtYXR0ZXJUb2tlbikgewogICAgICAgICAgZm9ybWF0dGVyc1tmb3JtYXR0ZXJUb2tlbiArICdvJ10gPSBmdW5jdGlvbiAoZGF0ZSwgZm9ybWF0dGVycykgewogICAgICAgICAgICByZXR1cm4gb3JkaW5hbChmb3JtYXR0ZXJzW2Zvcm1hdHRlclRva2VuXShkYXRlKSk7CiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBmb3JtYXR0ZXJzOiBmb3JtYXR0ZXJzLAogICAgICAgICAgZm9ybWF0dGluZ1Rva2Vuc1JlZ0V4cDogYnVpbGRGb3JtYXR0aW5nVG9rZW5zUmVnRXhwKGZvcm1hdHRlcnMpCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gb3JkaW5hbChudW1iZXIpIHsKICAgICAgICB2YXIgcmVtMTAwID0gbnVtYmVyICUgMTAwOwoKICAgICAgICBpZiAocmVtMTAwID4gMjAgfHwgcmVtMTAwIDwgMTApIHsKICAgICAgICAgIHN3aXRjaCAocmVtMTAwICUgMTApIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIHJldHVybiBudW1iZXIgKyAnc3QnOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHJldHVybiBudW1iZXIgKyAnbmQnOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHJldHVybiBudW1iZXIgKyAncmQnOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bWJlciArICd0aCc7CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gYnVpbGRGb3JtYXRMb2NhbGU7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjExICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgdmFyIGNvbW1vbkZvcm1hdHRlcktleXMgPSBbJ00nLCAnTU0nLCAnUScsICdEJywgJ0REJywgJ0RERCcsICdEREREJywgJ2QnLCAnRScsICdXJywgJ1dXJywgJ1lZJywgJ1lZWVknLCAnR0cnLCAnR0dHRycsICdIJywgJ0hIJywgJ2gnLCAnaGgnLCAnbScsICdtbScsICdzJywgJ3NzJywgJ1MnLCAnU1MnLCAnU1NTJywgJ1onLCAnWlonLCAnWCcsICd4J107CgogICAgICBmdW5jdGlvbiBidWlsZEZvcm1hdHRpbmdUb2tlbnNSZWdFeHAoZm9ybWF0dGVycykgewogICAgICAgIHZhciBmb3JtYXR0ZXJLZXlzID0gW107CgogICAgICAgIGZvciAodmFyIGtleSBpbiBmb3JtYXR0ZXJzKSB7CiAgICAgICAgICBpZiAoZm9ybWF0dGVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgIGZvcm1hdHRlcktleXMucHVzaChrZXkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGZvcm1hdHRpbmdUb2tlbnMgPSBjb21tb25Gb3JtYXR0ZXJLZXlzLmNvbmNhdChmb3JtYXR0ZXJLZXlzKS5zb3J0KCkucmV2ZXJzZSgpOwogICAgICAgIHZhciBmb3JtYXR0aW5nVG9rZW5zUmVnRXhwID0gbmV3IFJlZ0V4cCgnKFxcW1teXFxbXSpcXF0pfChcXFxcKT8nICsgJygnICsgZm9ybWF0dGluZ1Rva2Vucy5qb2luKCd8JykgKyAnfC4pJywgJ2cnKTsKICAgICAgICByZXR1cm4gZm9ybWF0dGluZ1Rva2Vuc1JlZ0V4cDsKICAgICAgfQoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBidWlsZEZvcm1hdHRpbmdUb2tlbnNSZWdFeHA7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjEyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgZnVuY3Rpb24gYnVpbGREaXN0YW5jZUluV29yZHNMb2NhbGUoKSB7CiAgICAgICAgdmFyIGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZSA9IHsKICAgICAgICAgIGxlc3NUaGFuWFNlY29uZHM6IHsKICAgICAgICAgICAgb25lOiAn5LiN5YiwIDEg56eSJywKICAgICAgICAgICAgb3RoZXI6ICfkuI3liLAge3tjb3VudH19IOenkicKICAgICAgICAgIH0sCiAgICAgICAgICB4U2Vjb25kczogewogICAgICAgICAgICBvbmU6ICcxIOenkicsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IOenkicKICAgICAgICAgIH0sCiAgICAgICAgICBoYWxmQU1pbnV0ZTogJ+WNiuWIhumSnycsCiAgICAgICAgICBsZXNzVGhhblhNaW51dGVzOiB7CiAgICAgICAgICAgIG9uZTogJ+S4jeWIsCAxIOWIhumSnycsCiAgICAgICAgICAgIG90aGVyOiAn5LiN5YiwIHt7Y291bnR9fSDliIbpkp8nCiAgICAgICAgICB9LAogICAgICAgICAgeE1pbnV0ZXM6IHsKICAgICAgICAgICAgb25lOiAnMSDliIbpkp8nLAogICAgICAgICAgICBvdGhlcjogJ3t7Y291bnR9fSDliIbpkp8nCiAgICAgICAgICB9LAogICAgICAgICAgeEhvdXJzOiB7CiAgICAgICAgICAgIG9uZTogJzEg5bCP5pe2JywKICAgICAgICAgICAgb3RoZXI6ICd7e2NvdW50fX0g5bCP5pe2JwogICAgICAgICAgfSwKICAgICAgICAgIGFib3V0WEhvdXJzOiB7CiAgICAgICAgICAgIG9uZTogJ+Wkp+e6piAxIOWwj+aXticsCiAgICAgICAgICAgIG90aGVyOiAn5aSn57qmIHt7Y291bnR9fSDlsI/ml7YnCiAgICAgICAgICB9LAogICAgICAgICAgeERheXM6IHsKICAgICAgICAgICAgb25lOiAnMSDlpKknLAogICAgICAgICAgICBvdGhlcjogJ3t7Y291bnR9fSDlpKknCiAgICAgICAgICB9LAogICAgICAgICAgYWJvdXRYTW9udGhzOiB7CiAgICAgICAgICAgIG9uZTogJ+Wkp+e6piAxIOS4quaciCcsCiAgICAgICAgICAgIG90aGVyOiAn5aSn57qmIHt7Y291bnR9fSDkuKrmnIgnCiAgICAgICAgICB9LAogICAgICAgICAgeE1vbnRoczogewogICAgICAgICAgICBvbmU6ICcxIOS4quaciCcsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IOS4quaciCcKICAgICAgICAgIH0sCiAgICAgICAgICBhYm91dFhZZWFyczogewogICAgICAgICAgICBvbmU6ICflpKfnuqYgMSDlubQnLAogICAgICAgICAgICBvdGhlcjogJ+Wkp+e6piB7e2NvdW50fX0g5bm0JwogICAgICAgICAgfSwKICAgICAgICAgIHhZZWFyczogewogICAgICAgICAgICBvbmU6ICcxIOW5tCcsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IOW5tCcKICAgICAgICAgIH0sCiAgICAgICAgICBvdmVyWFllYXJzOiB7CiAgICAgICAgICAgIG9uZTogJ+i2hei/hyAxIOW5tCcsCiAgICAgICAgICAgIG90aGVyOiAn6LaF6L+HIHt7Y291bnR9fSDlubQnCiAgICAgICAgICB9LAogICAgICAgICAgYWxtb3N0WFllYXJzOiB7CiAgICAgICAgICAgIG9uZTogJ+Wwhui/kSAxIOW5tCcsCiAgICAgICAgICAgIG90aGVyOiAn5bCG6L+RIHt7Y291bnR9fSDlubQnCiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gbG9jYWxpemUodG9rZW4sIGNvdW50LCBvcHRpb25zKSB7CiAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICAgIHZhciByZXN1bHQ7CgogICAgICAgICAgaWYgKHR5cGVvZiBkaXN0YW5jZUluV29yZHNMb2NhbGVbdG9rZW5dID09PSAnc3RyaW5nJykgewogICAgICAgICAgICByZXN1bHQgPSBkaXN0YW5jZUluV29yZHNMb2NhbGVbdG9rZW5dOwogICAgICAgICAgfSBlbHNlIGlmIChjb3VudCA9PT0gMSkgewogICAgICAgICAgICByZXN1bHQgPSBkaXN0YW5jZUluV29yZHNMb2NhbGVbdG9rZW5dLm9uZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZVt0b2tlbl0ub3RoZXIucmVwbGFjZSgne3tjb3VudH19JywgY291bnQpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChvcHRpb25zLmFkZFN1ZmZpeCkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5jb21wYXJpc29uID4gMCkgewogICAgICAgICAgICAgIHJldHVybiByZXN1bHQgKyAn5YaFJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0ICsgJ+WJjSc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGxvY2FsaXplOiBsb2NhbGl6ZQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gYnVpbGREaXN0YW5jZUluV29yZHNMb2NhbGU7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjEzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgZnVuY3Rpb24gYnVpbGREaXN0YW5jZUluV29yZHNMb2NhbGUoKSB7CiAgICAgICAgdmFyIGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZSA9IHsKICAgICAgICAgIGxlc3NUaGFuWFNlY29uZHM6IHsKICAgICAgICAgICAgb25lOiAn5bCR5pa8IDEg56eSJywKICAgICAgICAgICAgb3RoZXI6ICflsJHmlrwge3tjb3VudH19IOenkicKICAgICAgICAgIH0sCiAgICAgICAgICB4U2Vjb25kczogewogICAgICAgICAgICBvbmU6ICcxIOenkicsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IOenkicKICAgICAgICAgIH0sCiAgICAgICAgICBoYWxmQU1pbnV0ZTogJ+WNiuWIhumQmCcsCiAgICAgICAgICBsZXNzVGhhblhNaW51dGVzOiB7CiAgICAgICAgICAgIG9uZTogJ+WwkeaWvCAxIOWIhumQmCcsCiAgICAgICAgICAgIG90aGVyOiAn5bCR5pa8IHt7Y291bnR9fSDliIbpkJgnCiAgICAgICAgICB9LAogICAgICAgICAgeE1pbnV0ZXM6IHsKICAgICAgICAgICAgb25lOiAnMSDliIbpkJgnLAogICAgICAgICAgICBvdGhlcjogJ3t7Y291bnR9fSDliIbpkJgnCiAgICAgICAgICB9LAogICAgICAgICAgeEhvdXJzOiB7CiAgICAgICAgICAgIG9uZTogJzEg5bCP5pmCJywKICAgICAgICAgICAgb3RoZXI6ICd7e2NvdW50fX0g5bCP5pmCJwogICAgICAgICAgfSwKICAgICAgICAgIGFib3V0WEhvdXJzOiB7CiAgICAgICAgICAgIG9uZTogJ+Wkp+e0hCAxIOWwj+aZgicsCiAgICAgICAgICAgIG90aGVyOiAn5aSn57SEIHt7Y291bnR9fSDlsI/mmYInCiAgICAgICAgICB9LAogICAgICAgICAgeERheXM6IHsKICAgICAgICAgICAgb25lOiAnMSDlpKknLAogICAgICAgICAgICBvdGhlcjogJ3t7Y291bnR9fSDlpKknCiAgICAgICAgICB9LAogICAgICAgICAgYWJvdXRYTW9udGhzOiB7CiAgICAgICAgICAgIG9uZTogJ+Wkp+e0hCAxIOWAi+aciCcsCiAgICAgICAgICAgIG90aGVyOiAn5aSn57SEIHt7Y291bnR9fSDlgIvmnIgnCiAgICAgICAgICB9LAogICAgICAgICAgeE1vbnRoczogewogICAgICAgICAgICBvbmU6ICcxIOWAi+aciCcsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IOWAi+aciCcKICAgICAgICAgIH0sCiAgICAgICAgICBhYm91dFhZZWFyczogewogICAgICAgICAgICBvbmU6ICflpKfntIQgMSDlubQnLAogICAgICAgICAgICBvdGhlcjogJ+Wkp+e0hCB7e2NvdW50fX0g5bm0JwogICAgICAgICAgfSwKICAgICAgICAgIHhZZWFyczogewogICAgICAgICAgICBvbmU6ICcxIOW5tCcsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IOW5tCcKICAgICAgICAgIH0sCiAgICAgICAgICBvdmVyWFllYXJzOiB7CiAgICAgICAgICAgIG9uZTogJ+i2hemBjiAxIOW5tCcsCiAgICAgICAgICAgIG90aGVyOiAn6LaF6YGOIHt7Y291bnR9fSDlubQnCiAgICAgICAgICB9LAogICAgICAgICAgYWxtb3N0WFllYXJzOiB7CiAgICAgICAgICAgIG9uZTogJ+Wwh+i/kSAxIOW5tCcsCiAgICAgICAgICAgIG90aGVyOiAn5bCH6L+RIHt7Y291bnR9fSDlubQnCiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gbG9jYWxpemUodG9rZW4sIGNvdW50LCBvcHRpb25zKSB7CiAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICAgIHZhciByZXN1bHQ7CgogICAgICAgICAgaWYgKHR5cGVvZiBkaXN0YW5jZUluV29yZHNMb2NhbGVbdG9rZW5dID09PSAnc3RyaW5nJykgewogICAgICAgICAgICByZXN1bHQgPSBkaXN0YW5jZUluV29yZHNMb2NhbGVbdG9rZW5dOwogICAgICAgICAgfSBlbHNlIGlmIChjb3VudCA9PT0gMSkgewogICAgICAgICAgICByZXN1bHQgPSBkaXN0YW5jZUluV29yZHNMb2NhbGVbdG9rZW5dLm9uZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZVt0b2tlbl0ub3RoZXIucmVwbGFjZSgne3tjb3VudH19JywgY291bnQpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChvcHRpb25zLmFkZFN1ZmZpeCkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5jb21wYXJpc29uID4gMCkgewogICAgICAgICAgICAgIHJldHVybiByZXN1bHQgKyAn5YWnJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0ICsgJ+WJjSc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGxvY2FsaXplOiBsb2NhbGl6ZQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gYnVpbGREaXN0YW5jZUluV29yZHNMb2NhbGU7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjE0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgZnVuY3Rpb24gYnVpbGREaXN0YW5jZUluV29yZHNMb2NhbGUoKSB7CiAgICAgICAgdmFyIGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZSA9IHsKICAgICAgICAgIGxlc3NUaGFuWFNlY29uZHM6IHsKICAgICAgICAgICAgb25lOiAnbWVub3MgZGUgdW4gc2VndW5kbycsCiAgICAgICAgICAgIG90aGVyOiAnbWVub3MgZGUge3tjb3VudH19IHNlZ3VuZG9zJwogICAgICAgICAgfSwKICAgICAgICAgIHhTZWNvbmRzOiB7CiAgICAgICAgICAgIG9uZTogJzEgc2VndW5kbycsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IHNlZ3VuZG9zJwogICAgICAgICAgfSwKICAgICAgICAgIGhhbGZBTWludXRlOiAnbWVkaW8gbWludXRvJywKICAgICAgICAgIGxlc3NUaGFuWE1pbnV0ZXM6IHsKICAgICAgICAgICAgb25lOiAnbWVub3MgZGUgdW4gbWludXRvJywKICAgICAgICAgICAgb3RoZXI6ICdtZW5vcyBkZSB7e2NvdW50fX0gbWludXRvcycKICAgICAgICAgIH0sCiAgICAgICAgICB4TWludXRlczogewogICAgICAgICAgICBvbmU6ICcxIG1pbnV0bycsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IG1pbnV0b3MnCiAgICAgICAgICB9LAogICAgICAgICAgYWJvdXRYSG91cnM6IHsKICAgICAgICAgICAgb25lOiAnYWxyZWRlZG9yIGRlIDEgaG9yYScsCiAgICAgICAgICAgIG90aGVyOiAnYWxyZWRlZG9yIGRlIHt7Y291bnR9fSBob3JhcycKICAgICAgICAgIH0sCiAgICAgICAgICB4SG91cnM6IHsKICAgICAgICAgICAgb25lOiAnMSBob3JhJywKICAgICAgICAgICAgb3RoZXI6ICd7e2NvdW50fX0gaG9yYXMnCiAgICAgICAgICB9LAogICAgICAgICAgeERheXM6IHsKICAgICAgICAgICAgb25lOiAnMSBkw61hJywKICAgICAgICAgICAgb3RoZXI6ICd7e2NvdW50fX0gZMOtYXMnCiAgICAgICAgICB9LAogICAgICAgICAgYWJvdXRYTW9udGhzOiB7CiAgICAgICAgICAgIG9uZTogJ2FscmVkZWRvciBkZSAxIG1lcycsCiAgICAgICAgICAgIG90aGVyOiAnYWxyZWRlZG9yIGRlIHt7Y291bnR9fSBtZXNlcycKICAgICAgICAgIH0sCiAgICAgICAgICB4TW9udGhzOiB7CiAgICAgICAgICAgIG9uZTogJzEgbWVzJywKICAgICAgICAgICAgb3RoZXI6ICd7e2NvdW50fX0gbWVzZXMnCiAgICAgICAgICB9LAogICAgICAgICAgYWJvdXRYWWVhcnM6IHsKICAgICAgICAgICAgb25lOiAnYWxyZWRlZG9yIGRlIDEgYcOxbycsCiAgICAgICAgICAgIG90aGVyOiAnYWxyZWRlZG9yIGRlIHt7Y291bnR9fSBhw7FvcycKICAgICAgICAgIH0sCiAgICAgICAgICB4WWVhcnM6IHsKICAgICAgICAgICAgb25lOiAnMSBhw7FvJywKICAgICAgICAgICAgb3RoZXI6ICd7e2NvdW50fX0gYcOxb3MnCiAgICAgICAgICB9LAogICAgICAgICAgb3ZlclhZZWFyczogewogICAgICAgICAgICBvbmU6ICdtw6FzIGRlIDEgYcOxbycsCiAgICAgICAgICAgIG90aGVyOiAnbcOhcyBkZSB7e2NvdW50fX0gYcOxb3MnCiAgICAgICAgICB9LAogICAgICAgICAgYWxtb3N0WFllYXJzOiB7CiAgICAgICAgICAgIG9uZTogJ2Nhc2kgMSBhw7FvJywKICAgICAgICAgICAgb3RoZXI6ICdjYXNpIHt7Y291bnR9fSBhw7FvcycKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBsb2NhbGl6ZSh0b2tlbiwgY291bnQsIG9wdGlvbnMpIHsKICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgdmFyIHJlc3VsdDsKCiAgICAgICAgICBpZiAodHlwZW9mIGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZVt0b2tlbl0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZVt0b2tlbl07CiAgICAgICAgICB9IGVsc2UgaWYgKGNvdW50ID09PSAxKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IGRpc3RhbmNlSW5Xb3Jkc0xvY2FsZVt0b2tlbl0ub25lOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gZGlzdGFuY2VJbldvcmRzTG9jYWxlW3Rva2VuXS5vdGhlci5yZXBsYWNlKCd7e2NvdW50fX0nLCBjb3VudCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9wdGlvbnMuYWRkU3VmZml4KSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmNvbXBhcmlzb24gPiAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuICdlbiAnICsgcmVzdWx0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiAnaGFjZSAnICsgcmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsb2NhbGl6ZTogbG9jYWxpemUKICAgICAgICB9OwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGJ1aWxkRGlzdGFuY2VJbldvcmRzTG9jYWxlOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDIxNSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIGZ1bmN0aW9uIGJ1aWxkRGlzdGFuY2VJbldvcmRzTG9jYWxlKCkgewogICAgICAgIHZhciBkaXN0YW5jZUluV29yZHNMb2NhbGUgPSB7CiAgICAgICAgICBsZXNzVGhhblhTZWNvbmRzOiB7CiAgICAgICAgICAgIG9uZTogJ21vaW5zIGTigJl1bmUgc2Vjb25kZScsCiAgICAgICAgICAgIG90aGVyOiAnbW9pbnMgZGUge3tjb3VudH19IHNlY29uZGVzJwogICAgICAgICAgfSwKICAgICAgICAgIHhTZWNvbmRzOiB7CiAgICAgICAgICAgIG9uZTogJzEgc2Vjb25kZScsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IHNlY29uZGVzJwogICAgICAgICAgfSwKICAgICAgICAgIGhhbGZBTWludXRlOiAnMzAgc2Vjb25kZXMnLAogICAgICAgICAgbGVzc1RoYW5YTWludXRlczogewogICAgICAgICAgICBvbmU6ICdtb2lucyBk4oCZdW5lIG1pbnV0ZScsCiAgICAgICAgICAgIG90aGVyOiAnbW9pbnMgZGUge3tjb3VudH19IG1pbnV0ZXMnCiAgICAgICAgICB9LAogICAgICAgICAgeE1pbnV0ZXM6IHsKICAgICAgICAgICAgb25lOiAnMSBtaW51dGUnLAogICAgICAgICAgICBvdGhlcjogJ3t7Y291bnR9fSBtaW51dGVzJwogICAgICAgICAgfSwKICAgICAgICAgIGFib3V0WEhvdXJzOiB7CiAgICAgICAgICAgIG9uZTogJ2Vudmlyb24gMSBoZXVyZScsCiAgICAgICAgICAgIG90aGVyOiAnZW52aXJvbiB7e2NvdW50fX0gaGV1cmVzJwogICAgICAgICAgfSwKICAgICAgICAgIHhIb3VyczogewogICAgICAgICAgICBvbmU6ICcxIGhldXJlJywKICAgICAgICAgICAgb3RoZXI6ICd7e2NvdW50fX0gaGV1cmVzJwogICAgICAgICAgfSwKICAgICAgICAgIHhEYXlzOiB7CiAgICAgICAgICAgIG9uZTogJzEgam91cicsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IGpvdXJzJwogICAgICAgICAgfSwKICAgICAgICAgIGFib3V0WE1vbnRoczogewogICAgICAgICAgICBvbmU6ICdlbnZpcm9uIDEgbW9pcycsCiAgICAgICAgICAgIG90aGVyOiAnZW52aXJvbiB7e2NvdW50fX0gbW9pcycKICAgICAgICAgIH0sCiAgICAgICAgICB4TW9udGhzOiB7CiAgICAgICAgICAgIG9uZTogJzEgbW9pcycsCiAgICAgICAgICAgIG90aGVyOiAne3tjb3VudH19IG1vaXMnCiAgICAgICAgICB9LAogICAgICAgICAgYWJvdXRYWWVhcnM6IHsKICAgICAgICAgICAgb25lOiAnZW52aXJvbiAxIGFuJywKICAgICAgICAgICAgb3RoZXI6ICdlbnZpcm9uIHt7Y291bnR9fSBhbnMnCiAgICAgICAgICB9LAogICAgICAgICAgeFllYXJzOiB7CiAgICAgICAgICAgIG9uZTogJzEgYW4nLAogICAgICAgICAgICBvdGhlcjogJ3t7Y291bnR9fSBhbnMnCiAgICAgICAgICB9LAogICAgICAgICAgb3ZlclhZZWFyczogewogICAgICAgICAgICBvbmU6ICdwbHVzIGTigJl1biBhbicsCiAgICAgICAgICAgIG90aGVyOiAncGx1cyBkZSB7e2NvdW50fX0gYW5zJwogICAgICAgICAgfSwKICAgICAgICAgIGFsbW9zdFhZZWFyczogewogICAgICAgICAgICBvbmU6ICdwcmVzcXXigJl1biBhbicsCiAgICAgICAgICAgIG90aGVyOiAncHJlc3F1ZSB7e2NvdW50fX0gYW5zJwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGxvY2FsaXplKHRva2VuLCBjb3VudCwgb3B0aW9ucykgewogICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICAgICB2YXIgcmVzdWx0OwoKICAgICAgICAgIGlmICh0eXBlb2YgZGlzdGFuY2VJbldvcmRzTG9jYWxlW3Rva2VuXSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgcmVzdWx0ID0gZGlzdGFuY2VJbldvcmRzTG9jYWxlW3Rva2VuXTsKICAgICAgICAgIH0gZWxzZSBpZiAoY291bnQgPT09IDEpIHsKICAgICAgICAgICAgcmVzdWx0ID0gZGlzdGFuY2VJbldvcmRzTG9jYWxlW3Rva2VuXS5vbmU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSBkaXN0YW5jZUluV29yZHNMb2NhbGVbdG9rZW5dLm90aGVyLnJlcGxhY2UoJ3t7Y291bnR9fScsIGNvdW50KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAob3B0aW9ucy5hZGRTdWZmaXgpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuY29tcGFyaXNvbiA+IDApIHsKICAgICAgICAgICAgICByZXR1cm4gJ2RhbnMgJyArIHJlc3VsdDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gJ2lsIHkgYSAnICsgcmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsb2NhbGl6ZTogbG9jYWxpemUKICAgICAgICB9OwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGJ1aWxkRGlzdGFuY2VJbldvcmRzTG9jYWxlOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDIxNiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIGZ1bmN0aW9uIGRlY2xlbnNpb24oc2NoZW1lLCBjb3VudCkgewogICAgICAgIC8vIHNjaGVtZSBmb3IgY291bnQ9MSBleGlzdHMKICAgICAgICBpZiAoc2NoZW1lLm9uZSAhPT0gdW5kZWZpbmVkICYmIGNvdW50ID09PSAxKSB7CiAgICAgICAgICByZXR1cm4gc2NoZW1lLm9uZTsKICAgICAgICB9CgogICAgICAgIHZhciByZW0xMCA9IGNvdW50ICUgMTA7CiAgICAgICAgdmFyIHJlbTEwMCA9IGNvdW50ICUgMTAwOyAvLyAxLCAyMSwgMzEsIC4uLgoKICAgICAgICBpZiAocmVtMTAgPT09IDEgJiYgcmVtMTAwICE9PSAxMSkgewogICAgICAgICAgcmV0dXJuIHNjaGVtZS5zaW5ndWxhck5vbWluYXRpdmUucmVwbGFjZSgne3tjb3VudH19JywgY291bnQpOyAvLyAyLCAzLCA0LCAyMiwgMjMsIDI0LCAzMiAuLi4KICAgICAgICB9IGVsc2UgaWYgKHJlbTEwID49IDIgJiYgcmVtMTAgPD0gNCAmJiAocmVtMTAwIDwgMTAgfHwgcmVtMTAwID4gMjApKSB7CiAgICAgICAgICByZXR1cm4gc2NoZW1lLnNpbmd1bGFyR2VuaXRpdmUucmVwbGFjZSgne3tjb3VudH19JywgY291bnQpOyAvLyA1LCA2LCA3LCA4LCA5LCAxMCwgMTEsIC4uLgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gc2NoZW1lLnBsdXJhbEdlbml0aXZlLnJlcGxhY2UoJ3t7Y291bnR9fScsIGNvdW50KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGJ1aWxkTG9jYWxpemVUb2tlbkZuKHNjaGVtZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoY291bnQsIG9wdGlvbnMpIHsKICAgICAgICAgIGlmIChvcHRpb25zLmFkZFN1ZmZpeCkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5jb21wYXJpc29uID4gMCkgewogICAgICAgICAgICAgIGlmIChzY2hlbWUuZnV0dXJlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGVjbGVuc2lvbihzY2hlbWUuZnV0dXJlLCBjb3VudCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAn0YfQtdGA0LXQtyAnICsgZGVjbGVuc2lvbihzY2hlbWUucmVndWxhciwgY291bnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoc2NoZW1lLnBhc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkZWNsZW5zaW9uKHNjaGVtZS5wYXN0LCBjb3VudCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBkZWNsZW5zaW9uKHNjaGVtZS5yZWd1bGFyLCBjb3VudCkgKyAnINC90LDQt9Cw0LQnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGRlY2xlbnNpb24oc2NoZW1lLnJlZ3VsYXIsIGNvdW50KTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBidWlsZERpc3RhbmNlSW5Xb3Jkc0xvY2FsZSgpIHsKICAgICAgICB2YXIgZGlzdGFuY2VJbldvcmRzTG9jYWxlID0gewogICAgICAgICAgbGVzc1RoYW5YU2Vjb25kczogYnVpbGRMb2NhbGl6ZVRva2VuRm4oewogICAgICAgICAgICByZWd1bGFyOiB7CiAgICAgICAgICAgICAgb25lOiAn0LzQtdC90YzRiNC1INGB0LXQutGD0L3QtNGLJywKICAgICAgICAgICAgICBzaW5ndWxhck5vbWluYXRpdmU6ICfQvNC10L3RjNGI0LUge3tjb3VudH19INGB0LXQutGD0L3QtNGLJywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAn0LzQtdC90YzRiNC1IHt7Y291bnR9fSDRgdC10LrRg9C90LQnLAogICAgICAgICAgICAgIHBsdXJhbEdlbml0aXZlOiAn0LzQtdC90YzRiNC1IHt7Y291bnR9fSDRgdC10LrRg9C90LQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZ1dHVyZTogewogICAgICAgICAgICAgIG9uZTogJ9C80LXQvdGM0YjQtSwg0YfQtdC8INGH0LXRgNC10Lcg0YHQtdC60YPQvdC00YMnLAogICAgICAgICAgICAgIHNpbmd1bGFyTm9taW5hdGl2ZTogJ9C80LXQvdGM0YjQtSwg0YfQtdC8INGH0LXRgNC10Lcge3tjb3VudH19INGB0LXQutGD0L3QtNGDJywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAn0LzQtdC90YzRiNC1LCDRh9C10Lwg0YfQtdGA0LXQtyB7e2NvdW50fX0g0YHQtdC60YPQvdC00YsnLAogICAgICAgICAgICAgIHBsdXJhbEdlbml0aXZlOiAn0LzQtdC90YzRiNC1LCDRh9C10Lwg0YfQtdGA0LXQtyB7e2NvdW50fX0g0YHQtdC60YPQvdC0JwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIHhTZWNvbmRzOiBidWlsZExvY2FsaXplVG9rZW5Gbih7CiAgICAgICAgICAgIHJlZ3VsYXI6IHsKICAgICAgICAgICAgICBzaW5ndWxhck5vbWluYXRpdmU6ICd7e2NvdW50fX0g0YHQtdC60YPQvdC00LAnLAogICAgICAgICAgICAgIHNpbmd1bGFyR2VuaXRpdmU6ICd7e2NvdW50fX0g0YHQtdC60YPQvdC00YsnLAogICAgICAgICAgICAgIHBsdXJhbEdlbml0aXZlOiAne3tjb3VudH19INGB0LXQutGD0L3QtCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcGFzdDogewogICAgICAgICAgICAgIHNpbmd1bGFyTm9taW5hdGl2ZTogJ3t7Y291bnR9fSDRgdC10LrRg9C90LTRgyDQvdCw0LfQsNC0JywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAne3tjb3VudH19INGB0LXQutGD0L3QtNGLINC90LDQt9Cw0LQnLAogICAgICAgICAgICAgIHBsdXJhbEdlbml0aXZlOiAne3tjb3VudH19INGB0LXQutGD0L3QtCDQvdCw0LfQsNC0JwogICAgICAgICAgICB9LAogICAgICAgICAgICBmdXR1cmU6IHsKICAgICAgICAgICAgICBzaW5ndWxhck5vbWluYXRpdmU6ICfRh9C10YDQtdC3IHt7Y291bnR9fSDRgdC10LrRg9C90LTRgycsCiAgICAgICAgICAgICAgc2luZ3VsYXJHZW5pdGl2ZTogJ9GH0LXRgNC10Lcge3tjb3VudH19INGB0LXQutGD0L3QtNGLJywKICAgICAgICAgICAgICBwbHVyYWxHZW5pdGl2ZTogJ9GH0LXRgNC10Lcge3tjb3VudH19INGB0LXQutGD0L3QtCcKICAgICAgICAgICAgfQogICAgICAgICAgfSksCiAgICAgICAgICBoYWxmQU1pbnV0ZTogZnVuY3Rpb24gaGFsZkFNaW51dGUoXywgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucy5hZGRTdWZmaXgpIHsKICAgICAgICAgICAgICBpZiAob3B0aW9ucy5jb21wYXJpc29uID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuICfRh9C10YDQtdC3INC/0L7Qu9C80LjQvdGD0YLRiyc7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAn0L/QvtC70LzQuNC90YPRgtGLINC90LDQt9Cw0LQnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICfQv9C+0LvQvNC40L3Rg9GC0YsnOwogICAgICAgICAgfSwKICAgICAgICAgIGxlc3NUaGFuWE1pbnV0ZXM6IGJ1aWxkTG9jYWxpemVUb2tlbkZuKHsKICAgICAgICAgICAgcmVndWxhcjogewogICAgICAgICAgICAgIG9uZTogJ9C80LXQvdGM0YjQtSDQvNC40L3Rg9GC0YsnLAogICAgICAgICAgICAgIHNpbmd1bGFyTm9taW5hdGl2ZTogJ9C80LXQvdGM0YjQtSB7e2NvdW50fX0g0LzQuNC90YPRgtGLJywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAn0LzQtdC90YzRiNC1IHt7Y291bnR9fSDQvNC40L3Rg9GCJywKICAgICAgICAgICAgICBwbHVyYWxHZW5pdGl2ZTogJ9C80LXQvdGM0YjQtSB7e2NvdW50fX0g0LzQuNC90YPRgicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnV0dXJlOiB7CiAgICAgICAgICAgICAgb25lOiAn0LzQtdC90YzRiNC1LCDRh9C10Lwg0YfQtdGA0LXQtyDQvNC40L3Rg9GC0YMnLAogICAgICAgICAgICAgIHNpbmd1bGFyTm9taW5hdGl2ZTogJ9C80LXQvdGM0YjQtSwg0YfQtdC8INGH0LXRgNC10Lcge3tjb3VudH19INC80LjQvdGD0YLRgycsCiAgICAgICAgICAgICAgc2luZ3VsYXJHZW5pdGl2ZTogJ9C80LXQvdGM0YjQtSwg0YfQtdC8INGH0LXRgNC10Lcge3tjb3VudH19INC80LjQvdGD0YLRiycsCiAgICAgICAgICAgICAgcGx1cmFsR2VuaXRpdmU6ICfQvNC10L3RjNGI0LUsINGH0LXQvCDRh9C10YDQtdC3IHt7Y291bnR9fSDQvNC40L3Rg9GCJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIHhNaW51dGVzOiBidWlsZExvY2FsaXplVG9rZW5Gbih7CiAgICAgICAgICAgIHJlZ3VsYXI6IHsKICAgICAgICAgICAgICBzaW5ndWxhck5vbWluYXRpdmU6ICd7e2NvdW50fX0g0LzQuNC90YPRgtCwJywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAne3tjb3VudH19INC80LjQvdGD0YLRiycsCiAgICAgICAgICAgICAgcGx1cmFsR2VuaXRpdmU6ICd7e2NvdW50fX0g0LzQuNC90YPRgicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcGFzdDogewogICAgICAgICAgICAgIHNpbmd1bGFyTm9taW5hdGl2ZTogJ3t7Y291bnR9fSDQvNC40L3Rg9GC0YMg0L3QsNC30LDQtCcsCiAgICAgICAgICAgICAgc2luZ3VsYXJHZW5pdGl2ZTogJ3t7Y291bnR9fSDQvNC40L3Rg9GC0Ysg0L3QsNC30LDQtCcsCiAgICAgICAgICAgICAgcGx1cmFsR2VuaXRpdmU6ICd7e2NvdW50fX0g0LzQuNC90YPRgiDQvdCw0LfQsNC0JwogICAgICAgICAgICB9LAogICAgICAgICAgICBmdXR1cmU6IHsKICAgICAgICAgICAgICBzaW5ndWxhck5vbWluYXRpdmU6ICfRh9C10YDQtdC3IHt7Y291bnR9fSDQvNC40L3Rg9GC0YMnLAogICAgICAgICAgICAgIHNpbmd1bGFyR2VuaXRpdmU6ICfRh9C10YDQtdC3IHt7Y291bnR9fSDQvNC40L3Rg9GC0YsnLAogICAgICAgICAgICAgIHBsdXJhbEdlbml0aXZlOiAn0YfQtdGA0LXQtyB7e2NvdW50fX0g0LzQuNC90YPRgicKICAgICAgICAgICAgfQogICAgICAgICAgfSksCiAgICAgICAgICBhYm91dFhIb3VyczogYnVpbGRMb2NhbGl6ZVRva2VuRm4oewogICAgICAgICAgICByZWd1bGFyOiB7CiAgICAgICAgICAgICAgc2luZ3VsYXJOb21pbmF0aXZlOiAn0L7QutC+0LvQviB7e2NvdW50fX0g0YfQsNGB0LAnLAogICAgICAgICAgICAgIHNpbmd1bGFyR2VuaXRpdmU6ICfQvtC60L7Qu9C+IHt7Y291bnR9fSDRh9Cw0YHQvtCyJywKICAgICAgICAgICAgICBwbHVyYWxHZW5pdGl2ZTogJ9C+0LrQvtC70L4ge3tjb3VudH19INGH0LDRgdC+0LInCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZ1dHVyZTogewogICAgICAgICAgICAgIHNpbmd1bGFyTm9taW5hdGl2ZTogJ9C/0YDQuNCx0LvQuNC30LjRgtC10LvRjNC90L4g0YfQtdGA0LXQtyB7e2NvdW50fX0g0YfQsNGBJywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAn0L/RgNC40LHQu9C40LfQuNGC0LXQu9GM0L3QviDRh9C10YDQtdC3IHt7Y291bnR9fSDRh9Cw0YHQsCcsCiAgICAgICAgICAgICAgcGx1cmFsR2VuaXRpdmU6ICfQv9GA0LjQsdC70LjQt9C40YLQtdC70YzQvdC+INGH0LXRgNC10Lcge3tjb3VudH19INGH0LDRgdC+0LInCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLAogICAgICAgICAgeEhvdXJzOiBidWlsZExvY2FsaXplVG9rZW5Gbih7CiAgICAgICAgICAgIHJlZ3VsYXI6IHsKICAgICAgICAgICAgICBzaW5ndWxhck5vbWluYXRpdmU6ICd7e2NvdW50fX0g0YfQsNGBJywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAne3tjb3VudH19INGH0LDRgdCwJywKICAgICAgICAgICAgICBwbHVyYWxHZW5pdGl2ZTogJ3t7Y291bnR9fSDRh9Cw0YHQvtCyJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIHhEYXlzOiBidWlsZExvY2FsaXplVG9rZW5Gbih7CiAgICAgICAgICAgIHJlZ3VsYXI6IHsKICAgICAgICAgICAgICBzaW5ndWxhck5vbWluYXRpdmU6ICd7e2NvdW50fX0g0LTQtdC90YwnLAogICAgICAgICAgICAgIHNpbmd1bGFyR2VuaXRpdmU6ICd7e2NvdW50fX0g0LTQvdGPJywKICAgICAgICAgICAgICBwbHVyYWxHZW5pdGl2ZTogJ3t7Y291bnR9fSDQtNC90LXQuScKICAgICAgICAgICAgfQogICAgICAgICAgfSksCiAgICAgICAgICBhYm91dFhNb250aHM6IGJ1aWxkTG9jYWxpemVUb2tlbkZuKHsKICAgICAgICAgICAgcmVndWxhcjogewogICAgICAgICAgICAgIHNpbmd1bGFyTm9taW5hdGl2ZTogJ9C+0LrQvtC70L4ge3tjb3VudH19INC80LXRgdGP0YbQsCcsCiAgICAgICAgICAgICAgc2luZ3VsYXJHZW5pdGl2ZTogJ9C+0LrQvtC70L4ge3tjb3VudH19INC80LXRgdGP0YbQtdCyJywKICAgICAgICAgICAgICBwbHVyYWxHZW5pdGl2ZTogJ9C+0LrQvtC70L4ge3tjb3VudH19INC80LXRgdGP0YbQtdCyJwogICAgICAgICAgICB9LAogICAgICAgICAgICBmdXR1cmU6IHsKICAgICAgICAgICAgICBzaW5ndWxhck5vbWluYXRpdmU6ICfQv9GA0LjQsdC70LjQt9C40YLQtdC70YzQvdC+INGH0LXRgNC10Lcge3tjb3VudH19INC80LXRgdGP0YYnLAogICAgICAgICAgICAgIHNpbmd1bGFyR2VuaXRpdmU6ICfQv9GA0LjQsdC70LjQt9C40YLQtdC70YzQvdC+INGH0LXRgNC10Lcge3tjb3VudH19INC80LXRgdGP0YbQsCcsCiAgICAgICAgICAgICAgcGx1cmFsR2VuaXRpdmU6ICfQv9GA0LjQsdC70LjQt9C40YLQtdC70YzQvdC+INGH0LXRgNC10Lcge3tjb3VudH19INC80LXRgdGP0YbQtdCyJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIHhNb250aHM6IGJ1aWxkTG9jYWxpemVUb2tlbkZuKHsKICAgICAgICAgICAgcmVndWxhcjogewogICAgICAgICAgICAgIHNpbmd1bGFyTm9taW5hdGl2ZTogJ3t7Y291bnR9fSDQvNC10YHRj9GGJywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAne3tjb3VudH19INC80LXRgdGP0YbQsCcsCiAgICAgICAgICAgICAgcGx1cmFsR2VuaXRpdmU6ICd7e2NvdW50fX0g0LzQtdGB0Y/RhtC10LInCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLAogICAgICAgICAgYWJvdXRYWWVhcnM6IGJ1aWxkTG9jYWxpemVUb2tlbkZuKHsKICAgICAgICAgICAgcmVndWxhcjogewogICAgICAgICAgICAgIHNpbmd1bGFyTm9taW5hdGl2ZTogJ9C+0LrQvtC70L4ge3tjb3VudH19INCz0L7QtNCwJywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAn0L7QutC+0LvQviB7e2NvdW50fX0g0LvQtdGCJywKICAgICAgICAgICAgICBwbHVyYWxHZW5pdGl2ZTogJ9C+0LrQvtC70L4ge3tjb3VudH19INC70LXRgicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnV0dXJlOiB7CiAgICAgICAgICAgICAgc2luZ3VsYXJOb21pbmF0aXZlOiAn0L/RgNC40LHQu9C40LfQuNGC0LXQu9GM0L3QviDRh9C10YDQtdC3IHt7Y291bnR9fSDQs9C+0LQnLAogICAgICAgICAgICAgIHNpbmd1bGFyR2VuaXRpdmU6ICfQv9GA0LjQsdC70LjQt9C40YLQtdC70YzQvdC+INGH0LXRgNC10Lcge3tjb3VudH19INCz0L7QtNCwJywKICAgICAgICAgICAgICBwbHVyYWxHZW5pdGl2ZTogJ9C/0YDQuNCx0LvQuNC30LjRgtC10LvRjNC90L4g0YfQtdGA0LXQtyB7e2NvdW50fX0g0LvQtdGCJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIHhZZWFyczogYnVpbGRMb2NhbGl6ZVRva2VuRm4oewogICAgICAgICAgICByZWd1bGFyOiB7CiAgICAgICAgICAgICAgc2luZ3VsYXJOb21pbmF0aXZlOiAne3tjb3VudH19INCz0L7QtCcsCiAgICAgICAgICAgICAgc2luZ3VsYXJHZW5pdGl2ZTogJ3t7Y291bnR9fSDQs9C+0LTQsCcsCiAgICAgICAgICAgICAgcGx1cmFsR2VuaXRpdmU6ICd7e2NvdW50fX0g0LvQtdGCJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIG92ZXJYWWVhcnM6IGJ1aWxkTG9jYWxpemVUb2tlbkZuKHsKICAgICAgICAgICAgcmVndWxhcjogewogICAgICAgICAgICAgIHNpbmd1bGFyTm9taW5hdGl2ZTogJ9Cx0L7Qu9GM0YjQtSB7e2NvdW50fX0g0LPQvtC00LAnLAogICAgICAgICAgICAgIHNpbmd1bGFyR2VuaXRpdmU6ICfQsdC+0LvRjNGI0LUge3tjb3VudH19INC70LXRgicsCiAgICAgICAgICAgICAgcGx1cmFsR2VuaXRpdmU6ICfQsdC+0LvRjNGI0LUge3tjb3VudH19INC70LXRgicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnV0dXJlOiB7CiAgICAgICAgICAgICAgc2luZ3VsYXJOb21pbmF0aXZlOiAn0LHQvtC70YzRiNC1LCDRh9C10Lwg0YfQtdGA0LXQtyB7e2NvdW50fX0g0LPQvtC0JywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAn0LHQvtC70YzRiNC1LCDRh9C10Lwg0YfQtdGA0LXQtyB7e2NvdW50fX0g0LPQvtC00LAnLAogICAgICAgICAgICAgIHBsdXJhbEdlbml0aXZlOiAn0LHQvtC70YzRiNC1LCDRh9C10Lwg0YfQtdGA0LXQtyB7e2NvdW50fX0g0LvQtdGCJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIGFsbW9zdFhZZWFyczogYnVpbGRMb2NhbGl6ZVRva2VuRm4oewogICAgICAgICAgICByZWd1bGFyOiB7CiAgICAgICAgICAgICAgc2luZ3VsYXJOb21pbmF0aXZlOiAn0L/QvtGH0YLQuCB7e2NvdW50fX0g0LPQvtC0JywKICAgICAgICAgICAgICBzaW5ndWxhckdlbml0aXZlOiAn0L/QvtGH0YLQuCB7e2NvdW50fX0g0LPQvtC00LAnLAogICAgICAgICAgICAgIHBsdXJhbEdlbml0aXZlOiAn0L/QvtGH0YLQuCB7e2NvdW50fX0g0LvQtdGCJwogICAgICAgICAgICB9LAogICAgICAgICAgICBmdXR1cmU6IHsKICAgICAgICAgICAgICBzaW5ndWxhck5vbWluYXRpdmU6ICfQv9C+0YfRgtC4INGH0LXRgNC10Lcge3tjb3VudH19INCz0L7QtCcsCiAgICAgICAgICAgICAgc2luZ3VsYXJHZW5pdGl2ZTogJ9C/0L7Rh9GC0Lgg0YfQtdGA0LXQtyB7e2NvdW50fX0g0LPQvtC00LAnLAogICAgICAgICAgICAgIHBsdXJhbEdlbml0aXZlOiAn0L/QvtGH0YLQuCDRh9C10YDQtdC3IHt7Y291bnR9fSDQu9C10YInCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gbG9jYWxpemUodG9rZW4sIGNvdW50LCBvcHRpb25zKSB7CiAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICAgIHJldHVybiBkaXN0YW5jZUluV29yZHNMb2NhbGVbdG9rZW5dKGNvdW50LCBvcHRpb25zKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsb2NhbGl6ZTogbG9jYWxpemUKICAgICAgICB9OwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGJ1aWxkRGlzdGFuY2VJbldvcmRzTG9jYWxlOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDIxNyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7Ly8gcmVtb3ZlZCBieSBleHRyYWN0LXRleHQtd2VicGFjay1wbHVnaW4KCiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjE4ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwogICAgICB2YXIgR1RfQUNDRVNTX1RPS0VOID0gZXhwb3J0cy5HVF9BQ0NFU1NfVE9LRU4gPSAnR1RfQUNDRVNTX1RPS0VOJzsKICAgICAgdmFyIEdUX1ZFUlNJT04gPSBleHBvcnRzLkdUX1ZFUlNJT04gPSAiMS42LjIiOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lCgogICAgICB2YXIgR1RfQ09NTUVOVCA9IGV4cG9ydHMuR1RfQ09NTUVOVCA9ICdHVF9DT01NRU5UJzsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAyMTkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CgogICAgICB2YXIgX3RvQ29uc3VtYWJsZUFycmF5MiA9IF9fd2VicGFja19yZXF1aXJlX18oMjIwKTsKCiAgICAgIHZhciBfdG9Db25zdW1hYmxlQXJyYXkzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdG9Db25zdW1hYmxlQXJyYXkyKTsKCiAgICAgIHZhciBfdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oNzEpOwoKICAgICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICAgICAgICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgICAgICAgImRlZmF1bHQiOiBvYmoKICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgZ2V0UUwgPSBmdW5jdGlvbiBnZXRRTCh2YXJzLCBwYWdlckRpcmVjdGlvbikgewogICAgICAgIHZhciBjdXJzb3JEaXJlY3Rpb24gPSBwYWdlckRpcmVjdGlvbiA9PT0gJ2xhc3QnID8gJ2JlZm9yZScgOiAnYWZ0ZXInOwogICAgICAgIHZhciBxbCA9ICdcbiAgcXVlcnkgZ2V0SXNzdWVBbmRDb21tZW50cyhcbiAgICAkb3duZXI6IFN0cmluZyEsXG4gICAgJHJlcG86IFN0cmluZyEsXG4gICAgJGlkOiBJbnQhLFxuICAgICRjdXJzb3I6IFN0cmluZyxcbiAgICAkcGFnZVNpemU6IEludCFcbiAgKSB7XG4gICAgcmVwb3NpdG9yeShvd25lcjogJG93bmVyLCBuYW1lOiAkcmVwbykge1xuICAgICAgaXNzdWUobnVtYmVyOiAkaWQpIHtcbiAgICAgICAgdGl0bGVcbiAgICAgICAgdXJsXG4gICAgICAgIGJvZHlIVE1MXG4gICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICBjb21tZW50cygnICsgcGFnZXJEaXJlY3Rpb24gKyAnOiAkcGFnZVNpemUsICcgKyBjdXJzb3JEaXJlY3Rpb24gKyAnOiAkY3Vyc29yKSB7XG4gICAgICAgICAgdG90YWxDb3VudFxuICAgICAgICAgIHBhZ2VJbmZvIHtcbiAgICAgICAgICAgICcgKyAocGFnZXJEaXJlY3Rpb24gPT09ICdsYXN0JyA/ICdoYXNQcmV2aW91c1BhZ2UnIDogJ2hhc05leHRQYWdlJykgKyAnXG4gICAgICAgICAgICAnICsgKGN1cnNvckRpcmVjdGlvbiA9PT0gJ2JlZm9yZScgPyAnc3RhcnRDdXJzb3InIDogJ2VuZEN1cnNvcicpICsgJ1xuICAgICAgICAgIH1cbiAgICAgICAgICBub2RlcyB7XG4gICAgICAgICAgICBpZFxuICAgICAgICAgICAgZGF0YWJhc2VJZFxuICAgICAgICAgICAgYXV0aG9yIHtcbiAgICAgICAgICAgICAgYXZhdGFyVXJsXG4gICAgICAgICAgICAgIGxvZ2luXG4gICAgICAgICAgICAgIHVybFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYm9keUhUTUxcbiAgICAgICAgICAgIGJvZHlcbiAgICAgICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICAgICAgcmVhY3Rpb25zKGZpcnN0OiAxMDAsIGNvbnRlbnQ6IEhFQVJUKSB7XG4gICAgICAgICAgICAgIHRvdGFsQ291bnRcbiAgICAgICAgICAgICAgdmlld2VySGFzUmVhY3RlZFxuICAgICAgICAgICAgICBwYWdlSW5mb3tcbiAgICAgICAgICAgICAgICBoYXNOZXh0UGFnZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIG5vZGVzIHtcbiAgICAgICAgICAgICAgICBpZFxuICAgICAgICAgICAgICAgIGRhdGFiYXNlSWRcbiAgICAgICAgICAgICAgICB1c2VyIHtcbiAgICAgICAgICAgICAgICAgIGxvZ2luXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gICc7CiAgICAgICAgaWYgKHZhcnMuY3Vyc29yID09PSBudWxsKSBkZWxldGUgdmFycy5jdXJzb3I7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG9wZXJhdGlvbk5hbWU6ICdnZXRJc3N1ZUFuZENvbW1lbnRzJywKICAgICAgICAgIHF1ZXJ5OiBxbCwKICAgICAgICAgIHZhcmlhYmxlczogdmFycwogICAgICAgIH07CiAgICAgIH07CgogICAgICBmdW5jdGlvbiBnZXRDb21tZW50cyhpc3N1ZSkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHZhciBfb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgb3duZXIgPSBfb3B0aW9ucy5vd25lciwKICAgICAgICAgICAgcmVwbyA9IF9vcHRpb25zLnJlcG8sCiAgICAgICAgICAgIHBlclBhZ2UgPSBfb3B0aW9ucy5wZXJQYWdlLAogICAgICAgICAgICBwYWdlckRpcmVjdGlvbiA9IF9vcHRpb25zLnBhZ2VyRGlyZWN0aW9uLAogICAgICAgICAgICBkZWZhdWx0QXV0aG9yID0gX29wdGlvbnMuZGVmYXVsdEF1dGhvcjsKICAgICAgICB2YXIgX3N0YXRlID0gdGhpcy5zdGF0ZSwKICAgICAgICAgICAgY3Vyc29yID0gX3N0YXRlLmN1cnNvciwKICAgICAgICAgICAgY29tbWVudHMgPSBfc3RhdGUuY29tbWVudHM7CiAgICAgICAgcmV0dXJuIF91dGlsLmF4aW9zR2l0aHViLnBvc3QoJy9ncmFwaHFsJywgZ2V0UUwoewogICAgICAgICAgb3duZXI6IG93bmVyLAogICAgICAgICAgcmVwbzogcmVwbywKICAgICAgICAgIGlkOiBpc3N1ZS5udW1iZXIsCiAgICAgICAgICBwYWdlU2l6ZTogcGVyUGFnZSwKICAgICAgICAgIGN1cnNvcjogY3Vyc29yCiAgICAgICAgfSwgcGFnZXJEaXJlY3Rpb24pLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdiZWFyZXIgJyArIHRoaXMuYWNjZXNzVG9rZW4KICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIHZhciBkYXRhID0gcmVzLmRhdGEuZGF0YS5yZXBvc2l0b3J5Lmlzc3VlLmNvbW1lbnRzOwogICAgICAgICAgdmFyIGl0ZW1zID0gZGF0YS5ub2Rlcy5tYXAoZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgICAgdmFyIGF1dGhvciA9IG5vZGUuYXV0aG9yIHx8IGRlZmF1bHRBdXRob3I7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgaWQ6IG5vZGUuZGF0YWJhc2VJZCwKICAgICAgICAgICAgICBnSWQ6IG5vZGUuaWQsCiAgICAgICAgICAgICAgdXNlcjogewogICAgICAgICAgICAgICAgYXZhdGFyX3VybDogYXV0aG9yLmF2YXRhclVybCwKICAgICAgICAgICAgICAgIGxvZ2luOiBhdXRob3IubG9naW4sCiAgICAgICAgICAgICAgICBodG1sX3VybDogYXV0aG9yLnVybAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgY3JlYXRlZF9hdDogbm9kZS5jcmVhdGVkQXQsCiAgICAgICAgICAgICAgYm9keV9odG1sOiBub2RlLmJvZHlIVE1MLAogICAgICAgICAgICAgIGJvZHk6IG5vZGUuYm9keSwKICAgICAgICAgICAgICBodG1sX3VybDogJ2h0dHBzOi8vZ2l0aHViLmNvbS8nICsgb3duZXIgKyAnLycgKyByZXBvICsgJy9pc3N1ZXMvJyArIGlzc3VlLm51bWJlciArICcjaXNzdWVjb21tZW50LScgKyBub2RlLmRhdGFiYXNlSWQsCiAgICAgICAgICAgICAgcmVhY3Rpb25zOiBub2RlLnJlYWN0aW9ucwogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgY3MgPSB2b2lkIDA7CgogICAgICAgICAgaWYgKHBhZ2VyRGlyZWN0aW9uID09PSAnbGFzdCcpIHsKICAgICAgICAgICAgY3MgPSBbXS5jb25jYXQoKDAsIF90b0NvbnN1bWFibGVBcnJheTNbImRlZmF1bHQiXSkoaXRlbXMpLCAoMCwgX3RvQ29uc3VtYWJsZUFycmF5M1siZGVmYXVsdCJdKShjb21tZW50cykpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3MgPSBbXS5jb25jYXQoKDAsIF90b0NvbnN1bWFibGVBcnJheTNbImRlZmF1bHQiXSkoY29tbWVudHMpLCAoMCwgX3RvQ29uc3VtYWJsZUFycmF5M1siZGVmYXVsdCJdKShpdGVtcykpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpc0xvYWRPdmVyID0gZGF0YS5wYWdlSW5mby5oYXNQcmV2aW91c1BhZ2UgPT09IGZhbHNlIHx8IGRhdGEucGFnZUluZm8uaGFzTmV4dFBhZ2UgPT09IGZhbHNlOwoKICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgY29tbWVudHM6IGNzLAogICAgICAgICAgICBpc0xvYWRPdmVyOiBpc0xvYWRPdmVyLAogICAgICAgICAgICBjdXJzb3I6IGRhdGEucGFnZUluZm8uc3RhcnRDdXJzb3IgfHwgZGF0YS5wYWdlSW5mby5lbmRDdXJzb3IKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiBjczsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gZ2V0Q29tbWVudHM7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjIwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCiAgICAgIHZhciBfZnJvbSA9IF9fd2VicGFja19yZXF1aXJlX18oMjIxKTsKCiAgICAgIHZhciBfZnJvbTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9mcm9tKTsKCiAgICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgICAgICAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgICAgICAgICJkZWZhdWx0Ijogb2JqCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gZnVuY3Rpb24gKGFycikgewogICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gYXJyMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuICgwLCBfZnJvbTJbImRlZmF1bHQiXSkoYXJyKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDIyMSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgICJkZWZhdWx0IjogX193ZWJwYWNrX3JlcXVpcmVfXygyMjIpLAogICAgICAgIF9fZXNNb2R1bGU6IHRydWUKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAyMjIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwKTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMjIzKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKS5BcnJheS5mcm9tOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDIyMyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKTsKCiAgICAgIHZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTsKCiAgICAgIHZhciB0b09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTcpOwoKICAgICAgdmFyIGNhbGwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU3KTsKCiAgICAgIHZhciBpc0FycmF5SXRlciA9IF9fd2VicGFja19yZXF1aXJlX18oNTgpOwoKICAgICAgdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNyk7CgogICAgICB2YXIgY3JlYXRlUHJvcGVydHkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIyNCk7CgogICAgICB2YXIgZ2V0SXRlckZuID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Mik7CgogICAgICAkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFfX3dlYnBhY2tfcmVxdWlyZV9fKDYzKShmdW5jdGlvbiAoaXRlcikgewogICAgICAgIEFycmF5LmZyb20oaXRlcik7CiAgICAgIH0pLCAnQXJyYXknLCB7CiAgICAgICAgLy8gMjIuMS4yLjEgQXJyYXkuZnJvbShhcnJheUxpa2UsIG1hcGZuID0gdW5kZWZpbmVkLCB0aGlzQXJnID0gdW5kZWZpbmVkKQogICAgICAgIGZyb206IGZ1bmN0aW9uIGZyb20oYXJyYXlMaWtlCiAgICAgICAgLyogLCBtYXBmbiA9IHVuZGVmaW5lZCwgdGhpc0FyZyA9IHVuZGVmaW5lZCAqLwogICAgICAgICkgewogICAgICAgICAgdmFyIE8gPSB0b09iamVjdChhcnJheUxpa2UpOwogICAgICAgICAgdmFyIEMgPSB0eXBlb2YgdGhpcyA9PSAnZnVuY3Rpb24nID8gdGhpcyA6IEFycmF5OwogICAgICAgICAgdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICAgICAgdmFyIG1hcGZuID0gYUxlbiA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgbWFwcGluZyA9IG1hcGZuICE9PSB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgICAgdmFyIGl0ZXJGbiA9IGdldEl0ZXJGbihPKTsKICAgICAgICAgIHZhciBsZW5ndGgsIHJlc3VsdCwgc3RlcCwgaXRlcmF0b3I7CiAgICAgICAgICBpZiAobWFwcGluZykgbWFwZm4gPSBjdHgobWFwZm4sIGFMZW4gPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkLCAyKTsgLy8gaWYgb2JqZWN0IGlzbid0IGl0ZXJhYmxlIG9yIGl0J3MgYXJyYXkgd2l0aCBkZWZhdWx0IGl0ZXJhdG9yIC0gdXNlIHNpbXBsZSBjYXNlCgogICAgICAgICAgaWYgKGl0ZXJGbiAhPSB1bmRlZmluZWQgJiYgIShDID09IEFycmF5ICYmIGlzQXJyYXlJdGVyKGl0ZXJGbikpKSB7CiAgICAgICAgICAgIGZvciAoaXRlcmF0b3IgPSBpdGVyRm4uY2FsbChPKSwgcmVzdWx0ID0gbmV3IEMoKTsgIShzdGVwID0gaXRlcmF0b3IubmV4dCgpKS5kb25lOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgY3JlYXRlUHJvcGVydHkocmVzdWx0LCBpbmRleCwgbWFwcGluZyA/IGNhbGwoaXRlcmF0b3IsIG1hcGZuLCBbc3RlcC52YWx1ZSwgaW5kZXhdLCB0cnVlKSA6IHN0ZXAudmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7CgogICAgICAgICAgICBmb3IgKHJlc3VsdCA9IG5ldyBDKGxlbmd0aCk7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgY3JlYXRlUHJvcGVydHkocmVzdWx0LCBpbmRleCwgbWFwcGluZyA/IG1hcGZuKE9baW5kZXhdLCBpbmRleCkgOiBPW2luZGV4XSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXN1bHQubGVuZ3RoID0gaW5kZXg7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjI0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgdmFyICRkZWZpbmVQcm9wZXJ0eSA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7CgogICAgICB2YXIgY3JlYXRlRGVzYyA9IF9fd2VicGFja19yZXF1aXJlX18oMTkpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqZWN0LCBpbmRleCwgdmFsdWUpIHsKICAgICAgICBpZiAoaW5kZXggaW4gb2JqZWN0KSAkZGVmaW5lUHJvcGVydHkuZihvYmplY3QsIGluZGV4LCBjcmVhdGVEZXNjKDAsIHZhbHVlKSk7ZWxzZSBvYmplY3RbaW5kZXhdID0gdmFsdWU7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfQogICAgLyoqKioqKi8KICAgIF0pCiAgKTsKfSk7"},null]}